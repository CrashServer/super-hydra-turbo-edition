(function(){const b=document.createElement("link").relList;if(b&&b.supports&&b.supports("modulepreload"))return;for(const S of document.querySelectorAll('link[rel="modulepreload"]'))m(S);new MutationObserver(S=>{for(const I of S)if(I.type==="childList")for(const ae of I.addedNodes)ae.tagName==="LINK"&&ae.rel==="modulepreload"&&m(ae)}).observe(document,{childList:!0,subtree:!0});function d(S){const I={};return S.integrity&&(I.integrity=S.integrity),S.referrerPolicy&&(I.referrerPolicy=S.referrerPolicy),S.crossOrigin==="use-credentials"?I.credentials="include":S.crossOrigin==="anonymous"?I.credentials="omit":I.credentials="same-origin",I}function m(S){if(S.ep)return;S.ep=!0;const I=d(S);fetch(S.href,I)}})();function getDefaultExportFromCjs(T){return T&&T.__esModule&&Object.prototype.hasOwnProperty.call(T,"default")?T.default:T}var codemirror$1={exports:{}},codemirror=codemirror$1.exports,hasRequiredCodemirror;function requireCodemirror(){return hasRequiredCodemirror||(hasRequiredCodemirror=1,function(T,b){(function(d,m){T.exports=m()})(codemirror,function(){var d=navigator.userAgent,m=navigator.platform,S=/gecko\/\d/i.test(d),I=/MSIE \d/.test(d),ae=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(d),Q=/Edge\/(\d+)/.exec(d),he=I||ae||Q,ee=he&&(I?document.documentMode||6:+(Q||ae)[1]),j=!Q&&/WebKit\//.test(d),se=j&&/Qt\/\d+\.\d+/.test(d),G=!Q&&/Chrome\/(\d+)/.exec(d),fe=G&&+G[1],ve=/Opera\//.test(d),Ge=/Apple Computer/.test(navigator.vendor),qe=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(d),q=/PhantomJS/.test(d),A=Ge&&(/Mobile\/\w+/.test(d)||navigator.maxTouchPoints>2),U=/Android/.test(d),h=A||U||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(d),_=A||/Mac/.test(m),D=/\bCrOS\b/.test(d),W=/win/i.test(m),ie=ve&&d.match(/Version\/(\d*\.\d*)/);ie&&(ie=Number(ie[1])),ie&&ie>=15&&(ve=!1,j=!0);var me=_&&(se||ve&&(ie==null||ie<12.11)),Te=S||he&&ee>=9;function ke(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}var We=function(e,t){var r=e.className,n=ke(t).exec(r);if(n){var i=r.slice(n.index+n[0].length);e.className=r.slice(0,n.index)+(i?n[1]+i:"")}};function C(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function E(e,t){return C(e).appendChild(t)}function p(e,t,r,n){var i=document.createElement(e);if(r&&(i.className=r),n&&(i.style.cssText=n),typeof t=="string")i.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)i.appendChild(t[o]);return i}function Z(e,t,r,n){var i=p(e,t,r,n);return i.setAttribute("role","presentation"),i}var be;document.createRange?be=function(e,t,r,n){var i=document.createRange();return i.setEnd(n||e,r),i.setStart(e,t),i}:be=function(e,t,r){var n=document.body.createTextRange();try{n.moveToElementText(e.parentNode)}catch{return n}return n.collapse(!0),n.moveEnd("character",r),n.moveStart("character",t),n};function Pe(e,t){if(t.nodeType==3&&(t=t.parentNode),e.contains)return e.contains(t);do if(t.nodeType==11&&(t=t.host),t==e)return!0;while(t=t.parentNode)}function $e(e){var t=e.ownerDocument||e,r;try{r=e.activeElement}catch{r=t.body||null}for(;r&&r.shadowRoot&&r.shadowRoot.activeElement;)r=r.shadowRoot.activeElement;return r}function Ve(e,t){var r=e.className;ke(t).test(r)||(e.className+=(r?" ":"")+t)}function Ke(e,t){for(var r=e.split(" "),n=0;n<r.length;n++)r[n]&&!ke(r[n]).test(t)&&(t+=" "+r[n]);return t}var Je=function(e){e.select()};A?Je=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:he&&(Je=function(e){try{e.select()}catch{}});function at(e){return e.display.wrapper.ownerDocument}function Rt(e){return st(e.display.wrapper)}function st(e){return e.getRootNode?e.getRootNode():e.ownerDocument}function ft(e){return at(e).defaultView}function tt(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function pt(e,t,r){t||(t={});for(var n in e)e.hasOwnProperty(n)&&(r!==!1||!t.hasOwnProperty(n))&&(t[n]=e[n]);return t}function Ct(e,t,r,n,i){t==null&&(t=e.search(/[^\s\u00a0]/),t==-1&&(t=e.length));for(var o=n||0,s=i||0;;){var l=e.indexOf("	",o);if(l<0||l>=t)return s+(t-o);s+=l-o,s+=r-s%r,o=l+1}}var Ht=function(){this.id=null,this.f=null,this.time=0,this.handler=tt(this.onTimeout,this)};Ht.prototype.onTimeout=function(e){e.id=0,e.time<=+new Date?e.f():setTimeout(e.handler,e.time-+new Date)},Ht.prototype.set=function(e,t){this.f=t;var r=+new Date+e;(!this.id||r<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,e),this.time=r)};function ut(e,t){for(var r=0;r<e.length;++r)if(e[r]==t)return r;return-1}var Mt=50,Vt={toString:function(){return"CodeMirror.Pass"}},ar={scroll:!1},Sr={origin:"*mouse"},fr={origin:"+move"};function $t(e,t,r){for(var n=0,i=0;;){var o=e.indexOf("	",n);o==-1&&(o=e.length);var s=o-n;if(o==e.length||i+s>=t)return n+Math.min(s,t-i);if(i+=o-n,i+=r-i%r,n=o+1,i>=t)return n}}var Pt=[""];function nn(e){for(;Pt.length<=e;)Pt.push(_t(Pt)+" ");return Pt[e]}function _t(e){return e[e.length-1]}function ri(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=t(e[n],n);return r}function qo(e,t,r){for(var n=0,i=r(t);n<e.length&&r(e[n])<=i;)n++;e.splice(n,0,t)}function M(){}function Za(e,t){var r;return Object.create?r=Object.create(e):(M.prototype=e,r=new M),t&&pt(t,r),r}var Uo=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function fa(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||Uo.test(e))}function an(e,t){return t?t.source.indexOf("\\w")>-1&&fa(e)?!0:t.test(e):fa(e)}function Yr(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}var Kr=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function jt(e){return e.charCodeAt(0)>=768&&Kr.test(e)}function on(e,t,r){for(;(r<0?t>0:t<e.length)&&jt(e.charAt(t));)t+=r;return t}function Vr(e,t,r){for(var n=t>r?-1:1;;){if(t==r)return t;var i=(t+r)/2,o=n<0?Math.ceil(i):Math.floor(i);if(o==t)return e(o)?t:r;e(o)?r=o:t=o+n}}function Mn(e,t,r,n){if(!e)return n(t,r,"ltr",0);for(var i=!1,o=0;o<e.length;++o){var s=e[o];(s.from<r&&s.to>t||t==r&&s.to==t)&&(n(Math.max(s.from,t),Math.min(s.to,r),s.level==1?"rtl":"ltr",o),i=!0)}i||n(t,r,"ltr")}var Fn=null;function nr(e,t,r){var n;Fn=null;for(var i=0;i<e.length;++i){var o=e[i];if(o.from<t&&o.to>t)return i;o.to==t&&(o.from!=o.to&&r=="before"?n=i:Fn=i),o.from==t&&(o.from!=o.to&&r!="before"?n=i:Fn=i)}return n??Fn}var ca=function(){var e="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",t="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function r(c){return c<=247?e.charAt(c):1424<=c&&c<=1524?"R":1536<=c&&c<=1785?t.charAt(c-1536):1774<=c&&c<=2220?"r":8192<=c&&c<=8203?"w":c==8204?"b":"L"}var n=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,i=/[stwN]/,o=/[LRr]/,s=/[Lb1n]/,l=/[1n]/;function u(c,y,R){this.level=c,this.from=y,this.to=R}return function(c,y){var R=y=="ltr"?"L":"R";if(c.length==0||y=="ltr"&&!n.test(c))return!1;for(var B=c.length,O=[],H=0;H<B;++H)O.push(r(c.charCodeAt(H)));for(var ce=0,we=R;ce<B;++ce){var ge=O[ce];ge=="m"?O[ce]=we:we=ge}for(var Oe=0,Ee=R;Oe<B;++Oe){var Me=O[Oe];Me=="1"&&Ee=="r"?O[Oe]="n":o.test(Me)&&(Ee=Me,Me=="r"&&(O[Oe]="R"))}for(var Ye=1,Ze=O[0];Ye<B-1;++Ye){var ct=O[Ye];ct=="+"&&Ze=="1"&&O[Ye+1]=="1"?O[Ye]="1":ct==","&&Ze==O[Ye+1]&&(Ze=="1"||Ze=="n")&&(O[Ye]=Ze),Ze=ct}for(var rt=0;rt<B;++rt){var kt=O[rt];if(kt==",")O[rt]="N";else if(kt=="%"){var yt=void 0;for(yt=rt+1;yt<B&&O[yt]=="%";++yt);for(var Ft=rt&&O[rt-1]=="!"||yt<B&&O[yt]=="1"?"1":"N",It=rt;It<yt;++It)O[It]=Ft;rt=yt-1}}for(var Et=0,Gt=R;Et<B;++Et){var Nt=O[Et];Gt=="L"&&Nt=="1"?O[Et]="L":o.test(Nt)&&(Gt=Nt)}for(var Tt=0;Tt<B;++Tt)if(i.test(O[Tt])){var nt=void 0;for(nt=Tt+1;nt<B&&i.test(O[nt]);++nt);for(var Lt=(Tt?O[Tt-1]:R)=="L",St=(nt<B?O[nt]:R)=="L",ot=Lt==St?Lt?"L":"R":R,mt=Tt;mt<nt;++mt)O[mt]=ot;Tt=nt-1}for(var vt=[],Wt,Xt=0;Xt<B;)if(s.test(O[Xt])){var Rn=Xt;for(++Xt;Xt<B&&s.test(O[Xt]);++Xt);vt.push(new u(0,Rn,Xt))}else{var P=Xt,de=vt.length,le=y=="rtl"?1:0;for(++Xt;Xt<B&&O[Xt]!="L";++Xt);for(var je=P;je<Xt;)if(l.test(O[je])){P<je&&(vt.splice(de,0,new u(1,P,je)),de+=le);var bt=je;for(++je;je<Xt&&l.test(O[je]);++je);vt.splice(de,0,new u(2,bt,je)),de+=le,P=je}else++je;P<Xt&&vt.splice(de,0,new u(1,P,Xt))}return y=="ltr"&&(vt[0].level==1&&(Wt=c.match(/^\s+/))&&(vt[0].from=Wt[0].length,vt.unshift(new u(0,0,Wt[0].length))),_t(vt).level==1&&(Wt=c.match(/\s+$/))&&(_t(vt).to-=Wt[0].length,vt.push(new u(0,B-Wt[0].length,B)))),y=="rtl"?vt.reverse():vt}}();function At(e,t){var r=e.order;return r==null&&(r=e.order=ca(e.text,t)),r}var Ja=[],ht=function(e,t,r){if(e.addEventListener)e.addEventListener(t,r,!1);else if(e.attachEvent)e.attachEvent("on"+t,r);else{var n=e._handlers||(e._handlers={});n[t]=(n[t]||Ja).concat(r)}};function sn(e,t){return e._handlers&&e._handlers[t]||Ja}function cr(e,t,r){if(e.removeEventListener)e.removeEventListener(t,r,!1);else if(e.detachEvent)e.detachEvent("on"+t,r);else{var n=e._handlers,i=n&&n[t];if(i){var o=ut(i,r);o>-1&&(n[t]=i.slice(0,o).concat(i.slice(o+1)))}}}function Qt(e,t){var r=sn(e,t);if(r.length)for(var n=Array.prototype.slice.call(arguments,2),i=0;i<r.length;++i)r[i].apply(null,n)}function Kt(e,t,r){return typeof t=="string"&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),Qt(e,r||t.type,e,t),gr(t)||t.codemirrorIgnore}function _r(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var r=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),n=0;n<t.length;++n)ut(r,t[n])==-1&&r.push(t[n])}function wr(e,t){return sn(e,t).length>0}function Pr(e){e.prototype.on=function(t,r){ht(this,t,r)},e.prototype.off=function(t,r){cr(this,t,r)}}function qt(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function _i(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function gr(e){return e.defaultPrevented!=null?e.defaultPrevented:e.returnValue==!1}function In(e){qt(e),_i(e)}function da(e){return e.target||e.srcElement}function Br(e){var t=e.which;return t==null&&(e.button&1?t=1:e.button&2?t=3:e.button&4&&(t=2)),_&&e.ctrlKey&&t==1&&(t=3),t}var Xo=function(){if(he&&ee<9)return!1;var e=p("div");return"draggable"in e||"dragDrop"in e}(),Ei;function eo(e){if(Ei==null){var t=p("span","​");E(e,p("span",[t,document.createTextNode("x")])),e.firstChild.offsetHeight!=0&&(Ei=t.offsetWidth<=1&&t.offsetHeight>2&&!(he&&ee<8))}var r=Ei?p("span","​"):p("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return r.setAttribute("cm-text",""),r}var Li;function ln(e){if(Li!=null)return Li;var t=E(e,document.createTextNode("AخA")),r=be(t,0,1).getBoundingClientRect(),n=be(t,1,2).getBoundingClientRect();return C(e),!r||r.left==r.right?!1:Li=n.right-r.right<3}var Bt=`

b`.split(/\n/).length!=3?function(e){for(var t=0,r=[],n=e.length;t<=n;){var i=e.indexOf(`
`,t);i==-1&&(i=e.length);var o=e.slice(t,e.charAt(i-1)=="\r"?i-1:i),s=o.indexOf("\r");s!=-1?(r.push(o.slice(0,s)),t+=s+1):(r.push(o),t=i+1)}return r}:function(e){return e.split(/\r\n?|\n/)},Nn=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch{return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch{}return!t||t.parentElement()!=e?!1:t.compareEndPoints("StartToEnd",t)!=0},to=function(){var e=p("div");return"oncopy"in e?!0:(e.setAttribute("oncopy","return;"),typeof e.oncopy=="function")}(),Dr=null;function jo(e){if(Dr!=null)return Dr;var t=E(e,p("span","x")),r=t.getBoundingClientRect(),n=be(t,0,1).getBoundingClientRect();return Dr=Math.abs(r.left-n.left)>1}var Ai={},Gr={};function Hr(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),Ai[e]=t}function ni(e,t){Gr[e]=t}function ki(e){if(typeof e=="string"&&Gr.hasOwnProperty(e))e=Gr[e];else if(e&&typeof e.name=="string"&&Gr.hasOwnProperty(e.name)){var t=Gr[e.name];typeof t=="string"&&(t={name:t}),e=Za(t,e),e.name=t.name}else{if(typeof e=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return ki("application/xml");if(typeof e=="string"&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return ki("application/json")}return typeof e=="string"?{name:e}:e||{name:"null"}}function Ri(e,t){t=ki(t);var r=Ai[t.name];if(!r)return Ri(e,"text/plain");var n=r(e,t);if(Pn.hasOwnProperty(t.name)){var i=Pn[t.name];for(var o in i)i.hasOwnProperty(o)&&(n.hasOwnProperty(o)&&(n["_"+o]=n[o]),n[o]=i[o])}if(n.name=t.name,t.helperType&&(n.helperType=t.helperType),t.modeProps)for(var s in t.modeProps)n[s]=t.modeProps[s];return n}var Pn={};function Oi(e,t){var r=Pn.hasOwnProperty(e)?Pn[e]:Pn[e]={};pt(t,r)}function $r(e,t){if(t===!0)return t;if(e.copyState)return e.copyState(t);var r={};for(var n in t){var i=t[n];i instanceof Array&&(i=i.concat([])),r[n]=i}return r}function ha(e,t){for(var r;e.innerMode&&(r=e.innerMode(t),!(!r||r.mode==e));)t=r.state,e=r.mode;return r||{mode:e,state:t}}function Mi(e,t,r){return e.startState?e.startState(t,r):!0}var Zt=function(e,t,r){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=r};Zt.prototype.eol=function(){return this.pos>=this.string.length},Zt.prototype.sol=function(){return this.pos==this.lineStart},Zt.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},Zt.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},Zt.prototype.eat=function(e){var t=this.string.charAt(this.pos),r;if(typeof e=="string"?r=t==e:r=t&&(e.test?e.test(t):e(t)),r)return++this.pos,t},Zt.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},Zt.prototype.eatSpace=function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},Zt.prototype.skipToEnd=function(){this.pos=this.string.length},Zt.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},Zt.prototype.backUp=function(e){this.pos-=e},Zt.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Ct(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?Ct(this.string,this.lineStart,this.tabSize):0)},Zt.prototype.indentation=function(){return Ct(this.string,null,this.tabSize)-(this.lineStart?Ct(this.string,this.lineStart,this.tabSize):0)},Zt.prototype.match=function(e,t,r){if(typeof e=="string"){var n=function(s){return r?s.toLowerCase():s},i=this.string.substr(this.pos,e.length);if(n(i)==n(e))return t!==!1&&(this.pos+=e.length),!0}else{var o=this.string.slice(this.pos).match(e);return o&&o.index>0?null:(o&&t!==!1&&(this.pos+=o[0].length),o)}},Zt.prototype.current=function(){return this.string.slice(this.start,this.pos)},Zt.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},Zt.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)},Zt.prototype.baseToken=function(){var e=this.lineOracle;return e&&e.baseToken(this.pos)};function lt(e,t){if(t-=e.first,t<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var r=e;!r.lines;)for(var n=0;;++n){var i=r.children[n],o=i.chunkSize();if(t<o){r=i;break}t-=o}return r.lines[t]}function un(e,t,r){var n=[],i=t.line;return e.iter(t.line,r.line+1,function(o){var s=o.text;i==r.line&&(s=s.slice(0,r.ch)),i==t.line&&(s=s.slice(t.ch)),n.push(s),++i}),n}function pa(e,t,r){var n=[];return e.iter(t,r,function(i){n.push(i.text)}),n}function Er(e,t){var r=t-e.height;if(r)for(var n=e;n;n=n.parent)n.height+=r}function v(e){if(e.parent==null)return null;for(var t=e.parent,r=ut(t.lines,e),n=t.parent;n;t=n,n=n.parent)for(var i=0;n.children[i]!=t;++i)r+=n.children[i].chunkSize();return r+t.first}function X(e,t){var r=e.first;e:do{for(var n=0;n<e.children.length;++n){var i=e.children[n],o=i.height;if(t<o){e=i;continue e}t-=o,r+=i.chunkSize()}return r}while(!e.lines);for(var s=0;s<e.lines.length;++s){var l=e.lines[s],u=l.height;if(t<u)break;t-=u}return r+s}function Re(e,t){return t>=e.first&&t<e.first+e.size}function Ue(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function xe(e,t,r){if(r===void 0&&(r=null),!(this instanceof xe))return new xe(e,t,r);this.line=e,this.ch=t,this.sticky=r}function Qe(e,t){return e.line-t.line||e.ch-t.ch}function zt(e,t){return e.sticky==t.sticky&&Qe(e,t)==0}function Jt(e){return xe(e.line,e.ch)}function hr(e,t){return Qe(e,t)<0?t:e}function Fi(e,t){return Qe(e,t)<0?e:t}function Ks(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function gt(e,t){if(t.line<e.first)return xe(e.first,0);var r=e.first+e.size-1;return t.line>r?xe(r,lt(e,r).text.length):Yo(t,lt(e,t.line).text.length)}function Yo(e,t){var r=e.ch;return r==null||r>t?xe(e.line,t):r<0?xe(e.line,0):e}function Ko(e,t){for(var r=[],n=0;n<t.length;n++)r[n]=gt(e,t[n]);return r}var Ii=function(e,t){this.state=e,this.lookAhead=t},Qr=function(e,t,r,n){this.state=t,this.doc=e,this.line=r,this.maxLookAhead=n||0,this.baseTokens=null,this.baseTokenPos=1};Qr.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);return t!=null&&e>this.maxLookAhead&&(this.maxLookAhead=e),t},Qr.prototype.baseToken=function(e){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=e;)this.baseTokenPos+=2;var t=this.baseTokens[this.baseTokenPos+1];return{type:t&&t.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-e}},Qr.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},Qr.fromSaved=function(e,t,r){return t instanceof Ii?new Qr(e,$r(e.mode,t.state),r,t.lookAhead):new Qr(e,$r(e.mode,t),r)},Qr.prototype.save=function(e){var t=e!==!1?$r(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new Ii(t,this.maxLookAhead):t};function Vs(e,t,r,n){var i=[e.state.modeGen],o={};$o(e,t.text,e.doc.mode,r,function(c,y){return i.push(c,y)},o,n);for(var s=r.state,l=function(c){r.baseTokens=i;var y=e.state.overlays[c],R=1,B=0;r.state=!0,$o(e,t.text,y.mode,r,function(O,H){for(var ce=R;B<O;){var we=i[R];we>O&&i.splice(R,1,O,i[R+1],we),R+=2,B=Math.min(O,we)}if(H)if(y.opaque)i.splice(ce,R-ce,O,"overlay "+H),R=ce+2;else for(;ce<R;ce+=2){var ge=i[ce+1];i[ce+1]=(ge?ge+" ":"")+"overlay "+H}},o),r.state=s,r.baseTokens=null,r.baseTokenPos=1},u=0;u<e.state.overlays.length;++u)l(u);return{styles:i,classes:o.bgClass||o.textClass?o:null}}function $s(e,t,r){if(!t.styles||t.styles[0]!=e.state.modeGen){var n=va(e,v(t)),i=t.text.length>e.options.maxHighlightLength&&$r(e.doc.mode,n.state),o=Vs(e,t,n);i&&(n.state=i),t.stateAfter=n.save(!i),t.styles=o.styles,o.classes?t.styleClasses=o.classes:t.styleClasses&&(t.styleClasses=null),r===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function va(e,t,r){var n=e.doc,i=e.display;if(!n.mode.startState)return new Qr(n,!0,t);var o=Jl(e,t,r),s=o>n.first&&lt(n,o-1).stateAfter,l=s?Qr.fromSaved(n,s,o):new Qr(n,Mi(n.mode),o);return n.iter(o,t,function(u){Lr(e,u.text,l);var c=l.line;u.stateAfter=c==t-1||c%5==0||c>=i.viewFrom&&c<i.viewTo?l.save():null,l.nextLine()}),r&&(n.modeFrontier=l.line),l}function Lr(e,t,r,n){var i=e.doc.mode,o=new Zt(t,e.options.tabSize,r);for(o.start=o.pos=n||0,t==""&&Tr(i,r.state);!o.eol();)Ni(i,o,r.state),o.start=o.pos}function Tr(e,t){if(e.blankLine)return e.blankLine(t);if(e.innerMode){var r=ha(e,t);if(r.mode.blankLine)return r.mode.blankLine(r.state)}}function Ni(e,t,r,n){for(var i=0;i<10;i++){n&&(n[0]=ha(e,r).mode);var o=e.token(t,r);if(t.pos>t.start)return o}throw new Error("Mode "+e.name+" failed to advance stream.")}var Qs=function(e,t,r){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=r};function Zs(e,t,r,n){var i=e.doc,o=i.mode,s;t=gt(i,t);var l=lt(i,t.line),u=va(e,t.line,r),c=new Zt(l.text,e.options.tabSize,u),y;for(n&&(y=[]);(n||c.pos<t.ch)&&!c.eol();)c.start=c.pos,s=Ni(o,c,u.state),n&&y.push(new Qs(c,s,$r(i.mode,u.state)));return n?y:new Qs(c,s,u.state)}function Vo(e,t){if(e)for(;;){var r=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!r)break;e=e.slice(0,r.index)+e.slice(r.index+r[0].length);var n=r[1]?"bgClass":"textClass";t[n]==null?t[n]=r[2]:new RegExp("(?:^|\\s)"+r[2]+"(?:$|\\s)").test(t[n])||(t[n]+=" "+r[2])}return e}function $o(e,t,r,n,i,o,s){var l=r.flattenSpans;l==null&&(l=e.options.flattenSpans);var u=0,c=null,y=new Zt(t,e.options.tabSize,n),R,B=e.options.addModeClass&&[null];for(t==""&&Vo(Tr(r,n.state),o);!y.eol();){if(y.pos>e.options.maxHighlightLength?(l=!1,s&&Lr(e,t,n,y.pos),y.pos=t.length,R=null):R=Vo(Ni(r,y,n.state,B),o),B){var O=B[0].name;O&&(R="m-"+(R?O+" "+R:O))}if(!l||c!=R){for(;u<y.start;)u=Math.min(y.start,u+5e3),i(u,c);c=R}y.start=y.pos}for(;u<y.pos;){var H=Math.min(y.pos,u+5e3);i(H,c),u=H}}function Jl(e,t,r){for(var n,i,o=e.doc,s=r?-1:t-(e.doc.mode.innerMode?1e3:100),l=t;l>s;--l){if(l<=o.first)return o.first;var u=lt(o,l-1),c=u.stateAfter;if(c&&(!r||l+(c instanceof Ii?c.lookAhead:0)<=o.modeFrontier))return l;var y=Ct(u.text,null,e.options.tabSize);(i==null||n>y)&&(i=l-1,n=y)}return i}function eu(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),!(e.highlightFrontier<t-10)){for(var r=e.first,n=t-1;n>r;n--){var i=lt(e,n).stateAfter;if(i&&(!(i instanceof Ii)||n+i.lookAhead<t)){r=n+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,r)}}var ro=!1,fn=!1;function tu(){ro=!0}function ru(){fn=!0}function no(e,t,r){this.marker=e,this.from=t,this.to=r}function ma(e,t){if(e)for(var r=0;r<e.length;++r){var n=e[r];if(n.marker==t)return n}}function nu(e,t){for(var r,n=0;n<e.length;++n)e[n]!=t&&(r||(r=[])).push(e[n]);return r}function iu(e,t,r){var n=r&&window.WeakSet&&(r.markedSpans||(r.markedSpans=new WeakSet));n&&e.markedSpans&&n.has(e.markedSpans)?e.markedSpans.push(t):(e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],n&&n.add(e.markedSpans)),t.marker.attachLine(e)}function au(e,t,r){var n;if(e)for(var i=0;i<e.length;++i){var o=e[i],s=o.marker,l=o.from==null||(s.inclusiveLeft?o.from<=t:o.from<t);if(l||o.from==t&&s.type=="bookmark"&&(!r||!o.marker.insertLeft)){var u=o.to==null||(s.inclusiveRight?o.to>=t:o.to>t);(n||(n=[])).push(new no(s,o.from,u?null:o.to))}}return n}function ii(e,t,r){var n;if(e)for(var i=0;i<e.length;++i){var o=e[i],s=o.marker,l=o.to==null||(s.inclusiveRight?o.to>=t:o.to>t);if(l||o.from==t&&s.type=="bookmark"&&(!r||o.marker.insertLeft)){var u=o.from==null||(s.inclusiveLeft?o.from<=t:o.from<t);(n||(n=[])).push(new no(s,u?null:o.from-t,o.to==null?null:o.to-t))}}return n}function Qo(e,t){if(t.full)return null;var r=Re(e,t.from.line)&&lt(e,t.from.line).markedSpans,n=Re(e,t.to.line)&&lt(e,t.to.line).markedSpans;if(!r&&!n)return null;var i=t.from.ch,o=t.to.ch,s=Qe(t.from,t.to)==0,l=au(r,i,s),u=ii(n,o,s),c=t.text.length==1,y=_t(t.text).length+(c?i:0);if(l)for(var R=0;R<l.length;++R){var B=l[R];if(B.to==null){var O=ma(u,B.marker);O?c&&(B.to=O.to==null?null:O.to+y):B.to=i}}if(u)for(var H=0;H<u.length;++H){var ce=u[H];if(ce.to!=null&&(ce.to+=y),ce.from==null){var we=ma(l,ce.marker);we||(ce.from=y,c&&(l||(l=[])).push(ce))}else ce.from+=y,c&&(l||(l=[])).push(ce)}l&&(l=Js(l)),u&&u!=l&&(u=Js(u));var ge=[l];if(!c){var Oe=t.text.length-2,Ee;if(Oe>0&&l)for(var Me=0;Me<l.length;++Me)l[Me].to==null&&(Ee||(Ee=[])).push(new no(l[Me].marker,null,null));for(var Ye=0;Ye<Oe;++Ye)ge.push(Ee);ge.push(u)}return ge}function Js(e){for(var t=0;t<e.length;++t){var r=e[t];r.from!=null&&r.from==r.to&&r.marker.clearWhenEmpty!==!1&&e.splice(t--,1)}return e.length?e:null}function io(e,t,r){var n=null;if(e.iter(t.line,r.line+1,function(O){if(O.markedSpans)for(var H=0;H<O.markedSpans.length;++H){var ce=O.markedSpans[H].marker;ce.readOnly&&(!n||ut(n,ce)==-1)&&(n||(n=[])).push(ce)}}),!n)return null;for(var i=[{from:t,to:r}],o=0;o<n.length;++o)for(var s=n[o],l=s.find(0),u=0;u<i.length;++u){var c=i[u];if(!(Qe(c.to,l.from)<0||Qe(c.from,l.to)>0)){var y=[u,1],R=Qe(c.from,l.from),B=Qe(c.to,l.to);(R<0||!s.inclusiveLeft&&!R)&&y.push({from:c.from,to:l.from}),(B>0||!s.inclusiveRight&&!B)&&y.push({from:l.to,to:c.to}),i.splice.apply(i,y),u+=y.length-3}}return i}function ao(e){var t=e.markedSpans;if(t){for(var r=0;r<t.length;++r)t[r].marker.detachLine(e);e.markedSpans=null}}function Zo(e,t){if(t){for(var r=0;r<t.length;++r)t[r].marker.attachLine(e);e.markedSpans=t}}function ga(e){return e.inclusiveLeft?-1:0}function oo(e){return e.inclusiveRight?1:0}function ya(e,t){var r=e.lines.length-t.lines.length;if(r!=0)return r;var n=e.find(),i=t.find(),o=Qe(n.from,i.from)||ga(e)-ga(t);if(o)return-o;var s=Qe(n.to,i.to)||oo(e)-oo(t);return s||t.id-e.id}function so(e,t){var r=fn&&e.markedSpans,n;if(r)for(var i=void 0,o=0;o<r.length;++o)i=r[o],i.marker.collapsed&&(t?i.from:i.to)==null&&(!n||ya(n,i.marker)<0)&&(n=i.marker);return n}function cn(e){return so(e,!0)}function ai(e){return so(e,!1)}function el(e,t){var r=fn&&e.markedSpans,n;if(r)for(var i=0;i<r.length;++i){var o=r[i];o.marker.collapsed&&(o.from==null||o.from<t)&&(o.to==null||o.to>t)&&(!n||ya(n,o.marker)<0)&&(n=o.marker)}return n}function Jo(e,t,r,n,i){var o=lt(e,t),s=fn&&o.markedSpans;if(s)for(var l=0;l<s.length;++l){var u=s[l];if(u.marker.collapsed){var c=u.marker.find(0),y=Qe(c.from,r)||ga(u.marker)-ga(i),R=Qe(c.to,n)||oo(u.marker)-oo(i);if(!(y>=0&&R<=0||y<=0&&R>=0)&&(y<=0&&(u.marker.inclusiveRight&&i.inclusiveLeft?Qe(c.to,r)>=0:Qe(c.to,r)>0)||y>=0&&(u.marker.inclusiveRight&&i.inclusiveLeft?Qe(c.from,n)<=0:Qe(c.from,n)<0)))return!0}}}function zr(e){for(var t;t=cn(e);)e=t.find(-1,!0).line;return e}function ou(e){for(var t;t=ai(e);)e=t.find(1,!0).line;return e}function su(e){for(var t,r;t=ai(e);)e=t.find(1,!0).line,(r||(r=[])).push(e);return r}function es(e,t){var r=lt(e,t),n=zr(r);return r==n?t:v(n)}function tl(e,t){if(t>e.lastLine())return t;var r=lt(e,t),n;if(!Bn(e,r))return t;for(;n=ai(r);)r=n.find(1,!0).line;return v(r)+1}function Bn(e,t){var r=fn&&t.markedSpans;if(r){for(var n=void 0,i=0;i<r.length;++i)if(n=r[i],!!n.marker.collapsed){if(n.from==null)return!0;if(!n.marker.widgetNode&&n.from==0&&n.marker.inclusiveLeft&&ts(e,t,n))return!0}}}function ts(e,t,r){if(r.to==null){var n=r.marker.find(1,!0);return ts(e,n.line,ma(n.line.markedSpans,r.marker))}if(r.marker.inclusiveRight&&r.to==t.text.length)return!0;for(var i=void 0,o=0;o<t.markedSpans.length;++o)if(i=t.markedSpans[o],i.marker.collapsed&&!i.marker.widgetNode&&i.from==r.to&&(i.to==null||i.to!=r.from)&&(i.marker.inclusiveLeft||r.marker.inclusiveRight)&&ts(e,t,i))return!0}function Cr(e){e=zr(e);for(var t=0,r=e.parent,n=0;n<r.lines.length;++n){var i=r.lines[n];if(i==e)break;t+=i.height}for(var o=r.parent;o;r=o,o=r.parent)for(var s=0;s<o.children.length;++s){var l=o.children[s];if(l==r)break;t+=l.height}return t}function lo(e){if(e.height==0)return 0;for(var t=e.text.length,r,n=e;r=cn(n);){var i=r.find(0,!0);n=i.from.line,t+=i.from.ch-i.to.ch}for(n=e;r=ai(n);){var o=r.find(0,!0);t-=n.text.length-o.from.ch,n=o.to.line,t+=n.text.length-o.to.ch}return t}function rs(e){var t=e.display,r=e.doc;t.maxLine=lt(r,r.first),t.maxLineLength=lo(t.maxLine),t.maxLineChanged=!0,r.iter(function(n){var i=lo(n);i>t.maxLineLength&&(t.maxLineLength=i,t.maxLine=n)})}var Zr=function(e,t,r){this.text=e,Zo(this,t),this.height=r?r(this):1};Zr.prototype.lineNo=function(){return v(this)},Pr(Zr);function lu(e,t,r,n){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),e.order!=null&&(e.order=null),ao(e),Zo(e,r);var i=n?n(e):1;i!=e.height&&Er(e,i)}function Pi(e){e.parent=null,ao(e)}var rl={},Bi={};function ns(e,t){if(!e||/^\s*$/.test(e))return null;var r=t.addModeClass?Bi:rl;return r[e]||(r[e]=e.replace(/\S+/g,"cm-$&"))}function Dn(e,t){var r=Z("span",null,null,j?"padding-right: .1px":null),n={pre:Z("pre",[r],"CodeMirror-line"),content:r,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:e.getOption("lineWrapping")};t.measure={};for(var i=0;i<=(t.rest?t.rest.length:0);i++){var o=i?t.rest[i-1]:t.line,s=void 0;n.pos=0,n.addToken=uu,ln(e.display.measure)&&(s=At(o,e.doc.direction))&&(n.addToken=cu(n.addToken,s)),n.map=[];var l=t!=e.display.externalMeasured&&v(o);du(o,n,$s(e,o,l)),o.styleClasses&&(o.styleClasses.bgClass&&(n.bgClass=Ke(o.styleClasses.bgClass,n.bgClass||"")),o.styleClasses.textClass&&(n.textClass=Ke(o.styleClasses.textClass,n.textClass||""))),n.map.length==0&&n.map.push(0,0,n.content.appendChild(eo(e.display.measure))),i==0?(t.measure.map=n.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(n.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(j){var u=n.content.lastChild;(/\bcm-tab\b/.test(u.className)||u.querySelector&&u.querySelector(".cm-tab"))&&(n.content.className="cm-tab-wrap-hack")}return Qt(e,"renderLine",e,t.line,n.pre),n.pre.className&&(n.textClass=Ke(n.pre.className,n.textClass||"")),n}function is(e){var t=p("span","•","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function uu(e,t,r,n,i,o,s){if(t){var l=e.splitSpaces?fu(t,e.trailingSpace):t,u=e.cm.state.specialChars,c=!1,y;if(!u.test(t))e.col+=t.length,y=document.createTextNode(l),e.map.push(e.pos,e.pos+t.length,y),he&&ee<9&&(c=!0),e.pos+=t.length;else{y=document.createDocumentFragment();for(var R=0;;){u.lastIndex=R;var B=u.exec(t),O=B?B.index-R:t.length-R;if(O){var H=document.createTextNode(l.slice(R,R+O));he&&ee<9?y.appendChild(p("span",[H])):y.appendChild(H),e.map.push(e.pos,e.pos+O,H),e.col+=O,e.pos+=O}if(!B)break;R+=O+1;var ce=void 0;if(B[0]=="	"){var we=e.cm.options.tabSize,ge=we-e.col%we;ce=y.appendChild(p("span",nn(ge),"cm-tab")),ce.setAttribute("role","presentation"),ce.setAttribute("cm-text","	"),e.col+=ge}else B[0]=="\r"||B[0]==`
`?(ce=y.appendChild(p("span",B[0]=="\r"?"␍":"␤","cm-invalidchar")),ce.setAttribute("cm-text",B[0]),e.col+=1):(ce=e.cm.options.specialCharPlaceholder(B[0]),ce.setAttribute("cm-text",B[0]),he&&ee<9?y.appendChild(p("span",[ce])):y.appendChild(ce),e.col+=1);e.map.push(e.pos,e.pos+1,ce),e.pos++}}if(e.trailingSpace=l.charCodeAt(t.length-1)==32,r||n||i||c||o||s){var Oe=r||"";n&&(Oe+=n),i&&(Oe+=i);var Ee=p("span",[y],Oe,o);if(s)for(var Me in s)s.hasOwnProperty(Me)&&Me!="style"&&Me!="class"&&Ee.setAttribute(Me,s[Me]);return e.content.appendChild(Ee)}e.content.appendChild(y)}}function fu(e,t){if(e.length>1&&!/  /.test(e))return e;for(var r=t,n="",i=0;i<e.length;i++){var o=e.charAt(i);o==" "&&r&&(i==e.length-1||e.charCodeAt(i+1)==32)&&(o=" "),n+=o,r=o==" "}return n}function cu(e,t){return function(r,n,i,o,s,l,u){i=i?i+" cm-force-border":"cm-force-border";for(var c=r.pos,y=c+n.length;;){for(var R=void 0,B=0;B<t.length&&(R=t[B],!(R.to>c&&R.from<=c));B++);if(R.to>=y)return e(r,n,i,o,s,l,u);e(r,n.slice(0,R.to-c),i,o,null,l,u),o=null,n=n.slice(R.to-c),c=R.to}}}function as(e,t,r,n){var i=!n&&r.widgetNode;i&&e.map.push(e.pos,e.pos+t,i),!n&&e.cm.display.input.needsContentAttribute&&(i||(i=e.content.appendChild(document.createElement("span"))),i.setAttribute("cm-marker",r.id)),i&&(e.cm.display.input.setUneditable(i),e.content.appendChild(i)),e.pos+=t,e.trailingSpace=!1}function du(e,t,r){var n=e.markedSpans,i=e.text,o=0;if(!n){for(var s=1;s<r.length;s+=2)t.addToken(t,i.slice(o,o=r[s]),ns(r[s+1],t.cm.options));return}for(var l=i.length,u=0,c=1,y="",R,B,O=0,H,ce,we,ge,Oe;;){if(O==u){H=ce=we=B="",Oe=null,ge=null,O=1/0;for(var Ee=[],Me=void 0,Ye=0;Ye<n.length;++Ye){var Ze=n[Ye],ct=Ze.marker;if(ct.type=="bookmark"&&Ze.from==u&&ct.widgetNode)Ee.push(ct);else if(Ze.from<=u&&(Ze.to==null||Ze.to>u||ct.collapsed&&Ze.to==u&&Ze.from==u)){if(Ze.to!=null&&Ze.to!=u&&O>Ze.to&&(O=Ze.to,ce=""),ct.className&&(H+=" "+ct.className),ct.css&&(B=(B?B+";":"")+ct.css),ct.startStyle&&Ze.from==u&&(we+=" "+ct.startStyle),ct.endStyle&&Ze.to==O&&(Me||(Me=[])).push(ct.endStyle,Ze.to),ct.title&&((Oe||(Oe={})).title=ct.title),ct.attributes)for(var rt in ct.attributes)(Oe||(Oe={}))[rt]=ct.attributes[rt];ct.collapsed&&(!ge||ya(ge.marker,ct)<0)&&(ge=Ze)}else Ze.from>u&&O>Ze.from&&(O=Ze.from)}if(Me)for(var kt=0;kt<Me.length;kt+=2)Me[kt+1]==O&&(ce+=" "+Me[kt]);if(!ge||ge.from==u)for(var yt=0;yt<Ee.length;++yt)as(t,0,Ee[yt]);if(ge&&(ge.from||0)==u){if(as(t,(ge.to==null?l+1:ge.to)-u,ge.marker,ge.from==null),ge.to==null)return;ge.to==u&&(ge=!1)}}if(u>=l)break;for(var Ft=Math.min(l,O);;){if(y){var It=u+y.length;if(!ge){var Et=It>Ft?y.slice(0,Ft-u):y;t.addToken(t,Et,R?R+H:H,we,u+Et.length==O?ce:"",B,Oe)}if(It>=Ft){y=y.slice(Ft-u),u=Ft;break}u=It,we=""}y=i.slice(o,o=r[c++]),R=ns(r[c++],t.cm.options)}}}function nl(e,t,r){this.line=t,this.rest=su(t),this.size=this.rest?v(_t(this.rest))-r+1:1,this.node=this.text=null,this.hidden=Bn(e,t)}function ba(e,t,r){for(var n=[],i,o=t;o<r;o=i){var s=new nl(e.doc,lt(e.doc,o),o);i=o+s.size,n.push(s)}return n}var Ut=null;function il(e){Ut?Ut.ops.push(e):e.ownsGroup=Ut={ops:[e],delayedCallbacks:[]}}function hu(e){var t=e.delayedCallbacks,r=0;do{for(;r<t.length;r++)t[r].call(null);for(var n=0;n<e.ops.length;n++){var i=e.ops[n];if(i.cursorActivityHandlers)for(;i.cursorActivityCalled<i.cursorActivityHandlers.length;)i.cursorActivityHandlers[i.cursorActivityCalled++].call(null,i.cm)}}while(r<t.length)}function Jr(e,t){var r=e.ownsGroup;if(r)try{hu(r)}finally{Ut=null,t(r)}}var oi=null;function er(e,t){var r=sn(e,t);if(r.length){var n=Array.prototype.slice.call(arguments,2),i;Ut?i=Ut.delayedCallbacks:oi?i=oi:(i=oi=[],setTimeout(si,0));for(var o=function(l){i.push(function(){return r[l].apply(null,n)})},s=0;s<r.length;++s)o(s)}}function si(){var e=oi;oi=null;for(var t=0;t<e.length;++t)e[t]()}function uo(e,t,r,n){for(var i=0;i<t.changes.length;i++){var o=t.changes[i];o=="text"?al(e,t):o=="gutter"?os(e,t,r,n):o=="class"?wa(e,t):o=="widget"&&pu(e,t,n)}t.changes=null}function Gn(e){return e.node==e.text&&(e.node=p("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),he&&ee<8&&(e.node.style.zIndex=2)),e.node}function xa(e,t){var r=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(r&&(r+=" CodeMirror-linebackground"),t.background)r?t.background.className=r:(t.background.parentNode.removeChild(t.background),t.background=null);else if(r){var n=Gn(t);t.background=n.insertBefore(p("div",null,r),n.firstChild),e.display.input.setUneditable(t.background)}}function Sa(e,t){var r=e.display.externalMeasured;return r&&r.line==t.line?(e.display.externalMeasured=null,t.measure=r.measure,r.built):Dn(e,t)}function al(e,t){var r=t.text.className,n=Sa(e,t);t.text==t.node&&(t.node=n.pre),t.text.parentNode.replaceChild(n.pre,t.text),t.text=n.pre,n.bgClass!=t.bgClass||n.textClass!=t.textClass?(t.bgClass=n.bgClass,t.textClass=n.textClass,wa(e,t)):r&&(t.text.className=r)}function wa(e,t){xa(e,t),t.line.wrapClass?Gn(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var r=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=r||""}function os(e,t,r,n){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){var i=Gn(t);t.gutterBackground=p("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px; width: "+n.gutterTotalWidth+"px"),e.display.input.setUneditable(t.gutterBackground),i.insertBefore(t.gutterBackground,t.text)}var o=t.line.gutterMarkers;if(e.options.lineNumbers||o){var s=Gn(t),l=t.gutter=p("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px");if(l.setAttribute("aria-hidden","true"),e.display.input.setUneditable(l),s.insertBefore(l,t.text),t.line.gutterClass&&(l.className+=" "+t.line.gutterClass),e.options.lineNumbers&&(!o||!o["CodeMirror-linenumbers"])&&(t.lineNumber=l.appendChild(p("div",Ue(e.options,r),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+n.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),o)for(var u=0;u<e.display.gutterSpecs.length;++u){var c=e.display.gutterSpecs[u].className,y=o.hasOwnProperty(c)&&o[c];y&&l.appendChild(p("div",[y],"CodeMirror-gutter-elt","left: "+n.gutterLeft[c]+"px; width: "+n.gutterWidth[c]+"px"))}}}function pu(e,t,r){t.alignable&&(t.alignable=null);for(var n=ke("CodeMirror-linewidget"),i=t.node.firstChild,o=void 0;i;i=o)o=i.nextSibling,n.test(i.className)&&t.node.removeChild(i);ol(e,t,r)}function vu(e,t,r,n){var i=Sa(e,t);return t.text=t.node=i.pre,i.bgClass&&(t.bgClass=i.bgClass),i.textClass&&(t.textClass=i.textClass),wa(e,t),os(e,t,r,n),ol(e,t,n),t.node}function ol(e,t,r){if(sl(e,t.line,t,r,!0),t.rest)for(var n=0;n<t.rest.length;n++)sl(e,t.rest[n],t,r,!1)}function sl(e,t,r,n,i){if(t.widgets)for(var o=Gn(r),s=0,l=t.widgets;s<l.length;++s){var u=l[s],c=p("div",[u.node],"CodeMirror-linewidget"+(u.className?" "+u.className:""));u.handleMouseEvents||c.setAttribute("cm-ignore-events","true"),ss(u,c,r,n),e.display.input.setUneditable(c),i&&u.above?o.insertBefore(c,r.gutter||r.text):o.appendChild(c),er(u,"redraw")}}function ss(e,t,r,n){if(e.noHScroll){(r.alignable||(r.alignable=[])).push(t);var i=n.wrapperWidth;t.style.left=n.fixedPos+"px",e.coverGutter||(i-=n.gutterTotalWidth,t.style.paddingLeft=n.gutterTotalWidth+"px"),t.style.width=i+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-n.gutterTotalWidth+"px"))}function Hn(e){if(e.height!=null)return e.height;var t=e.doc.cm;if(!t)return 0;if(!Pe(document.body,e.node)){var r="position: relative;";e.coverGutter&&(r+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(r+="width: "+t.display.wrapper.clientWidth+"px;"),E(t.display.measure,p("div",[e.node],null,r))}return e.height=e.node.parentNode.offsetHeight}function Wr(e,t){for(var r=da(t);r!=e.wrapper;r=r.parentNode)if(!r||r.nodeType==1&&r.getAttribute("cm-ignore-events")=="true"||r.parentNode==e.sizer&&r!=e.mover)return!0}function Di(e){return e.lineSpace.offsetTop}function zn(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function fo(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=E(e.measure,p("pre","x","CodeMirror-line-like")),r=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,n={left:parseInt(r.paddingLeft),right:parseInt(r.paddingRight)};return!isNaN(n.left)&&!isNaN(n.right)&&(e.cachedPaddingH=n),n}function Mr(e){return Mt-e.display.nativeBarWidth}function dn(e){return e.display.scroller.clientWidth-Mr(e)-e.display.barWidth}function Ta(e){return e.display.scroller.clientHeight-Mr(e)-e.display.barHeight}function ll(e,t,r){var n=e.options.lineWrapping,i=n&&dn(e);if(!t.measure.heights||n&&t.measure.width!=i){var o=t.measure.heights=[];if(n){t.measure.width=i;for(var s=t.text.firstChild.getClientRects(),l=0;l<s.length-1;l++){var u=s[l],c=s[l+1];Math.abs(u.bottom-c.bottom)>2&&o.push((u.bottom+c.top)/2-r.top)}}o.push(r.bottom-r.top)}}function ls(e,t,r){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};if(e.rest){for(var n=0;n<e.rest.length;n++)if(e.rest[n]==t)return{map:e.measure.maps[n],cache:e.measure.caches[n]};for(var i=0;i<e.rest.length;i++)if(v(e.rest[i])>r)return{map:e.measure.maps[i],cache:e.measure.caches[i],before:!0}}}function ul(e,t){t=zr(t);var r=v(t),n=e.display.externalMeasured=new nl(e.doc,t,r);n.lineN=r;var i=n.built=Dn(e,n);return n.text=i.pre,E(e.display.lineMeasure,i.pre),n}function us(e,t,r,n){return qr(e,li(e,t),r,n)}function co(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[Fr(e,t)];var r=e.display.externalMeasured;if(r&&t>=r.lineN&&t<r.lineN+r.size)return r}function li(e,t){var r=v(t),n=co(e,r);n&&!n.text?n=null:n&&n.changes&&(uo(e,n,r,yo(e)),e.curOp.forceUpdate=!0),n||(n=ul(e,t));var i=ls(n,t,r);return{line:t,view:n,rect:null,map:i.map,cache:i.cache,before:i.before,hasHeights:!1}}function qr(e,t,r,n,i){t.before&&(r=-1);var o=r+(n||""),s;return t.cache.hasOwnProperty(o)?s=t.cache[o]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(ll(e,t.view,t.rect),t.hasHeights=!0),s=ds(e,t,r,n),s.bogus||(t.cache[o]=s)),{left:s.left,right:s.right,top:i?s.rtop:s.top,bottom:i?s.rbottom:s.bottom}}var fs={left:0,right:0,top:0,bottom:0};function ui(e,t,r){for(var n,i,o,s,l,u,c=0;c<e.length;c+=3)if(l=e[c],u=e[c+1],t<l?(i=0,o=1,s="left"):t<u?(i=t-l,o=i+1):(c==e.length-3||t==u&&e[c+3]>t)&&(o=u-l,i=o-1,t>=u&&(s="right")),i!=null){if(n=e[c+2],l==u&&r==(n.insertLeft?"left":"right")&&(s=r),r=="left"&&i==0)for(;c&&e[c-2]==e[c-3]&&e[c-1].insertLeft;)n=e[(c-=3)+2],s="left";if(r=="right"&&i==u-l)for(;c<e.length-3&&e[c+3]==e[c+4]&&!e[c+5].insertLeft;)n=e[(c+=3)+2],s="right";break}return{node:n,start:i,end:o,collapse:s,coverStart:l,coverEnd:u}}function cs(e,t){var r=fs;if(t=="left")for(var n=0;n<e.length&&(r=e[n]).left==r.right;n++);else for(var i=e.length-1;i>=0&&(r=e[i]).left==r.right;i--);return r}function ds(e,t,r,n){var i=ui(t.map,r,n),o=i.node,s=i.start,l=i.end,u=i.collapse,c;if(o.nodeType==3){for(var y=0;y<4;y++){for(;s&&jt(t.line.text.charAt(i.coverStart+s));)--s;for(;i.coverStart+l<i.coverEnd&&jt(t.line.text.charAt(i.coverStart+l));)++l;if(he&&ee<9&&s==0&&l==i.coverEnd-i.coverStart?c=o.parentNode.getBoundingClientRect():c=cs(be(o,s,l).getClientRects(),n),c.left||c.right||s==0)break;l=s,s=s-1,u="right"}he&&ee<11&&(c=Ca(e.display.measure,c))}else{s>0&&(u=n="right");var R;e.options.lineWrapping&&(R=o.getClientRects()).length>1?c=R[n=="right"?R.length-1:0]:c=o.getBoundingClientRect()}if(he&&ee<9&&!s&&(!c||!c.left&&!c.right)){var B=o.parentNode.getClientRects()[0];B?c={left:B.left,right:B.left+Hi(e.display),top:B.top,bottom:B.bottom}:c=fs}for(var O=c.top-t.rect.top,H=c.bottom-t.rect.top,ce=(O+H)/2,we=t.view.measure.heights,ge=0;ge<we.length-1&&!(ce<we[ge]);ge++);var Oe=ge?we[ge-1]:0,Ee=we[ge],Me={left:(u=="right"?c.right:c.left)-t.rect.left,right:(u=="left"?c.left:c.right)-t.rect.left,top:Oe,bottom:Ee};return!c.left&&!c.right&&(Me.bogus=!0),e.options.singleCursorHeightPerLine||(Me.rtop=O,Me.rbottom=H),Me}function Ca(e,t){if(!window.screen||screen.logicalXDPI==null||screen.logicalXDPI==screen.deviceXDPI||!jo(e))return t;var r=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*r,right:t.right*r,top:t.top*n,bottom:t.bottom*n}}function fl(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function cl(e){e.display.externalMeasure=null,C(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)fl(e.display.view[t])}function _a(e){cl(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function ho(e){return G&&U?-(e.body.getBoundingClientRect().left-parseInt(getComputedStyle(e.body).marginLeft)):e.defaultView.pageXOffset||(e.documentElement||e.body).scrollLeft}function dl(e){return G&&U?-(e.body.getBoundingClientRect().top-parseInt(getComputedStyle(e.body).marginTop)):e.defaultView.pageYOffset||(e.documentElement||e.body).scrollTop}function hs(e){var t=zr(e),r=t.widgets,n=0;if(r)for(var i=0;i<r.length;++i)r[i].above&&(n+=Hn(r[i]));return n}function po(e,t,r,n,i){if(!i){var o=hs(t);r.top+=o,r.bottom+=o}if(n=="line")return r;n||(n="local");var s=Cr(t);if(n=="local"?s+=Di(e.display):s-=e.display.viewOffset,n=="page"||n=="window"){var l=e.display.lineSpace.getBoundingClientRect();s+=l.top+(n=="window"?0:dl(at(e)));var u=l.left+(n=="window"?0:ho(at(e)));r.left+=u,r.right+=u}return r.top+=s,r.bottom+=s,r}function vo(e,t,r){if(r=="div")return t;var n=t.left,i=t.top;if(r=="page")n-=ho(at(e)),i-=dl(at(e));else if(r=="local"||!r){var o=e.display.sizer.getBoundingClientRect();n+=o.left,i+=o.top}var s=e.display.lineSpace.getBoundingClientRect();return{left:n-s.left,top:i-s.top}}function mo(e,t,r,n,i){return n||(n=lt(e.doc,t.line)),po(e,n,us(e,n,t.ch,i),r)}function Ar(e,t,r,n,i,o){n=n||lt(e.doc,t.line),i||(i=li(e,n));function s(H,ce){var we=qr(e,i,H,ce?"right":"left",o);return ce?we.left=we.right:we.right=we.left,po(e,n,we,r)}var l=At(n,e.doc.direction),u=t.ch,c=t.sticky;if(u>=n.text.length?(u=n.text.length,c="before"):u<=0&&(u=0,c="after"),!l)return s(c=="before"?u-1:u,c=="before");function y(H,ce,we){var ge=l[ce],Oe=ge.level==1;return s(we?H-1:H,Oe!=we)}var R=nr(l,u,c),B=Fn,O=y(u,R,c=="before");return B!=null&&(O.other=y(u,B,c!="before")),O}function ps(e,t){var r=0;t=gt(e.doc,t),e.options.lineWrapping||(r=Hi(e.display)*t.ch);var n=lt(e.doc,t.line),i=Cr(n)+Di(e.display);return{left:r,right:r,top:i,bottom:i+n.height}}function go(e,t,r,n,i){var o=xe(e,t,r);return o.xRel=i,n&&(o.outside=n),o}function Ea(e,t,r){var n=e.doc;if(r+=e.display.viewOffset,r<0)return go(n.first,0,null,-1,-1);var i=X(n,r),o=n.first+n.size-1;if(i>o)return go(n.first+n.size-1,lt(n,o).text.length,null,1,1);t<0&&(t=0);for(var s=lt(n,i);;){var l=mu(e,s,i,t,r),u=el(s,l.ch+(l.xRel>0||l.outside>0?1:0));if(!u)return l;var c=u.find(1);if(c.line==i)return c;s=lt(n,i=c.line)}}function hl(e,t,r,n){n-=hs(t);var i=t.text.length,o=Vr(function(s){return qr(e,r,s-1).bottom<=n},i,0);return i=Vr(function(s){return qr(e,r,s).top>n},o,i),{begin:o,end:i}}function La(e,t,r,n){r||(r=li(e,t));var i=po(e,t,qr(e,r,n),"line").top;return hl(e,t,r,i)}function vs(e,t,r,n){return e.bottom<=r?!1:e.top>r?!0:(n?e.left:e.right)>t}function mu(e,t,r,n,i){i-=Cr(t);var o=li(e,t),s=hs(t),l=0,u=t.text.length,c=!0,y=At(t,e.doc.direction);if(y){var R=(e.options.lineWrapping?yu:gu)(e,t,r,o,y,n,i);c=R.level!=1,l=c?R.from:R.to-1,u=c?R.to:R.from-1}var B=null,O=null,H=Vr(function(Ye){var Ze=qr(e,o,Ye);return Ze.top+=s,Ze.bottom+=s,vs(Ze,n,i,!1)?(Ze.top<=i&&Ze.left<=n&&(B=Ye,O=Ze),!0):!1},l,u),ce,we,ge=!1;if(O){var Oe=n-O.left<O.right-n,Ee=Oe==c;H=B+(Ee?0:1),we=Ee?"after":"before",ce=Oe?O.left:O.right}else{!c&&(H==u||H==l)&&H++,we=H==0?"after":H==t.text.length?"before":qr(e,o,H-(c?1:0)).bottom+s<=i==c?"after":"before";var Me=Ar(e,xe(r,H,we),"line",t,o);ce=Me.left,ge=i<Me.top?-1:i>=Me.bottom?1:0}return H=on(t.text,H,1),go(r,H,we,ge,n-ce)}function gu(e,t,r,n,i,o,s){var l=Vr(function(R){var B=i[R],O=B.level!=1;return vs(Ar(e,xe(r,O?B.to:B.from,O?"before":"after"),"line",t,n),o,s,!0)},0,i.length-1),u=i[l];if(l>0){var c=u.level!=1,y=Ar(e,xe(r,c?u.from:u.to,c?"after":"before"),"line",t,n);vs(y,o,s,!0)&&y.top>s&&(u=i[l-1])}return u}function yu(e,t,r,n,i,o,s){var l=hl(e,t,n,s),u=l.begin,c=l.end;/\s/.test(t.text.charAt(c-1))&&c--;for(var y=null,R=null,B=0;B<i.length;B++){var O=i[B];if(!(O.from>=c||O.to<=u)){var H=O.level!=1,ce=qr(e,n,H?Math.min(c,O.to)-1:Math.max(u,O.from)).right,we=ce<o?o-ce+1e9:ce-o;(!y||R>we)&&(y=O,R=we)}}return y||(y=i[i.length-1]),y.from<u&&(y={from:u,to:y.to,level:y.level}),y.to>c&&(y={from:y.from,to:c,level:y.level}),y}var fi;function Gi(e){if(e.cachedTextHeight!=null)return e.cachedTextHeight;if(fi==null){fi=p("pre",null,"CodeMirror-line-like");for(var t=0;t<49;++t)fi.appendChild(document.createTextNode("x")),fi.appendChild(p("br"));fi.appendChild(document.createTextNode("x"))}E(e.measure,fi);var r=fi.offsetHeight/50;return r>3&&(e.cachedTextHeight=r),C(e.measure),r||1}function Hi(e){if(e.cachedCharWidth!=null)return e.cachedCharWidth;var t=p("span","xxxxxxxxxx"),r=p("pre",[t],"CodeMirror-line-like");E(e.measure,r);var n=t.getBoundingClientRect(),i=(n.right-n.left)/10;return i>2&&(e.cachedCharWidth=i),i||10}function yo(e){for(var t=e.display,r={},n={},i=t.gutters.clientLeft,o=t.gutters.firstChild,s=0;o;o=o.nextSibling,++s){var l=e.display.gutterSpecs[s].className;r[l]=o.offsetLeft+o.clientLeft+i,n[l]=o.clientWidth}return{fixedPos:ci(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:r,gutterWidth:n,wrapperWidth:t.wrapper.clientWidth}}function ci(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function pl(e){var t=Gi(e.display),r=e.options.lineWrapping,n=r&&Math.max(5,e.display.scroller.clientWidth/Hi(e.display)-3);return function(i){if(Bn(e.doc,i))return 0;var o=0;if(i.widgets)for(var s=0;s<i.widgets.length;s++)i.widgets[s].height&&(o+=i.widgets[s].height);return r?o+(Math.ceil(i.text.length/n)||1)*t:o+t}}function zi(e){var t=e.doc,r=pl(e);t.iter(function(n){var i=r(n);i!=n.height&&Er(n,i)})}function ur(e,t,r,n){var i=e.display;if(!r&&da(t).getAttribute("cm-not-content")=="true")return null;var o,s,l=i.lineSpace.getBoundingClientRect();try{o=t.clientX-l.left,s=t.clientY-l.top}catch{return null}var u=Ea(e,o,s),c;if(n&&u.xRel>0&&(c=lt(e.doc,u.line).text).length==u.ch){var y=Ct(c,c.length,e.options.tabSize)-c.length;u=xe(u.line,Math.max(0,Math.round((o-fo(e.display).left)/Hi(e.display))-y))}return u}function Fr(e,t){if(t>=e.display.viewTo||(t-=e.display.viewFrom,t<0))return null;for(var r=e.display.view,n=0;n<r.length;n++)if(t-=r[n].size,t<0)return n}function pr(e,t,r,n){t==null&&(t=e.doc.first),r==null&&(r=e.doc.first+e.doc.size),n||(n=0);var i=e.display;if(n&&r<i.viewTo&&(i.updateLineNumbers==null||i.updateLineNumbers>t)&&(i.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=i.viewTo)fn&&es(e.doc,t)<i.viewTo&&pn(e);else if(r<=i.viewFrom)fn&&tl(e.doc,r+n)>i.viewFrom?pn(e):(i.viewFrom+=n,i.viewTo+=n);else if(t<=i.viewFrom&&r>=i.viewTo)pn(e);else if(t<=i.viewFrom){var o=Aa(e,r,r+n,1);o?(i.view=i.view.slice(o.index),i.viewFrom=o.lineN,i.viewTo+=n):pn(e)}else if(r>=i.viewTo){var s=Aa(e,t,t,-1);s?(i.view=i.view.slice(0,s.index),i.viewTo=s.lineN):pn(e)}else{var l=Aa(e,t,t,-1),u=Aa(e,r,r+n,1);l&&u?(i.view=i.view.slice(0,l.index).concat(ba(e,l.lineN,u.lineN)).concat(i.view.slice(u.index)),i.viewTo+=n):pn(e)}var c=i.externalMeasured;c&&(r<c.lineN?c.lineN+=n:t<c.lineN+c.size&&(i.externalMeasured=null))}function hn(e,t,r){e.curOp.viewChanged=!0;var n=e.display,i=e.display.externalMeasured;if(i&&t>=i.lineN&&t<i.lineN+i.size&&(n.externalMeasured=null),!(t<n.viewFrom||t>=n.viewTo)){var o=n.view[Fr(e,t)];if(o.node!=null){var s=o.changes||(o.changes=[]);ut(s,r)==-1&&s.push(r)}}}function pn(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function Aa(e,t,r,n){var i=Fr(e,t),o,s=e.display.view;if(!fn||r==e.doc.first+e.doc.size)return{index:i,lineN:r};for(var l=e.display.viewFrom,u=0;u<i;u++)l+=s[u].size;if(l!=t){if(n>0){if(i==s.length-1)return null;o=l+s[i].size-t,i++}else o=l-t;t+=o,r+=o}for(;es(e.doc,r)!=r;){if(i==(n<0?0:s.length-1))return null;r+=n*s[i-(n<0?1:0)].size,i+=n}return{index:i,lineN:r}}function vl(e,t,r){var n=e.display,i=n.view;i.length==0||t>=n.viewTo||r<=n.viewFrom?(n.view=ba(e,t,r),n.viewFrom=t):(n.viewFrom>t?n.view=ba(e,t,n.viewFrom).concat(n.view):n.viewFrom<t&&(n.view=n.view.slice(Fr(e,t))),n.viewFrom=t,n.viewTo<r?n.view=n.view.concat(ba(e,n.viewTo,r)):n.viewTo>r&&(n.view=n.view.slice(0,Fr(e,r)))),n.viewTo=r}function ms(e){for(var t=e.display.view,r=0,n=0;n<t.length;n++){var i=t[n];!i.hidden&&(!i.node||i.changes)&&++r}return r}function ka(e){e.display.input.showSelection(e.display.input.prepareSelection())}function di(e,t){t===void 0&&(t=!0);var r=e.doc,n={},i=n.cursors=document.createDocumentFragment(),o=n.selection=document.createDocumentFragment(),s=e.options.$customCursor;s&&(t=!0);for(var l=0;l<r.sel.ranges.length;l++)if(!(!t&&l==r.sel.primIndex)){var u=r.sel.ranges[l];if(!(u.from().line>=e.display.viewTo||u.to().line<e.display.viewFrom)){var c=u.empty();if(s){var y=s(e,u);y&&ir(e,y,i)}else(c||e.options.showCursorWhenSelecting)&&ir(e,u.head,i);c||ml(e,u,o)}}return n}function ir(e,t,r){var n=Ar(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),i=r.appendChild(p("div"," ","CodeMirror-cursor"));if(i.style.left=n.left+"px",i.style.top=n.top+"px",i.style.height=Math.max(0,n.bottom-n.top)*e.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(e.getWrapperElement().className)){var o=mo(e,t,"div",null,null),s=o.right-o.left;i.style.width=(s>0?s:e.defaultCharWidth())+"px"}if(n.other){var l=r.appendChild(p("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));l.style.display="",l.style.left=n.other.left+"px",l.style.top=n.other.top+"px",l.style.height=(n.other.bottom-n.other.top)*.85+"px"}}function Ra(e,t){return e.top-t.top||e.left-t.left}function ml(e,t,r){var n=e.display,i=e.doc,o=document.createDocumentFragment(),s=fo(e.display),l=s.left,u=Math.max(n.sizerWidth,dn(e)-n.sizer.offsetLeft)-s.right,c=i.direction=="ltr";function y(Ee,Me,Ye,Ze){Me<0&&(Me=0),Me=Math.round(Me),Ze=Math.round(Ze),o.appendChild(p("div",null,"CodeMirror-selected","position: absolute; left: "+Ee+`px;
                             top: `+Me+"px; width: "+(Ye??u-Ee)+`px;
                             height: `+(Ze-Me)+"px"))}function R(Ee,Me,Ye){var Ze=lt(i,Ee),ct=Ze.text.length,rt,kt;function yt(Et,Gt){return mo(e,xe(Ee,Et),"div",Ze,Gt)}function Ft(Et,Gt,Nt){var Tt=La(e,Ze,null,Et),nt=Gt=="ltr"==(Nt=="after")?"left":"right",Lt=Nt=="after"?Tt.begin:Tt.end-(/\s/.test(Ze.text.charAt(Tt.end-1))?2:1);return yt(Lt,nt)[nt]}var It=At(Ze,i.direction);return Mn(It,Me||0,Ye??ct,function(Et,Gt,Nt,Tt){var nt=Nt=="ltr",Lt=yt(Et,nt?"left":"right"),St=yt(Gt-1,nt?"right":"left"),ot=Me==null&&Et==0,mt=Ye==null&&Gt==ct,vt=Tt==0,Wt=!It||Tt==It.length-1;if(St.top-Lt.top<=3){var Xt=(c?ot:mt)&&vt,Rn=(c?mt:ot)&&Wt,P=Xt?l:(nt?Lt:St).left,de=Rn?u:(nt?St:Lt).right;y(P,Lt.top,de-P,Lt.bottom)}else{var le,je,bt,F;nt?(le=c&&ot&&vt?l:Lt.left,je=c?u:Ft(Et,Nt,"before"),bt=c?l:Ft(Gt,Nt,"after"),F=c&&mt&&Wt?u:St.right):(le=c?Ft(Et,Nt,"before"):l,je=!c&&ot&&vt?u:Lt.right,bt=!c&&mt&&Wt?l:St.left,F=c?Ft(Gt,Nt,"after"):u),y(le,Lt.top,je-le,Lt.bottom),Lt.bottom<St.top&&y(l,Lt.bottom,null,St.top),y(bt,St.top,F-bt,St.bottom)}(!rt||Ra(Lt,rt)<0)&&(rt=Lt),Ra(St,rt)<0&&(rt=St),(!kt||Ra(Lt,kt)<0)&&(kt=Lt),Ra(St,kt)<0&&(kt=St)}),{start:rt,end:kt}}var B=t.from(),O=t.to();if(B.line==O.line)R(B.line,B.ch,O.ch);else{var H=lt(i,B.line),ce=lt(i,O.line),we=zr(H)==zr(ce),ge=R(B.line,B.ch,we?H.text.length+1:null).end,Oe=R(O.line,we?0:null,O.ch).start;we&&(ge.top<Oe.top-2?(y(ge.right,ge.top,null,ge.bottom),y(l,Oe.top,Oe.left,Oe.bottom)):y(ge.right,ge.top,Oe.left-ge.right,ge.bottom)),ge.bottom<Oe.top&&y(l,ge.bottom,null,Oe.top)}r.appendChild(o)}function vn(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var r=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval(function(){e.hasFocus()||Wi(e),t.cursorDiv.style.visibility=(r=!r)?"":"hidden"},e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}}function gs(e){e.hasFocus()||(e.display.input.focus(),e.state.focused||ys(e))}function bo(e){e.state.delayingBlurEvent=!0,setTimeout(function(){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,e.state.focused&&Wi(e))},100)}function ys(e,t){e.state.delayingBlurEvent&&!e.state.draggingText&&(e.state.delayingBlurEvent=!1),e.options.readOnly!="nocursor"&&(e.state.focused||(Qt(e,"focus",e,t),e.state.focused=!0,Ve(e.display.wrapper,"CodeMirror-focused"),!e.curOp&&e.display.selForContextMenu!=e.doc.sel&&(e.display.input.reset(),j&&setTimeout(function(){return e.display.input.reset(!0)},20)),e.display.input.receivedFocus()),vn(e))}function Wi(e,t){e.state.delayingBlurEvent||(e.state.focused&&(Qt(e,"blur",e,t),e.state.focused=!1,We(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.display.shift=!1)},150))}function xo(e){for(var t=e.display,r=t.lineDiv.offsetTop,n=Math.max(0,t.scroller.getBoundingClientRect().top),i=t.lineDiv.getBoundingClientRect().top,o=0,s=0;s<t.view.length;s++){var l=t.view[s],u=e.options.lineWrapping,c=void 0,y=0;if(!l.hidden){if(i+=l.line.height,he&&ee<8){var R=l.node.offsetTop+l.node.offsetHeight;c=R-r,r=R}else{var B=l.node.getBoundingClientRect();c=B.bottom-B.top,!u&&l.text.firstChild&&(y=l.text.firstChild.getBoundingClientRect().right-B.left-1)}var O=l.line.height-c;if((O>.005||O<-.005)&&(i<n&&(o-=O),Er(l.line,c),gl(l.line),l.rest))for(var H=0;H<l.rest.length;H++)gl(l.rest[H]);if(y>e.display.sizerWidth){var ce=Math.ceil(y/Hi(e.display));ce>e.display.maxLineLength&&(e.display.maxLineLength=ce,e.display.maxLine=l.line,e.display.maxLineChanged=!0)}}}Math.abs(o)>2&&(t.scroller.scrollTop+=o)}function gl(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t){var r=e.widgets[t],n=r.node.parentNode;n&&(r.height=n.offsetHeight)}}function qi(e,t,r){var n=r&&r.top!=null?Math.max(0,r.top):e.scroller.scrollTop;n=Math.floor(n-Di(e));var i=r&&r.bottom!=null?r.bottom:n+e.wrapper.clientHeight,o=X(t,n),s=X(t,i);if(r&&r.ensure){var l=r.ensure.from.line,u=r.ensure.to.line;l<o?(o=l,s=X(t,Cr(lt(t,l))+e.wrapper.clientHeight)):Math.min(u,t.lastLine())>=s&&(o=X(t,Cr(lt(t,u))-e.wrapper.clientHeight),s=u)}return{from:o,to:Math.max(s,o+1)}}function yl(e,t){if(!Kt(e,"scrollCursorIntoView")){var r=e.display,n=r.sizer.getBoundingClientRect(),i=null,o=r.wrapper.ownerDocument;if(t.top+n.top<0?i=!0:t.bottom+n.top>(o.defaultView.innerHeight||o.documentElement.clientHeight)&&(i=!1),i!=null&&!q){var s=p("div","​",null,`position: absolute;
                         top: `+(t.top-r.viewOffset-Di(e.display))+`px;
                         height: `+(t.bottom-t.top+Mr(e)+r.barHeight)+`px;
                         left: `+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(s),s.scrollIntoView(i),e.display.lineSpace.removeChild(s)}}}function bu(e,t,r,n){n==null&&(n=0);var i;!e.options.lineWrapping&&t==r&&(r=t.sticky=="before"?xe(t.line,t.ch+1,"before"):t,t=t.ch?xe(t.line,t.sticky=="before"?t.ch-1:t.ch,"after"):t);for(var o=0;o<5;o++){var s=!1,l=Ar(e,t),u=!r||r==t?l:Ar(e,r);i={left:Math.min(l.left,u.left),top:Math.min(l.top,u.top)-n,right:Math.max(l.left,u.left),bottom:Math.max(l.bottom,u.bottom)+n};var c=So(e,i),y=e.doc.scrollTop,R=e.doc.scrollLeft;if(c.scrollTop!=null&&(Ui(e,c.scrollTop),Math.abs(e.doc.scrollTop-y)>1&&(s=!0)),c.scrollLeft!=null&&(qn(e,c.scrollLeft),Math.abs(e.doc.scrollLeft-R)>1&&(s=!0)),!s)break}return i}function bl(e,t){var r=So(e,t);r.scrollTop!=null&&Ui(e,r.scrollTop),r.scrollLeft!=null&&qn(e,r.scrollLeft)}function So(e,t){var r=e.display,n=Gi(e.display);t.top<0&&(t.top=0);var i=e.curOp&&e.curOp.scrollTop!=null?e.curOp.scrollTop:r.scroller.scrollTop,o=Ta(e),s={};t.bottom-t.top>o&&(t.bottom=t.top+o);var l=e.doc.height+zn(r),u=t.top<n,c=t.bottom>l-n;if(t.top<i)s.scrollTop=u?0:t.top;else if(t.bottom>i+o){var y=Math.min(t.top,(c?l:t.bottom)-o);y!=i&&(s.scrollTop=y)}var R=e.options.fixedGutter?0:r.gutters.offsetWidth,B=e.curOp&&e.curOp.scrollLeft!=null?e.curOp.scrollLeft:r.scroller.scrollLeft-R,O=dn(e)-r.gutters.offsetWidth,H=t.right-t.left>O;return H&&(t.right=t.left+O),t.left<10?s.scrollLeft=0:t.left<B?s.scrollLeft=Math.max(0,t.left+R-(H?0:10)):t.right>O+B-3&&(s.scrollLeft=t.right+(H?0:10)-O),s}function bs(e,t){t!=null&&(hi(e),e.curOp.scrollTop=(e.curOp.scrollTop==null?e.doc.scrollTop:e.curOp.scrollTop)+t)}function mn(e){hi(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function Oa(e,t,r){(t!=null||r!=null)&&hi(e),t!=null&&(e.curOp.scrollLeft=t),r!=null&&(e.curOp.scrollTop=r)}function Wn(e,t){hi(e),e.curOp.scrollToPos=t}function hi(e){var t=e.curOp.scrollToPos;if(t){e.curOp.scrollToPos=null;var r=ps(e,t.from),n=ps(e,t.to);xs(e,r,n,t.margin)}}function xs(e,t,r,n){var i=So(e,{left:Math.min(t.left,r.left),top:Math.min(t.top,r.top)-n,right:Math.max(t.right,r.right),bottom:Math.max(t.bottom,r.bottom)+n});Oa(e,i.scrollLeft,i.scrollTop)}function Ui(e,t){Math.abs(e.doc.scrollTop-t)<2||(S||Fa(e,{top:t}),Ss(e,t,!0),S&&Fa(e),Ma(e,100))}function Ss(e,t,r){t=Math.max(0,Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t)),!(e.display.scroller.scrollTop==t&&!r)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function qn(e,t,r,n){t=Math.max(0,Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth)),!((r?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!n)&&(e.doc.scrollLeft=t,Ll(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function Xi(e){var t=e.display,r=t.gutters.offsetWidth,n=Math.round(e.doc.height+zn(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?r:0,docHeight:n,scrollHeight:n+Mr(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:r}}var Un=function(e,t,r){this.cm=r;var n=this.vert=p("div",[p("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),i=this.horiz=p("div",[p("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");n.tabIndex=i.tabIndex=-1,e(n),e(i),ht(n,"scroll",function(){n.clientHeight&&t(n.scrollTop,"vertical")}),ht(i,"scroll",function(){i.clientWidth&&t(i.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,he&&ee<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};Un.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1,r=e.scrollHeight>e.clientHeight+1,n=e.nativeBarWidth;if(r){this.vert.style.display="block",this.vert.style.bottom=t?n+"px":"0";var i=e.viewHeight-(t?n:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+i)+"px"}else this.vert.scrollTop=0,this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=r?n+"px":"0",this.horiz.style.left=e.barLeft+"px";var o=e.viewWidth-e.barLeft-(r?n:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&e.clientHeight>0&&(n==0&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:r?n:0,bottom:t?n:0}},Un.prototype.setScrollLeft=function(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},Un.prototype.setScrollTop=function(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},Un.prototype.zeroWidthHack=function(){var e=_&&!qe?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.visibility=this.vert.style.visibility="hidden",this.disableHoriz=new Ht,this.disableVert=new Ht},Un.prototype.enableZeroWidthBar=function(e,t,r){e.style.visibility="";function n(){var i=e.getBoundingClientRect(),o=r=="vert"?document.elementFromPoint(i.right-1,(i.top+i.bottom)/2):document.elementFromPoint((i.right+i.left)/2,i.bottom-1);o!=e?e.style.visibility="hidden":t.set(1e3,n)}t.set(1e3,n)},Un.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)};var ji=function(){};ji.prototype.update=function(){return{bottom:0,right:0}},ji.prototype.setScrollLeft=function(){},ji.prototype.setScrollTop=function(){},ji.prototype.clear=function(){};function pi(e,t){t||(t=Xi(e));var r=e.display.barWidth,n=e.display.barHeight;ws(e,t);for(var i=0;i<4&&r!=e.display.barWidth||n!=e.display.barHeight;i++)r!=e.display.barWidth&&e.options.lineWrapping&&xo(e),ws(e,Xi(e)),r=e.display.barWidth,n=e.display.barHeight}function ws(e,t){var r=e.display,n=r.scrollbars.update(t);r.sizer.style.paddingRight=(r.barWidth=n.right)+"px",r.sizer.style.paddingBottom=(r.barHeight=n.bottom)+"px",r.heightForcer.style.borderBottom=n.bottom+"px solid transparent",n.right&&n.bottom?(r.scrollbarFiller.style.display="block",r.scrollbarFiller.style.height=n.bottom+"px",r.scrollbarFiller.style.width=n.right+"px"):r.scrollbarFiller.style.display="",n.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(r.gutterFiller.style.display="block",r.gutterFiller.style.height=n.bottom+"px",r.gutterFiller.style.width=t.gutterWidth+"px"):r.gutterFiller.style.display=""}var Ir={native:Un,null:ji};function Ts(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&We(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new Ir[e.options.scrollbarStyle](function(t){e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),ht(t,"mousedown",function(){e.state.focused&&setTimeout(function(){return e.display.input.focus()},0)}),t.setAttribute("cm-not-content","true")},function(t,r){r=="horizontal"?qn(e,t):Ui(e,t)},e),e.display.scrollbars.addClass&&Ve(e.display.wrapper,e.display.scrollbars.addClass)}var xu=0;function yr(e){e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++xu,markArrays:null},il(e.curOp)}function gn(e){var t=e.curOp;t&&Jr(t,function(r){for(var n=0;n<r.ops.length;n++)r.ops[n].cm.curOp=null;vi(r)})}function vi(e){for(var t=e.ops,r=0;r<t.length;r++)wo(t[r]);for(var n=0;n<t.length;n++)xl(t[n]);for(var i=0;i<t.length;i++)Sl(t[i]);for(var o=0;o<t.length;o++)wl(t[o]);for(var s=0;s<t.length;s++)Tl(t[s])}function wo(e){var t=e.cm,r=t.display;wu(t),e.updateMaxLine&&rs(t),e.mustUpdate=e.viewChanged||e.forceUpdate||e.scrollTop!=null||e.scrollToPos&&(e.scrollToPos.from.line<r.viewFrom||e.scrollToPos.to.line>=r.viewTo)||r.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new To(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function xl(e){e.updatedDisplay=e.mustUpdate&&Cs(e.cm,e.update)}function Sl(e){var t=e.cm,r=t.display;e.updatedDisplay&&xo(t),e.barMeasure=Xi(t),r.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=us(t,r.maxLine,r.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(r.scroller.clientWidth,r.sizer.offsetLeft+e.adjustWidthTo+Mr(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,r.sizer.offsetLeft+e.adjustWidthTo-dn(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=r.input.prepareSelection())}function wl(e){var t=e.cm;e.adjustWidthTo!=null&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&qn(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);var r=e.focus&&e.focus==$e(Rt(t));e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,r),(e.updatedDisplay||e.startHeight!=t.doc.height)&&pi(t,e.barMeasure),e.updatedDisplay&&Es(t,e.barMeasure),e.selectionChanged&&vn(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),r&&gs(e.cm)}function Tl(e){var t=e.cm,r=t.display,n=t.doc;if(e.updatedDisplay&&El(t,e.update),r.wheelStartX!=null&&(e.scrollTop!=null||e.scrollLeft!=null||e.scrollToPos)&&(r.wheelStartX=r.wheelStartY=null),e.scrollTop!=null&&Ss(t,e.scrollTop,e.forceScroll),e.scrollLeft!=null&&qn(t,e.scrollLeft,!0,!0),e.scrollToPos){var i=bu(t,gt(n,e.scrollToPos.from),gt(n,e.scrollToPos.to),e.scrollToPos.margin);yl(t,i)}var o=e.maybeHiddenMarkers,s=e.maybeUnhiddenMarkers;if(o)for(var l=0;l<o.length;++l)o[l].lines.length||Qt(o[l],"hide");if(s)for(var u=0;u<s.length;++u)s[u].lines.length&&Qt(s[u],"unhide");r.wrapper.offsetHeight&&(n.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&Qt(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function br(e,t){if(e.curOp)return t();yr(e);try{return t()}finally{gn(e)}}function or(e,t){return function(){if(e.curOp)return t.apply(e,arguments);yr(e);try{return t.apply(e,arguments)}finally{gn(e)}}}function vr(e){return function(){if(this.curOp)return e.apply(this,arguments);yr(this);try{return e.apply(this,arguments)}finally{gn(this)}}}function sr(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);yr(t);try{return e.apply(this,arguments)}finally{gn(t)}}}function Ma(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,tt(Su,e))}function Su(e){var t=e.doc;if(!(t.highlightFrontier>=e.display.viewTo)){var r=+new Date+e.options.workTime,n=va(e,t.highlightFrontier),i=[];t.iter(n.line,Math.min(t.first+t.size,e.display.viewTo+500),function(o){if(n.line>=e.display.viewFrom){var s=o.styles,l=o.text.length>e.options.maxHighlightLength?$r(t.mode,n.state):null,u=Vs(e,o,n,!0);l&&(n.state=l),o.styles=u.styles;var c=o.styleClasses,y=u.classes;y?o.styleClasses=y:c&&(o.styleClasses=null);for(var R=!s||s.length!=o.styles.length||c!=y&&(!c||!y||c.bgClass!=y.bgClass||c.textClass!=y.textClass),B=0;!R&&B<s.length;++B)R=s[B]!=o.styles[B];R&&i.push(n.line),o.stateAfter=n.save(),n.nextLine()}else o.text.length<=e.options.maxHighlightLength&&Lr(e,o.text,n),o.stateAfter=n.line%5==0?n.save():null,n.nextLine();if(+new Date>r)return Ma(e,e.options.workDelay),!0}),t.highlightFrontier=n.line,t.modeFrontier=Math.max(t.modeFrontier,n.line),i.length&&br(e,function(){for(var o=0;o<i.length;o++)hn(e,i[o],"text")})}}var To=function(e,t,r){var n=e.display;this.viewport=t,this.visible=qi(n,e.doc,t),this.editorIsHidden=!n.wrapper.offsetWidth,this.wrapperHeight=n.wrapper.clientHeight,this.wrapperWidth=n.wrapper.clientWidth,this.oldDisplayWidth=dn(e),this.force=r,this.dims=yo(e),this.events=[]};To.prototype.signal=function(e,t){wr(e,t)&&this.events.push(arguments)},To.prototype.finish=function(){for(var e=0;e<this.events.length;e++)Qt.apply(null,this.events[e])};function wu(e){var t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=Mr(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=Mr(e)+"px",t.scrollbarsClipped=!0)}function Cl(e){if(e.hasFocus())return null;var t=$e(Rt(e));if(!t||!Pe(e.display.lineDiv,t))return null;var r={activeElt:t};if(window.getSelection){var n=ft(e).getSelection();n.anchorNode&&n.extend&&Pe(e.display.lineDiv,n.anchorNode)&&(r.anchorNode=n.anchorNode,r.anchorOffset=n.anchorOffset,r.focusNode=n.focusNode,r.focusOffset=n.focusOffset)}return r}function _l(e){if(!(!e||!e.activeElt||e.activeElt==$e(st(e.activeElt)))&&(e.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(e.activeElt.nodeName)&&e.anchorNode&&Pe(document.body,e.anchorNode)&&Pe(document.body,e.focusNode))){var t=e.activeElt.ownerDocument,r=t.defaultView.getSelection(),n=t.createRange();n.setEnd(e.anchorNode,e.anchorOffset),n.collapse(!1),r.removeAllRanges(),r.addRange(n),r.extend(e.focusNode,e.focusOffset)}}function Cs(e,t){var r=e.display,n=e.doc;if(t.editorIsHidden)return pn(e),!1;if(!t.force&&t.visible.from>=r.viewFrom&&t.visible.to<=r.viewTo&&(r.updateLineNumbers==null||r.updateLineNumbers>=r.viewTo)&&r.renderedView==r.view&&ms(e)==0)return!1;Al(e)&&(pn(e),t.dims=yo(e));var i=n.first+n.size,o=Math.max(t.visible.from-e.options.viewportMargin,n.first),s=Math.min(i,t.visible.to+e.options.viewportMargin);r.viewFrom<o&&o-r.viewFrom<20&&(o=Math.max(n.first,r.viewFrom)),r.viewTo>s&&r.viewTo-s<20&&(s=Math.min(i,r.viewTo)),fn&&(o=es(e.doc,o),s=tl(e.doc,s));var l=o!=r.viewFrom||s!=r.viewTo||r.lastWrapHeight!=t.wrapperHeight||r.lastWrapWidth!=t.wrapperWidth;vl(e,o,s),r.viewOffset=Cr(lt(e.doc,r.viewFrom)),e.display.mover.style.top=r.viewOffset+"px";var u=ms(e);if(!l&&u==0&&!t.force&&r.renderedView==r.view&&(r.updateLineNumbers==null||r.updateLineNumbers>=r.viewTo))return!1;var c=Cl(e);return u>4&&(r.lineDiv.style.display="none"),Co(e,r.updateLineNumbers,t.dims),u>4&&(r.lineDiv.style.display=""),r.renderedView=r.view,_l(c),C(r.cursorDiv),C(r.selectionDiv),r.gutters.style.height=r.sizer.style.minHeight=0,l&&(r.lastWrapHeight=t.wrapperHeight,r.lastWrapWidth=t.wrapperWidth,Ma(e,400)),r.updateLineNumbers=null,!0}function El(e,t){for(var r=t.viewport,n=!0;;n=!1){if(!n||!e.options.lineWrapping||t.oldDisplayWidth==dn(e)){if(r&&r.top!=null&&(r={top:Math.min(e.doc.height+zn(e.display)-Ta(e),r.top)}),t.visible=qi(e.display,e.doc,r),t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)break}else n&&(t.visible=qi(e.display,e.doc,r));if(!Cs(e,t))break;xo(e);var i=Xi(e);ka(e),pi(e,i),Es(e,i),t.force=!1}t.signal(e,"update",e),(e.display.viewFrom!=e.display.reportedViewFrom||e.display.viewTo!=e.display.reportedViewTo)&&(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function Fa(e,t){var r=new To(e,t);if(Cs(e,r)){xo(e),El(e,r);var n=Xi(e);ka(e),pi(e,n),Es(e,n),r.finish()}}function Co(e,t,r){var n=e.display,i=e.options.lineNumbers,o=n.lineDiv,s=o.firstChild;function l(H){var ce=H.nextSibling;return j&&_&&e.display.currentWheelTarget==H?H.style.display="none":H.parentNode.removeChild(H),ce}for(var u=n.view,c=n.viewFrom,y=0;y<u.length;y++){var R=u[y];if(!R.hidden)if(!R.node||R.node.parentNode!=o){var B=vu(e,R,c,r);o.insertBefore(B,s)}else{for(;s!=R.node;)s=l(s);var O=i&&t!=null&&t<=c&&R.lineNumber;R.changes&&(ut(R.changes,"gutter")>-1&&(O=!1),uo(e,R,c,r)),O&&(C(R.lineNumber),R.lineNumber.appendChild(document.createTextNode(Ue(e.options,c)))),s=R.node.nextSibling}c+=R.size}for(;s;)s=l(s)}function _s(e){var t=e.gutters.offsetWidth;e.sizer.style.marginLeft=t+"px",er(e,"gutterChanged",e)}function Es(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+Mr(e)+"px"}function Ll(e){var t=e.display,r=t.view;if(!(!t.alignWidgets&&(!t.gutters.firstChild||!e.options.fixedGutter))){for(var n=ci(t)-t.scroller.scrollLeft+e.doc.scrollLeft,i=t.gutters.offsetWidth,o=n+"px",s=0;s<r.length;s++)if(!r[s].hidden){e.options.fixedGutter&&(r[s].gutter&&(r[s].gutter.style.left=o),r[s].gutterBackground&&(r[s].gutterBackground.style.left=o));var l=r[s].alignable;if(l)for(var u=0;u<l.length;u++)l[u].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=n+i+"px")}}function Al(e){if(!e.options.lineNumbers)return!1;var t=e.doc,r=Ue(e.options,t.first+t.size-1),n=e.display;if(r.length!=n.lineNumChars){var i=n.measure.appendChild(p("div",[p("div",r)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=i.firstChild.offsetWidth,s=i.offsetWidth-o;return n.lineGutter.style.width="",n.lineNumInnerWidth=Math.max(o,n.lineGutter.offsetWidth-s)+1,n.lineNumWidth=n.lineNumInnerWidth+s,n.lineNumChars=n.lineNumInnerWidth?r.length:-1,n.lineGutter.style.width=n.lineNumWidth+"px",_s(e.display),!0}return!1}function Ls(e,t){for(var r=[],n=!1,i=0;i<e.length;i++){var o=e[i],s=null;if(typeof o!="string"&&(s=o.style,o=o.className),o=="CodeMirror-linenumbers")if(t)n=!0;else continue;r.push({className:o,style:s})}return t&&!n&&r.push({className:"CodeMirror-linenumbers",style:null}),r}function As(e){var t=e.gutters,r=e.gutterSpecs;C(t),e.lineGutter=null;for(var n=0;n<r.length;++n){var i=r[n],o=i.className,s=i.style,l=t.appendChild(p("div",null,"CodeMirror-gutter "+o));s&&(l.style.cssText=s),o=="CodeMirror-linenumbers"&&(e.lineGutter=l,l.style.width=(e.lineNumWidth||1)+"px")}t.style.display=r.length?"":"none",_s(e)}function Ia(e){As(e.display),pr(e),Ll(e)}function Tu(e,t,r,n){var i=this;this.input=r,i.scrollbarFiller=p("div",null,"CodeMirror-scrollbar-filler"),i.scrollbarFiller.setAttribute("cm-not-content","true"),i.gutterFiller=p("div",null,"CodeMirror-gutter-filler"),i.gutterFiller.setAttribute("cm-not-content","true"),i.lineDiv=Z("div",null,"CodeMirror-code"),i.selectionDiv=p("div",null,null,"position: relative; z-index: 1"),i.cursorDiv=p("div",null,"CodeMirror-cursors"),i.measure=p("div",null,"CodeMirror-measure"),i.lineMeasure=p("div",null,"CodeMirror-measure"),i.lineSpace=Z("div",[i.measure,i.lineMeasure,i.selectionDiv,i.cursorDiv,i.lineDiv],null,"position: relative; outline: none");var o=Z("div",[i.lineSpace],"CodeMirror-lines");i.mover=p("div",[o],null,"position: relative"),i.sizer=p("div",[i.mover],"CodeMirror-sizer"),i.sizerWidth=null,i.heightForcer=p("div",null,null,"position: absolute; height: "+Mt+"px; width: 1px;"),i.gutters=p("div",null,"CodeMirror-gutters"),i.lineGutter=null,i.scroller=p("div",[i.sizer,i.heightForcer,i.gutters],"CodeMirror-scroll"),i.scroller.setAttribute("tabIndex","-1"),i.wrapper=p("div",[i.scrollbarFiller,i.gutterFiller,i.scroller],"CodeMirror"),G&&fe>=105&&(i.wrapper.style.clipPath="inset(0px)"),i.wrapper.setAttribute("translate","no"),he&&ee<8&&(i.gutters.style.zIndex=-1,i.scroller.style.paddingRight=0),!j&&!(S&&h)&&(i.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(i.wrapper):e(i.wrapper)),i.viewFrom=i.viewTo=t.first,i.reportedViewFrom=i.reportedViewTo=t.first,i.view=[],i.renderedView=null,i.externalMeasured=null,i.viewOffset=0,i.lastWrapHeight=i.lastWrapWidth=0,i.updateLineNumbers=null,i.nativeBarWidth=i.barHeight=i.barWidth=0,i.scrollbarsClipped=!1,i.lineNumWidth=i.lineNumInnerWidth=i.lineNumChars=null,i.alignWidgets=!1,i.cachedCharWidth=i.cachedTextHeight=i.cachedPaddingH=null,i.maxLine=null,i.maxLineLength=0,i.maxLineChanged=!1,i.wheelDX=i.wheelDY=i.wheelStartX=i.wheelStartY=null,i.shift=!1,i.selForContextMenu=null,i.activeTouch=null,i.gutterSpecs=Ls(n.gutters,n.lineNumbers),As(i),r.init(i)}var _o=0,yn=null;he?yn=-.53:S?yn=15:G?yn=-.7:Ge&&(yn=-1/3);function kl(e){var t=e.wheelDeltaX,r=e.wheelDeltaY;return t==null&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),r==null&&e.detail&&e.axis==e.VERTICAL_AXIS?r=e.detail:r==null&&(r=e.wheelDelta),{x:t,y:r}}function Yi(e){var t=kl(e);return t.x*=yn,t.y*=yn,t}function Rl(e,t){G&&fe==102&&(e.display.chromeScrollHack==null?e.display.sizer.style.pointerEvents="none":clearTimeout(e.display.chromeScrollHack),e.display.chromeScrollHack=setTimeout(function(){e.display.chromeScrollHack=null,e.display.sizer.style.pointerEvents=""},100));var r=kl(t),n=r.x,i=r.y,o=yn;t.deltaMode===0&&(n=t.deltaX,i=t.deltaY,o=1);var s=e.display,l=s.scroller,u=l.scrollWidth>l.clientWidth,c=l.scrollHeight>l.clientHeight;if(n&&u||i&&c){if(i&&_&&j){e:for(var y=t.target,R=s.view;y!=l;y=y.parentNode)for(var B=0;B<R.length;B++)if(R[B].node==y){e.display.currentWheelTarget=y;break e}}if(n&&!S&&!ve&&o!=null){i&&c&&Ui(e,Math.max(0,l.scrollTop+i*o)),qn(e,Math.max(0,l.scrollLeft+n*o)),(!i||i&&c)&&qt(t),s.wheelStartX=null;return}if(i&&o!=null){var O=i*o,H=e.doc.scrollTop,ce=H+s.wrapper.clientHeight;O<0?H=Math.max(0,H+O-50):ce=Math.min(e.doc.height,ce+O+50),Fa(e,{top:H,bottom:ce})}_o<20&&t.deltaMode!==0&&(s.wheelStartX==null?(s.wheelStartX=l.scrollLeft,s.wheelStartY=l.scrollTop,s.wheelDX=n,s.wheelDY=i,setTimeout(function(){if(s.wheelStartX!=null){var we=l.scrollLeft-s.wheelStartX,ge=l.scrollTop-s.wheelStartY,Oe=ge&&s.wheelDY&&ge/s.wheelDY||we&&s.wheelDX&&we/s.wheelDX;s.wheelStartX=s.wheelStartY=null,Oe&&(yn=(yn*_o+Oe)/(_o+1),++_o)}},200)):(s.wheelDX+=n,s.wheelDY+=i))}}var kr=function(e,t){this.ranges=e,this.primIndex=t};kr.prototype.primary=function(){return this.ranges[this.primIndex]},kr.prototype.equals=function(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var t=0;t<this.ranges.length;t++){var r=this.ranges[t],n=e.ranges[t];if(!zt(r.anchor,n.anchor)||!zt(r.head,n.head))return!1}return!0},kr.prototype.deepCopy=function(){for(var e=[],t=0;t<this.ranges.length;t++)e[t]=new Dt(Jt(this.ranges[t].anchor),Jt(this.ranges[t].head));return new kr(e,this.primIndex)},kr.prototype.somethingSelected=function(){for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1},kr.prototype.contains=function(e,t){t||(t=e);for(var r=0;r<this.ranges.length;r++){var n=this.ranges[r];if(Qe(t,n.from())>=0&&Qe(e,n.to())<=0)return r}return-1};var Dt=function(e,t){this.anchor=e,this.head=t};Dt.prototype.from=function(){return Fi(this.anchor,this.head)},Dt.prototype.to=function(){return hr(this.anchor,this.head)},Dt.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};function Rr(e,t,r){var n=e&&e.options.selectionsMayTouch,i=t[r];t.sort(function(B,O){return Qe(B.from(),O.from())}),r=ut(t,i);for(var o=1;o<t.length;o++){var s=t[o],l=t[o-1],u=Qe(l.to(),s.from());if(n&&!s.empty()?u>0:u>=0){var c=Fi(l.from(),s.from()),y=hr(l.to(),s.to()),R=l.empty()?s.from()==s.head:l.from()==l.head;o<=r&&--r,t.splice(--o,2,new Dt(R?y:c,R?c:y))}}return new kr(t,r)}function Xn(e,t){return new kr([new Dt(e,t||e)],0)}function bn(e){return e.text?xe(e.from.line+e.text.length-1,_t(e.text).length+(e.text.length==1?e.from.ch:0)):e.to}function Ol(e,t){if(Qe(e,t.from)<0)return e;if(Qe(e,t.to)<=0)return bn(t);var r=e.line+t.text.length-(t.to.line-t.from.line)-1,n=e.ch;return e.line==t.to.line&&(n+=bn(t).ch-t.to.ch),xe(r,n)}function ks(e,t){for(var r=[],n=0;n<e.sel.ranges.length;n++){var i=e.sel.ranges[n];r.push(new Dt(Ol(i.anchor,t),Ol(i.head,t)))}return Rr(e.cm,r,e.sel.primIndex)}function Ml(e,t,r){return e.line==t.line?xe(r.line,e.ch-t.ch+r.ch):xe(r.line+(e.line-t.line),e.ch)}function Cu(e,t,r){for(var n=[],i=xe(e.first,0),o=i,s=0;s<t.length;s++){var l=t[s],u=Ml(l.from,i,o),c=Ml(bn(l),i,o);if(i=l.to,o=c,r=="around"){var y=e.sel.ranges[s],R=Qe(y.head,y.anchor)<0;n[s]=new Dt(R?c:u,R?u:c)}else n[s]=new Dt(u,u)}return new kr(n,e.sel.primIndex)}function Rs(e){e.doc.mode=Ri(e.options,e.doc.modeOption),xn(e)}function xn(e){e.doc.iter(function(t){t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null)}),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,Ma(e,100),e.state.modeGen++,e.curOp&&pr(e)}function Fl(e,t){return t.from.ch==0&&t.to.ch==0&&_t(t.text)==""&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function Ki(e,t,r,n){function i(Oe){return r?r[Oe]:null}function o(Oe,Ee,Me){lu(Oe,Ee,Me,n),er(Oe,"change",Oe,t)}function s(Oe,Ee){for(var Me=[],Ye=Oe;Ye<Ee;++Ye)Me.push(new Zr(c[Ye],i(Ye),n));return Me}var l=t.from,u=t.to,c=t.text,y=lt(e,l.line),R=lt(e,u.line),B=_t(c),O=i(c.length-1),H=u.line-l.line;if(t.full)e.insert(0,s(0,c.length)),e.remove(c.length,e.size-c.length);else if(Fl(e,t)){var ce=s(0,c.length-1);o(R,R.text,O),H&&e.remove(l.line,H),ce.length&&e.insert(l.line,ce)}else if(y==R)if(c.length==1)o(y,y.text.slice(0,l.ch)+B+y.text.slice(u.ch),O);else{var we=s(1,c.length-1);we.push(new Zr(B+y.text.slice(u.ch),O,n)),o(y,y.text.slice(0,l.ch)+c[0],i(0)),e.insert(l.line+1,we)}else if(c.length==1)o(y,y.text.slice(0,l.ch)+c[0]+R.text.slice(u.ch),i(0)),e.remove(l.line+1,H);else{o(y,y.text.slice(0,l.ch)+c[0],i(0)),o(R,B+R.text.slice(u.ch),O);var ge=s(1,c.length-1);H>1&&e.remove(l.line+1,H-1),e.insert(l.line+1,ge)}er(e,"change",e,t)}function jn(e,t,r){function n(i,o,s){if(i.linked)for(var l=0;l<i.linked.length;++l){var u=i.linked[l];if(u.doc!=o){var c=s&&u.sharedHist;r&&!c||(t(u.doc,c),n(u.doc,i,c))}}}n(e,null,!0)}function mi(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,zi(e),Rs(e),gi(e),e.options.direction=t.direction,e.options.lineWrapping||rs(e),e.options.mode=t.modeOption,pr(e)}function gi(e){(e.doc.direction=="rtl"?Ve:We)(e.display.lineDiv,"CodeMirror-rtl")}function _u(e){br(e,function(){gi(e),pr(e)})}function Sn(e){this.done=[],this.undone=[],this.undoDepth=e?e.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e?e.maxGeneration:1}function Eo(e,t){var r={from:Jt(t.from),to:bn(t),text:un(e,t.from,t.to)};return Na(e,r,t.from.line,t.to.line+1),jn(e,function(n){return Na(n,r,t.from.line,t.to.line+1)},!0),r}function yi(e){for(;e.length;){var t=_t(e);if(t.ranges)e.pop();else break}}function Os(e,t){if(t)return yi(e.done),_t(e.done);if(e.done.length&&!_t(e.done).ranges)return _t(e.done);if(e.done.length>1&&!e.done[e.done.length-2].ranges)return e.done.pop(),_t(e.done)}function Lo(e,t,r,n){var i=e.history;i.undone.length=0;var o=+new Date,s,l;if((i.lastOp==n||i.lastOrigin==t.origin&&t.origin&&(t.origin.charAt(0)=="+"&&i.lastModTime>o-(e.cm?e.cm.options.historyEventDelay:500)||t.origin.charAt(0)=="*"))&&(s=Os(i,i.lastOp==n)))l=_t(s.changes),Qe(t.from,t.to)==0&&Qe(t.from,l.to)==0?l.to=bn(t):s.changes.push(Eo(e,t));else{var u=_t(i.done);for((!u||!u.ranges)&&Vi(e.sel,i.done),s={changes:[Eo(e,t)],generation:i.generation},i.done.push(s);i.done.length>i.undoDepth;)i.done.shift(),i.done[0].ranges||i.done.shift()}i.done.push(r),i.generation=++i.maxGeneration,i.lastModTime=i.lastSelTime=o,i.lastOp=i.lastSelOp=n,i.lastOrigin=i.lastSelOrigin=t.origin,l||Qt(e,"historyAdded")}function Ms(e,t,r,n){var i=t.charAt(0);return i=="*"||i=="+"&&r.ranges.length==n.ranges.length&&r.somethingSelected()==n.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function Fs(e,t,r,n){var i=e.history,o=n&&n.origin;r==i.lastSelOp||o&&i.lastSelOrigin==o&&(i.lastModTime==i.lastSelTime&&i.lastOrigin==o||Ms(e,o,_t(i.done),t))?i.done[i.done.length-1]=t:Vi(t,i.done),i.lastSelTime=+new Date,i.lastSelOrigin=o,i.lastSelOp=r,n&&n.clearRedo!==!1&&yi(i.undone)}function Vi(e,t){var r=_t(t);r&&r.ranges&&r.equals(e)||t.push(e)}function Na(e,t,r,n){var i=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,r),Math.min(e.first+e.size,n),function(s){s.markedSpans&&((i||(i=t["spans_"+e.id]={}))[o]=s.markedSpans),++o})}function Il(e){if(!e)return null;for(var t,r=0;r<e.length;++r)e[r].marker.explicitlyCleared?t||(t=e.slice(0,r)):t&&t.push(e[r]);return t?t.length?t:null:e}function Nl(e,t){var r=t["spans_"+e.id];if(!r)return null;for(var n=[],i=0;i<t.text.length;++i)n.push(Il(r[i]));return n}function Is(e,t){var r=Nl(e,t),n=Qo(e,t);if(!r)return n;if(!n)return r;for(var i=0;i<r.length;++i){var o=r[i],s=n[i];if(o&&s)e:for(var l=0;l<s.length;++l){for(var u=s[l],c=0;c<o.length;++c)if(o[c].marker==u.marker)continue e;o.push(u)}else s&&(r[i]=s)}return r}function bi(e,t,r){for(var n=[],i=0;i<e.length;++i){var o=e[i];if(o.ranges){n.push(r?kr.prototype.deepCopy.call(o):o);continue}var s=o.changes,l=[];n.push({changes:l});for(var u=0;u<s.length;++u){var c=s[u],y=void 0;if(l.push({from:c.from,to:c.to,text:c.text}),t)for(var R in c)(y=R.match(/^spans_(\d+)$/))&&ut(t,Number(y[1]))>-1&&(_t(l)[R]=c[R],delete c[R])}}return n}function Ao(e,t,r,n){if(n){var i=e.anchor;if(r){var o=Qe(t,i)<0;o!=Qe(r,i)<0?(i=t,t=r):o!=Qe(t,r)<0&&(t=r)}return new Dt(i,t)}else return new Dt(r||t,t)}function $i(e,t,r,n,i){i==null&&(i=e.cm&&(e.cm.display.shift||e.extend)),lr(e,new kr([Ao(e.sel.primary(),t,r,i)],0),n)}function ko(e,t,r){for(var n=[],i=e.cm&&(e.cm.display.shift||e.extend),o=0;o<e.sel.ranges.length;o++)n[o]=Ao(e.sel.ranges[o],t[o],null,i);var s=Rr(e.cm,n,e.sel.primIndex);lr(e,s,r)}function Ro(e,t,r,n){var i=e.sel.ranges.slice(0);i[t]=r,lr(e,Rr(e.cm,i,e.sel.primIndex),n)}function Ns(e,t,r,n){lr(e,Xn(t,r),n)}function Pl(e,t,r){var n={ranges:t.ranges,update:function(i){this.ranges=[];for(var o=0;o<i.length;o++)this.ranges[o]=new Dt(gt(e,i[o].anchor),gt(e,i[o].head))},origin:r&&r.origin};return Qt(e,"beforeSelectionChange",e,n),e.cm&&Qt(e.cm,"beforeSelectionChange",e.cm,n),n.ranges!=t.ranges?Rr(e.cm,n.ranges,n.ranges.length-1):t}function Ps(e,t,r){var n=e.history.done,i=_t(n);i&&i.ranges?(n[n.length-1]=t,Pa(e,t,r)):lr(e,t,r)}function lr(e,t,r){Pa(e,t,r),Fs(e,e.sel,e.cm?e.cm.curOp.id:NaN,r)}function Pa(e,t,r){(wr(e,"beforeSelectionChange")||e.cm&&wr(e.cm,"beforeSelectionChange"))&&(t=Pl(e,t,r));var n=r&&r.bias||(Qe(t.primary().head,e.sel.primary().head)<0?-1:1);Bs(e,Mo(e,t,n,!0)),!(r&&r.scroll===!1)&&e.cm&&e.cm.getOption("readOnly")!="nocursor"&&mn(e.cm)}function Bs(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=1,e.cm.curOp.selectionChanged=!0,_r(e.cm)),er(e,"cursorActivity",e))}function Oo(e){Bs(e,Mo(e,e.sel,null,!1))}function Mo(e,t,r,n){for(var i,o=0;o<t.ranges.length;o++){var s=t.ranges[o],l=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o],u=Qi(e,s.anchor,l&&l.anchor,r,n),c=s.head==s.anchor?u:Qi(e,s.head,l&&l.head,r,n);(i||u!=s.anchor||c!=s.head)&&(i||(i=t.ranges.slice(0,o)),i[o]=new Dt(u,c))}return i?Rr(e.cm,i,t.primIndex):t}function xi(e,t,r,n,i){var o=lt(e,t.line);if(o.markedSpans)for(var s=0;s<o.markedSpans.length;++s){var l=o.markedSpans[s],u=l.marker,c="selectLeft"in u?!u.selectLeft:u.inclusiveLeft,y="selectRight"in u?!u.selectRight:u.inclusiveRight;if((l.from==null||(c?l.from<=t.ch:l.from<t.ch))&&(l.to==null||(y?l.to>=t.ch:l.to>t.ch))){if(i&&(Qt(u,"beforeCursorEnter"),u.explicitlyCleared))if(o.markedSpans){--s;continue}else break;if(!u.atomic)continue;if(r){var R=u.find(n<0?1:-1),B=void 0;if((n<0?y:c)&&(R=Ds(e,R,-n,R&&R.line==t.line?o:null)),R&&R.line==t.line&&(B=Qe(R,r))&&(n<0?B<0:B>0))return xi(e,R,t,n,i)}var O=u.find(n<0?-1:1);return(n<0?c:y)&&(O=Ds(e,O,n,O.line==t.line?o:null)),O?xi(e,O,t,n,i):null}}return t}function Qi(e,t,r,n,i){var o=n||1,s=xi(e,t,r,o,i)||!i&&xi(e,t,r,o,!0)||xi(e,t,r,-o,i)||!i&&xi(e,t,r,-o,!0);return s||(e.cantEdit=!0,xe(e.first,0))}function Ds(e,t,r,n){return r<0&&t.ch==0?t.line>e.first?gt(e,xe(t.line-1)):null:r>0&&t.ch==(n||lt(e,t.line)).text.length?t.line<e.first+e.size-1?xe(t.line+1,0):null:new xe(t.line,t.ch+r)}function Gs(e){e.setSelection(xe(e.firstLine(),0),xe(e.lastLine()),ar)}function Fo(e,t,r){var n={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){return n.canceled=!0}};return r&&(n.update=function(i,o,s,l){i&&(n.from=gt(e,i)),o&&(n.to=gt(e,o)),s&&(n.text=s),l!==void 0&&(n.origin=l)}),Qt(e,"beforeChange",e,n),e.cm&&Qt(e.cm,"beforeChange",e.cm,n),n.canceled?(e.cm&&(e.cm.curOp.updateInput=2),null):{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Si(e,t,r){if(e.cm){if(!e.cm.curOp)return or(e.cm,Si)(e,t,r);if(e.cm.state.suppressEdits)return}if(!((wr(e,"beforeChange")||e.cm&&wr(e.cm,"beforeChange"))&&(t=Fo(e,t,!0),!t))){var n=ro&&!r&&io(e,t.from,t.to);if(n)for(var i=n.length-1;i>=0;--i)Hs(e,{from:n[i].from,to:n[i].to,text:i?[""]:t.text,origin:t.origin});else Hs(e,t)}}function Hs(e,t){if(!(t.text.length==1&&t.text[0]==""&&Qe(t.from,t.to)==0)){var r=ks(e,t);Lo(e,t,r,e.cm?e.cm.curOp.id:NaN),wn(e,t,r,Qo(e,t));var n=[];jn(e,function(i,o){!o&&ut(n,i.history)==-1&&(Yn(i.history,t),n.push(i.history)),wn(i,t,null,Qo(i,t))})}}function Zi(e,t,r){var n=e.cm&&e.cm.state.suppressEdits;if(!(n&&!r)){for(var i=e.history,o,s=e.sel,l=t=="undo"?i.done:i.undone,u=t=="undo"?i.undone:i.done,c=0;c<l.length&&(o=l[c],!(r?o.ranges&&!o.equals(e.sel):!o.ranges));c++);if(c!=l.length){for(i.lastOrigin=i.lastSelOrigin=null;;)if(o=l.pop(),o.ranges){if(Vi(o,u),r&&!o.equals(e.sel)){lr(e,o,{clearRedo:!1});return}s=o}else if(n){l.push(o);return}else break;var y=[];Vi(s,u),u.push({changes:y,generation:i.generation}),i.generation=o.generation||++i.maxGeneration;for(var R=wr(e,"beforeChange")||e.cm&&wr(e.cm,"beforeChange"),B=function(ce){var we=o.changes[ce];if(we.origin=t,R&&!Fo(e,we,!1))return l.length=0,{};y.push(Eo(e,we));var ge=ce?ks(e,we):_t(l);wn(e,we,ge,Is(e,we)),!ce&&e.cm&&e.cm.scrollIntoView({from:we.from,to:bn(we)});var Oe=[];jn(e,function(Ee,Me){!Me&&ut(Oe,Ee.history)==-1&&(Yn(Ee.history,we),Oe.push(Ee.history)),wn(Ee,we,null,Is(Ee,we))})},O=o.changes.length-1;O>=0;--O){var H=B(O);if(H)return H.v}}}}function Io(e,t){if(t!=0&&(e.first+=t,e.sel=new kr(ri(e.sel.ranges,function(i){return new Dt(xe(i.anchor.line+t,i.anchor.ch),xe(i.head.line+t,i.head.ch))}),e.sel.primIndex),e.cm)){pr(e.cm,e.first,e.first-t,t);for(var r=e.cm.display,n=r.viewFrom;n<r.viewTo;n++)hn(e.cm,n,"gutter")}}function wn(e,t,r,n){if(e.cm&&!e.cm.curOp)return or(e.cm,wn)(e,t,r,n);if(t.to.line<e.first){Io(e,t.text.length-1-(t.to.line-t.from.line));return}if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var i=t.text.length-1-(e.first-t.from.line);Io(e,i),t={from:xe(e.first,0),to:xe(t.to.line+i,t.to.ch),text:[_t(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:xe(o,lt(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=un(e,t.from,t.to),r||(r=ks(e,t)),e.cm?Bl(e.cm,t,n):Ki(e,t,n),Pa(e,r,ar),e.cantEdit&&Qi(e,xe(e.firstLine(),0))&&(e.cantEdit=!1)}}function Bl(e,t,r){var n=e.doc,i=e.display,o=t.from,s=t.to,l=!1,u=o.line;e.options.lineWrapping||(u=v(zr(lt(n,o.line))),n.iter(u,s.line+1,function(O){if(O==i.maxLine)return l=!0,!0})),n.sel.contains(t.from,t.to)>-1&&_r(e),Ki(n,t,r,pl(e)),e.options.lineWrapping||(n.iter(u,o.line+t.text.length,function(O){var H=lo(O);H>i.maxLineLength&&(i.maxLine=O,i.maxLineLength=H,i.maxLineChanged=!0,l=!1)}),l&&(e.curOp.updateMaxLine=!0)),eu(n,o.line),Ma(e,400);var c=t.text.length-(s.line-o.line)-1;t.full?pr(e):o.line==s.line&&t.text.length==1&&!Fl(e.doc,t)?hn(e,o.line,"text"):pr(e,o.line,s.line+1,c);var y=wr(e,"changes"),R=wr(e,"change");if(R||y){var B={from:o,to:s,text:t.text,removed:t.removed,origin:t.origin};R&&er(e,"change",e,B),y&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(B)}e.display.selForContextMenu=null}function Tn(e,t,r,n,i){var o;n||(n=r),Qe(n,r)<0&&(o=[n,r],r=o[0],n=o[1]),typeof t=="string"&&(t=e.splitLines(t)),Si(e,{from:r,to:n,text:t,origin:i})}function en(e,t,r,n){r<e.line?e.line+=n:t<e.line&&(e.line=t,e.ch=0)}function Ji(e,t,r,n){for(var i=0;i<e.length;++i){var o=e[i],s=!0;if(o.ranges){o.copied||(o=e[i]=o.deepCopy(),o.copied=!0);for(var l=0;l<o.ranges.length;l++)en(o.ranges[l].anchor,t,r,n),en(o.ranges[l].head,t,r,n);continue}for(var u=0;u<o.changes.length;++u){var c=o.changes[u];if(r<c.from.line)c.from=xe(c.from.line+n,c.from.ch),c.to=xe(c.to.line+n,c.to.ch);else if(t<=c.to.line){s=!1;break}}s||(e.splice(0,i+1),i=0)}}function Yn(e,t){var r=t.from.line,n=t.to.line,i=t.text.length-(n-r)-1;Ji(e.done,r,n,i),Ji(e.undone,r,n,i)}function Cn(e,t,r,n){var i=t,o=t;return typeof t=="number"?o=lt(e,Ks(e,t)):i=v(t),i==null?null:(n(o,i)&&e.cm&&hn(e.cm,i,r),o)}function _n(e){this.lines=e,this.parent=null;for(var t=0,r=0;r<e.length;++r)e[r].parent=this,t+=e[r].height;this.height=t}_n.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var r=e,n=e+t;r<n;++r){var i=this.lines[r];this.height-=i.height,Pi(i),er(i,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,r){this.height+=r,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var n=0;n<t.length;++n)t[n].parent=this},iterN:function(e,t,r){for(var n=e+t;e<n;++e)if(r(this.lines[e]))return!0}};function Ur(e){this.children=e;for(var t=0,r=0,n=0;n<e.length;++n){var i=e[n];t+=i.chunkSize(),r+=i.height,i.parent=this}this.size=t,this.height=r,this.parent=null}Ur.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var r=0;r<this.children.length;++r){var n=this.children[r],i=n.chunkSize();if(e<i){var o=Math.min(t,i-e),s=n.height;if(n.removeInner(e,o),this.height-=s-n.height,i==o&&(this.children.splice(r--,1),n.parent=null),(t-=o)==0)break;e=0}else e-=i}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof _n))){var l=[];this.collapse(l),this.children=[new _n(l)],this.children[0].parent=this}},collapse:function(e){for(var t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner:function(e,t,r){this.size+=t.length,this.height+=r;for(var n=0;n<this.children.length;++n){var i=this.children[n],o=i.chunkSize();if(e<=o){if(i.insertInner(e,t,r),i.lines&&i.lines.length>50){for(var s=i.lines.length%25+25,l=s;l<i.lines.length;){var u=new _n(i.lines.slice(l,l+=25));i.height-=u.height,this.children.splice(++n,0,u),u.parent=this}i.lines=i.lines.slice(0,s),this.maybeSpill()}break}e-=o}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=e.children.splice(e.children.length-5,5),r=new Ur(t);if(e.parent){e.size-=r.size,e.height-=r.height;var i=ut(e.parent.children,e);e.parent.children.splice(i+1,0,r)}else{var n=new Ur(e.children);n.parent=e,e.children=[n,r],e=n}r.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,r){for(var n=0;n<this.children.length;++n){var i=this.children[n],o=i.chunkSize();if(e<o){var s=Math.min(t,o-e);if(i.iterN(e,s,r))return!0;if((t-=s)==0)break;e=0}else e-=o}}};var Xr=function(e,t,r){if(r)for(var n in r)r.hasOwnProperty(n)&&(this[n]=r[n]);this.doc=e,this.node=t};Xr.prototype.clear=function(){var e=this.doc.cm,t=this.line.widgets,r=this.line,n=v(r);if(!(n==null||!t)){for(var i=0;i<t.length;++i)t[i]==this&&t.splice(i--,1);t.length||(r.widgets=null);var o=Hn(this);Er(r,Math.max(0,r.height-o)),e&&(br(e,function(){Kn(e,r,-o),hn(e,n,"widget")}),er(e,"lineWidgetCleared",e,this,n))}},Xr.prototype.changed=function(){var e=this,t=this.height,r=this.doc.cm,n=this.line;this.height=null;var i=Hn(this)-t;i&&(Bn(this.doc,n)||Er(n,n.height+i),r&&br(r,function(){r.curOp.forceUpdate=!0,Kn(r,n,i),er(r,"lineWidgetChanged",r,e,v(n))}))},Pr(Xr);function Kn(e,t,r){Cr(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&bs(e,r)}function No(e,t,r,n){var i=new Xr(e,r,n),o=e.cm;return o&&i.noHScroll&&(o.display.alignWidgets=!0),Cn(e,t,"widget",function(s){var l=s.widgets||(s.widgets=[]);if(i.insertAt==null?l.push(i):l.splice(Math.min(l.length,Math.max(0,i.insertAt)),0,i),i.line=s,o&&!Bn(e,s)){var u=Cr(s)<e.scrollTop;Er(s,s.height+Hn(i)),u&&bs(o,i.height),o.curOp.forceUpdate=!0}return!0}),o&&er(o,"lineWidgetAdded",o,i,typeof t=="number"?t:v(t)),i}var Ba=0,Nr=function(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++Ba};Nr.prototype.clear=function(){if(!this.explicitlyCleared){var e=this.doc.cm,t=e&&!e.curOp;if(t&&yr(e),wr(this,"clear")){var r=this.find();r&&er(this,"clear",r.from,r.to)}for(var n=null,i=null,o=0;o<this.lines.length;++o){var s=this.lines[o],l=ma(s.markedSpans,this);e&&!this.collapsed?hn(e,v(s),"text"):e&&(l.to!=null&&(i=v(s)),l.from!=null&&(n=v(s))),s.markedSpans=nu(s.markedSpans,l),l.from==null&&this.collapsed&&!Bn(this.doc,s)&&e&&Er(s,Gi(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var u=0;u<this.lines.length;++u){var c=zr(this.lines[u]),y=lo(c);y>e.display.maxLineLength&&(e.display.maxLine=c,e.display.maxLineLength=y,e.display.maxLineChanged=!0)}n!=null&&e&&this.collapsed&&pr(e,n,i+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&Oo(e.doc)),e&&er(e,"markerCleared",e,this,n,i),t&&gn(e),this.parent&&this.parent.clear()}},Nr.prototype.find=function(e,t){e==null&&this.type=="bookmark"&&(e=1);for(var r,n,i=0;i<this.lines.length;++i){var o=this.lines[i],s=ma(o.markedSpans,this);if(s.from!=null&&(r=xe(t?o:v(o),s.from),e==-1))return r;if(s.to!=null&&(n=xe(t?o:v(o),s.to),e==1))return n}return r&&{from:r,to:n}},Nr.prototype.changed=function(){var e=this,t=this.find(-1,!0),r=this,n=this.doc.cm;!t||!n||br(n,function(){var i=t.line,o=v(t.line),s=co(n,o);if(s&&(fl(s),n.curOp.selectionChanged=n.curOp.forceUpdate=!0),n.curOp.updateMaxLine=!0,!Bn(r.doc,i)&&r.height!=null){var l=r.height;r.height=null;var u=Hn(r)-l;u&&Er(i,i.height+u)}er(n,"markerChanged",n,e)})},Nr.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(!t.maybeHiddenMarkers||ut(t.maybeHiddenMarkers,this)==-1)&&(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},Nr.prototype.detachLine=function(e){if(this.lines.splice(ut(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},Pr(Nr);function Vn(e,t,r,n,i){if(n&&n.shared)return ea(e,t,r,n,i);if(e.cm&&!e.cm.curOp)return or(e.cm,Vn)(e,t,r,n,i);var o=new Nr(e,i),s=Qe(t,r);if(n&&pt(n,o,!1),s>0||s==0&&o.clearWhenEmpty!==!1)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=Z("span",[o.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||o.widgetNode.setAttribute("cm-ignore-events","true"),n.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(Jo(e,t.line,t,r,o)||t.line!=r.line&&Jo(e,r.line,t,r,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");ru()}o.addToHistory&&Lo(e,{from:t,to:r,origin:"markText"},e.sel,NaN);var l=t.line,u=e.cm,c;if(e.iter(l,r.line+1,function(R){u&&o.collapsed&&!u.options.lineWrapping&&zr(R)==u.display.maxLine&&(c=!0),o.collapsed&&l!=t.line&&Er(R,0),iu(R,new no(o,l==t.line?t.ch:null,l==r.line?r.ch:null),e.cm&&e.cm.curOp),++l}),o.collapsed&&e.iter(t.line,r.line+1,function(R){Bn(e,R)&&Er(R,0)}),o.clearOnEnter&&ht(o,"beforeCursorEnter",function(){return o.clear()}),o.readOnly&&(tu(),(e.history.done.length||e.history.undone.length)&&e.clearHistory()),o.collapsed&&(o.id=++Ba,o.atomic=!0),u){if(c&&(u.curOp.updateMaxLine=!0),o.collapsed)pr(u,t.line,r.line+1);else if(o.className||o.startStyle||o.endStyle||o.css||o.attributes||o.title)for(var y=t.line;y<=r.line;y++)hn(u,y,"text");o.atomic&&Oo(u.doc),er(u,"markerAdded",u,o)}return o}var wi=function(e,t){this.markers=e,this.primary=t;for(var r=0;r<e.length;++r)e[r].parent=this};wi.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();er(this,"clear")}},wi.prototype.find=function(e,t){return this.primary.find(e,t)},Pr(wi);function ea(e,t,r,n,i){n=pt(n),n.shared=!1;var o=[Vn(e,t,r,n,i)],s=o[0],l=n.widgetNode;return jn(e,function(u){l&&(n.widgetNode=l.cloneNode(!0)),o.push(Vn(u,gt(u,t),gt(u,r),n,i));for(var c=0;c<u.linked.length;++c)if(u.linked[c].isParent)return;s=_t(o)}),new wi(o,s)}function Ti(e){return e.findMarks(xe(e.first,0),e.clipPos(xe(e.lastLine())),function(t){return t.parent})}function Eu(e,t){for(var r=0;r<t.length;r++){var n=t[r],i=n.find(),o=e.clipPos(i.from),s=e.clipPos(i.to);if(Qe(o,s)){var l=Vn(e,o,s,n.primary,n.primary.type);n.markers.push(l),l.parent=n}}}function Lu(e){for(var t=function(n){var i=e[n],o=[i.primary.doc];jn(i.primary.doc,function(u){return o.push(u)});for(var s=0;s<i.markers.length;s++){var l=i.markers[s];ut(o,l.doc)==-1&&(l.parent=null,i.markers.splice(s--,1))}},r=0;r<e.length;r++)t(r)}var Dl=0,mr=function(e,t,r,n,i){if(!(this instanceof mr))return new mr(e,t,r,n,i);r==null&&(r=0),Ur.call(this,[new _n([new Zr("",null)])]),this.first=r,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=r;var o=xe(r,0);this.sel=Xn(o),this.history=new Sn(null),this.id=++Dl,this.modeOption=t,this.lineSep=n,this.direction=i=="rtl"?"rtl":"ltr",this.extend=!1,typeof e=="string"&&(e=this.splitLines(e)),Ki(this,{from:o,to:o,text:e}),lr(this,Xn(o),ar)};mr.prototype=Za(Ur.prototype,{constructor:mr,iter:function(e,t,r){r?this.iterN(e-this.first,t-e,r):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var r=0,n=0;n<t.length;++n)r+=t[n].height;this.insertInner(e-this.first,t,r)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=pa(this,this.first,this.first+this.size);return e===!1?t:t.join(e||this.lineSeparator())},setValue:sr(function(e){var t=xe(this.first,0),r=this.first+this.size-1;Si(this,{from:t,to:xe(r,lt(this,r).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&Oa(this.cm,0,0),lr(this,Xn(t),ar)}),replaceRange:function(e,t,r,n){t=gt(this,t),r=r?gt(this,r):t,Tn(this,e,t,r,n)},getRange:function(e,t,r){var n=un(this,gt(this,e),gt(this,t));return r===!1?n:r===""?n.join(""):n.join(r||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(Re(this,e))return lt(this,e)},getLineNumber:function(e){return v(e)},getLineHandleVisualStart:function(e){return typeof e=="number"&&(e=lt(this,e)),zr(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return gt(this,e)},getCursor:function(e){var t=this.sel.primary(),r;return e==null||e=="head"?r=t.head:e=="anchor"?r=t.anchor:e=="end"||e=="to"||e===!1?r=t.to():r=t.from(),r},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:sr(function(e,t,r){Ns(this,gt(this,typeof e=="number"?xe(e,t||0):e),null,r)}),setSelection:sr(function(e,t,r){Ns(this,gt(this,e),gt(this,t||e),r)}),extendSelection:sr(function(e,t,r){$i(this,gt(this,e),t&&gt(this,t),r)}),extendSelections:sr(function(e,t){ko(this,Ko(this,e),t)}),extendSelectionsBy:sr(function(e,t){var r=ri(this.sel.ranges,e);ko(this,Ko(this,r),t)}),setSelections:sr(function(e,t,r){if(e.length){for(var n=[],i=0;i<e.length;i++)n[i]=new Dt(gt(this,e[i].anchor),gt(this,e[i].head||e[i].anchor));t==null&&(t=Math.min(e.length-1,this.sel.primIndex)),lr(this,Rr(this.cm,n,t),r)}}),addSelection:sr(function(e,t,r){var n=this.sel.ranges.slice(0);n.push(new Dt(gt(this,e),gt(this,t||e))),lr(this,Rr(this.cm,n,n.length-1),r)}),getSelection:function(e){for(var t=this.sel.ranges,r,n=0;n<t.length;n++){var i=un(this,t[n].from(),t[n].to());r=r?r.concat(i):i}return e===!1?r:r.join(e||this.lineSeparator())},getSelections:function(e){for(var t=[],r=this.sel.ranges,n=0;n<r.length;n++){var i=un(this,r[n].from(),r[n].to());e!==!1&&(i=i.join(e||this.lineSeparator())),t[n]=i}return t},replaceSelection:function(e,t,r){for(var n=[],i=0;i<this.sel.ranges.length;i++)n[i]=e;this.replaceSelections(n,t,r||"+input")},replaceSelections:sr(function(e,t,r){for(var n=[],i=this.sel,o=0;o<i.ranges.length;o++){var s=i.ranges[o];n[o]={from:s.from(),to:s.to(),text:this.splitLines(e[o]),origin:r}}for(var l=t&&t!="end"&&Cu(this,n,t),u=n.length-1;u>=0;u--)Si(this,n[u]);l?Ps(this,l):this.cm&&mn(this.cm)}),undo:sr(function(){Zi(this,"undo")}),redo:sr(function(){Zi(this,"redo")}),undoSelection:sr(function(){Zi(this,"undo",!0)}),redoSelection:sr(function(){Zi(this,"redo",!0)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,r=0,n=0;n<e.done.length;n++)e.done[n].ranges||++t;for(var i=0;i<e.undone.length;i++)e.undone[i].ranges||++r;return{undo:t,redo:r}},clearHistory:function(){var e=this;this.history=new Sn(this.history),jn(this,function(t){return t.history=e.history},!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:bi(this.history.done),undone:bi(this.history.undone)}},setHistory:function(e){var t=this.history=new Sn(this.history);t.done=bi(e.done.slice(0),null,!0),t.undone=bi(e.undone.slice(0),null,!0)},setGutterMarker:sr(function(e,t,r){return Cn(this,e,"gutter",function(n){var i=n.gutterMarkers||(n.gutterMarkers={});return i[t]=r,!r&&Yr(i)&&(n.gutterMarkers=null),!0})}),clearGutter:sr(function(e){var t=this;this.iter(function(r){r.gutterMarkers&&r.gutterMarkers[e]&&Cn(t,r,"gutter",function(){return r.gutterMarkers[e]=null,Yr(r.gutterMarkers)&&(r.gutterMarkers=null),!0})})}),lineInfo:function(e){var t;if(typeof e=="number"){if(!Re(this,e)||(t=e,e=lt(this,e),!e))return null}else if(t=v(e),t==null)return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:sr(function(e,t,r){return Cn(this,e,t=="gutter"?"gutter":"class",function(n){var i=t=="text"?"textClass":t=="background"?"bgClass":t=="gutter"?"gutterClass":"wrapClass";if(!n[i])n[i]=r;else{if(ke(r).test(n[i]))return!1;n[i]+=" "+r}return!0})}),removeLineClass:sr(function(e,t,r){return Cn(this,e,t=="gutter"?"gutter":"class",function(n){var i=t=="text"?"textClass":t=="background"?"bgClass":t=="gutter"?"gutterClass":"wrapClass",o=n[i];if(o)if(r==null)n[i]=null;else{var s=o.match(ke(r));if(!s)return!1;var l=s.index+s[0].length;n[i]=o.slice(0,s.index)+(!s.index||l==o.length?"":" ")+o.slice(l)||null}else return!1;return!0})}),addLineWidget:sr(function(e,t,r){return No(this,e,t,r)}),removeLineWidget:function(e){e.clear()},markText:function(e,t,r){return Vn(this,gt(this,e),gt(this,t),r,r&&r.type||"range")},setBookmark:function(e,t){var r={replacedWith:t&&(t.nodeType==null?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return e=gt(this,e),Vn(this,e,e,r,"bookmark")},findMarksAt:function(e){e=gt(this,e);var t=[],r=lt(this,e.line).markedSpans;if(r)for(var n=0;n<r.length;++n){var i=r[n];(i.from==null||i.from<=e.ch)&&(i.to==null||i.to>=e.ch)&&t.push(i.marker.parent||i.marker)}return t},findMarks:function(e,t,r){e=gt(this,e),t=gt(this,t);var n=[],i=e.line;return this.iter(e.line,t.line+1,function(o){var s=o.markedSpans;if(s)for(var l=0;l<s.length;l++){var u=s[l];!(u.to!=null&&i==e.line&&e.ch>=u.to||u.from==null&&i!=e.line||u.from!=null&&i==t.line&&u.from>=t.ch)&&(!r||r(u.marker))&&n.push(u.marker.parent||u.marker)}++i}),n},getAllMarks:function(){var e=[];return this.iter(function(t){var r=t.markedSpans;if(r)for(var n=0;n<r.length;++n)r[n].from!=null&&e.push(r[n].marker)}),e},posFromIndex:function(e){var t,r=this.first,n=this.lineSeparator().length;return this.iter(function(i){var o=i.text.length+n;if(o>e)return t=e,!0;e-=o,++r}),gt(this,xe(r,t))},indexFromPos:function(e){e=gt(this,e);var t=e.ch;if(e.line<this.first||e.ch<0)return 0;var r=this.lineSeparator().length;return this.iter(this.first,e.line,function(n){t+=n.text.length+r}),t},copy:function(e){var t=new mr(pa(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,r=this.first+this.size;e.from!=null&&e.from>t&&(t=e.from),e.to!=null&&e.to<r&&(r=e.to);var n=new mr(pa(this,t,r),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],Eu(n,Ti(this)),n},unlinkDoc:function(e){if(e instanceof Yt&&(e=e.doc),this.linked)for(var t=0;t<this.linked.length;++t){var r=this.linked[t];if(r.doc==e){this.linked.splice(t,1),e.unlinkDoc(this),Lu(Ti(this));break}}if(e.history==this.history){var n=[e.id];jn(e,function(i){return n.push(i.id)},!0),e.history=new Sn(null),e.history.done=bi(this.history.done,n),e.history.undone=bi(this.history.undone,n)}},iterLinkedDocs:function(e){jn(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):Bt(e)},lineSeparator:function(){return this.lineSep||`
`},setDirection:sr(function(e){e!="rtl"&&(e="ltr"),e!=this.direction&&(this.direction=e,this.iter(function(t){return t.order=null}),this.cm&&_u(this.cm))})}),mr.prototype.eachLine=mr.prototype.iter;var zs=0;function Au(e){var t=this;if(Gl(t),!(Kt(t,e)||Wr(t.display,e))){qt(e),he&&(zs=+new Date);var r=ur(t,e,!0),n=e.dataTransfer.files;if(!(!r||t.isReadOnly()))if(n&&n.length&&window.FileReader&&window.File)for(var i=n.length,o=Array(i),s=0,l=function(){++s==i&&or(t,function(){r=gt(t.doc,r);var O={from:r,to:r,text:t.doc.splitLines(o.filter(function(H){return H!=null}).join(t.doc.lineSeparator())),origin:"paste"};Si(t.doc,O),Ps(t.doc,Xn(gt(t.doc,r),gt(t.doc,bn(O))))})()},u=function(O,H){if(t.options.allowDropFileTypes&&ut(t.options.allowDropFileTypes,O.type)==-1){l();return}var ce=new FileReader;ce.onerror=function(){return l()},ce.onload=function(){var we=ce.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(we)){l();return}o[H]=we,l()},ce.readAsText(O)},c=0;c<n.length;c++)u(n[c],c);else{if(t.state.draggingText&&t.doc.sel.contains(r)>-1){t.state.draggingText(e),setTimeout(function(){return t.display.input.focus()},20);return}try{var y=e.dataTransfer.getData("Text");if(y){var R;if(t.state.draggingText&&!t.state.draggingText.copy&&(R=t.listSelections()),Pa(t.doc,Xn(r,r)),R)for(var B=0;B<R.length;++B)Tn(t.doc,"",R[B].anchor,R[B].head,"drag");t.replaceSelection(y,"around","paste"),t.display.input.focus()}}catch{}}}}function ta(e,t){if(he&&(!e.state.draggingText||+new Date-zs<100)){In(t);return}if(!(Kt(e,t)||Wr(e.display,t))&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!Ge)){var r=p("img",null,null,"position: fixed; left: 0; top: 0;");r.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",ve&&(r.width=r.height=1,e.display.wrapper.appendChild(r),r._top=r.offsetTop),t.dataTransfer.setDragImage(r,0,0),ve&&r.parentNode.removeChild(r)}}function ku(e,t){var r=ur(e,t);if(r){var n=document.createDocumentFragment();ir(e,r,n),e.display.dragCursor||(e.display.dragCursor=p("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),E(e.display.dragCursor,n)}}function Gl(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function Hl(e){if(document.getElementsByClassName){for(var t=document.getElementsByClassName("CodeMirror"),r=[],n=0;n<t.length;n++){var i=t[n].CodeMirror;i&&r.push(i)}r.length&&r[0].operation(function(){for(var o=0;o<r.length;o++)e(r[o])})}}var Ws=!1;function Ru(){Ws||(Ou(),Ws=!0)}function Ou(){var e;ht(window,"resize",function(){e==null&&(e=setTimeout(function(){e=null,Hl(Mu)},100))}),ht(window,"blur",function(){return Hl(Wi)})}function Mu(e){var t=e.display;t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize()}for(var $n={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Da=0;Da<10;Da++)$n[Da+48]=$n[Da+96]=String(Da);for(var Po=65;Po<=90;Po++)$n[Po]=String.fromCharCode(Po);for(var Ga=1;Ga<=12;Ga++)$n[Ga+111]=$n[Ga+63235]="F"+Ga;var En={};En.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},En.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},En.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},En.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},En.default=_?En.macDefault:En.pcDefault;function Fu(e){var t=e.split(/-(?!$)/);e=t[t.length-1];for(var r,n,i,o,s=0;s<t.length-1;s++){var l=t[s];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))n=!0;else if(/^s(hift)?$/i.test(l))i=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(e="Alt-"+e),n&&(e="Ctrl-"+e),o&&(e="Cmd-"+e),i&&(e="Shift-"+e),e}function Iu(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];if(/^(name|fallthrough|(de|at)tach)$/.test(r))continue;if(n=="..."){delete e[r];continue}for(var i=ri(r.split(" "),Fu),o=0;o<i.length;o++){var s=void 0,l=void 0;o==i.length-1?(l=i.join(" "),s=n):(l=i.slice(0,o+1).join(" "),s="...");var u=t[l];if(!u)t[l]=s;else if(u!=s)throw new Error("Inconsistent bindings for "+l)}delete e[r]}for(var c in t)e[c]=t[c];return e}function Qn(e,t,r,n){t=ra(t);var i=t.call?t.call(e,n):t[e];if(i===!1)return"nothing";if(i==="...")return"multi";if(i!=null&&r(i))return"handled";if(t.fallthrough){if(Object.prototype.toString.call(t.fallthrough)!="[object Array]")return Qn(e,t.fallthrough,r,n);for(var o=0;o<t.fallthrough.length;o++){var s=Qn(e,t.fallthrough[o],r,n);if(s)return s}}}function Ha(e){var t=typeof e=="string"?e:$n[e.keyCode];return t=="Ctrl"||t=="Alt"||t=="Shift"||t=="Mod"}function za(e,t,r){var n=e;return t.altKey&&n!="Alt"&&(e="Alt-"+e),(me?t.metaKey:t.ctrlKey)&&n!="Ctrl"&&(e="Ctrl-"+e),(me?t.ctrlKey:t.metaKey)&&n!="Mod"&&(e="Cmd-"+e),!r&&t.shiftKey&&n!="Shift"&&(e="Shift-"+e),e}function Wa(e,t){if(ve&&e.keyCode==34&&e.char)return!1;var r=$n[e.keyCode];return r==null||e.altGraphKey?!1:(e.keyCode==3&&e.code&&(r=e.code),za(r,e,t))}function ra(e){return typeof e=="string"?En[e]:e}function Ln(e,t){for(var r=e.doc.sel.ranges,n=[],i=0;i<r.length;i++){for(var o=t(r[i]);n.length&&Qe(o.from,_t(n).to)<=0;){var s=n.pop();if(Qe(s.from,o.from)<0){o.from=s.from;break}}n.push(o)}br(e,function(){for(var l=n.length-1;l>=0;l--)Tn(e.doc,"",n[l].from,n[l].to,"+delete");mn(e)})}function na(e,t,r){var n=on(e.text,t+r,r);return n<0||n>e.text.length?null:n}function ia(e,t,r){var n=na(e,t.ch,r);return n==null?null:new xe(t.line,n,r<0?"after":"before")}function qa(e,t,r,n,i){if(e){t.doc.direction=="rtl"&&(i=-i);var o=At(r,t.doc.direction);if(o){var s=i<0?_t(o):o[0],l=i<0==(s.level==1),u=l?"after":"before",c;if(s.level>0||t.doc.direction=="rtl"){var y=li(t,r);c=i<0?r.text.length-1:0;var R=qr(t,y,c).top;c=Vr(function(B){return qr(t,y,B).top==R},i<0==(s.level==1)?s.from:s.to-1,c),u=="before"&&(c=na(r,c,1))}else c=i<0?s.to:s.from;return new xe(n,c,u)}}return new xe(n,i<0?r.text.length:0,i<0?"before":"after")}function Bo(e,t,r,n){var i=At(t,e.doc.direction);if(!i)return ia(t,r,n);r.ch>=t.text.length?(r.ch=t.text.length,r.sticky="before"):r.ch<=0&&(r.ch=0,r.sticky="after");var o=nr(i,r.ch,r.sticky),s=i[o];if(e.doc.direction=="ltr"&&s.level%2==0&&(n>0?s.to>r.ch:s.from<r.ch))return ia(t,r,n);var l=function(ge,Oe){return na(t,ge instanceof xe?ge.ch:ge,Oe)},u,c=function(ge){return e.options.lineWrapping?(u=u||li(e,t),La(e,t,u,ge)):{begin:0,end:t.text.length}},y=c(r.sticky=="before"?l(r,-1):r.ch);if(e.doc.direction=="rtl"||s.level==1){var R=s.level==1==n<0,B=l(r,R?1:-1);if(B!=null&&(R?B<=s.to&&B<=y.end:B>=s.from&&B>=y.begin)){var O=R?"before":"after";return new xe(r.line,B,O)}}var H=function(ge,Oe,Ee){for(var Me=function(rt,kt){return kt?new xe(r.line,l(rt,1),"before"):new xe(r.line,rt,"after")};ge>=0&&ge<i.length;ge+=Oe){var Ye=i[ge],Ze=Oe>0==(Ye.level!=1),ct=Ze?Ee.begin:l(Ee.end,-1);if(Ye.from<=ct&&ct<Ye.to||(ct=Ze?Ye.from:l(Ye.to,-1),Ee.begin<=ct&&ct<Ee.end))return Me(ct,Ze)}},ce=H(o+n,n,y);if(ce)return ce;var we=n>0?y.end:l(y.begin,-1);return we!=null&&!(n>0&&we==t.text.length)&&(ce=H(n>0?0:i.length-1,n,c(we)),ce)?ce:null}var Zn={selectAll:Gs,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),ar)},killLine:function(e){return Ln(e,function(t){if(t.empty()){var r=lt(e.doc,t.head.line).text.length;return t.head.ch==r&&t.head.line<e.lastLine()?{from:t.head,to:xe(t.head.line+1,0)}:{from:t.head,to:xe(t.head.line,r)}}else return{from:t.from(),to:t.to()}})},deleteLine:function(e){return Ln(e,function(t){return{from:xe(t.from().line,0),to:gt(e.doc,xe(t.to().line+1,0))}})},delLineLeft:function(e){return Ln(e,function(t){return{from:xe(t.from().line,0),to:t.from()}})},delWrappedLineLeft:function(e){return Ln(e,function(t){var r=e.charCoords(t.head,"div").top+5,n=e.coordsChar({left:0,top:r},"div");return{from:n,to:t.from()}})},delWrappedLineRight:function(e){return Ln(e,function(t){var r=e.charCoords(t.head,"div").top+5,n=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div");return{from:t.from(),to:n}})},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(xe(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(xe(e.lastLine()))},goLineStart:function(e){return e.extendSelectionsBy(function(t){return Ua(e,t.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(e){return e.extendSelectionsBy(function(t){return aa(e,t.head)},{origin:"+move",bias:1})},goLineEnd:function(e){return e.extendSelectionsBy(function(t){return Xa(e,t.head.line)},{origin:"+move",bias:-1})},goLineRight:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div")},fr)},goLineLeft:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:r},"div")},fr)},goLineLeftSmart:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5,n=e.coordsChar({left:0,top:r},"div");return n.ch<e.getLine(n.line).search(/\S/)?aa(e,t.head):n},fr)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"codepoint")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("	")},insertSoftTab:function(e){for(var t=[],r=e.listSelections(),n=e.options.tabSize,i=0;i<r.length;i++){var o=r[i].from(),s=Ct(e.getLine(o.line),o.ch,n);t.push(nn(n-s%n))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){return br(e,function(){for(var t=e.listSelections(),r=[],n=0;n<t.length;n++)if(t[n].empty()){var i=t[n].head,o=lt(e.doc,i.line).text;if(o){if(i.ch==o.length&&(i=new xe(i.line,i.ch-1)),i.ch>0)i=new xe(i.line,i.ch+1),e.replaceRange(o.charAt(i.ch-1)+o.charAt(i.ch-2),xe(i.line,i.ch-2),i,"+transpose");else if(i.line>e.doc.first){var s=lt(e.doc,i.line-1).text;s&&(i=new xe(i.line,1),e.replaceRange(o.charAt(0)+e.doc.lineSeparator()+s.charAt(s.length-1),xe(i.line-1,s.length-1),i,"+transpose"))}}r.push(new Dt(i,i))}e.setSelections(r)})},newlineAndIndent:function(e){return br(e,function(){for(var t=e.listSelections(),r=t.length-1;r>=0;r--)e.replaceRange(e.doc.lineSeparator(),t[r].anchor,t[r].head,"+input");t=e.listSelections();for(var n=0;n<t.length;n++)e.indentLine(t[n].from().line,null,!0);mn(e)})},openLine:function(e){return e.replaceSelection(`
`,"start")},toggleOverwrite:function(e){return e.toggleOverwrite()}};function Ua(e,t){var r=lt(e.doc,t),n=zr(r);return n!=r&&(t=v(n)),qa(!0,e,n,t,1)}function Xa(e,t){var r=lt(e.doc,t),n=ou(r);return n!=r&&(t=v(n)),qa(!0,e,r,t,-1)}function aa(e,t){var r=Ua(e,t.line),n=lt(e.doc,r.line),i=At(n,e.doc.direction);if(!i||i[0].level==0){var o=Math.max(r.ch,n.text.search(/\S/)),s=t.line==r.line&&t.ch<=o&&t.ch;return xe(r.line,s?0:o,r.sticky)}return r}function Jn(e,t,r){if(typeof t=="string"&&(t=Zn[t],!t))return!1;e.display.input.ensurePolled();var n=e.display.shift,i=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),r&&(e.display.shift=!1),i=t(e)!=Vt}finally{e.display.shift=n,e.state.suppressEdits=!1}return i}function ja(e,t,r){for(var n=0;n<e.state.keyMaps.length;n++){var i=Qn(t,e.state.keyMaps[n],r,e);if(i)return i}return e.options.extraKeys&&Qn(t,e.options.extraKeys,r,e)||Qn(t,e.options.keyMap,r,e)}var Ya=new Ht;function oa(e,t,r,n){var i=e.state.keySeq;if(i){if(Ha(t))return"handled";if(/\'$/.test(t)?e.state.keySeq=null:Ya.set(50,function(){e.state.keySeq==i&&(e.state.keySeq=null,e.display.input.reset())}),sa(e,i+" "+t,r,n))return!0}return sa(e,t,r,n)}function sa(e,t,r,n){var i=ja(e,t,n);return i=="multi"&&(e.state.keySeq=t),i=="handled"&&er(e,"keyHandled",e,t,r),(i=="handled"||i=="multi")&&(qt(r),vn(e)),!!i}function ei(e,t){var r=Wa(t,!0);return r?t.shiftKey&&!e.state.keySeq?oa(e,"Shift-"+r,t,function(n){return Jn(e,n,!0)})||oa(e,r,t,function(n){if(typeof n=="string"?/^go[A-Z]/.test(n):n.motion)return Jn(e,n)}):oa(e,r,t,function(n){return Jn(e,n)}):!1}function zl(e,t,r){return oa(e,"'"+r+"'",t,function(n){return Jn(e,n,!0)})}var Ka=null;function Wl(e){var t=this;if(!(e.target&&e.target!=t.display.input.getField())&&(t.curOp.focus=$e(Rt(t)),!Kt(t,e))){he&&ee<11&&e.keyCode==27&&(e.returnValue=!1);var r=e.keyCode;t.display.shift=r==16||e.shiftKey;var n=ei(t,e);ve&&(Ka=n?r:null,!n&&r==88&&!to&&(_?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut")),S&&!_&&!n&&r==46&&e.shiftKey&&!e.ctrlKey&&document.execCommand&&document.execCommand("cut"),r==18&&!/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)&&Nu(t)}}function Nu(e){var t=e.display.lineDiv;Ve(t,"CodeMirror-crosshair");function r(n){(n.keyCode==18||!n.altKey)&&(We(t,"CodeMirror-crosshair"),cr(document,"keyup",r),cr(document,"mouseover",r))}ht(document,"keyup",r),ht(document,"mouseover",r)}function ql(e){e.keyCode==16&&(this.doc.sel.shift=!1),Kt(this,e)}function An(e){var t=this;if(!(e.target&&e.target!=t.display.input.getField())&&!(Wr(t.display,e)||Kt(t,e)||e.ctrlKey&&!e.altKey||_&&e.metaKey)){var r=e.keyCode,n=e.charCode;if(ve&&r==Ka){Ka=null,qt(e);return}if(!(ve&&(!e.which||e.which<10)&&ei(t,e))){var i=String.fromCharCode(n??r);i!="\b"&&(zl(t,e,i)||t.display.input.onKeyPress(e))}}}var Ul=400,Do=function(e,t,r){this.time=e,this.pos=t,this.button=r};Do.prototype.compare=function(e,t,r){return this.time+Ul>e&&Qe(t,this.pos)==0&&r==this.button};var la,Va;function Xl(e,t){var r=+new Date;return Va&&Va.compare(r,e,t)?(la=Va=null,"triple"):la&&la.compare(r,e,t)?(Va=new Do(r,e,t),la=null,"double"):(la=new Do(r,e,t),Va=null,"single")}function jl(e){var t=this,r=t.display;if(!(Kt(t,e)||r.activeTouch&&r.input.supportsTouch())){if(r.input.ensurePolled(),r.shift=e.shiftKey,Wr(r,e)){j||(r.scroller.draggable=!1,setTimeout(function(){return r.scroller.draggable=!0},100));return}if(!dr(t,e)){var n=ur(t,e),i=Br(e),o=n?Xl(n,i):"single";ft(t).focus(),i==1&&t.state.selectingText&&t.state.selectingText(e),!(n&&tn(t,i,n,o,e))&&(i==1?n?ua(t,n,o,e):da(e)==r.scroller&&qt(e):i==2?(n&&$i(t.doc,n),setTimeout(function(){return r.input.focus()},20)):i==3&&(Te?t.display.input.onContextMenu(e):bo(t)))}}}function tn(e,t,r,n,i){var o="Click";return n=="double"?o="Double"+o:n=="triple"&&(o="Triple"+o),o=(t==1?"Left":t==2?"Middle":"Right")+o,oa(e,za(o,i),i,function(s){if(typeof s=="string"&&(s=Zn[s]),!s)return!1;var l=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),l=s(e,r)!=Vt}finally{e.state.suppressEdits=!1}return l})}function Yl(e,t,r){var n=e.getOption("configureMouse"),i=n?n(e,t,r):{};if(i.unit==null){var o=D?r.shiftKey&&r.metaKey:r.altKey;i.unit=o?"rectangle":t=="single"?"char":t=="double"?"word":"line"}return(i.extend==null||e.doc.extend)&&(i.extend=e.doc.extend||r.shiftKey),i.addNew==null&&(i.addNew=_?r.metaKey:r.ctrlKey),i.moveOnDrag==null&&(i.moveOnDrag=!(_?r.altKey:r.ctrlKey)),i}function ua(e,t,r,n){he?setTimeout(tt(gs,e),0):e.curOp.focus=$e(Rt(e));var i=Yl(e,r,n),o=e.doc.sel,s;e.options.dragDrop&&Xo&&!e.isReadOnly()&&r=="single"&&(s=o.contains(t))>-1&&(Qe((s=o.ranges[s]).from(),t)<0||t.xRel>0)&&(Qe(s.to(),t)>0||t.xRel<0)?ti(e,n,t,i):Us(e,n,t,i)}function ti(e,t,r,n){var i=e.display,o=!1,s=or(e,function(c){j&&(i.scroller.draggable=!1),e.state.draggingText=!1,e.state.delayingBlurEvent&&(e.hasFocus()?e.state.delayingBlurEvent=!1:bo(e)),cr(i.wrapper.ownerDocument,"mouseup",s),cr(i.wrapper.ownerDocument,"mousemove",l),cr(i.scroller,"dragstart",u),cr(i.scroller,"drop",s),o||(qt(c),n.addNew||$i(e.doc,r,null,null,n.extend),j&&!Ge||he&&ee==9?setTimeout(function(){i.wrapper.ownerDocument.body.focus({preventScroll:!0}),i.input.focus()},20):i.input.focus())}),l=function(c){o=o||Math.abs(t.clientX-c.clientX)+Math.abs(t.clientY-c.clientY)>=10},u=function(){return o=!0};j&&(i.scroller.draggable=!0),e.state.draggingText=s,s.copy=!n.moveOnDrag,ht(i.wrapper.ownerDocument,"mouseup",s),ht(i.wrapper.ownerDocument,"mousemove",l),ht(i.scroller,"dragstart",u),ht(i.scroller,"drop",s),e.state.delayingBlurEvent=!0,setTimeout(function(){return i.input.focus()},20),i.scroller.dragDrop&&i.scroller.dragDrop()}function qs(e,t,r){if(r=="char")return new Dt(t,t);if(r=="word")return e.findWordAt(t);if(r=="line")return new Dt(xe(t.line,0),gt(e.doc,xe(t.line+1,0)));var n=r(e,t);return new Dt(n.from,n.to)}function Us(e,t,r,n){he&&bo(e);var i=e.display,o=e.doc;qt(t);var s,l,u=o.sel,c=u.ranges;if(n.addNew&&!n.extend?(l=o.sel.contains(r),l>-1?s=c[l]:s=new Dt(r,r)):(s=o.sel.primary(),l=o.sel.primIndex),n.unit=="rectangle")n.addNew||(s=new Dt(r,r)),r=ur(e,t,!0,!0),l=-1;else{var y=qs(e,r,n.unit);n.extend?s=Ao(s,y.anchor,y.head,n.extend):s=y}n.addNew?l==-1?(l=c.length,lr(o,Rr(e,c.concat([s]),l),{scroll:!1,origin:"*mouse"})):c.length>1&&c[l].empty()&&n.unit=="char"&&!n.extend?(lr(o,Rr(e,c.slice(0,l).concat(c.slice(l+1)),0),{scroll:!1,origin:"*mouse"}),u=o.sel):Ro(o,l,s,Sr):(l=0,lr(o,new kr([s],0),Sr),u=o.sel);var R=r;function B(Ee){if(Qe(R,Ee)!=0)if(R=Ee,n.unit=="rectangle"){for(var Me=[],Ye=e.options.tabSize,Ze=Ct(lt(o,r.line).text,r.ch,Ye),ct=Ct(lt(o,Ee.line).text,Ee.ch,Ye),rt=Math.min(Ze,ct),kt=Math.max(Ze,ct),yt=Math.min(r.line,Ee.line),Ft=Math.min(e.lastLine(),Math.max(r.line,Ee.line));yt<=Ft;yt++){var It=lt(o,yt).text,Et=$t(It,rt,Ye);rt==kt?Me.push(new Dt(xe(yt,Et),xe(yt,Et))):It.length>Et&&Me.push(new Dt(xe(yt,Et),xe(yt,$t(It,kt,Ye))))}Me.length||Me.push(new Dt(r,r)),lr(o,Rr(e,u.ranges.slice(0,l).concat(Me),l),{origin:"*mouse",scroll:!1}),e.scrollIntoView(Ee)}else{var Gt=s,Nt=qs(e,Ee,n.unit),Tt=Gt.anchor,nt;Qe(Nt.anchor,Tt)>0?(nt=Nt.head,Tt=Fi(Gt.from(),Nt.anchor)):(nt=Nt.anchor,Tt=hr(Gt.to(),Nt.head));var Lt=u.ranges.slice(0);Lt[l]=Go(e,new Dt(gt(o,Tt),nt)),lr(o,Rr(e,Lt,l),Sr)}}var O=i.wrapper.getBoundingClientRect(),H=0;function ce(Ee){var Me=++H,Ye=ur(e,Ee,!0,n.unit=="rectangle");if(Ye)if(Qe(Ye,R)!=0){e.curOp.focus=$e(Rt(e)),B(Ye);var Ze=qi(i,o);(Ye.line>=Ze.to||Ye.line<Ze.from)&&setTimeout(or(e,function(){H==Me&&ce(Ee)}),150)}else{var ct=Ee.clientY<O.top?-20:Ee.clientY>O.bottom?20:0;ct&&setTimeout(or(e,function(){H==Me&&(i.scroller.scrollTop+=ct,ce(Ee))}),50)}}function we(Ee){e.state.selectingText=!1,H=1/0,Ee&&(qt(Ee),i.input.focus()),cr(i.wrapper.ownerDocument,"mousemove",ge),cr(i.wrapper.ownerDocument,"mouseup",Oe),o.history.lastSelOrigin=null}var ge=or(e,function(Ee){Ee.buttons===0||!Br(Ee)?we(Ee):ce(Ee)}),Oe=or(e,we);e.state.selectingText=Oe,ht(i.wrapper.ownerDocument,"mousemove",ge),ht(i.wrapper.ownerDocument,"mouseup",Oe)}function Go(e,t){var r=t.anchor,n=t.head,i=lt(e.doc,r.line);if(Qe(r,n)==0&&r.sticky==n.sticky)return t;var o=At(i);if(!o)return t;var s=nr(o,r.ch,r.sticky),l=o[s];if(l.from!=r.ch&&l.to!=r.ch)return t;var u=s+(l.from==r.ch==(l.level!=1)?0:1);if(u==0||u==o.length)return t;var c;if(n.line!=r.line)c=(n.line-r.line)*(e.doc.direction=="ltr"?1:-1)>0;else{var y=nr(o,n.ch,n.sticky),R=y-s||(n.ch-r.ch)*(l.level==1?-1:1);y==u-1||y==u?c=R<0:c=R>0}var B=o[u+(c?-1:0)],O=c==(B.level==1),H=O?B.from:B.to,ce=O?"after":"before";return r.ch==H&&r.sticky==ce?t:new Dt(new xe(r.line,H,ce),n)}function Xs(e,t,r,n){var i,o;if(t.touches)i=t.touches[0].clientX,o=t.touches[0].clientY;else try{i=t.clientX,o=t.clientY}catch{return!1}if(i>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;n&&qt(t);var s=e.display,l=s.lineDiv.getBoundingClientRect();if(o>l.bottom||!wr(e,r))return gr(t);o-=l.top-s.viewOffset;for(var u=0;u<e.display.gutterSpecs.length;++u){var c=s.gutters.childNodes[u];if(c&&c.getBoundingClientRect().right>=i){var y=X(e.doc,o),R=e.display.gutterSpecs[u];return Qt(e,r,e,y,R.className,t),gr(t)}}}function dr(e,t){return Xs(e,t,"gutterClick",!0)}function kn(e,t){Wr(e.display,t)||tr(e,t)||Kt(e,t,"contextmenu")||Te||e.display.input.onContextMenu(t)}function tr(e,t){return wr(e,"gutterContextMenu")?Xs(e,t,"gutterContextMenu",!1):!1}function xr(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),_a(e)}var Ci={toString:function(){return"CodeMirror.Init"}},Kl={},Ho={};function Pu(e){var t=e.optionHandlers;function r(n,i,o,s){e.defaults[n]=i,o&&(t[n]=s?function(l,u,c){c!=Ci&&o(l,u,c)}:o)}e.defineOption=r,e.Init=Ci,r("value","",function(n,i){return n.setValue(i)},!0),r("mode",null,function(n,i){n.doc.modeOption=i,Rs(n)},!0),r("indentUnit",2,Rs,!0),r("indentWithTabs",!1),r("smartIndent",!0),r("tabSize",4,function(n){xn(n),_a(n),pr(n)},!0),r("lineSeparator",null,function(n,i){if(n.doc.lineSep=i,!!i){var o=[],s=n.doc.first;n.doc.iter(function(u){for(var c=0;;){var y=u.text.indexOf(i,c);if(y==-1)break;c=y+i.length,o.push(xe(s,y))}s++});for(var l=o.length-1;l>=0;l--)Tn(n.doc,i,o[l],xe(o[l].line,o[l].ch+i.length))}}),r("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\u202d\u202e\u2066\u2067\u2069\ufeff\ufff9-\ufffc]/g,function(n,i,o){n.state.specialChars=new RegExp(i.source+(i.test("	")?"":"|	"),"g"),o!=Ci&&n.refresh()}),r("specialCharPlaceholder",is,function(n){return n.refresh()},!0),r("electricChars",!0),r("inputStyle",h?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),r("spellcheck",!1,function(n,i){return n.getInputField().spellcheck=i},!0),r("autocorrect",!1,function(n,i){return n.getInputField().autocorrect=i},!0),r("autocapitalize",!1,function(n,i){return n.getInputField().autocapitalize=i},!0),r("rtlMoveVisually",!W),r("wholeLineUpdateBefore",!0),r("theme","default",function(n){xr(n),Ia(n)},!0),r("keyMap","default",function(n,i,o){var s=ra(i),l=o!=Ci&&ra(o);l&&l.detach&&l.detach(n,s),s.attach&&s.attach(n,l||null)}),r("extraKeys",null),r("configureMouse",null),r("lineWrapping",!1,Vl,!0),r("gutters",[],function(n,i){n.display.gutterSpecs=Ls(i,n.options.lineNumbers),Ia(n)},!0),r("fixedGutter",!0,function(n,i){n.display.gutters.style.left=i?ci(n.display)+"px":"0",n.refresh()},!0),r("coverGutterNextToScrollbar",!1,function(n){return pi(n)},!0),r("scrollbarStyle","native",function(n){Ts(n),pi(n),n.display.scrollbars.setScrollTop(n.doc.scrollTop),n.display.scrollbars.setScrollLeft(n.doc.scrollLeft)},!0),r("lineNumbers",!1,function(n,i){n.display.gutterSpecs=Ls(n.options.gutters,i),Ia(n)},!0),r("firstLineNumber",1,Ia,!0),r("lineNumberFormatter",function(n){return n},Ia,!0),r("showCursorWhenSelecting",!1,ka,!0),r("resetSelectionOnContextMenu",!0),r("lineWiseCopyCut",!0),r("pasteLinesPerSelection",!0),r("selectionsMayTouch",!1),r("readOnly",!1,function(n,i){i=="nocursor"&&(Wi(n),n.display.input.blur()),n.display.input.readOnlyChanged(i)}),r("screenReaderLabel",null,function(n,i){i=i===""?null:i,n.display.input.screenReaderLabelChanged(i)}),r("disableInput",!1,function(n,i){i||n.display.input.reset()},!0),r("dragDrop",!0,Bu),r("allowDropFileTypes",null),r("cursorBlinkRate",530),r("cursorScrollMargin",0),r("cursorHeight",1,ka,!0),r("singleCursorHeightPerLine",!0,ka,!0),r("workTime",100),r("workDelay",100),r("flattenSpans",!0,xn,!0),r("addModeClass",!1,xn,!0),r("pollInterval",100),r("undoDepth",200,function(n,i){return n.doc.history.undoDepth=i}),r("historyEventDelay",1250),r("viewportMargin",10,function(n){return n.refresh()},!0),r("maxHighlightLength",1e4,xn,!0),r("moveInputWithCursor",!0,function(n,i){i||n.display.input.resetPosition()}),r("tabindex",null,function(n,i){return n.display.input.getField().tabIndex=i||""}),r("autofocus",null),r("direction","ltr",function(n,i){return n.doc.setDirection(i)},!0),r("phrases",null)}function Bu(e,t,r){var n=r&&r!=Ci;if(!t!=!n){var i=e.display.dragFunctions,o=t?ht:cr;o(e.display.scroller,"dragstart",i.start),o(e.display.scroller,"dragenter",i.enter),o(e.display.scroller,"dragover",i.over),o(e.display.scroller,"dragleave",i.leave),o(e.display.scroller,"drop",i.drop)}}function Vl(e){e.options.lineWrapping?(Ve(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(We(e.display.wrapper,"CodeMirror-wrap"),rs(e)),zi(e),pr(e),_a(e),setTimeout(function(){return pi(e)},100)}function Yt(e,t){var r=this;if(!(this instanceof Yt))return new Yt(e,t);this.options=t=t?pt(t):{},pt(Kl,t,!1);var n=t.value;typeof n=="string"?n=new mr(n,t.mode,null,t.lineSeparator,t.direction):t.mode&&(n.modeOption=t.mode),this.doc=n;var i=new Yt.inputStyles[t.inputStyle](this),o=this.display=new Tu(e,n,i,t);o.wrapper.CodeMirror=this,xr(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),Ts(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new Ht,keySeq:null,specialChars:null},t.autofocus&&!h&&o.input.focus(),he&&ee<11&&setTimeout(function(){return r.display.input.reset(!0)},20),Du(this),Ru(),yr(this),this.curOp.forceUpdate=!0,mi(this,n),t.autofocus&&!h||this.hasFocus()?setTimeout(function(){r.hasFocus()&&!r.state.focused&&ys(r)},20):Wi(this);for(var s in Ho)Ho.hasOwnProperty(s)&&Ho[s](this,t[s],Ci);Al(this),t.finishInit&&t.finishInit(this);for(var l=0;l<js.length;++l)js[l](this);gn(this),j&&t.lineWrapping&&getComputedStyle(o.lineDiv).textRendering=="optimizelegibility"&&(o.lineDiv.style.textRendering="auto")}Yt.defaults=Kl,Yt.optionHandlers=Ho;function Du(e){var t=e.display;ht(t.scroller,"mousedown",or(e,jl)),he&&ee<11?ht(t.scroller,"dblclick",or(e,function(u){if(!Kt(e,u)){var c=ur(e,u);if(!(!c||dr(e,u)||Wr(e.display,u))){qt(u);var y=e.findWordAt(c);$i(e.doc,y.anchor,y.head)}}})):ht(t.scroller,"dblclick",function(u){return Kt(e,u)||qt(u)}),ht(t.scroller,"contextmenu",function(u){return kn(e,u)}),ht(t.input.getField(),"contextmenu",function(u){t.scroller.contains(u.target)||kn(e,u)});var r,n={end:0};function i(){t.activeTouch&&(r=setTimeout(function(){return t.activeTouch=null},1e3),n=t.activeTouch,n.end=+new Date)}function o(u){if(u.touches.length!=1)return!1;var c=u.touches[0];return c.radiusX<=1&&c.radiusY<=1}function s(u,c){if(c.left==null)return!0;var y=c.left-u.left,R=c.top-u.top;return y*y+R*R>20*20}ht(t.scroller,"touchstart",function(u){if(!Kt(e,u)&&!o(u)&&!dr(e,u)){t.input.ensurePolled(),clearTimeout(r);var c=+new Date;t.activeTouch={start:c,moved:!1,prev:c-n.end<=300?n:null},u.touches.length==1&&(t.activeTouch.left=u.touches[0].pageX,t.activeTouch.top=u.touches[0].pageY)}}),ht(t.scroller,"touchmove",function(){t.activeTouch&&(t.activeTouch.moved=!0)}),ht(t.scroller,"touchend",function(u){var c=t.activeTouch;if(c&&!Wr(t,u)&&c.left!=null&&!c.moved&&new Date-c.start<300){var y=e.coordsChar(t.activeTouch,"page"),R;!c.prev||s(c,c.prev)?R=new Dt(y,y):!c.prev.prev||s(c,c.prev.prev)?R=e.findWordAt(y):R=new Dt(xe(y.line,0),gt(e.doc,xe(y.line+1,0))),e.setSelection(R.anchor,R.head),e.focus(),qt(u)}i()}),ht(t.scroller,"touchcancel",i),ht(t.scroller,"scroll",function(){t.scroller.clientHeight&&(Ui(e,t.scroller.scrollTop),qn(e,t.scroller.scrollLeft,!0),Qt(e,"scroll",e))}),ht(t.scroller,"mousewheel",function(u){return Rl(e,u)}),ht(t.scroller,"DOMMouseScroll",function(u){return Rl(e,u)}),ht(t.wrapper,"scroll",function(){return t.wrapper.scrollTop=t.wrapper.scrollLeft=0}),t.dragFunctions={enter:function(u){Kt(e,u)||In(u)},over:function(u){Kt(e,u)||(ku(e,u),In(u))},start:function(u){return ta(e,u)},drop:or(e,Au),leave:function(u){Kt(e,u)||Gl(e)}};var l=t.input.getField();ht(l,"keyup",function(u){return ql.call(e,u)}),ht(l,"keydown",or(e,Wl)),ht(l,"keypress",or(e,An)),ht(l,"focus",function(u){return ys(e,u)}),ht(l,"blur",function(u){return Wi(e,u)})}var js=[];Yt.defineInitHook=function(e){return js.push(e)};function $a(e,t,r,n){var i=e.doc,o;r==null&&(r="add"),r=="smart"&&(i.mode.indent?o=va(e,t).state:r="prev");var s=e.options.tabSize,l=lt(i,t),u=Ct(l.text,null,s);l.stateAfter&&(l.stateAfter=null);var c=l.text.match(/^\s*/)[0],y;if(!n&&!/\S/.test(l.text))y=0,r="not";else if(r=="smart"&&(y=i.mode.indent(o,l.text.slice(c.length),l.text),y==Vt||y>150)){if(!n)return;r="prev"}r=="prev"?t>i.first?y=Ct(lt(i,t-1).text,null,s):y=0:r=="add"?y=u+e.options.indentUnit:r=="subtract"?y=u-e.options.indentUnit:typeof r=="number"&&(y=u+r),y=Math.max(0,y);var R="",B=0;if(e.options.indentWithTabs)for(var O=Math.floor(y/s);O;--O)B+=s,R+="	";if(B<y&&(R+=nn(y-B)),R!=c)return Tn(i,R,xe(t,0),xe(t,c.length),"+input"),l.stateAfter=null,!0;for(var H=0;H<i.sel.ranges.length;H++){var ce=i.sel.ranges[H];if(ce.head.line==t&&ce.head.ch<c.length){var we=xe(t,c.length);Ro(i,H,new Dt(we,we));break}}}var jr=null;function Qa(e){jr=e}function zo(e,t,r,n,i){var o=e.doc;e.display.shift=!1,n||(n=o.sel);var s=+new Date-200,l=i=="paste"||e.state.pasteIncoming>s,u=Bt(t),c=null;if(l&&n.ranges.length>1)if(jr&&jr.text.join(`
`)==t){if(n.ranges.length%jr.text.length==0){c=[];for(var y=0;y<jr.text.length;y++)c.push(o.splitLines(jr.text[y]))}}else u.length==n.ranges.length&&e.options.pasteLinesPerSelection&&(c=ri(u,function(ge){return[ge]}));for(var R=e.curOp.updateInput,B=n.ranges.length-1;B>=0;B--){var O=n.ranges[B],H=O.from(),ce=O.to();O.empty()&&(r&&r>0?H=xe(H.line,H.ch-r):e.state.overwrite&&!l?ce=xe(ce.line,Math.min(lt(o,ce.line).text.length,ce.ch+_t(u).length)):l&&jr&&jr.lineWise&&jr.text.join(`
`)==u.join(`
`)&&(H=ce=xe(H.line,0)));var we={from:H,to:ce,text:c?c[B%c.length]:u,origin:i||(l?"paste":e.state.cutIncoming>s?"cut":"+input")};Si(e.doc,we),er(e,"inputRead",e,we)}t&&!l&&$l(e,t),mn(e),e.curOp.updateInput<2&&(e.curOp.updateInput=R),e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=-1}function Ys(e,t){var r=e.clipboardData&&e.clipboardData.getData("Text");if(r)return e.preventDefault(),!t.isReadOnly()&&!t.options.disableInput&&t.hasFocus()&&br(t,function(){return zo(t,r,0,null,"paste")}),!0}function $l(e,t){if(!(!e.options.electricChars||!e.options.smartIndent))for(var r=e.doc.sel,n=r.ranges.length-1;n>=0;n--){var i=r.ranges[n];if(!(i.head.ch>100||n&&r.ranges[n-1].head.line==i.head.line)){var o=e.getModeAt(i.head),s=!1;if(o.electricChars){for(var l=0;l<o.electricChars.length;l++)if(t.indexOf(o.electricChars.charAt(l))>-1){s=$a(e,i.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(lt(e.doc,i.head.line).text.slice(0,i.head.ch))&&(s=$a(e,i.head.line,"smart"));s&&er(e,"electricInput",e,i.head.line)}}}function Ql(e){for(var t=[],r=[],n=0;n<e.doc.sel.ranges.length;n++){var i=e.doc.sel.ranges[n].head.line,o={anchor:xe(i,0),head:xe(i+1,0)};r.push(o),t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:r}}function Wo(e,t,r,n){e.setAttribute("autocorrect",r?"on":"off"),e.setAttribute("autocapitalize",n?"on":"off"),e.setAttribute("spellcheck",!!t)}function Zl(){var e=p("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none"),t=p("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return j?e.style.width="1000px":e.setAttribute("wrap","off"),A&&(e.style.border="1px solid black"),t}function f(e){var t=e.optionHandlers,r=e.helpers={};e.prototype={constructor:e,focus:function(){ft(this).focus(),this.display.input.focus()},setOption:function(n,i){var o=this.options,s=o[n];o[n]==i&&n!="mode"||(o[n]=i,t.hasOwnProperty(n)&&or(this,t[n])(this,i,s),Qt(this,"optionChange",this,n))},getOption:function(n){return this.options[n]},getDoc:function(){return this.doc},addKeyMap:function(n,i){this.state.keyMaps[i?"push":"unshift"](ra(n))},removeKeyMap:function(n){for(var i=this.state.keyMaps,o=0;o<i.length;++o)if(i[o]==n||i[o].name==n)return i.splice(o,1),!0},addOverlay:vr(function(n,i){var o=n.token?n:e.getMode(this.options,n);if(o.startState)throw new Error("Overlays may not be stateful.");qo(this.state.overlays,{mode:o,modeSpec:n,opaque:i&&i.opaque,priority:i&&i.priority||0},function(s){return s.priority}),this.state.modeGen++,pr(this)}),removeOverlay:vr(function(n){for(var i=this.state.overlays,o=0;o<i.length;++o){var s=i[o].modeSpec;if(s==n||typeof n=="string"&&s.name==n){i.splice(o,1),this.state.modeGen++,pr(this);return}}}),indentLine:vr(function(n,i,o){typeof i!="string"&&typeof i!="number"&&(i==null?i=this.options.smartIndent?"smart":"prev":i=i?"add":"subtract"),Re(this.doc,n)&&$a(this,n,i,o)}),indentSelection:vr(function(n){for(var i=this.doc.sel.ranges,o=-1,s=0;s<i.length;s++){var l=i[s];if(l.empty())l.head.line>o&&($a(this,l.head.line,n,!0),o=l.head.line,s==this.doc.sel.primIndex&&mn(this));else{var u=l.from(),c=l.to(),y=Math.max(o,u.line);o=Math.min(this.lastLine(),c.line-(c.ch?0:1))+1;for(var R=y;R<o;++R)$a(this,R,n);var B=this.doc.sel.ranges;u.ch==0&&i.length==B.length&&B[s].from().ch>0&&Ro(this.doc,s,new Dt(u,B[s].to()),ar)}}}),getTokenAt:function(n,i){return Zs(this,n,i)},getLineTokens:function(n,i){return Zs(this,xe(n),i,!0)},getTokenTypeAt:function(n){n=gt(this.doc,n);var i=$s(this,lt(this.doc,n.line)),o=0,s=(i.length-1)/2,l=n.ch,u;if(l==0)u=i[2];else for(;;){var c=o+s>>1;if((c?i[c*2-1]:0)>=l)s=c;else if(i[c*2+1]<l)o=c+1;else{u=i[c*2+2];break}}var y=u?u.indexOf("overlay "):-1;return y<0?u:y==0?null:u.slice(0,y-1)},getModeAt:function(n){var i=this.doc.mode;return i.innerMode?e.innerMode(i,this.getTokenAt(n).state).mode:i},getHelper:function(n,i){return this.getHelpers(n,i)[0]},getHelpers:function(n,i){var o=[];if(!r.hasOwnProperty(i))return o;var s=r[i],l=this.getModeAt(n);if(typeof l[i]=="string")s[l[i]]&&o.push(s[l[i]]);else if(l[i])for(var u=0;u<l[i].length;u++){var c=s[l[i][u]];c&&o.push(c)}else l.helperType&&s[l.helperType]?o.push(s[l.helperType]):s[l.name]&&o.push(s[l.name]);for(var y=0;y<s._global.length;y++){var R=s._global[y];R.pred(l,this)&&ut(o,R.val)==-1&&o.push(R.val)}return o},getStateAfter:function(n,i){var o=this.doc;return n=Ks(o,n??o.first+o.size-1),va(this,n+1,i).state},cursorCoords:function(n,i){var o,s=this.doc.sel.primary();return n==null?o=s.head:typeof n=="object"?o=gt(this.doc,n):o=n?s.from():s.to(),Ar(this,o,i||"page")},charCoords:function(n,i){return mo(this,gt(this.doc,n),i||"page")},coordsChar:function(n,i){return n=vo(this,n,i||"page"),Ea(this,n.left,n.top)},lineAtHeight:function(n,i){return n=vo(this,{top:n,left:0},i||"page").top,X(this.doc,n+this.display.viewOffset)},heightAtLine:function(n,i,o){var s=!1,l;if(typeof n=="number"){var u=this.doc.first+this.doc.size-1;n<this.doc.first?n=this.doc.first:n>u&&(n=u,s=!0),l=lt(this.doc,n)}else l=n;return po(this,l,{top:0,left:0},i||"page",o||s).top+(s?this.doc.height-Cr(l):0)},defaultTextHeight:function(){return Gi(this.display)},defaultCharWidth:function(){return Hi(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(n,i,o,s,l){var u=this.display;n=Ar(this,gt(this.doc,n));var c=n.bottom,y=n.left;if(i.style.position="absolute",i.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(i),u.sizer.appendChild(i),s=="over")c=n.top;else if(s=="above"||s=="near"){var R=Math.max(u.wrapper.clientHeight,this.doc.height),B=Math.max(u.sizer.clientWidth,u.lineSpace.clientWidth);(s=="above"||n.bottom+i.offsetHeight>R)&&n.top>i.offsetHeight?c=n.top-i.offsetHeight:n.bottom+i.offsetHeight<=R&&(c=n.bottom),y+i.offsetWidth>B&&(y=B-i.offsetWidth)}i.style.top=c+"px",i.style.left=i.style.right="",l=="right"?(y=u.sizer.clientWidth-i.offsetWidth,i.style.right="0px"):(l=="left"?y=0:l=="middle"&&(y=(u.sizer.clientWidth-i.offsetWidth)/2),i.style.left=y+"px"),o&&bl(this,{left:y,top:c,right:y+i.offsetWidth,bottom:c+i.offsetHeight})},triggerOnKeyDown:vr(Wl),triggerOnKeyPress:vr(An),triggerOnKeyUp:ql,triggerOnMouseDown:vr(jl),execCommand:function(n){if(Zn.hasOwnProperty(n))return Zn[n].call(null,this)},triggerElectric:vr(function(n){$l(this,n)}),findPosH:function(n,i,o,s){var l=1;i<0&&(l=-1,i=-i);for(var u=gt(this.doc,n),c=0;c<i&&(u=L(this.doc,u,l,o,s),!u.hitSide);++c);return u},moveH:vr(function(n,i){var o=this;this.extendSelectionsBy(function(s){return o.display.shift||o.doc.extend||s.empty()?L(o.doc,s.head,n,i,o.options.rtlMoveVisually):n<0?s.from():s.to()},fr)}),deleteH:vr(function(n,i){var o=this.doc.sel,s=this.doc;o.somethingSelected()?s.replaceSelection("",null,"+delete"):Ln(this,function(l){var u=L(s,l.head,n,i,!1);return n<0?{from:u,to:l.head}:{from:l.head,to:u}})}),findPosV:function(n,i,o,s){var l=1,u=s;i<0&&(l=-1,i=-i);for(var c=gt(this.doc,n),y=0;y<i;++y){var R=Ar(this,c,"div");if(u==null?u=R.left:R.left=u,c=z(this,R,l,o),c.hitSide)break}return c},moveV:vr(function(n,i){var o=this,s=this.doc,l=[],u=!this.display.shift&&!s.extend&&s.sel.somethingSelected();if(s.extendSelectionsBy(function(y){if(u)return n<0?y.from():y.to();var R=Ar(o,y.head,"div");y.goalColumn!=null&&(R.left=y.goalColumn),l.push(R.left);var B=z(o,R,n,i);return i=="page"&&y==s.sel.primary()&&bs(o,mo(o,B,"div").top-R.top),B},fr),l.length)for(var c=0;c<s.sel.ranges.length;c++)s.sel.ranges[c].goalColumn=l[c]}),findWordAt:function(n){var i=this.doc,o=lt(i,n.line).text,s=n.ch,l=n.ch;if(o){var u=this.getHelper(n,"wordChars");(n.sticky=="before"||l==o.length)&&s?--s:++l;for(var c=o.charAt(s),y=an(c,u)?function(R){return an(R,u)}:/\s/.test(c)?function(R){return/\s/.test(R)}:function(R){return!/\s/.test(R)&&!an(R)};s>0&&y(o.charAt(s-1));)--s;for(;l<o.length&&y(o.charAt(l));)++l}return new Dt(xe(n.line,s),xe(n.line,l))},toggleOverwrite:function(n){n!=null&&n==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?Ve(this.display.cursorDiv,"CodeMirror-overwrite"):We(this.display.cursorDiv,"CodeMirror-overwrite"),Qt(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==$e(Rt(this))},isReadOnly:function(){return!!(this.options.readOnly||this.doc.cantEdit)},scrollTo:vr(function(n,i){Oa(this,n,i)}),getScrollInfo:function(){var n=this.display.scroller;return{left:n.scrollLeft,top:n.scrollTop,height:n.scrollHeight-Mr(this)-this.display.barHeight,width:n.scrollWidth-Mr(this)-this.display.barWidth,clientHeight:Ta(this),clientWidth:dn(this)}},scrollIntoView:vr(function(n,i){n==null?(n={from:this.doc.sel.primary().head,to:null},i==null&&(i=this.options.cursorScrollMargin)):typeof n=="number"?n={from:xe(n,0),to:null}:n.from==null&&(n={from:n,to:null}),n.to||(n.to=n.from),n.margin=i||0,n.from.line!=null?Wn(this,n):xs(this,n.from,n.to,n.margin)}),setSize:vr(function(n,i){var o=this,s=function(u){return typeof u=="number"||/^\d+$/.test(String(u))?u+"px":u};n!=null&&(this.display.wrapper.style.width=s(n)),i!=null&&(this.display.wrapper.style.height=s(i)),this.options.lineWrapping&&cl(this);var l=this.display.viewFrom;this.doc.iter(l,this.display.viewTo,function(u){if(u.widgets){for(var c=0;c<u.widgets.length;c++)if(u.widgets[c].noHScroll){hn(o,l,"widget");break}}++l}),this.curOp.forceUpdate=!0,Qt(this,"refresh",this)}),operation:function(n){return br(this,n)},startOperation:function(){return yr(this)},endOperation:function(){return gn(this)},refresh:vr(function(){var n=this.display.cachedTextHeight;pr(this),this.curOp.forceUpdate=!0,_a(this),Oa(this,this.doc.scrollLeft,this.doc.scrollTop),_s(this.display),(n==null||Math.abs(n-Gi(this.display))>.5||this.options.lineWrapping)&&zi(this),Qt(this,"refresh",this)}),swapDoc:vr(function(n){var i=this.doc;return i.cm=null,this.state.selectingText&&this.state.selectingText(),mi(this,n),_a(this),this.display.input.reset(),Oa(this,n.scrollLeft,n.scrollTop),this.curOp.forceScroll=!0,er(this,"swapDoc",this,i),i}),phrase:function(n){var i=this.options.phrases;return i&&Object.prototype.hasOwnProperty.call(i,n)?i[n]:n},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Pr(e),e.registerHelper=function(n,i,o){r.hasOwnProperty(n)||(r[n]=e[n]={_global:[]}),r[n][i]=o},e.registerGlobalHelper=function(n,i,o,s){e.registerHelper(n,i,s),r[n]._global.push({pred:o,val:s})}}function L(e,t,r,n,i){var o=t,s=r,l=lt(e,t.line),u=i&&e.direction=="rtl"?-r:r;function c(){var Oe=t.line+u;return Oe<e.first||Oe>=e.first+e.size?!1:(t=new xe(Oe,t.ch,t.sticky),l=lt(e,Oe))}function y(Oe){var Ee;if(n=="codepoint"){var Me=l.text.charCodeAt(t.ch+(r>0?0:-1));if(isNaN(Me))Ee=null;else{var Ye=r>0?Me>=55296&&Me<56320:Me>=56320&&Me<57343;Ee=new xe(t.line,Math.max(0,Math.min(l.text.length,t.ch+r*(Ye?2:1))),-r)}}else i?Ee=Bo(e.cm,l,t,r):Ee=ia(l,t,r);if(Ee==null)if(!Oe&&c())t=qa(i,e.cm,l,t.line,u);else return!1;else t=Ee;return!0}if(n=="char"||n=="codepoint")y();else if(n=="column")y(!0);else if(n=="word"||n=="group")for(var R=null,B=n=="group",O=e.cm&&e.cm.getHelper(t,"wordChars"),H=!0;!(r<0&&!y(!H));H=!1){var ce=l.text.charAt(t.ch)||`
`,we=an(ce,O)?"w":B&&ce==`
`?"n":!B||/\s/.test(ce)?null:"p";if(B&&!H&&!we&&(we="s"),R&&R!=we){r<0&&(r=1,y(),t.sticky="after");break}if(we&&(R=we),r>0&&!y(!H))break}var ge=Qi(e,t,o,s,!0);return zt(o,ge)&&(ge.hitSide=!0),ge}function z(e,t,r,n){var i=e.doc,o=t.left,s;if(n=="page"){var l=Math.min(e.display.wrapper.clientHeight,ft(e).innerHeight||i(e).documentElement.clientHeight),u=Math.max(l-.5*Gi(e.display),3);s=(r>0?t.bottom:t.top)+r*u}else n=="line"&&(s=r>0?t.bottom+3:t.top-3);for(var c;c=Ea(e,o,s),!!c.outside;){if(r<0?s<=0:s>=i.height){c.hitSide=!0;break}s+=r*5}return c}var re=function(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Ht,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};re.prototype.init=function(e){var t=this,r=this,n=r.cm,i=r.div=e.lineDiv;i.contentEditable=!0,Wo(i,n.options.spellcheck,n.options.autocorrect,n.options.autocapitalize);function o(l){for(var u=l.target;u;u=u.parentNode){if(u==i)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(u.className))break}return!1}ht(i,"paste",function(l){!o(l)||Kt(n,l)||Ys(l,n)||ee<=11&&setTimeout(or(n,function(){return t.updateFromDOM()}),20)}),ht(i,"compositionstart",function(l){t.composing={data:l.data,done:!1}}),ht(i,"compositionupdate",function(l){t.composing||(t.composing={data:l.data,done:!1})}),ht(i,"compositionend",function(l){t.composing&&(l.data!=t.composing.data&&t.readFromDOMSoon(),t.composing.done=!0)}),ht(i,"touchstart",function(){return r.forceCompositionEnd()}),ht(i,"input",function(){t.composing||t.readFromDOMSoon()});function s(l){if(!(!o(l)||Kt(n,l))){if(n.somethingSelected())Qa({lineWise:!1,text:n.getSelections()}),l.type=="cut"&&n.replaceSelection("",null,"cut");else if(n.options.lineWiseCopyCut){var u=Ql(n);Qa({lineWise:!0,text:u.text}),l.type=="cut"&&n.operation(function(){n.setSelections(u.ranges,0,ar),n.replaceSelection("",null,"cut")})}else return;if(l.clipboardData){l.clipboardData.clearData();var c=jr.text.join(`
`);if(l.clipboardData.setData("Text",c),l.clipboardData.getData("Text")==c){l.preventDefault();return}}var y=Zl(),R=y.firstChild;Wo(R),n.display.lineSpace.insertBefore(y,n.display.lineSpace.firstChild),R.value=jr.text.join(`
`);var B=$e(st(i));Je(R),setTimeout(function(){n.display.lineSpace.removeChild(y),B.focus(),B==i&&r.showPrimarySelection()},50)}}ht(i,"copy",s),ht(i,"cut",s)},re.prototype.screenReaderLabelChanged=function(e){e?this.div.setAttribute("aria-label",e):this.div.removeAttribute("aria-label")},re.prototype.prepareSelection=function(){var e=di(this.cm,!1);return e.focus=$e(st(this.div))==this.div,e},re.prototype.showSelection=function(e,t){!e||!this.cm.display.view.length||((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))},re.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},re.prototype.showPrimarySelection=function(){var e=this.getSelection(),t=this.cm,r=t.doc.sel.primary(),n=r.from(),i=r.to();if(t.display.viewTo==t.display.viewFrom||n.line>=t.display.viewTo||i.line<t.display.viewFrom){e.removeAllRanges();return}var o=Ie(t,e.anchorNode,e.anchorOffset),s=Ie(t,e.focusNode,e.focusOffset);if(!(o&&!o.bad&&s&&!s.bad&&Qe(Fi(o,s),n)==0&&Qe(hr(o,s),i)==0)){var l=t.display.view,u=n.line>=t.display.viewFrom&&_e(t,n)||{node:l[0].measure.map[2],offset:0},c=i.line<t.display.viewTo&&_e(t,i);if(!c){var y=l[l.length-1].measure,R=y.maps?y.maps[y.maps.length-1]:y.map;c={node:R[R.length-1],offset:R[R.length-2]-R[R.length-3]}}if(!u||!c){e.removeAllRanges();return}var B=e.rangeCount&&e.getRangeAt(0),O;try{O=be(u.node,u.offset,c.offset,c.node)}catch{}O&&(!S&&t.state.focused?(e.collapse(u.node,u.offset),O.collapsed||(e.removeAllRanges(),e.addRange(O))):(e.removeAllRanges(),e.addRange(O)),B&&e.anchorNode==null?e.addRange(B):S&&this.startGracePeriod()),this.rememberSelection()}},re.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){e.gracePeriod=!1,e.selectionChanged()&&e.cm.operation(function(){return e.cm.curOp.selectionChanged=!0})},20)},re.prototype.showMultipleSelections=function(e){E(this.cm.display.cursorDiv,e.cursors),E(this.cm.display.selectionDiv,e.selection)},re.prototype.rememberSelection=function(){var e=this.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset},re.prototype.selectionInEditor=function(){var e=this.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).commonAncestorContainer;return Pe(this.div,t)},re.prototype.focus=function(){this.cm.options.readOnly!="nocursor"&&((!this.selectionInEditor()||$e(st(this.div))!=this.div)&&this.showSelection(this.prepareSelection(),!0),this.div.focus())},re.prototype.blur=function(){this.div.blur()},re.prototype.getField=function(){return this.div},re.prototype.supportsTouch=function(){return!0},re.prototype.receivedFocus=function(){var e=this,t=this;this.selectionInEditor()?setTimeout(function(){return e.pollSelection()},20):br(this.cm,function(){return t.cm.curOp.selectionChanged=!0});function r(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,r))}this.polling.set(this.cm.options.pollInterval,r)},re.prototype.selectionChanged=function(){var e=this.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},re.prototype.pollSelection=function(){if(!(this.readDOMTimeout!=null||this.gracePeriod||!this.selectionChanged())){var e=this.getSelection(),t=this.cm;if(U&&G&&this.cm.display.gutterSpecs.length&&pe(e.anchorNode)){this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),this.focus();return}if(!this.composing){this.rememberSelection();var r=Ie(t,e.anchorNode,e.anchorOffset),n=Ie(t,e.focusNode,e.focusOffset);r&&n&&br(t,function(){lr(t.doc,Xn(r,n),ar),(r.bad||n.bad)&&(t.curOp.selectionChanged=!0)})}}},re.prototype.pollContent=function(){this.readDOMTimeout!=null&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var e=this.cm,t=e.display,r=e.doc.sel.primary(),n=r.from(),i=r.to();if(n.ch==0&&n.line>e.firstLine()&&(n=xe(n.line-1,lt(e.doc,n.line-1).length)),i.ch==lt(e.doc,i.line).text.length&&i.line<e.lastLine()&&(i=xe(i.line+1,0)),n.line<t.viewFrom||i.line>t.viewTo-1)return!1;var o,s,l;n.line==t.viewFrom||(o=Fr(e,n.line))==0?(s=v(t.view[0].line),l=t.view[0].node):(s=v(t.view[o].line),l=t.view[o-1].node.nextSibling);var u=Fr(e,i.line),c,y;if(u==t.view.length-1?(c=t.viewTo-1,y=t.lineDiv.lastChild):(c=v(t.view[u+1].line)-1,y=t.view[u+1].node.previousSibling),!l)return!1;for(var R=e.doc.splitLines(Fe(e,l,y,s,c)),B=un(e.doc,xe(s,0),xe(c,lt(e.doc,c).text.length));R.length>1&&B.length>1;)if(_t(R)==_t(B))R.pop(),B.pop(),c--;else if(R[0]==B[0])R.shift(),B.shift(),s++;else break;for(var O=0,H=0,ce=R[0],we=B[0],ge=Math.min(ce.length,we.length);O<ge&&ce.charCodeAt(O)==we.charCodeAt(O);)++O;for(var Oe=_t(R),Ee=_t(B),Me=Math.min(Oe.length-(R.length==1?O:0),Ee.length-(B.length==1?O:0));H<Me&&Oe.charCodeAt(Oe.length-H-1)==Ee.charCodeAt(Ee.length-H-1);)++H;if(R.length==1&&B.length==1&&s==n.line)for(;O&&O>n.ch&&Oe.charCodeAt(Oe.length-H-1)==Ee.charCodeAt(Ee.length-H-1);)O--,H++;R[R.length-1]=Oe.slice(0,Oe.length-H).replace(/^\u200b+/,""),R[0]=R[0].slice(O).replace(/\u200b+$/,"");var Ye=xe(s,O),Ze=xe(c,B.length?_t(B).length-H:0);if(R.length>1||R[0]||Qe(Ye,Ze))return Tn(e.doc,R,Ye,Ze,"+input"),!0},re.prototype.ensurePolled=function(){this.forceCompositionEnd()},re.prototype.reset=function(){this.forceCompositionEnd()},re.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},re.prototype.readFromDOMSoon=function(){var e=this;this.readDOMTimeout==null&&(this.readDOMTimeout=setTimeout(function(){if(e.readDOMTimeout=null,e.composing)if(e.composing.done)e.composing=null;else return;e.updateFromDOM()},80))},re.prototype.updateFromDOM=function(){var e=this;(this.cm.isReadOnly()||!this.pollContent())&&br(this.cm,function(){return pr(e.cm)})},re.prototype.setUneditable=function(e){e.contentEditable="false"},re.prototype.onKeyPress=function(e){e.charCode==0||this.composing||(e.preventDefault(),this.cm.isReadOnly()||or(this.cm,zo)(this.cm,String.fromCharCode(e.charCode==null?e.keyCode:e.charCode),0))},re.prototype.readOnlyChanged=function(e){this.div.contentEditable=String(e!="nocursor")},re.prototype.onContextMenu=function(){},re.prototype.resetPosition=function(){},re.prototype.needsContentAttribute=!0;function _e(e,t){var r=co(e,t.line);if(!r||r.hidden)return null;var n=lt(e.doc,t.line),i=ls(r,n,t.line),o=At(n,e.doc.direction),s="left";if(o){var l=nr(o,t.ch);s=l%2?"right":"left"}var u=ui(i.map,t.ch,s);return u.offset=u.collapse=="right"?u.end:u.start,u}function pe(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}function ye(e,t){return t&&(e.bad=!0),e}function Fe(e,t,r,n,i){var o="",s=!1,l=e.doc.lineSeparator(),u=!1;function c(O){return function(H){return H.id==O}}function y(){s&&(o+=l,u&&(o+=l),s=u=!1)}function R(O){O&&(y(),o+=O)}function B(O){if(O.nodeType==1){var H=O.getAttribute("cm-text");if(H){R(H);return}var ce=O.getAttribute("cm-marker"),we;if(ce){var ge=e.findMarks(xe(n,0),xe(i+1,0),c(+ce));ge.length&&(we=ge[0].find(0))&&R(un(e.doc,we.from,we.to).join(l));return}if(O.getAttribute("contenteditable")=="false")return;var Oe=/^(pre|div|p|li|table|br)$/i.test(O.nodeName);if(!/^br$/i.test(O.nodeName)&&O.textContent.length==0)return;Oe&&y();for(var Ee=0;Ee<O.childNodes.length;Ee++)B(O.childNodes[Ee]);/^(pre|p)$/i.test(O.nodeName)&&(u=!0),Oe&&(s=!0)}else O.nodeType==3&&R(O.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;B(t),t!=r;)t=t.nextSibling,u=!1;return o}function Ie(e,t,r){var n;if(t==e.display.lineDiv){if(n=e.display.lineDiv.childNodes[r],!n)return ye(e.clipPos(xe(e.display.viewTo-1)),!0);t=null,r=0}else for(n=t;;n=n.parentNode){if(!n||n==e.display.lineDiv)return null;if(n.parentNode&&n.parentNode==e.display.lineDiv)break}for(var i=0;i<e.display.view.length;i++){var o=e.display.view[i];if(o.node==n)return Be(o,t,r)}}function Be(e,t,r){var n=e.text.firstChild,i=!1;if(!t||!Pe(n,t))return ye(xe(v(e.line),0),!0);if(t==n&&(i=!0,t=n.childNodes[r],r=0,!t)){var o=e.rest?_t(e.rest):e.line;return ye(xe(v(o),o.text.length),i)}var s=t.nodeType==3?t:null,l=t;for(!s&&t.childNodes.length==1&&t.firstChild.nodeType==3&&(s=t.firstChild,r&&(r=s.nodeValue.length));l.parentNode!=n;)l=l.parentNode;var u=e.measure,c=u.maps;function y(we,ge,Oe){for(var Ee=-1;Ee<(c?c.length:0);Ee++)for(var Me=Ee<0?u.map:c[Ee],Ye=0;Ye<Me.length;Ye+=3){var Ze=Me[Ye+2];if(Ze==we||Ze==ge){var ct=v(Ee<0?e.line:e.rest[Ee]),rt=Me[Ye]+Oe;return(Oe<0||Ze!=we)&&(rt=Me[Ye+(Oe?1:0)]),xe(ct,rt)}}}var R=y(s,l,r);if(R)return ye(R,i);for(var B=l.nextSibling,O=s?s.nodeValue.length-r:0;B;B=B.nextSibling){if(R=y(B,B.firstChild,0),R)return ye(xe(R.line,R.ch-O),i);O+=B.textContent.length}for(var H=l.previousSibling,ce=r;H;H=H.previousSibling){if(R=y(H,H.firstChild,-1),R)return ye(xe(R.line,R.ch+ce),i);ce+=H.textContent.length}}var Le=function(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new Ht,this.hasSelection=!1,this.composing=null,this.resetting=!1};Le.prototype.init=function(e){var t=this,r=this,n=this.cm;this.createField(e);var i=this.textarea;e.wrapper.insertBefore(this.wrapper,e.wrapper.firstChild),A&&(i.style.width="0px"),ht(i,"input",function(){he&&ee>=9&&t.hasSelection&&(t.hasSelection=null),r.poll()}),ht(i,"paste",function(s){Kt(n,s)||Ys(s,n)||(n.state.pasteIncoming=+new Date,r.fastPoll())});function o(s){if(!Kt(n,s)){if(n.somethingSelected())Qa({lineWise:!1,text:n.getSelections()});else if(n.options.lineWiseCopyCut){var l=Ql(n);Qa({lineWise:!0,text:l.text}),s.type=="cut"?n.setSelections(l.ranges,null,ar):(r.prevInput="",i.value=l.text.join(`
`),Je(i))}else return;s.type=="cut"&&(n.state.cutIncoming=+new Date)}}ht(i,"cut",o),ht(i,"copy",o),ht(e.scroller,"paste",function(s){if(!(Wr(e,s)||Kt(n,s))){if(!i.dispatchEvent){n.state.pasteIncoming=+new Date,r.focus();return}var l=new Event("paste");l.clipboardData=s.clipboardData,i.dispatchEvent(l)}}),ht(e.lineSpace,"selectstart",function(s){Wr(e,s)||qt(s)}),ht(i,"compositionstart",function(){var s=n.getCursor("from");r.composing&&r.composing.range.clear(),r.composing={start:s,range:n.markText(s,n.getCursor("to"),{className:"CodeMirror-composing"})}}),ht(i,"compositionend",function(){r.composing&&(r.poll(),r.composing.range.clear(),r.composing=null)})},Le.prototype.createField=function(e){this.wrapper=Zl(),this.textarea=this.wrapper.firstChild;var t=this.cm.options;Wo(this.textarea,t.spellcheck,t.autocorrect,t.autocapitalize)},Le.prototype.screenReaderLabelChanged=function(e){e?this.textarea.setAttribute("aria-label",e):this.textarea.removeAttribute("aria-label")},Le.prototype.prepareSelection=function(){var e=this.cm,t=e.display,r=e.doc,n=di(e);if(e.options.moveInputWithCursor){var i=Ar(e,r.sel.primary().head,"div"),o=t.wrapper.getBoundingClientRect(),s=t.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,i.top+s.top-o.top)),n.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,i.left+s.left-o.left))}return n},Le.prototype.showSelection=function(e){var t=this.cm,r=t.display;E(r.cursorDiv,e.cursors),E(r.selectionDiv,e.selection),e.teTop!=null&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")},Le.prototype.reset=function(e){if(!(this.contextMenuPending||this.composing&&e)){var t=this.cm;if(this.resetting=!0,t.somethingSelected()){this.prevInput="";var r=t.getSelection();this.textarea.value=r,t.state.focused&&Je(this.textarea),he&&ee>=9&&(this.hasSelection=r)}else e||(this.prevInput=this.textarea.value="",he&&ee>=9&&(this.hasSelection=null));this.resetting=!1}},Le.prototype.getField=function(){return this.textarea},Le.prototype.supportsTouch=function(){return!1},Le.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"&&(!h||$e(st(this.textarea))!=this.textarea))try{this.textarea.focus()}catch{}},Le.prototype.blur=function(){this.textarea.blur()},Le.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},Le.prototype.receivedFocus=function(){this.slowPoll()},Le.prototype.slowPoll=function(){var e=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){e.poll(),e.cm.state.focused&&e.slowPoll()})},Le.prototype.fastPoll=function(){var e=!1,t=this;t.pollingFast=!0;function r(){var n=t.poll();!n&&!e?(e=!0,t.polling.set(60,r)):(t.pollingFast=!1,t.slowPoll())}t.polling.set(20,r)},Le.prototype.poll=function(){var e=this,t=this.cm,r=this.textarea,n=this.prevInput;if(this.contextMenuPending||this.resetting||!t.state.focused||Nn(r)&&!n&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;var i=r.value;if(i==n&&!t.somethingSelected())return!1;if(he&&ee>=9&&this.hasSelection===i||_&&/[\uf700-\uf7ff]/.test(i))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var o=i.charCodeAt(0);if(o==8203&&!n&&(n="​"),o==8666)return this.reset(),this.cm.execCommand("undo")}for(var s=0,l=Math.min(n.length,i.length);s<l&&n.charCodeAt(s)==i.charCodeAt(s);)++s;return br(t,function(){zo(t,i.slice(s),n.length-s,null,e.composing?"*compose":null),i.length>1e3||i.indexOf(`
`)>-1?r.value=e.prevInput="":e.prevInput=i,e.composing&&(e.composing.range.clear(),e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},Le.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},Le.prototype.onKeyPress=function(){he&&ee>=9&&(this.hasSelection=null),this.fastPoll()},Le.prototype.onContextMenu=function(e){var t=this,r=t.cm,n=r.display,i=t.textarea;t.contextMenuPending&&t.contextMenuPending();var o=ur(r,e),s=n.scroller.scrollTop;if(!o||ve)return;var l=r.options.resetSelectionOnContextMenu;l&&r.doc.sel.contains(o)==-1&&or(r,lr)(r.doc,Xn(o),ar);var u=i.style.cssText,c=t.wrapper.style.cssText,y=t.wrapper.offsetParent.getBoundingClientRect();t.wrapper.style.cssText="position: static",i.style.cssText=`position: absolute; width: 30px; height: 30px;
      top: `+(e.clientY-y.top-5)+"px; left: "+(e.clientX-y.left-5)+`px;
      z-index: 1000; background: `+(he?"rgba(255, 255, 255, .05)":"transparent")+`;
      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);`;var R;j&&(R=i.ownerDocument.defaultView.scrollY),n.input.focus(),j&&i.ownerDocument.defaultView.scrollTo(null,R),n.input.reset(),r.somethingSelected()||(i.value=t.prevInput=" "),t.contextMenuPending=O,n.selForContextMenu=r.doc.sel,clearTimeout(n.detectingSelectAll);function B(){if(i.selectionStart!=null){var ce=r.somethingSelected(),we="​"+(ce?i.value:"");i.value="⇚",i.value=we,t.prevInput=ce?"":"​",i.selectionStart=1,i.selectionEnd=we.length,n.selForContextMenu=r.doc.sel}}function O(){if(t.contextMenuPending==O&&(t.contextMenuPending=!1,t.wrapper.style.cssText=c,i.style.cssText=u,he&&ee<9&&n.scrollbars.setScrollTop(n.scroller.scrollTop=s),i.selectionStart!=null)){(!he||he&&ee<9)&&B();var ce=0,we=function(){n.selForContextMenu==r.doc.sel&&i.selectionStart==0&&i.selectionEnd>0&&t.prevInput=="​"?or(r,Gs)(r):ce++<10?n.detectingSelectAll=setTimeout(we,500):(n.selForContextMenu=null,n.input.reset())};n.detectingSelectAll=setTimeout(we,200)}}if(he&&ee>=9&&B(),Te){In(e);var H=function(){cr(window,"mouseup",H),setTimeout(O,20)};ht(window,"mouseup",H)}else setTimeout(O,50)},Le.prototype.readOnlyChanged=function(e){e||this.reset(),this.textarea.disabled=e=="nocursor",this.textarea.readOnly=!!e},Le.prototype.setUneditable=function(){},Le.prototype.needsContentAttribute=!1;function ze(e,t){if(t=t?pt(t):{},t.value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),t.autofocus==null){var r=$e(st(e));t.autofocus=r==e||e.getAttribute("autofocus")!=null&&r==document.body}function n(){e.value=l.getValue()}var i;if(e.form&&(ht(e.form,"submit",n),!t.leaveSubmitMethodAlone)){var o=e.form;i=o.submit;try{var s=o.submit=function(){n(),o.submit=i,o.submit(),o.submit=s}}catch{}}t.finishInit=function(u){u.save=n,u.getTextArea=function(){return e},u.toTextArea=function(){u.toTextArea=isNaN,n(),e.parentNode.removeChild(u.getWrapperElement()),e.style.display="",e.form&&(cr(e.form,"submit",n),!t.leaveSubmitMethodAlone&&typeof e.form.submit=="function"&&(e.form.submit=i))}},e.style.display="none";var l=Yt(function(u){return e.parentNode.insertBefore(u,e.nextSibling)},t);return l}function Xe(e){e.off=cr,e.on=ht,e.wheelEventPixels=Yi,e.Doc=mr,e.splitLines=Bt,e.countColumn=Ct,e.findColumn=$t,e.isWordChar=fa,e.Pass=Vt,e.signal=Qt,e.Line=Zr,e.changeEnd=bn,e.scrollbarModel=Ir,e.Pos=xe,e.cmpPos=Qe,e.modes=Ai,e.mimeModes=Gr,e.resolveMode=ki,e.getMode=Ri,e.modeExtensions=Pn,e.extendMode=Oi,e.copyState=$r,e.startState=Mi,e.innerMode=ha,e.commands=Zn,e.keyMap=En,e.keyName=Wa,e.isModifierKey=Ha,e.lookupKey=Qn,e.normalizeKeyMap=Iu,e.StringStream=Zt,e.SharedTextMarker=wi,e.TextMarker=Nr,e.LineWidget=Xr,e.e_preventDefault=qt,e.e_stopPropagation=_i,e.e_stop=In,e.addClass=Ve,e.contains=Pe,e.rmClass=We,e.keyNames=$n}Pu(Yt),f(Yt);var Ne="iter insert remove copy getEditor constructor".split(" ");for(var He in mr.prototype)mr.prototype.hasOwnProperty(He)&&ut(Ne,He)<0&&(Yt.prototype[He]=function(e){return function(){return e.apply(this.doc,arguments)}}(mr.prototype[He]));return Pr(mr),Yt.inputStyles={textarea:Le,contenteditable:re},Yt.defineMode=function(e){!Yt.defaults.mode&&e!="null"&&(Yt.defaults.mode=e),Hr.apply(this,arguments)},Yt.defineMIME=ni,Yt.defineMode("null",function(){return{token:function(e){return e.skipToEnd()}}}),Yt.defineMIME("text/plain","null"),Yt.defineExtension=function(e,t){Yt.prototype[e]=t},Yt.defineDocExtension=function(e,t){mr.prototype[e]=t},Yt.fromTextArea=ze,Xe(Yt),Yt.version="5.65.19",Yt})}(codemirror$1)),codemirror$1.exports}var codemirrorExports=requireCodemirror();const CodeMirror=getDefaultExportFromCjs(codemirrorExports);var javascript={exports:{}},hasRequiredJavascript;function requireJavascript(){return hasRequiredJavascript||(hasRequiredJavascript=1,function(T,b){(function(d){d(requireCodemirror())})(function(d){d.defineMode("javascript",function(m,S){var I=m.indentUnit,ae=S.statementIndent,Q=S.jsonld,he=S.json||Q,ee=S.trackScope!==!1,j=S.typescript,se=S.wordCharacters||/[\w$\xa1-\uffff]/,G=function(){function v(Jt){return{type:Jt,style:"keyword"}}var X=v("keyword a"),Re=v("keyword b"),Ue=v("keyword c"),xe=v("keyword d"),Qe=v("operator"),zt={type:"atom",style:"atom"};return{if:v("if"),while:X,with:X,else:Re,do:Re,try:Re,finally:Re,return:xe,break:xe,continue:xe,new:v("new"),delete:Ue,void:Ue,throw:Ue,debugger:v("debugger"),var:v("var"),const:v("var"),let:v("var"),function:v("function"),catch:v("catch"),for:v("for"),switch:v("switch"),case:v("case"),default:v("default"),in:Qe,typeof:Qe,instanceof:Qe,true:zt,false:zt,null:zt,undefined:zt,NaN:zt,Infinity:zt,this:v("this"),class:v("class"),super:v("atom"),yield:Ue,export:v("export"),import:v("import"),extends:Ue,await:Ue}}(),fe=/[+\-*&%=<>!?|~^@]/,ve=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function Ge(v){for(var X=!1,Re,Ue=!1;(Re=v.next())!=null;){if(!X){if(Re=="/"&&!Ue)return;Re=="["?Ue=!0:Ue&&Re=="]"&&(Ue=!1)}X=!X&&Re=="\\"}}var qe,q;function A(v,X,Re){return qe=v,q=Re,X}function U(v,X){var Re=v.next();if(Re=='"'||Re=="'")return X.tokenize=h(Re),X.tokenize(v,X);if(Re=="."&&v.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return A("number","number");if(Re=="."&&v.match(".."))return A("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(Re))return A(Re);if(Re=="="&&v.eat(">"))return A("=>","operator");if(Re=="0"&&v.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return A("number","number");if(/\d/.test(Re))return v.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),A("number","number");if(Re=="/")return v.eat("*")?(X.tokenize=_,_(v,X)):v.eat("/")?(v.skipToEnd(),A("comment","comment")):Er(v,X,1)?(Ge(v),v.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),A("regexp","string-2")):(v.eat("="),A("operator","operator",v.current()));if(Re=="`")return X.tokenize=D,D(v,X);if(Re=="#"&&v.peek()=="!")return v.skipToEnd(),A("meta","meta");if(Re=="#"&&v.eatWhile(se))return A("variable","property");if(Re=="<"&&v.match("!--")||Re=="-"&&v.match("->")&&!/\S/.test(v.string.slice(0,v.start)))return v.skipToEnd(),A("comment","comment");if(fe.test(Re))return(Re!=">"||!X.lexical||X.lexical.type!=">")&&(v.eat("=")?(Re=="!"||Re=="=")&&v.eat("="):/[<>*+\-|&?]/.test(Re)&&(v.eat(Re),Re==">"&&v.eat(Re))),Re=="?"&&v.eat(".")?A("."):A("operator","operator",v.current());if(se.test(Re)){v.eatWhile(se);var Ue=v.current();if(X.lastType!="."){if(G.propertyIsEnumerable(Ue)){var xe=G[Ue];return A(xe.type,xe.style,Ue)}if(Ue=="async"&&v.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return A("async","keyword",Ue)}return A("variable","variable",Ue)}}function h(v){return function(X,Re){var Ue=!1,xe;if(Q&&X.peek()=="@"&&X.match(ve))return Re.tokenize=U,A("jsonld-keyword","meta");for(;(xe=X.next())!=null&&!(xe==v&&!Ue);)Ue=!Ue&&xe=="\\";return Ue||(Re.tokenize=U),A("string","string")}}function _(v,X){for(var Re=!1,Ue;Ue=v.next();){if(Ue=="/"&&Re){X.tokenize=U;break}Re=Ue=="*"}return A("comment","comment")}function D(v,X){for(var Re=!1,Ue;(Ue=v.next())!=null;){if(!Re&&(Ue=="`"||Ue=="$"&&v.eat("{"))){X.tokenize=U;break}Re=!Re&&Ue=="\\"}return A("quasi","string-2",v.current())}var W="([{}])";function ie(v,X){X.fatArrowAt&&(X.fatArrowAt=null);var Re=v.string.indexOf("=>",v.start);if(!(Re<0)){if(j){var Ue=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(v.string.slice(v.start,Re));Ue&&(Re=Ue.index)}for(var xe=0,Qe=!1,zt=Re-1;zt>=0;--zt){var Jt=v.string.charAt(zt),hr=W.indexOf(Jt);if(hr>=0&&hr<3){if(!xe){++zt;break}if(--xe==0){Jt=="("&&(Qe=!0);break}}else if(hr>=3&&hr<6)++xe;else if(se.test(Jt))Qe=!0;else if(/["'\/`]/.test(Jt))for(;;--zt){if(zt==0)return;var Fi=v.string.charAt(zt-1);if(Fi==Jt&&v.string.charAt(zt-2)!="\\"){zt--;break}}else if(Qe&&!xe){++zt;break}}Qe&&!xe&&(X.fatArrowAt=zt)}}var me={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function Te(v,X,Re,Ue,xe,Qe){this.indented=v,this.column=X,this.type=Re,this.prev=xe,this.info=Qe,Ue!=null&&(this.align=Ue)}function ke(v,X){if(!ee)return!1;for(var Re=v.localVars;Re;Re=Re.next)if(Re.name==X)return!0;for(var Ue=v.context;Ue;Ue=Ue.prev)for(var Re=Ue.vars;Re;Re=Re.next)if(Re.name==X)return!0}function We(v,X,Re,Ue,xe){var Qe=v.cc;for(C.state=v,C.stream=xe,C.marked=null,C.cc=Qe,C.style=X,v.lexical.hasOwnProperty("align")||(v.lexical.align=!0);;){var zt=Qe.length?Qe.pop():he?ut:Ct;if(zt(Re,Ue)){for(;Qe.length&&Qe[Qe.length-1].lex;)Qe.pop()();return C.marked?C.marked:Re=="variable"&&ke(v,Ue)?"variable-2":X}}}var C={state:null,marked:null,cc:null};function E(){for(var v=arguments.length-1;v>=0;v--)C.cc.push(arguments[v])}function p(){return E.apply(null,arguments),!0}function Z(v,X){for(var Re=X;Re;Re=Re.next)if(Re.name==v)return!0;return!1}function be(v){var X=C.state;if(C.marked="def",!!ee){if(X.context){if(X.lexical.info=="var"&&X.context&&X.context.block){var Re=Pe(v,X.context);if(Re!=null){X.context=Re;return}}else if(!Z(v,X.localVars)){X.localVars=new Ke(v,X.localVars);return}}S.globalVars&&!Z(v,X.globalVars)&&(X.globalVars=new Ke(v,X.globalVars))}}function Pe(v,X){if(X)if(X.block){var Re=Pe(v,X.prev);return Re?Re==X.prev?X:new Ve(Re,X.vars,!0):null}else return Z(v,X.vars)?X:new Ve(X.prev,new Ke(v,X.vars),!1);else return null}function $e(v){return v=="public"||v=="private"||v=="protected"||v=="abstract"||v=="readonly"}function Ve(v,X,Re){this.prev=v,this.vars=X,this.block=Re}function Ke(v,X){this.name=v,this.next=X}var Je=new Ke("this",new Ke("arguments",null));function at(){C.state.context=new Ve(C.state.context,C.state.localVars,!1),C.state.localVars=Je}function Rt(){C.state.context=new Ve(C.state.context,C.state.localVars,!0),C.state.localVars=null}at.lex=Rt.lex=!0;function st(){C.state.localVars=C.state.context.vars,C.state.context=C.state.context.prev}st.lex=!0;function ft(v,X){var Re=function(){var Ue=C.state,xe=Ue.indented;if(Ue.lexical.type=="stat")xe=Ue.lexical.indented;else for(var Qe=Ue.lexical;Qe&&Qe.type==")"&&Qe.align;Qe=Qe.prev)xe=Qe.indented;Ue.lexical=new Te(xe,C.stream.column(),v,null,Ue.lexical,X)};return Re.lex=!0,Re}function tt(){var v=C.state;v.lexical.prev&&(v.lexical.type==")"&&(v.indented=v.lexical.indented),v.lexical=v.lexical.prev)}tt.lex=!0;function pt(v){function X(Re){return Re==v?p():v==";"||Re=="}"||Re==")"||Re=="]"?E():p(X)}return X}function Ct(v,X){return v=="var"?p(ft("vardef",X),_i,pt(";"),tt):v=="keyword a"?p(ft("form"),Vt,Ct,tt):v=="keyword b"?p(ft("form"),Ct,tt):v=="keyword d"?C.stream.match(/^\s*$/,!1)?p():p(ft("stat"),Sr,pt(";"),tt):v=="debugger"?p(pt(";")):v=="{"?p(ft("}"),Rt,Vr,tt,st):v==";"?p():v=="if"?(C.state.lexical.info=="else"&&C.state.cc[C.state.cc.length-1]==tt&&C.state.cc.pop()(),p(ft("form"),Vt,Ct,tt,Ei)):v=="function"?p(Bt):v=="for"?p(ft("form"),Rt,eo,Ct,st,tt):v=="class"||j&&X=="interface"?(C.marked="keyword",p(ft("form",v=="class"?v:X),Ai,tt)):v=="variable"?j&&X=="declare"?(C.marked="keyword",p(Ct)):j&&(X=="module"||X=="enum"||X=="type")&&C.stream.match(/^\s*\w/,!1)?(C.marked="keyword",X=="enum"?p(lt):X=="type"?p(to,pt("operator"),At,pt(";")):p(ft("form"),gr,pt("{"),ft("}"),Vr,tt,tt)):j&&X=="namespace"?(C.marked="keyword",p(ft("form"),ut,Ct,tt)):j&&X=="abstract"?(C.marked="keyword",p(Ct)):p(ft("stat"),Uo):v=="switch"?p(ft("form"),Vt,pt("{"),ft("}","switch"),Rt,Vr,tt,tt,st):v=="case"?p(ut,pt(":")):v=="default"?p(pt(":")):v=="catch"?p(ft("form"),at,Ht,Ct,tt,st):v=="export"?p(ft("stat"),ki,tt):v=="import"?p(ft("stat"),Pn,tt):v=="async"?p(Ct):X=="@"?p(ut,Ct):E(ft("stat"),ut,pt(";"),tt)}function Ht(v){if(v=="(")return p(Dr,pt(")"))}function ut(v,X){return ar(v,X,!1)}function Mt(v,X){return ar(v,X,!0)}function Vt(v){return v!="("?E():p(ft(")"),Sr,pt(")"),tt)}function ar(v,X,Re){if(C.state.fatArrowAt==C.stream.start){var Ue=Re?ri:_t;if(v=="(")return p(at,ft(")"),jt(Dr,")"),tt,pt("=>"),Ue,st);if(v=="variable")return E(at,gr,pt("=>"),Ue,st)}var xe=Re?$t:fr;return me.hasOwnProperty(v)?p(xe):v=="function"?p(Bt,xe):v=="class"||j&&X=="interface"?(C.marked="keyword",p(ft("form"),jo,tt)):v=="keyword c"||v=="async"?p(Re?Mt:ut):v=="("?p(ft(")"),Sr,pt(")"),tt,xe):v=="operator"||v=="spread"?p(Re?Mt:ut):v=="["?p(ft("]"),Zt,tt,xe):v=="{"?on(an,"}",null,xe):v=="quasi"?E(Pt,xe):v=="new"?p(qo(Re)):p()}function Sr(v){return v.match(/[;\}\)\],]/)?E():E(ut)}function fr(v,X){return v==","?p(Sr):$t(v,X,!1)}function $t(v,X,Re){var Ue=Re==!1?fr:$t,xe=Re==!1?ut:Mt;if(v=="=>")return p(at,Re?ri:_t,st);if(v=="operator")return/\+\+|--/.test(X)||j&&X=="!"?p(Ue):j&&X=="<"&&C.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?p(ft(">"),jt(At,">"),tt,Ue):X=="?"?p(ut,pt(":"),xe):p(xe);if(v=="quasi")return E(Pt,Ue);if(v!=";"){if(v=="(")return on(Mt,")","call",Ue);if(v==".")return p(fa,Ue);if(v=="[")return p(ft("]"),Sr,pt("]"),tt,Ue);if(j&&X=="as")return C.marked="keyword",p(At,Ue);if(v=="regexp")return C.state.lastType=C.marked="operator",C.stream.backUp(C.stream.pos-C.stream.start-1),p(xe)}}function Pt(v,X){return v!="quasi"?E():X.slice(X.length-2)!="${"?p(Pt):p(Sr,nn)}function nn(v){if(v=="}")return C.marked="string-2",C.state.tokenize=D,p(Pt)}function _t(v){return ie(C.stream,C.state),E(v=="{"?Ct:ut)}function ri(v){return ie(C.stream,C.state),E(v=="{"?Ct:Mt)}function qo(v){return function(X){return X=="."?p(v?Za:M):X=="variable"&&j?p(wr,v?$t:fr):E(v?Mt:ut)}}function M(v,X){if(X=="target")return C.marked="keyword",p(fr)}function Za(v,X){if(X=="target")return C.marked="keyword",p($t)}function Uo(v){return v==":"?p(tt,Ct):E(fr,pt(";"),tt)}function fa(v){if(v=="variable")return C.marked="property",p()}function an(v,X){if(v=="async")return C.marked="property",p(an);if(v=="variable"||C.style=="keyword"){if(C.marked="property",X=="get"||X=="set")return p(Yr);var Re;return j&&C.state.fatArrowAt==C.stream.start&&(Re=C.stream.match(/^\s*:\s*/,!1))&&(C.state.fatArrowAt=C.stream.pos+Re[0].length),p(Kr)}else{if(v=="number"||v=="string")return C.marked=Q?"property":C.style+" property",p(Kr);if(v=="jsonld-keyword")return p(Kr);if(j&&$e(X))return C.marked="keyword",p(an);if(v=="[")return p(ut,Mn,pt("]"),Kr);if(v=="spread")return p(Mt,Kr);if(X=="*")return C.marked="keyword",p(an);if(v==":")return E(Kr)}}function Yr(v){return v!="variable"?E(Kr):(C.marked="property",p(Bt))}function Kr(v){if(v==":")return p(Mt);if(v=="(")return E(Bt)}function jt(v,X,Re){function Ue(xe,Qe){if(Re?Re.indexOf(xe)>-1:xe==","){var zt=C.state.lexical;return zt.info=="call"&&(zt.pos=(zt.pos||0)+1),p(function(Jt,hr){return Jt==X||hr==X?E():E(v)},Ue)}return xe==X||Qe==X?p():Re&&Re.indexOf(";")>-1?E(v):p(pt(X))}return function(xe,Qe){return xe==X||Qe==X?p():E(v,Ue)}}function on(v,X,Re){for(var Ue=3;Ue<arguments.length;Ue++)C.cc.push(arguments[Ue]);return p(ft(X,Re),jt(v,X),tt)}function Vr(v){return v=="}"?p():E(Ct,Vr)}function Mn(v,X){if(j){if(v==":")return p(At);if(X=="?")return p(Mn)}}function Fn(v,X){if(j&&(v==":"||X=="in"))return p(At)}function nr(v){if(j&&v==":")return C.stream.match(/^\s*\w+\s+is\b/,!1)?p(ut,ca,At):p(At)}function ca(v,X){if(X=="is")return C.marked="keyword",p()}function At(v,X){if(X=="keyof"||X=="typeof"||X=="infer"||X=="readonly")return C.marked="keyword",p(X=="typeof"?Mt:At);if(v=="variable"||X=="void")return C.marked="type",p(_r);if(X=="|"||X=="&")return p(At);if(v=="string"||v=="number"||v=="atom")return p(_r);if(v=="[")return p(ft("]"),jt(At,"]",","),tt,_r);if(v=="{")return p(ft("}"),ht,tt,_r);if(v=="(")return p(jt(Kt,")"),Ja,_r);if(v=="<")return p(jt(At,">"),At);if(v=="quasi")return E(cr,_r)}function Ja(v){if(v=="=>")return p(At)}function ht(v){return v.match(/[\}\)\]]/)?p():v==","||v==";"?p(ht):E(sn,ht)}function sn(v,X){if(v=="variable"||C.style=="keyword")return C.marked="property",p(sn);if(X=="?"||v=="number"||v=="string")return p(sn);if(v==":")return p(At);if(v=="[")return p(pt("variable"),Fn,pt("]"),sn);if(v=="(")return E(Nn,sn);if(!v.match(/[;\}\)\],]/))return p()}function cr(v,X){return v!="quasi"?E():X.slice(X.length-2)!="${"?p(cr):p(At,Qt)}function Qt(v){if(v=="}")return C.marked="string-2",C.state.tokenize=D,p(cr)}function Kt(v,X){return v=="variable"&&C.stream.match(/^\s*[?:]/,!1)||X=="?"?p(Kt):v==":"?p(At):v=="spread"?p(Kt):E(At)}function _r(v,X){if(X=="<")return p(ft(">"),jt(At,">"),tt,_r);if(X=="|"||v=="."||X=="&")return p(At);if(v=="[")return p(At,pt("]"),_r);if(X=="extends"||X=="implements")return C.marked="keyword",p(At);if(X=="?")return p(At,pt(":"),At)}function wr(v,X){if(X=="<")return p(ft(">"),jt(At,">"),tt,_r)}function Pr(){return E(At,qt)}function qt(v,X){if(X=="=")return p(At)}function _i(v,X){return X=="enum"?(C.marked="keyword",p(lt)):E(gr,Mn,Br,Xo)}function gr(v,X){if(j&&$e(X))return C.marked="keyword",p(gr);if(v=="variable")return be(X),p();if(v=="spread")return p(gr);if(v=="[")return on(da,"]");if(v=="{")return on(In,"}")}function In(v,X){return v=="variable"&&!C.stream.match(/^\s*:/,!1)?(be(X),p(Br)):(v=="variable"&&(C.marked="property"),v=="spread"?p(gr):v=="}"?E():v=="["?p(ut,pt("]"),pt(":"),In):p(pt(":"),gr,Br))}function da(){return E(gr,Br)}function Br(v,X){if(X=="=")return p(Mt)}function Xo(v){if(v==",")return p(_i)}function Ei(v,X){if(v=="keyword b"&&X=="else")return p(ft("form","else"),Ct,tt)}function eo(v,X){if(X=="await")return p(eo);if(v=="(")return p(ft(")"),Li,tt)}function Li(v){return v=="var"?p(_i,ln):v=="variable"?p(ln):E(ln)}function ln(v,X){return v==")"?p():v==";"?p(ln):X=="in"||X=="of"?(C.marked="keyword",p(ut,ln)):E(ut,ln)}function Bt(v,X){if(X=="*")return C.marked="keyword",p(Bt);if(v=="variable")return be(X),p(Bt);if(v=="(")return p(at,ft(")"),jt(Dr,")"),tt,nr,Ct,st);if(j&&X=="<")return p(ft(">"),jt(Pr,">"),tt,Bt)}function Nn(v,X){if(X=="*")return C.marked="keyword",p(Nn);if(v=="variable")return be(X),p(Nn);if(v=="(")return p(at,ft(")"),jt(Dr,")"),tt,nr,st);if(j&&X=="<")return p(ft(">"),jt(Pr,">"),tt,Nn)}function to(v,X){if(v=="keyword"||v=="variable")return C.marked="type",p(to);if(X=="<")return p(ft(">"),jt(Pr,">"),tt)}function Dr(v,X){return X=="@"&&p(ut,Dr),v=="spread"?p(Dr):j&&$e(X)?(C.marked="keyword",p(Dr)):j&&v=="this"?p(Mn,Br):E(gr,Mn,Br)}function jo(v,X){return v=="variable"?Ai(v,X):Gr(v,X)}function Ai(v,X){if(v=="variable")return be(X),p(Gr)}function Gr(v,X){if(X=="<")return p(ft(">"),jt(Pr,">"),tt,Gr);if(X=="extends"||X=="implements"||j&&v==",")return X=="implements"&&(C.marked="keyword"),p(j?At:ut,Gr);if(v=="{")return p(ft("}"),Hr,tt)}function Hr(v,X){if(v=="async"||v=="variable"&&(X=="static"||X=="get"||X=="set"||j&&$e(X))&&C.stream.match(/^\s+#?[\w$\xa1-\uffff]/,!1))return C.marked="keyword",p(Hr);if(v=="variable"||C.style=="keyword")return C.marked="property",p(ni,Hr);if(v=="number"||v=="string")return p(ni,Hr);if(v=="[")return p(ut,Mn,pt("]"),ni,Hr);if(X=="*")return C.marked="keyword",p(Hr);if(j&&v=="(")return E(Nn,Hr);if(v==";"||v==",")return p(Hr);if(v=="}")return p();if(X=="@")return p(ut,Hr)}function ni(v,X){if(X=="!"||X=="?")return p(ni);if(v==":")return p(At,Br);if(X=="=")return p(Mt);var Re=C.state.lexical.prev,Ue=Re&&Re.info=="interface";return E(Ue?Nn:Bt)}function ki(v,X){return X=="*"?(C.marked="keyword",p(Mi,pt(";"))):X=="default"?(C.marked="keyword",p(ut,pt(";"))):v=="{"?p(jt(Ri,"}"),Mi,pt(";")):E(Ct)}function Ri(v,X){if(X=="as")return C.marked="keyword",p(pt("variable"));if(v=="variable")return E(Mt,Ri)}function Pn(v){return v=="string"?p():v=="("?E(ut):v=="."?E(fr):E(Oi,$r,Mi)}function Oi(v,X){return v=="{"?on(Oi,"}"):(v=="variable"&&be(X),X=="*"&&(C.marked="keyword"),p(ha))}function $r(v){if(v==",")return p(Oi,$r)}function ha(v,X){if(X=="as")return C.marked="keyword",p(Oi)}function Mi(v,X){if(X=="from")return C.marked="keyword",p(ut)}function Zt(v){return v=="]"?p():E(jt(Mt,"]"))}function lt(){return E(ft("form"),gr,pt("{"),ft("}"),jt(un,"}"),tt,tt)}function un(){return E(gr,Br)}function pa(v,X){return v.lastType=="operator"||v.lastType==","||fe.test(X.charAt(0))||/[,.]/.test(X.charAt(0))}function Er(v,X,Re){return X.tokenize==U&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(X.lastType)||X.lastType=="quasi"&&/\{\s*$/.test(v.string.slice(0,v.pos-(Re||0)))}return{startState:function(v){var X={tokenize:U,lastType:"sof",cc:[],lexical:new Te((v||0)-I,0,"block",!1),localVars:S.localVars,context:S.localVars&&new Ve(null,null,!1),indented:v||0};return S.globalVars&&typeof S.globalVars=="object"&&(X.globalVars=S.globalVars),X},token:function(v,X){if(v.sol()&&(X.lexical.hasOwnProperty("align")||(X.lexical.align=!1),X.indented=v.indentation(),ie(v,X)),X.tokenize!=_&&v.eatSpace())return null;var Re=X.tokenize(v,X);return qe=="comment"?Re:(X.lastType=qe=="operator"&&(q=="++"||q=="--")?"incdec":qe,We(X,Re,qe,q,v))},indent:function(v,X){if(v.tokenize==_||v.tokenize==D)return d.Pass;if(v.tokenize!=U)return 0;var Re=X&&X.charAt(0),Ue=v.lexical,xe;if(!/^\s*else\b/.test(X))for(var Qe=v.cc.length-1;Qe>=0;--Qe){var zt=v.cc[Qe];if(zt==tt)Ue=Ue.prev;else if(zt!=Ei&&zt!=st)break}for(;(Ue.type=="stat"||Ue.type=="form")&&(Re=="}"||(xe=v.cc[v.cc.length-1])&&(xe==fr||xe==$t)&&!/^[,\.=+\-*:?[\(]/.test(X));)Ue=Ue.prev;ae&&Ue.type==")"&&Ue.prev.type=="stat"&&(Ue=Ue.prev);var Jt=Ue.type,hr=Re==Jt;return Jt=="vardef"?Ue.indented+(v.lastType=="operator"||v.lastType==","?Ue.info.length+1:0):Jt=="form"&&Re=="{"?Ue.indented:Jt=="form"?Ue.indented+I:Jt=="stat"?Ue.indented+(pa(v,X)?ae||I:0):Ue.info=="switch"&&!hr&&S.doubleIndentSwitch!=!1?Ue.indented+(/^(?:case|default)\b/.test(X)?I:2*I):Ue.align?Ue.column+(hr?0:1):Ue.indented+(hr?0:I)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:he?null:"/*",blockCommentEnd:he?null:"*/",blockCommentContinue:he?null:" * ",lineComment:he?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:he?"json":"javascript",jsonldMode:Q,jsonMode:he,expressionAllowed:Er,skipExpression:function(v){We(v,"atom","atom","true",new d.StringStream("",2,null))}}}),d.registerHelper("wordChars","javascript",/[\w$]/),d.defineMIME("text/javascript","javascript"),d.defineMIME("text/ecmascript","javascript"),d.defineMIME("application/javascript","javascript"),d.defineMIME("application/x-javascript","javascript"),d.defineMIME("application/ecmascript","javascript"),d.defineMIME("application/json",{name:"javascript",json:!0}),d.defineMIME("application/x-json",{name:"javascript",json:!0}),d.defineMIME("application/manifest+json",{name:"javascript",json:!0}),d.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),d.defineMIME("text/typescript",{name:"javascript",typescript:!0}),d.defineMIME("application/typescript",{name:"javascript",typescript:!0})})}()),javascript.exports}requireJavascript();var dialog={exports:{}},hasRequiredDialog;function requireDialog(){return hasRequiredDialog||(hasRequiredDialog=1,function(T,b){(function(d){d(requireCodemirror())})(function(d){function m(I,ae,Q){var he=I.getWrapperElement(),ee;return ee=he.appendChild(document.createElement("div")),Q?ee.className="CodeMirror-dialog CodeMirror-dialog-bottom":ee.className="CodeMirror-dialog CodeMirror-dialog-top",typeof ae=="string"?ee.innerHTML=ae:ee.appendChild(ae),d.addClass(he,"dialog-opened"),ee}function S(I,ae){I.state.currentNotificationClose&&I.state.currentNotificationClose(),I.state.currentNotificationClose=ae}d.defineExtension("openDialog",function(I,ae,Q){Q||(Q={}),S(this,null);var he=m(this,I,Q.bottom),ee=!1,j=this;function se(ve){if(typeof ve=="string")G.value=ve;else{if(ee)return;ee=!0,d.rmClass(he.parentNode,"dialog-opened"),he.parentNode.removeChild(he),j.focus(),Q.onClose&&Q.onClose(he)}}var G=he.getElementsByTagName("input")[0],fe;return G?(G.focus(),Q.value&&(G.value=Q.value,Q.selectValueOnOpen!==!1&&G.select()),Q.onInput&&d.on(G,"input",function(ve){Q.onInput(ve,G.value,se)}),Q.onKeyUp&&d.on(G,"keyup",function(ve){Q.onKeyUp(ve,G.value,se)}),d.on(G,"keydown",function(ve){Q&&Q.onKeyDown&&Q.onKeyDown(ve,G.value,se)||((ve.keyCode==27||Q.closeOnEnter!==!1&&ve.keyCode==13)&&(G.blur(),d.e_stop(ve),se()),ve.keyCode==13&&ae(G.value,ve))}),Q.closeOnBlur!==!1&&d.on(he,"focusout",function(ve){ve.relatedTarget!==null&&se()})):(fe=he.getElementsByTagName("button")[0])&&(d.on(fe,"click",function(){se(),j.focus()}),Q.closeOnBlur!==!1&&d.on(fe,"blur",se),fe.focus()),se}),d.defineExtension("openConfirm",function(I,ae,Q){S(this,null);var he=m(this,I,Q&&Q.bottom),ee=he.getElementsByTagName("button"),j=!1,se=this,G=1;function fe(){j||(j=!0,d.rmClass(he.parentNode,"dialog-opened"),he.parentNode.removeChild(he),se.focus())}ee[0].focus();for(var ve=0;ve<ee.length;++ve){var Ge=ee[ve];(function(qe){d.on(Ge,"click",function(q){d.e_preventDefault(q),fe(),qe&&qe(se)})})(ae[ve]),d.on(Ge,"blur",function(){--G,setTimeout(function(){G<=0&&fe()},200)}),d.on(Ge,"focus",function(){++G})}}),d.defineExtension("openNotification",function(I,ae){S(this,se);var Q=m(this,I,ae&&ae.bottom),he=!1,ee,j=ae&&typeof ae.duration<"u"?ae.duration:5e3;function se(){he||(he=!0,clearTimeout(ee),d.rmClass(Q.parentNode,"dialog-opened"),Q.parentNode.removeChild(Q))}return d.on(Q,"click",function(G){d.e_preventDefault(G),se()}),j&&(ee=setTimeout(se,j)),se})})}()),dialog.exports}requireDialog();var sublime={exports:{}},searchcursor={exports:{}},hasRequiredSearchcursor;function requireSearchcursor(){return hasRequiredSearchcursor||(hasRequiredSearchcursor=1,function(T,b){(function(d){d(requireCodemirror())})(function(d){var m=d.Pos;function S(A){var U=A.flags;return U??(A.ignoreCase?"i":"")+(A.global?"g":"")+(A.multiline?"m":"")}function I(A,U){for(var h=S(A),_=h,D=0;D<U.length;D++)_.indexOf(U.charAt(D))==-1&&(_+=U.charAt(D));return h==_?A:new RegExp(A.source,_)}function ae(A){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(A.source)}function Q(A,U,h){U=I(U,"g");for(var _=h.line,D=h.ch,W=A.lastLine();_<=W;_++,D=0){U.lastIndex=D;var ie=A.getLine(_),me=U.exec(ie);if(me)return{from:m(_,me.index),to:m(_,me.index+me[0].length),match:me}}}function he(A,U,h){if(!ae(U))return Q(A,U,h);U=I(U,"gm");for(var _,D=1,W=h.line,ie=A.lastLine();W<=ie;){for(var me=0;me<D&&!(W>ie);me++){var Te=A.getLine(W++);_=_==null?Te:_+`
`+Te}D=D*2,U.lastIndex=h.ch;var ke=U.exec(_);if(ke){var We=_.slice(0,ke.index).split(`
`),C=ke[0].split(`
`),E=h.line+We.length-1,p=We[We.length-1].length;return{from:m(E,p),to:m(E+C.length-1,C.length==1?p+C[0].length:C[C.length-1].length),match:ke}}}}function ee(A,U,h){for(var _,D=0;D<=A.length;){U.lastIndex=D;var W=U.exec(A);if(!W)break;var ie=W.index+W[0].length;if(ie>A.length-h)break;(!_||ie>_.index+_[0].length)&&(_=W),D=W.index+1}return _}function j(A,U,h){U=I(U,"g");for(var _=h.line,D=h.ch,W=A.firstLine();_>=W;_--,D=-1){var ie=A.getLine(_),me=ee(ie,U,D<0?0:ie.length-D);if(me)return{from:m(_,me.index),to:m(_,me.index+me[0].length),match:me}}}function se(A,U,h){if(!ae(U))return j(A,U,h);U=I(U,"gm");for(var _,D=1,W=A.getLine(h.line).length-h.ch,ie=h.line,me=A.firstLine();ie>=me;){for(var Te=0;Te<D&&ie>=me;Te++){var ke=A.getLine(ie--);_=_==null?ke:ke+`
`+_}D*=2;var We=ee(_,U,W);if(We){var C=_.slice(0,We.index).split(`
`),E=We[0].split(`
`),p=ie+C.length,Z=C[C.length-1].length;return{from:m(p,Z),to:m(p+E.length-1,E.length==1?Z+E[0].length:E[E.length-1].length),match:We}}}}var G,fe;String.prototype.normalize?(G=function(A){return A.normalize("NFD").toLowerCase()},fe=function(A){return A.normalize("NFD")}):(G=function(A){return A.toLowerCase()},fe=function(A){return A});function ve(A,U,h,_){if(A.length==U.length)return h;for(var D=0,W=h+Math.max(0,A.length-U.length);;){if(D==W)return D;var ie=D+W>>1,me=_(A.slice(0,ie)).length;if(me==h)return ie;me>h?W=ie:D=ie+1}}function Ge(A,U,h,_){if(!U.length)return null;var D=_?G:fe,W=D(U).split(/\r|\n\r?/);e:for(var ie=h.line,me=h.ch,Te=A.lastLine()+1-W.length;ie<=Te;ie++,me=0){var ke=A.getLine(ie).slice(me),We=D(ke);if(W.length==1){var C=We.indexOf(W[0]);if(C==-1)continue e;var h=ve(ke,We,C,D)+me;return{from:m(ie,ve(ke,We,C,D)+me),to:m(ie,ve(ke,We,C+W[0].length,D)+me)}}else{var E=We.length-W[0].length;if(We.slice(E)!=W[0])continue e;for(var p=1;p<W.length-1;p++)if(D(A.getLine(ie+p))!=W[p])continue e;var Z=A.getLine(ie+W.length-1),be=D(Z),Pe=W[W.length-1];if(be.slice(0,Pe.length)!=Pe)continue e;return{from:m(ie,ve(ke,We,E,D)+me),to:m(ie+W.length-1,ve(Z,be,Pe.length,D))}}}}function qe(A,U,h,_){if(!U.length)return null;var D=_?G:fe,W=D(U).split(/\r|\n\r?/);e:for(var ie=h.line,me=h.ch,Te=A.firstLine()-1+W.length;ie>=Te;ie--,me=-1){var ke=A.getLine(ie);me>-1&&(ke=ke.slice(0,me));var We=D(ke);if(W.length==1){var C=We.lastIndexOf(W[0]);if(C==-1)continue e;return{from:m(ie,ve(ke,We,C,D)),to:m(ie,ve(ke,We,C+W[0].length,D))}}else{var E=W[W.length-1];if(We.slice(0,E.length)!=E)continue e;for(var p=1,h=ie-W.length+1;p<W.length-1;p++)if(D(A.getLine(h+p))!=W[p])continue e;var Z=A.getLine(ie+1-W.length),be=D(Z);if(be.slice(be.length-W[0].length)!=W[0])continue e;return{from:m(ie+1-W.length,ve(Z,be,Z.length-W[0].length,D)),to:m(ie,ve(ke,We,E.length,D))}}}}function q(A,U,h,_){this.atOccurrence=!1,this.afterEmptyMatch=!1,this.doc=A,h=h?A.clipPos(h):m(0,0),this.pos={from:h,to:h};var D;typeof _=="object"?D=_.caseFold:(D=_,_=null),typeof U=="string"?(D==null&&(D=!1),this.matches=function(W,ie){return(W?qe:Ge)(A,U,ie,D)}):(U=I(U,"gm"),!_||_.multiline!==!1?this.matches=function(W,ie){return(W?se:he)(A,U,ie)}:this.matches=function(W,ie){return(W?j:Q)(A,U,ie)})}q.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(A){var U=this.doc.clipPos(A?this.pos.from:this.pos.to);if(this.afterEmptyMatch&&this.atOccurrence&&(U=m(U.line,U.ch),A?(U.ch--,U.ch<0&&(U.line--,U.ch=(this.doc.getLine(U.line)||"").length)):(U.ch++,U.ch>(this.doc.getLine(U.line)||"").length&&(U.ch=0,U.line++)),d.cmpPos(U,this.doc.clipPos(U))!=0))return this.atOccurrence=!1;var h=this.matches(A,U);if(this.afterEmptyMatch=h&&d.cmpPos(h.from,h.to)==0,h)return this.pos=h,this.atOccurrence=!0,this.pos.match||!0;var _=m(A?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:_,to:_},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(A,U){if(this.atOccurrence){var h=d.splitLines(A);this.doc.replaceRange(h,this.pos.from,this.pos.to,U),this.pos.to=m(this.pos.from.line+h.length-1,h[h.length-1].length+(h.length==1?this.pos.from.ch:0))}}},d.defineExtension("getSearchCursor",function(A,U,h){return new q(this.doc,A,U,h)}),d.defineDocExtension("getSearchCursor",function(A,U,h){return new q(this,A,U,h)}),d.defineExtension("selectMatches",function(A,U){for(var h=[],_=this.getSearchCursor(A,this.getCursor("from"),U);_.findNext()&&!(d.cmpPos(_.to(),this.getCursor("to"))>0);)h.push({anchor:_.from(),head:_.to()});h.length&&this.setSelections(h,0)})})}()),searchcursor.exports}var matchbrackets={exports:{}},hasRequiredMatchbrackets;function requireMatchbrackets(){return hasRequiredMatchbrackets||(hasRequiredMatchbrackets=1,function(T,b){(function(d){d(requireCodemirror())})(function(d){var m=/MSIE \d/.test(navigator.userAgent)&&(document.documentMode==null||document.documentMode<8),S=d.Pos,I={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};function ae(G){return G&&G.bracketRegex||/[(){}[\]]/}function Q(G,fe,ve){var Ge=G.getLineHandle(fe.line),qe=fe.ch-1,q=ve&&ve.afterCursor;q==null&&(q=/(^| )cm-fat-cursor($| )/.test(G.getWrapperElement().className));var A=ae(ve),U=!q&&qe>=0&&A.test(Ge.text.charAt(qe))&&I[Ge.text.charAt(qe)]||A.test(Ge.text.charAt(qe+1))&&I[Ge.text.charAt(++qe)];if(!U)return null;var h=U.charAt(1)==">"?1:-1;if(ve&&ve.strict&&h>0!=(qe==fe.ch))return null;var _=G.getTokenTypeAt(S(fe.line,qe+1)),D=he(G,S(fe.line,qe+(h>0?1:0)),h,_,ve);return D==null?null:{from:S(fe.line,qe),to:D&&D.pos,match:D&&D.ch==U.charAt(0),forward:h>0}}function he(G,fe,ve,Ge,qe){for(var q=qe&&qe.maxScanLineLength||1e4,A=qe&&qe.maxScanLines||1e3,U=[],h=ae(qe),_=ve>0?Math.min(fe.line+A,G.lastLine()+1):Math.max(G.firstLine()-1,fe.line-A),D=fe.line;D!=_;D+=ve){var W=G.getLine(D);if(W){var ie=ve>0?0:W.length-1,me=ve>0?W.length:-1;if(!(W.length>q))for(D==fe.line&&(ie=fe.ch-(ve<0?1:0));ie!=me;ie+=ve){var Te=W.charAt(ie);if(h.test(Te)&&(Ge===void 0||(G.getTokenTypeAt(S(D,ie+1))||"")==(Ge||""))){var ke=I[Te];if(ke&&ke.charAt(1)==">"==ve>0)U.push(Te);else if(U.length)U.pop();else return{pos:S(D,ie),ch:Te}}}}}return D-ve==(ve>0?G.lastLine():G.firstLine())?!1:null}function ee(G,fe,ve){for(var Ge=G.state.matchBrackets.maxHighlightLineLength||1e3,qe=ve&&ve.highlightNonMatching,q=[],A=G.listSelections(),U=0;U<A.length;U++){var h=A[U].empty()&&Q(G,A[U].head,ve);if(h&&(h.match||qe!==!1)&&G.getLine(h.from.line).length<=Ge){var _=h.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";q.push(G.markText(h.from,S(h.from.line,h.from.ch+1),{className:_})),h.to&&G.getLine(h.to.line).length<=Ge&&q.push(G.markText(h.to,S(h.to.line,h.to.ch+1),{className:_}))}}if(q.length){m&&G.state.focused&&G.focus();var D=function(){G.operation(function(){for(var W=0;W<q.length;W++)q[W].clear()})};if(fe)setTimeout(D,800);else return D}}function j(G){G.operation(function(){G.state.matchBrackets.currentlyHighlighted&&(G.state.matchBrackets.currentlyHighlighted(),G.state.matchBrackets.currentlyHighlighted=null),G.state.matchBrackets.currentlyHighlighted=ee(G,!1,G.state.matchBrackets)})}function se(G){G.state.matchBrackets&&G.state.matchBrackets.currentlyHighlighted&&(G.state.matchBrackets.currentlyHighlighted(),G.state.matchBrackets.currentlyHighlighted=null)}d.defineOption("matchBrackets",!1,function(G,fe,ve){ve&&ve!=d.Init&&(G.off("cursorActivity",j),G.off("focus",j),G.off("blur",se),se(G)),fe&&(G.state.matchBrackets=typeof fe=="object"?fe:{},G.on("cursorActivity",j),G.on("focus",j),G.on("blur",se))}),d.defineExtension("matchBrackets",function(){ee(this,!0)}),d.defineExtension("findMatchingBracket",function(G,fe,ve){return(ve||typeof fe=="boolean")&&(ve?(ve.strict=fe,fe=ve):fe=fe?{strict:!0}:null),Q(this,G,fe)}),d.defineExtension("scanForBracket",function(G,fe,ve,Ge){return he(this,G,fe,ve,Ge)})})}()),matchbrackets.exports}var hasRequiredSublime;function requireSublime(){return hasRequiredSublime||(hasRequiredSublime=1,function(T,b){(function(d){d(requireCodemirror(),requireSearchcursor(),requireMatchbrackets())})(function(d){var m=d.commands,S=d.Pos;function I(h,_,D){if(D<0&&_.ch==0)return h.clipPos(S(_.line-1));var W=h.getLine(_.line);if(D>0&&_.ch>=W.length)return h.clipPos(S(_.line+1,0));for(var ie="start",me,Te=_.ch,ke=Te,We=D<0?0:W.length,C=0;ke!=We;ke+=D,C++){var E=W.charAt(D<0?ke-1:ke),p=E!="_"&&d.isWordChar(E)?"w":"o";if(p=="w"&&E.toUpperCase()==E&&(p="W"),ie=="start")p!="o"?(ie="in",me=p):Te=ke+D;else if(ie=="in"&&me!=p){if(me=="w"&&p=="W"&&D<0&&ke--,me=="W"&&p=="w"&&D>0)if(ke==Te+1){me="w";continue}else ke--;break}}return S(_.line,ke)}function ae(h,_){h.extendSelectionsBy(function(D){return h.display.shift||h.doc.extend||D.empty()?I(h.doc,D.head,_):_<0?D.from():D.to()})}m.goSubwordLeft=function(h){ae(h,-1)},m.goSubwordRight=function(h){ae(h,1)},m.scrollLineUp=function(h){var _=h.getScrollInfo();if(!h.somethingSelected()){var D=h.lineAtHeight(_.top+_.clientHeight,"local");h.getCursor().line>=D&&h.execCommand("goLineUp")}h.scrollTo(null,_.top-h.defaultTextHeight())},m.scrollLineDown=function(h){var _=h.getScrollInfo();if(!h.somethingSelected()){var D=h.lineAtHeight(_.top,"local")+1;h.getCursor().line<=D&&h.execCommand("goLineDown")}h.scrollTo(null,_.top+h.defaultTextHeight())},m.splitSelectionByLine=function(h){for(var _=h.listSelections(),D=[],W=0;W<_.length;W++)for(var ie=_[W].from(),me=_[W].to(),Te=ie.line;Te<=me.line;++Te)me.line>ie.line&&Te==me.line&&me.ch==0||D.push({anchor:Te==ie.line?ie:S(Te,0),head:Te==me.line?me:S(Te)});h.setSelections(D,0)},m.singleSelectionTop=function(h){var _=h.listSelections()[0];h.setSelection(_.anchor,_.head,{scroll:!1})},m.selectLine=function(h){for(var _=h.listSelections(),D=[],W=0;W<_.length;W++){var ie=_[W];D.push({anchor:S(ie.from().line,0),head:S(ie.to().line+1,0)})}h.setSelections(D)};function Q(h,_){if(h.isReadOnly())return d.Pass;h.operation(function(){for(var D=h.listSelections().length,W=[],ie=-1,me=0;me<D;me++){var Te=h.listSelections()[me].head;if(!(Te.line<=ie)){var ke=S(Te.line+(_?0:1),0);h.replaceRange(`
`,ke,null,"+insertLine"),h.indentLine(ke.line,null,!0),W.push({head:ke,anchor:ke}),ie=Te.line+1}}h.setSelections(W)}),h.execCommand("indentAuto")}m.insertLineAfter=function(h){return Q(h,!1)},m.insertLineBefore=function(h){return Q(h,!0)};function he(h,_){for(var D=_.ch,W=D,ie=h.getLine(_.line);D&&d.isWordChar(ie.charAt(D-1));)--D;for(;W<ie.length&&d.isWordChar(ie.charAt(W));)++W;return{from:S(_.line,D),to:S(_.line,W),word:ie.slice(D,W)}}m.selectNextOccurrence=function(h){var _=h.getCursor("from"),D=h.getCursor("to"),W=h.state.sublimeFindFullWord==h.doc.sel;if(d.cmpPos(_,D)==0){var ie=he(h,_);if(!ie.word)return;h.setSelection(ie.from,ie.to),W=!0}else{var me=h.getRange(_,D),Te=W?new RegExp("\\b"+me+"\\b"):me,ke=h.getSearchCursor(Te,D),We=ke.findNext();if(We||(ke=h.getSearchCursor(Te,S(h.firstLine(),0)),We=ke.findNext()),!We||j(h.listSelections(),ke.from(),ke.to()))return;h.addSelection(ke.from(),ke.to())}W&&(h.state.sublimeFindFullWord=h.doc.sel)},m.skipAndSelectNextOccurrence=function(h){var _=h.getCursor("anchor"),D=h.getCursor("head");m.selectNextOccurrence(h),d.cmpPos(_,D)!=0&&h.doc.setSelections(h.doc.listSelections().filter(function(W){return W.anchor!=_||W.head!=D}))};function ee(h,_){for(var D=h.listSelections(),W=[],ie=0;ie<D.length;ie++){var me=D[ie],Te=h.findPosV(me.anchor,_,"line",me.anchor.goalColumn),ke=h.findPosV(me.head,_,"line",me.head.goalColumn);Te.goalColumn=me.anchor.goalColumn!=null?me.anchor.goalColumn:h.cursorCoords(me.anchor,"div").left,ke.goalColumn=me.head.goalColumn!=null?me.head.goalColumn:h.cursorCoords(me.head,"div").left;var We={anchor:Te,head:ke};W.push(me),W.push(We)}h.setSelections(W)}m.addCursorToPrevLine=function(h){ee(h,-1)},m.addCursorToNextLine=function(h){ee(h,1)};function j(h,_,D){for(var W=0;W<h.length;W++)if(d.cmpPos(h[W].from(),_)==0&&d.cmpPos(h[W].to(),D)==0)return!0;return!1}var se="(){}[]";function G(h){for(var _=h.listSelections(),D=[],W=0;W<_.length;W++){var ie=_[W],me=ie.head,Te=h.scanForBracket(me,-1);if(!Te)return!1;for(;;){var ke=h.scanForBracket(me,1);if(!ke)return!1;if(ke.ch==se.charAt(se.indexOf(Te.ch)+1)){var We=S(Te.pos.line,Te.pos.ch+1);if(d.cmpPos(We,ie.from())==0&&d.cmpPos(ke.pos,ie.to())==0){if(Te=h.scanForBracket(Te.pos,-1),!Te)return!1}else{D.push({anchor:We,head:ke.pos});break}}me=S(ke.pos.line,ke.pos.ch+1)}}return h.setSelections(D),!0}m.selectScope=function(h){G(h)||h.execCommand("selectAll")},m.selectBetweenBrackets=function(h){if(!G(h))return d.Pass};function fe(h){return h?/\bpunctuation\b/.test(h)?h:void 0:null}m.goToBracket=function(h){h.extendSelectionsBy(function(_){var D=h.scanForBracket(_.head,1,fe(h.getTokenTypeAt(_.head)));if(D&&d.cmpPos(D.pos,_.head)!=0)return D.pos;var W=h.scanForBracket(_.head,-1,fe(h.getTokenTypeAt(S(_.head.line,_.head.ch+1))));return W&&S(W.pos.line,W.pos.ch+1)||_.head})},m.swapLineUp=function(h){if(h.isReadOnly())return d.Pass;for(var _=h.listSelections(),D=[],W=h.firstLine()-1,ie=[],me=0;me<_.length;me++){var Te=_[me],ke=Te.from().line-1,We=Te.to().line;ie.push({anchor:S(Te.anchor.line-1,Te.anchor.ch),head:S(Te.head.line-1,Te.head.ch)}),Te.to().ch==0&&!Te.empty()&&--We,ke>W?D.push(ke,We):D.length&&(D[D.length-1]=We),W=We}h.operation(function(){for(var C=0;C<D.length;C+=2){var E=D[C],p=D[C+1],Z=h.getLine(E);h.replaceRange("",S(E,0),S(E+1,0),"+swapLine"),p>h.lastLine()?h.replaceRange(`
`+Z,S(h.lastLine()),null,"+swapLine"):h.replaceRange(Z+`
`,S(p,0),null,"+swapLine")}h.setSelections(ie),h.scrollIntoView()})},m.swapLineDown=function(h){if(h.isReadOnly())return d.Pass;for(var _=h.listSelections(),D=[],W=h.lastLine()+1,ie=_.length-1;ie>=0;ie--){var me=_[ie],Te=me.to().line+1,ke=me.from().line;me.to().ch==0&&!me.empty()&&Te--,Te<W?D.push(Te,ke):D.length&&(D[D.length-1]=ke),W=ke}h.operation(function(){for(var We=D.length-2;We>=0;We-=2){var C=D[We],E=D[We+1],p=h.getLine(C);C==h.lastLine()?h.replaceRange("",S(C-1),S(C),"+swapLine"):h.replaceRange("",S(C,0),S(C+1,0),"+swapLine"),h.replaceRange(p+`
`,S(E,0),null,"+swapLine")}h.scrollIntoView()})},m.toggleCommentIndented=function(h){h.toggleComment({indent:!0})},m.joinLines=function(h){for(var _=h.listSelections(),D=[],W=0;W<_.length;W++){for(var ie=_[W],me=ie.from(),Te=me.line,ke=ie.to().line;W<_.length-1&&_[W+1].from().line==ke;)ke=_[++W].to().line;D.push({start:Te,end:ke,anchor:!ie.empty()&&me})}h.operation(function(){for(var We=0,C=[],E=0;E<D.length;E++){for(var p=D[E],Z=p.anchor&&S(p.anchor.line-We,p.anchor.ch),be,Pe=p.start;Pe<=p.end;Pe++){var $e=Pe-We;Pe==p.end&&(be=S($e,h.getLine($e).length+1)),$e<h.lastLine()&&(h.replaceRange(" ",S($e),S($e+1,/^\s*/.exec(h.getLine($e+1))[0].length)),++We)}C.push({anchor:Z||be,head:be})}h.setSelections(C,0)})},m.duplicateLine=function(h){h.operation(function(){for(var _=h.listSelections().length,D=0;D<_;D++){var W=h.listSelections()[D];W.empty()?h.replaceRange(h.getLine(W.head.line)+`
`,S(W.head.line,0)):h.replaceRange(h.getRange(W.from(),W.to()),W.from())}h.scrollIntoView()})};function ve(h,_,D){if(h.isReadOnly())return d.Pass;for(var W=h.listSelections(),ie=[],me,Te=0;Te<W.length;Te++){var ke=W[Te];if(!ke.empty()){for(var We=ke.from().line,C=ke.to().line;Te<W.length-1&&W[Te+1].from().line==C;)C=W[++Te].to().line;W[Te].to().ch||C--,ie.push(We,C)}}ie.length?me=!0:ie.push(h.firstLine(),h.lastLine()),h.operation(function(){for(var E=[],p=0;p<ie.length;p+=2){var Z=ie[p],be=ie[p+1],Pe=S(Z,0),$e=S(be),Ve=h.getRange(Pe,$e,!1);_?Ve.sort(function(Ke,Je){return Ke<Je?-D:Ke==Je?0:D}):Ve.sort(function(Ke,Je){var at=Ke.toUpperCase(),Rt=Je.toUpperCase();return at!=Rt&&(Ke=at,Je=Rt),Ke<Je?-D:Ke==Je?0:D}),h.replaceRange(Ve,Pe,$e),me&&E.push({anchor:Pe,head:S(be+1,0)})}me&&h.setSelections(E,0)})}m.sortLines=function(h){ve(h,!0,1)},m.reverseSortLines=function(h){ve(h,!0,-1)},m.sortLinesInsensitive=function(h){ve(h,!1,1)},m.reverseSortLinesInsensitive=function(h){ve(h,!1,-1)},m.nextBookmark=function(h){var _=h.state.sublimeBookmarks;if(_)for(;_.length;){var D=_.shift(),W=D.find();if(W)return _.push(D),h.setSelection(W.from,W.to)}},m.prevBookmark=function(h){var _=h.state.sublimeBookmarks;if(_)for(;_.length;){_.unshift(_.pop());var D=_[_.length-1].find();if(!D)_.pop();else return h.setSelection(D.from,D.to)}},m.toggleBookmark=function(h){for(var _=h.listSelections(),D=h.state.sublimeBookmarks||(h.state.sublimeBookmarks=[]),W=0;W<_.length;W++){for(var ie=_[W].from(),me=_[W].to(),Te=_[W].empty()?h.findMarksAt(ie):h.findMarks(ie,me),ke=0;ke<Te.length;ke++)if(Te[ke].sublimeBookmark){Te[ke].clear();for(var We=0;We<D.length;We++)D[We]==Te[ke]&&D.splice(We--,1);break}ke==Te.length&&D.push(h.markText(ie,me,{sublimeBookmark:!0,clearWhenEmpty:!1}))}},m.clearBookmarks=function(h){var _=h.state.sublimeBookmarks;if(_)for(var D=0;D<_.length;D++)_[D].clear();_.length=0},m.selectBookmarks=function(h){var _=h.state.sublimeBookmarks,D=[];if(_)for(var W=0;W<_.length;W++){var ie=_[W].find();ie?D.push({anchor:ie.from,head:ie.to}):_.splice(W--,0)}D.length&&h.setSelections(D,0)};function Ge(h,_){h.operation(function(){for(var D=h.listSelections(),W=[],ie=[],me=0;me<D.length;me++){var Te=D[me];Te.empty()?(W.push(me),ie.push("")):ie.push(_(h.getRange(Te.from(),Te.to())))}h.replaceSelections(ie,"around","case");for(var me=W.length-1,ke;me>=0;me--){var Te=D[W[me]];if(!(ke&&d.cmpPos(Te.head,ke)>0)){var We=he(h,Te.head);ke=We.from,h.replaceRange(_(We.word),We.from,We.to)}}})}m.smartBackspace=function(h){if(h.somethingSelected())return d.Pass;h.operation(function(){for(var _=h.listSelections(),D=h.getOption("indentUnit"),W=_.length-1;W>=0;W--){var ie=_[W].head,me=h.getRange({line:ie.line,ch:0},ie),Te=d.countColumn(me,null,h.getOption("tabSize")),ke=h.findPosH(ie,-1,"char",!1);if(me&&!/\S/.test(me)&&Te%D==0){var We=new S(ie.line,d.findColumn(me,Te-D,D));We.ch!=ie.ch&&(ke=We)}h.replaceRange("",ke,ie,"+delete")}})},m.delLineRight=function(h){h.operation(function(){for(var _=h.listSelections(),D=_.length-1;D>=0;D--)h.replaceRange("",_[D].anchor,S(_[D].to().line),"+delete");h.scrollIntoView()})},m.upcaseAtCursor=function(h){Ge(h,function(_){return _.toUpperCase()})},m.downcaseAtCursor=function(h){Ge(h,function(_){return _.toLowerCase()})},m.setSublimeMark=function(h){h.state.sublimeMark&&h.state.sublimeMark.clear(),h.state.sublimeMark=h.setBookmark(h.getCursor())},m.selectToSublimeMark=function(h){var _=h.state.sublimeMark&&h.state.sublimeMark.find();_&&h.setSelection(h.getCursor(),_)},m.deleteToSublimeMark=function(h){var _=h.state.sublimeMark&&h.state.sublimeMark.find();if(_){var D=h.getCursor(),W=_;if(d.cmpPos(D,W)>0){var ie=W;W=D,D=ie}h.state.sublimeKilled=h.getRange(D,W),h.replaceRange("",D,W)}},m.swapWithSublimeMark=function(h){var _=h.state.sublimeMark&&h.state.sublimeMark.find();_&&(h.state.sublimeMark.clear(),h.state.sublimeMark=h.setBookmark(h.getCursor()),h.setCursor(_))},m.sublimeYank=function(h){h.state.sublimeKilled!=null&&h.replaceSelection(h.state.sublimeKilled,null,"paste")},m.showInCenter=function(h){var _=h.cursorCoords(null,"local");h.scrollTo(null,(_.top+_.bottom)/2-h.getScrollInfo().clientHeight/2)};function qe(h){var _=h.getCursor("from"),D=h.getCursor("to");if(d.cmpPos(_,D)==0){var W=he(h,_);if(!W.word)return;_=W.from,D=W.to}return{from:_,to:D,query:h.getRange(_,D),word:W}}function q(h,_){var D=qe(h);if(D){var W=D.query,ie=h.getSearchCursor(W,_?D.to:D.from);(_?ie.findNext():ie.findPrevious())?h.setSelection(ie.from(),ie.to()):(ie=h.getSearchCursor(W,_?S(h.firstLine(),0):h.clipPos(S(h.lastLine()))),(_?ie.findNext():ie.findPrevious())?h.setSelection(ie.from(),ie.to()):D.word&&h.setSelection(D.from,D.to))}}m.findUnder=function(h){q(h,!0)},m.findUnderPrevious=function(h){q(h,!1)},m.findAllUnder=function(h){var _=qe(h);if(_){for(var D=h.getSearchCursor(_.query),W=[],ie=-1;D.findNext();)W.push({anchor:D.from(),head:D.to()}),D.from().line<=_.from.line&&D.from().ch<=_.from.ch&&ie++;h.setSelections(W,ie)}};var A=d.keyMap;A.macSublime={"Cmd-Left":"goLineStartSmart","Shift-Tab":"indentLess","Shift-Ctrl-K":"deleteLine","Alt-Q":"wrapLines","Ctrl-Left":"goSubwordLeft","Ctrl-Right":"goSubwordRight","Ctrl-Alt-Up":"scrollLineUp","Ctrl-Alt-Down":"scrollLineDown","Cmd-L":"selectLine","Shift-Cmd-L":"splitSelectionByLine",Esc:"singleSelectionTop","Cmd-Enter":"insertLineAfter","Shift-Cmd-Enter":"insertLineBefore","Cmd-D":"selectNextOccurrence","Shift-Cmd-Space":"selectScope","Shift-Cmd-M":"selectBetweenBrackets","Cmd-M":"goToBracket","Cmd-Ctrl-Up":"swapLineUp","Cmd-Ctrl-Down":"swapLineDown","Cmd-/":"toggleCommentIndented","Cmd-J":"joinLines","Shift-Cmd-D":"duplicateLine",F5:"sortLines","Shift-F5":"reverseSortLines","Cmd-F5":"sortLinesInsensitive","Shift-Cmd-F5":"reverseSortLinesInsensitive",F2:"nextBookmark","Shift-F2":"prevBookmark","Cmd-F2":"toggleBookmark","Shift-Cmd-F2":"clearBookmarks","Alt-F2":"selectBookmarks",Backspace:"smartBackspace","Cmd-K Cmd-D":"skipAndSelectNextOccurrence","Cmd-K Cmd-K":"delLineRight","Cmd-K Cmd-U":"upcaseAtCursor","Cmd-K Cmd-L":"downcaseAtCursor","Cmd-K Cmd-Space":"setSublimeMark","Cmd-K Cmd-A":"selectToSublimeMark","Cmd-K Cmd-W":"deleteToSublimeMark","Cmd-K Cmd-X":"swapWithSublimeMark","Cmd-K Cmd-Y":"sublimeYank","Cmd-K Cmd-C":"showInCenter","Cmd-K Cmd-G":"clearBookmarks","Cmd-K Cmd-Backspace":"delLineLeft","Cmd-K Cmd-1":"foldAll","Cmd-K Cmd-0":"unfoldAll","Cmd-K Cmd-J":"unfoldAll","Ctrl-Shift-Up":"addCursorToPrevLine","Ctrl-Shift-Down":"addCursorToNextLine","Cmd-F3":"findUnder","Shift-Cmd-F3":"findUnderPrevious","Alt-F3":"findAllUnder","Shift-Cmd-[":"fold","Shift-Cmd-]":"unfold","Cmd-I":"findIncremental","Shift-Cmd-I":"findIncrementalReverse","Cmd-H":"replace",F3:"findNext","Shift-F3":"findPrev",fallthrough:"macDefault"},d.normalizeKeyMap(A.macSublime),A.pcSublime={"Shift-Tab":"indentLess","Shift-Ctrl-K":"deleteLine","Alt-Q":"wrapLines","Ctrl-T":"transposeChars","Alt-Left":"goSubwordLeft","Alt-Right":"goSubwordRight","Ctrl-Up":"scrollLineUp","Ctrl-Down":"scrollLineDown","Ctrl-L":"selectLine","Shift-Ctrl-L":"splitSelectionByLine",Esc:"singleSelectionTop","Ctrl-Enter":"insertLineAfter","Shift-Ctrl-Enter":"insertLineBefore","Ctrl-D":"selectNextOccurrence","Shift-Ctrl-Space":"selectScope","Shift-Ctrl-M":"selectBetweenBrackets","Ctrl-M":"goToBracket","Shift-Ctrl-Up":"swapLineUp","Shift-Ctrl-Down":"swapLineDown","Ctrl-/":"toggleCommentIndented","Ctrl-J":"joinLines","Shift-Ctrl-D":"duplicateLine",F9:"sortLines","Shift-F9":"reverseSortLines","Ctrl-F9":"sortLinesInsensitive","Shift-Ctrl-F9":"reverseSortLinesInsensitive",F2:"nextBookmark","Shift-F2":"prevBookmark","Ctrl-F2":"toggleBookmark","Shift-Ctrl-F2":"clearBookmarks","Alt-F2":"selectBookmarks",Backspace:"smartBackspace","Ctrl-K Ctrl-D":"skipAndSelectNextOccurrence","Ctrl-K Ctrl-K":"delLineRight","Ctrl-K Ctrl-U":"upcaseAtCursor","Ctrl-K Ctrl-L":"downcaseAtCursor","Ctrl-K Ctrl-Space":"setSublimeMark","Ctrl-K Ctrl-A":"selectToSublimeMark","Ctrl-K Ctrl-W":"deleteToSublimeMark","Ctrl-K Ctrl-X":"swapWithSublimeMark","Ctrl-K Ctrl-Y":"sublimeYank","Ctrl-K Ctrl-C":"showInCenter","Ctrl-K Ctrl-G":"clearBookmarks","Ctrl-K Ctrl-Backspace":"delLineLeft","Ctrl-K Ctrl-1":"foldAll","Ctrl-K Ctrl-0":"unfoldAll","Ctrl-K Ctrl-J":"unfoldAll","Ctrl-Alt-Up":"addCursorToPrevLine","Ctrl-Alt-Down":"addCursorToNextLine","Ctrl-F3":"findUnder","Shift-Ctrl-F3":"findUnderPrevious","Alt-F3":"findAllUnder","Shift-Ctrl-[":"fold","Shift-Ctrl-]":"unfold","Ctrl-I":"findIncremental","Shift-Ctrl-I":"findIncrementalReverse","Ctrl-H":"replace",F3:"findNext","Shift-F3":"findPrev",fallthrough:"pcDefault"},d.normalizeKeyMap(A.pcSublime);var U=A.default==A.macDefault;A.sublime=U?A.macSublime:A.pcSublime})}()),sublime.exports}requireSublime();requireMatchbrackets();var closebrackets={exports:{}},hasRequiredClosebrackets;function requireClosebrackets(){return hasRequiredClosebrackets||(hasRequiredClosebrackets=1,function(T,b){(function(d){d(requireCodemirror())})(function(d){var m={pairs:`()[]{}''""`,closeBefore:`)]}'":;>`,triples:"",explode:"[]{}"},S=d.Pos;d.defineOption("autoCloseBrackets",!1,function(q,A,U){U&&U!=d.Init&&(q.removeKeyMap(ae),q.state.closeBrackets=null),A&&(Q(I(A,"pairs")),q.state.closeBrackets=A,q.addKeyMap(ae))});function I(q,A){return A=="pairs"&&typeof q=="string"?q:typeof q=="object"&&q[A]!=null?q[A]:m[A]}var ae={Backspace:j,Enter:se};function Q(q){for(var A=0;A<q.length;A++){var U=q.charAt(A),h="'"+U+"'";ae[h]||(ae[h]=he(U))}}Q(m.pairs+"`");function he(q){return function(A){return ve(A,q)}}function ee(q){var A=q.state.closeBrackets;if(!A||A.override)return A;var U=q.getModeAt(q.getCursor());return U.closeBrackets||A}function j(q){var A=ee(q);if(!A||q.getOption("disableInput"))return d.Pass;for(var U=I(A,"pairs"),h=q.listSelections(),_=0;_<h.length;_++){if(!h[_].empty())return d.Pass;var D=Ge(q,h[_].head);if(!D||U.indexOf(D)%2!=0)return d.Pass}for(var _=h.length-1;_>=0;_--){var W=h[_].head;q.replaceRange("",S(W.line,W.ch-1),S(W.line,W.ch+1),"+delete")}}function se(q){var A=ee(q),U=A&&I(A,"explode");if(!U||q.getOption("disableInput"))return d.Pass;for(var h=q.listSelections(),_=0;_<h.length;_++){if(!h[_].empty())return d.Pass;var D=Ge(q,h[_].head);if(!D||U.indexOf(D)%2!=0)return d.Pass}q.operation(function(){var W=q.lineSeparator()||`
`;q.replaceSelection(W+W,null),G(q,-1),h=q.listSelections();for(var ie=0;ie<h.length;ie++){var me=h[ie].head.line;q.indentLine(me,null,!0),q.indentLine(me+1,null,!0)}})}function G(q,A){for(var U=[],h=q.listSelections(),_=0,D=0;D<h.length;D++){var W=h[D];W.head==q.getCursor()&&(_=D);var ie=W.head.ch||A>0?{line:W.head.line,ch:W.head.ch+A}:{line:W.head.line-1};U.push({anchor:ie,head:ie})}q.setSelections(U,_)}function fe(q){var A=d.cmpPos(q.anchor,q.head)>0;return{anchor:new S(q.anchor.line,q.anchor.ch+(A?-1:1)),head:new S(q.head.line,q.head.ch+(A?1:-1))}}function ve(q,A){var U=ee(q);if(!U||q.getOption("disableInput"))return d.Pass;var h=I(U,"pairs"),_=h.indexOf(A);if(_==-1)return d.Pass;for(var D=I(U,"closeBefore"),W=I(U,"triples"),ie=h.charAt(_+1)==A,me=q.listSelections(),Te=_%2==0,ke,We=0;We<me.length;We++){var C=me[We],E=C.head,p,Z=q.getRange(E,S(E.line,E.ch+1));if(Te&&!C.empty())p="surround";else if((ie||!Te)&&Z==A)ie&&qe(q,E)?p="both":W.indexOf(A)>=0&&q.getRange(E,S(E.line,E.ch+3))==A+A+A?p="skipThree":p="skip";else if(ie&&E.ch>1&&W.indexOf(A)>=0&&q.getRange(S(E.line,E.ch-2),E)==A+A){if(E.ch>2&&/\bstring/.test(q.getTokenTypeAt(S(E.line,E.ch-2))))return d.Pass;p="addFour"}else if(ie){var be=E.ch==0?" ":q.getRange(S(E.line,E.ch-1),E);if(!d.isWordChar(Z)&&be!=A&&!d.isWordChar(be))p="both";else return d.Pass}else if(Te&&(Z.length===0||/\s/.test(Z)||D.indexOf(Z)>-1))p="both";else return d.Pass;if(!ke)ke=p;else if(ke!=p)return d.Pass}var Pe=_%2?h.charAt(_-1):A,$e=_%2?A:h.charAt(_+1);q.operation(function(){if(ke=="skip")G(q,1);else if(ke=="skipThree")G(q,3);else if(ke=="surround"){for(var Ve=q.getSelections(),Ke=0;Ke<Ve.length;Ke++)Ve[Ke]=Pe+Ve[Ke]+$e;q.replaceSelections(Ve,"around"),Ve=q.listSelections().slice();for(var Ke=0;Ke<Ve.length;Ke++)Ve[Ke]=fe(Ve[Ke]);q.setSelections(Ve)}else ke=="both"?(q.replaceSelection(Pe+$e,null),q.triggerElectric(Pe+$e),G(q,-1)):ke=="addFour"&&(q.replaceSelection(Pe+Pe+Pe+Pe,"before"),G(q,1))})}function Ge(q,A){var U=q.getRange(S(A.line,A.ch-1),S(A.line,A.ch+1));return U.length==2?U:null}function qe(q,A){var U=q.getTokenAt(S(A.line,A.ch+1));return/\bstring/.test(U.type)&&U.start==A.ch&&(A.ch==0||!/\bstring/.test(q.getTokenTypeAt(A)))}})}()),closebrackets.exports}requireClosebrackets();var comment={exports:{}},hasRequiredComment;function requireComment(){return hasRequiredComment||(hasRequiredComment=1,function(T,b){(function(d){d(requireCodemirror())})(function(d){var m={},S=/[^\s\u00a0]/,I=d.Pos,ae=d.cmpPos;function Q(j){var se=j.search(S);return se==-1?0:se}d.commands.toggleComment=function(j){j.toggleComment()},d.defineExtension("toggleComment",function(j){j||(j=m);for(var se=this,G=1/0,fe=this.listSelections(),ve=null,Ge=fe.length-1;Ge>=0;Ge--){var qe=fe[Ge].from(),q=fe[Ge].to();qe.line>=G||(q.line>=G&&(q=I(G,0)),G=qe.line,ve==null?se.uncomment(qe,q,j)?ve="un":(se.lineComment(qe,q,j),ve="line"):ve=="un"?se.uncomment(qe,q,j):se.lineComment(qe,q,j))}});function he(j,se,G){return/\bstring\b/.test(j.getTokenTypeAt(I(se.line,0)))&&!/^[\'\"\`]/.test(G)}function ee(j,se){var G=j.getMode();return G.useInnerComments===!1||!G.innerMode?G:j.getModeAt(se)}d.defineExtension("lineComment",function(j,se,G){G||(G=m);var fe=this,ve=ee(fe,j),Ge=fe.getLine(j.line);if(!(Ge==null||he(fe,j,Ge))){var qe=G.lineComment||ve.lineComment;if(!qe){(G.blockCommentStart||ve.blockCommentStart)&&(G.fullLines=!0,fe.blockComment(j,se,G));return}var q=Math.min(se.ch!=0||se.line==j.line?se.line+1:se.line,fe.lastLine()+1),A=G.padding==null?" ":G.padding,U=G.commentBlankLines||j.line==se.line;fe.operation(function(){if(G.indent){for(var h=null,_=j.line;_<q;++_){var D=fe.getLine(_),W=D.search(S)===-1?D:D.slice(0,Q(D));(h==null||h.length>W.length)&&(h=W)}for(var _=j.line;_<q;++_){var D=fe.getLine(_),ie=h.length;!U&&!S.test(D)||(D.slice(0,ie)!=h&&(ie=Q(D)),fe.replaceRange(h+qe+A,I(_,0),I(_,ie)))}}else for(var _=j.line;_<q;++_)(U||S.test(fe.getLine(_)))&&fe.replaceRange(qe+A,I(_,0))})}}),d.defineExtension("blockComment",function(j,se,G){G||(G=m);var fe=this,ve=ee(fe,j),Ge=G.blockCommentStart||ve.blockCommentStart,qe=G.blockCommentEnd||ve.blockCommentEnd;if(!Ge||!qe){(G.lineComment||ve.lineComment)&&G.fullLines!=!1&&fe.lineComment(j,se,G);return}if(!/\bcomment\b/.test(fe.getTokenTypeAt(I(j.line,0)))){var q=Math.min(se.line,fe.lastLine());q!=j.line&&se.ch==0&&S.test(fe.getLine(q))&&--q;var A=G.padding==null?" ":G.padding;j.line>q||fe.operation(function(){if(G.fullLines!=!1){var U=S.test(fe.getLine(q));fe.replaceRange(A+qe,I(q)),fe.replaceRange(Ge+A,I(j.line,0));var h=G.blockCommentLead||ve.blockCommentLead;if(h!=null)for(var _=j.line+1;_<=q;++_)(_!=q||U)&&fe.replaceRange(h+A,I(_,0))}else{var D=ae(fe.getCursor("to"),se)==0,W=!fe.somethingSelected();fe.replaceRange(qe,se),D&&fe.setSelection(W?se:fe.getCursor("from"),se),fe.replaceRange(Ge,j)}})}}),d.defineExtension("uncomment",function(j,se,G){G||(G=m);var fe=this,ve=ee(fe,j),Ge=Math.min(se.ch!=0||se.line==j.line?se.line:se.line-1,fe.lastLine()),qe=Math.min(j.line,Ge),q=G.lineComment||ve.lineComment,A=[],U=G.padding==null?" ":G.padding,h;e:{if(!q)break e;for(var _=qe;_<=Ge;++_){var D=fe.getLine(_),W=D.indexOf(q);if(W>-1&&!/comment/.test(fe.getTokenTypeAt(I(_,W+1)))&&(W=-1),W==-1&&S.test(D)||W>-1&&S.test(D.slice(0,W)))break e;A.push(D)}if(fe.operation(function(){for(var Ve=qe;Ve<=Ge;++Ve){var Ke=A[Ve-qe],Je=Ke.indexOf(q),at=Je+q.length;Je<0||(Ke.slice(at,at+U.length)==U&&(at+=U.length),h=!0,fe.replaceRange("",I(Ve,Je),I(Ve,at)))}}),h)return!0}var ie=G.blockCommentStart||ve.blockCommentStart,me=G.blockCommentEnd||ve.blockCommentEnd;if(!ie||!me)return!1;var Te=G.blockCommentLead||ve.blockCommentLead,ke=fe.getLine(qe),We=ke.indexOf(ie);if(We==-1)return!1;var C=Ge==qe?ke:fe.getLine(Ge),E=C.indexOf(me,Ge==qe?We+ie.length:0),p=I(qe,We+1),Z=I(Ge,E+1);if(E==-1||!/comment/.test(fe.getTokenTypeAt(p))||!/comment/.test(fe.getTokenTypeAt(Z))||fe.getRange(p,Z,`
`).indexOf(me)>-1)return!1;var be=ke.lastIndexOf(ie,j.ch),Pe=be==-1?-1:ke.slice(0,j.ch).indexOf(me,be+ie.length);if(be!=-1&&Pe!=-1&&Pe+me.length!=j.ch)return!1;Pe=C.indexOf(me,se.ch);var $e=C.slice(se.ch).lastIndexOf(ie,Pe-se.ch);return be=Pe==-1||$e==-1?-1:se.ch+$e,Pe!=-1&&be!=-1&&be!=se.ch?!1:(fe.operation(function(){fe.replaceRange("",I(Ge,E-(U&&C.slice(E-U.length,E)==U?U.length:0)),I(Ge,E+me.length));var Ve=We+ie.length;if(U&&ke.slice(Ve,Ve+U.length)==U&&(Ve+=U.length),fe.replaceRange("",I(qe,We),I(qe,Ve)),Te)for(var Ke=qe+1;Ke<=Ge;++Ke){var Je=fe.getLine(Ke),at=Je.indexOf(Te);if(!(at==-1||S.test(Je.slice(0,at)))){var Rt=at+Te.length;U&&Je.slice(Rt,Rt+U.length)==U&&(Rt+=U.length),fe.replaceRange("",I(Ke,at),I(Ke,Rt))}}}),!0)})})}()),comment.exports}requireComment();var showHint={exports:{}},hasRequiredShowHint;function requireShowHint(){return hasRequiredShowHint||(hasRequiredShowHint=1,function(T,b){(function(d){d(requireCodemirror())})(function(d){var m="CodeMirror-hint",S="CodeMirror-hint-active";d.showHint=function(q,A,U){if(!A)return q.showHint(U);U&&U.async&&(A.async=!0);var h={hint:A};if(U)for(var _ in U)h[_]=U[_];return q.showHint(h)},d.defineExtension("showHint",function(q){q=he(this,this.getCursor("start"),q);var A=this.listSelections();if(!(A.length>1)){if(this.somethingSelected()){if(!q.hint.supportsSelection)return;for(var U=0;U<A.length;U++)if(A[U].head.line!=A[U].anchor.line)return}this.state.completionActive&&this.state.completionActive.close();var h=this.state.completionActive=new I(this,q);h.options.hint&&(d.signal(this,"startCompletion",this),h.update(!0))}}),d.defineExtension("closeHint",function(){this.state.completionActive&&this.state.completionActive.close()});function I(q,A){if(this.cm=q,this.options=A,this.widget=null,this.debounce=0,this.tick=0,this.startPos=this.cm.getCursor("start"),this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length,this.options.updateOnCursorActivity){var U=this;q.on("cursorActivity",this.activityFunc=function(){U.cursorActivity()})}}var ae=window.requestAnimationFrame||function(q){return setTimeout(q,1e3/60)},Q=window.cancelAnimationFrame||clearTimeout;I.prototype={close:function(){this.active()&&(this.cm.state.completionActive=null,this.tick=null,this.options.updateOnCursorActivity&&this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.data&&d.signal(this.data,"close"),this.widget&&this.widget.close(),d.signal(this.cm,"endCompletion",this.cm))},active:function(){return this.cm.state.completionActive==this},pick:function(q,A){var U=q.list[A],h=this;this.cm.operation(function(){U.hint?U.hint(h.cm,q,U):h.cm.replaceRange(ee(U),U.from||q.from,U.to||q.to,"complete"),d.signal(q,"pick",U),h.cm.scrollIntoView()}),this.options.closeOnPick&&this.close()},cursorActivity:function(){this.debounce&&(Q(this.debounce),this.debounce=0);var q=this.startPos;this.data&&(q=this.data.from);var A=this.cm.getCursor(),U=this.cm.getLine(A.line);if(A.line!=this.startPos.line||U.length-A.ch!=this.startLen-this.startPos.ch||A.ch<q.ch||this.cm.somethingSelected()||!A.ch||this.options.closeCharacters.test(U.charAt(A.ch-1)))this.close();else{var h=this;this.debounce=ae(function(){h.update()}),this.widget&&this.widget.disable()}},update:function(q){if(this.tick!=null){var A=this,U=++this.tick;ve(this.options.hint,this.cm,this.options,function(h){A.tick==U&&A.finishUpdate(h,q)})}},finishUpdate:function(q,A){this.data&&d.signal(this.data,"update");var U=this.widget&&this.widget.picked||A&&this.options.completeSingle;this.widget&&this.widget.close(),this.data=q,q&&q.list.length&&(U&&q.list.length==1?this.pick(q,0):(this.widget=new G(this,q),d.signal(q,"shown")))}};function he(q,A,U){var h=q.options.hintOptions,_={};for(var D in qe)_[D]=qe[D];if(h)for(var D in h)h[D]!==void 0&&(_[D]=h[D]);if(U)for(var D in U)U[D]!==void 0&&(_[D]=U[D]);return _.hint.resolve&&(_.hint=_.hint.resolve(q,A)),_}function ee(q){return typeof q=="string"?q:q.text}function j(q,A){var U={Up:function(){A.moveFocus(-1)},Down:function(){A.moveFocus(1)},PageUp:function(){A.moveFocus(-A.menuSize()+1,!0)},PageDown:function(){A.moveFocus(A.menuSize()-1,!0)},Home:function(){A.setFocus(0)},End:function(){A.setFocus(A.length-1)},Enter:A.pick,Tab:A.pick,Esc:A.close},h=/Mac/.test(navigator.platform);h&&(U["Ctrl-P"]=function(){A.moveFocus(-1)},U["Ctrl-N"]=function(){A.moveFocus(1)});var _=q.options.customKeys,D=_?{}:U;function W(Te,ke){var We;typeof ke!="string"?We=function(C){return ke(C,A)}:U.hasOwnProperty(ke)?We=U[ke]:We=ke,D[Te]=We}if(_)for(var ie in _)_.hasOwnProperty(ie)&&W(ie,_[ie]);var me=q.options.extraKeys;if(me)for(var ie in me)me.hasOwnProperty(ie)&&W(ie,me[ie]);return D}function se(q,A){for(;A&&A!=q;){if(A.nodeName.toUpperCase()==="LI"&&A.parentNode==q)return A;A=A.parentNode}}function G(q,A){this.id="cm-complete-"+Math.floor(Math.random(1e6)),this.completion=q,this.data=A,this.picked=!1;var U=this,h=q.cm,_=h.getInputField().ownerDocument,D=_.defaultView||_.parentWindow,W=this.hints=_.createElement("ul");W.setAttribute("role","listbox"),W.setAttribute("aria-expanded","true"),W.id=this.id;var ie=q.cm.options.theme;W.className="CodeMirror-hints "+ie,this.selectedHint=A.selectedHint||0;for(var me=A.list,Te=0;Te<me.length;++Te){var ke=W.appendChild(_.createElement("li")),We=me[Te],C=m+(Te!=this.selectedHint?"":" "+S);We.className!=null&&(C=We.className+" "+C),ke.className=C,Te==this.selectedHint&&ke.setAttribute("aria-selected","true"),ke.id=this.id+"-"+Te,ke.setAttribute("role","option"),We.render?We.render(ke,A,We):ke.appendChild(_.createTextNode(We.displayText||ee(We))),ke.hintId=Te}var E=q.options.container||_.body,p=h.cursorCoords(q.options.alignWithWord?A.from:null),Z=p.left,be=p.bottom,Pe=!0,$e=0,Ve=0;if(E!==_.body){var Ke=["absolute","relative","fixed"].indexOf(D.getComputedStyle(E).position)!==-1,Je=Ke?E:E.offsetParent,at=Je.getBoundingClientRect(),Rt=_.body.getBoundingClientRect();$e=at.left-Rt.left-Je.scrollLeft,Ve=at.top-Rt.top-Je.scrollTop}W.style.left=Z-$e+"px",W.style.top=be-Ve+"px";var st=D.innerWidth||Math.max(_.body.offsetWidth,_.documentElement.offsetWidth),ft=D.innerHeight||Math.max(_.body.offsetHeight,_.documentElement.offsetHeight);E.appendChild(W),h.getInputField().setAttribute("aria-autocomplete","list"),h.getInputField().setAttribute("aria-owns",this.id),h.getInputField().setAttribute("aria-activedescendant",this.id+"-"+this.selectedHint);var tt=q.options.moveOnOverlap?W.getBoundingClientRect():new DOMRect,pt=q.options.paddingForScrollbar?W.scrollHeight>W.clientHeight+1:!1,Ct;setTimeout(function(){Ct=h.getScrollInfo()});var Ht=tt.bottom-ft;if(Ht>0){var ut=tt.bottom-tt.top,Mt=tt.top-(p.bottom-p.top)-2;ft-tt.top<Mt?(ut>Mt&&(W.style.height=(ut=Mt)+"px"),W.style.top=(be=p.top-ut)+Ve+"px",Pe=!1):W.style.height=ft-tt.top-2+"px"}var Vt=tt.right-st;if(pt&&(Vt+=h.display.nativeBarWidth),Vt>0&&(tt.right-tt.left>st&&(W.style.width=st-5+"px",Vt-=tt.right-tt.left-st),W.style.left=(Z=Math.max(p.left-Vt-$e,0))+"px"),pt)for(var ar=W.firstChild;ar;ar=ar.nextSibling)ar.style.paddingRight=h.display.nativeBarWidth+"px";if(h.addKeyMap(this.keyMap=j(q,{moveFocus:function($t,Pt){U.changeActive(U.selectedHint+$t,Pt)},setFocus:function($t){U.changeActive($t)},menuSize:function(){return U.screenAmount()},length:me.length,close:function(){q.close()},pick:function(){U.pick()},data:A})),q.options.closeOnUnfocus){var Sr;h.on("blur",this.onBlur=function(){Sr=setTimeout(function(){q.close()},100)}),h.on("focus",this.onFocus=function(){clearTimeout(Sr)})}h.on("scroll",this.onScroll=function(){var $t=h.getScrollInfo(),Pt=h.getWrapperElement().getBoundingClientRect();Ct||(Ct=h.getScrollInfo());var nn=be+Ct.top-$t.top,_t=nn-(D.pageYOffset||(_.documentElement||_.body).scrollTop);if(Pe||(_t+=W.offsetHeight),_t<=Pt.top||_t>=Pt.bottom)return q.close();W.style.top=nn+"px",W.style.left=Z+Ct.left-$t.left+"px"}),d.on(W,"dblclick",function($t){var Pt=se(W,$t.target||$t.srcElement);Pt&&Pt.hintId!=null&&(U.changeActive(Pt.hintId),U.pick())}),d.on(W,"click",function($t){var Pt=se(W,$t.target||$t.srcElement);Pt&&Pt.hintId!=null&&(U.changeActive(Pt.hintId),q.options.completeOnSingleClick&&U.pick())}),d.on(W,"mousedown",function(){setTimeout(function(){h.focus()},20)});var fr=this.getSelectedHintRange();return(fr.from!==0||fr.to!==0)&&this.scrollToActive(),d.signal(A,"select",me[this.selectedHint],W.childNodes[this.selectedHint]),!0}G.prototype={close:function(){if(this.completion.widget==this){this.completion.widget=null,this.hints.parentNode&&this.hints.parentNode.removeChild(this.hints),this.completion.cm.removeKeyMap(this.keyMap);var q=this.completion.cm.getInputField();q.removeAttribute("aria-activedescendant"),q.removeAttribute("aria-owns");var A=this.completion.cm;this.completion.options.closeOnUnfocus&&(A.off("blur",this.onBlur),A.off("focus",this.onFocus)),A.off("scroll",this.onScroll)}},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var q=this;this.keyMap={Enter:function(){q.picked=!0}},this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(q,A){if(q>=this.data.list.length?q=A?this.data.list.length-1:0:q<0&&(q=A?0:this.data.list.length-1),this.selectedHint!=q){var U=this.hints.childNodes[this.selectedHint];U&&(U.className=U.className.replace(" "+S,""),U.removeAttribute("aria-selected")),U=this.hints.childNodes[this.selectedHint=q],U.className+=" "+S,U.setAttribute("aria-selected","true"),this.completion.cm.getInputField().setAttribute("aria-activedescendant",U.id),this.scrollToActive(),d.signal(this.data,"select",this.data.list[this.selectedHint],U)}},scrollToActive:function(){var q=this.getSelectedHintRange(),A=this.hints.childNodes[q.from],U=this.hints.childNodes[q.to],h=this.hints.firstChild;A.offsetTop<this.hints.scrollTop?this.hints.scrollTop=A.offsetTop-h.offsetTop:U.offsetTop+U.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=U.offsetTop+U.offsetHeight-this.hints.clientHeight+h.offsetTop)},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1},getSelectedHintRange:function(){var q=this.completion.options.scrollMargin||0;return{from:Math.max(0,this.selectedHint-q),to:Math.min(this.data.list.length-1,this.selectedHint+q)}}};function fe(q,A){if(!q.somethingSelected())return A;for(var U=[],h=0;h<A.length;h++)A[h].supportsSelection&&U.push(A[h]);return U}function ve(q,A,U,h){if(q.async)q(A,h,U);else{var _=q(A,U);_&&_.then?_.then(h):h(_)}}function Ge(q,A){var U=q.getHelpers(A,"hint"),h;if(U.length){var _=function(D,W,ie){var me=fe(D,U);function Te(ke){if(ke==me.length)return W(null);ve(me[ke],D,ie,function(We){We&&We.list.length>0?W(We):Te(ke+1)})}Te(0)};return _.async=!0,_.supportsSelection=!0,_}else return(h=q.getHelper(q.getCursor(),"hintWords"))?function(D){return d.hint.fromList(D,{words:h})}:d.hint.anyword?function(D,W){return d.hint.anyword(D,W)}:function(){}}d.registerHelper("hint","auto",{resolve:Ge}),d.registerHelper("hint","fromList",function(q,A){var U=q.getCursor(),h=q.getTokenAt(U),_,D=d.Pos(U.line,h.start),W=U;h.start<U.ch&&/\w/.test(h.string.charAt(U.ch-h.start-1))?_=h.string.substr(0,U.ch-h.start):(_="",D=U);for(var ie=[],me=0;me<A.words.length;me++){var Te=A.words[me];Te.slice(0,_.length)==_&&ie.push(Te)}if(ie.length)return{list:ie,from:D,to:W}}),d.commands.autocomplete=d.showHint;var qe={hint:d.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnPick:!0,closeOnUnfocus:!0,updateOnCursorActivity:!0,completeOnSingleClick:!0,container:null,customKeys:null,extraKeys:null,paddingForScrollbar:!0,moveOnOverlap:!0};d.defineOption("hintOptions",null)})}()),showHint.exports}requireShowHint();var activeLine={exports:{}},hasRequiredActiveLine;function requireActiveLine(){return hasRequiredActiveLine||(hasRequiredActiveLine=1,function(T,b){(function(d){d(requireCodemirror())})(function(d){var m="CodeMirror-activeline",S="CodeMirror-activeline-background",I="CodeMirror-activeline-gutter";d.defineOption("styleActiveLine",!1,function(j,se,G){var fe=G==d.Init?!1:G;se!=fe&&(fe&&(j.off("beforeSelectionChange",ee),ae(j),delete j.state.activeLines),se&&(j.state.activeLines=[],he(j,j.listSelections()),j.on("beforeSelectionChange",ee)))});function ae(j){for(var se=0;se<j.state.activeLines.length;se++)j.removeLineClass(j.state.activeLines[se],"wrap",m),j.removeLineClass(j.state.activeLines[se],"background",S),j.removeLineClass(j.state.activeLines[se],"gutter",I)}function Q(j,se){if(j.length!=se.length)return!1;for(var G=0;G<j.length;G++)if(j[G]!=se[G])return!1;return!0}function he(j,se){for(var G=[],fe=0;fe<se.length;fe++){var ve=se[fe],Ge=j.getOption("styleActiveLine");if(!(typeof Ge=="object"&&Ge.nonEmpty?ve.anchor.line!=ve.head.line:!ve.empty())){var qe=j.getLineHandleVisualStart(ve.head.line);G[G.length-1]!=qe&&G.push(qe)}}Q(j.state.activeLines,G)||j.operation(function(){ae(j);for(var q=0;q<G.length;q++)j.addLineClass(G[q],"wrap",m),j.addLineClass(G[q],"background",S),j.addLineClass(G[q],"gutter",I);j.state.activeLines=G})}function ee(j,se){he(j,se.ranges)}})}()),activeLine.exports}requireActiveLine();var markSelection={exports:{}},hasRequiredMarkSelection;function requireMarkSelection(){return hasRequiredMarkSelection||(hasRequiredMarkSelection=1,function(T,b){(function(d){d(requireCodemirror())})(function(d){d.defineOption("styleSelectedText",!1,function(G,fe,ve){var Ge=ve&&ve!=d.Init;fe&&!Ge?(G.state.markedSelection=[],G.state.markedSelectionStyle=typeof fe=="string"?fe:"CodeMirror-selectedtext",j(G),G.on("cursorActivity",m),G.on("change",S)):!fe&&Ge&&(G.off("cursorActivity",m),G.off("change",S),ee(G),G.state.markedSelection=G.state.markedSelectionStyle=null)});function m(G){G.state.markedSelection&&G.operation(function(){se(G)})}function S(G){G.state.markedSelection&&G.state.markedSelection.length&&G.operation(function(){ee(G)})}var I=8,ae=d.Pos,Q=d.cmpPos;function he(G,fe,ve,Ge){if(Q(fe,ve)!=0)for(var qe=G.state.markedSelection,q=G.state.markedSelectionStyle,A=fe.line;;){var U=A==fe.line?fe:ae(A,0),h=A+I,_=h>=ve.line,D=_?ve:ae(h,0),W=G.markText(U,D,{className:q});if(Ge==null?qe.push(W):qe.splice(Ge++,0,W),_)break;A=h}}function ee(G){for(var fe=G.state.markedSelection,ve=0;ve<fe.length;++ve)fe[ve].clear();fe.length=0}function j(G){ee(G);for(var fe=G.listSelections(),ve=0;ve<fe.length;ve++)he(G,fe[ve].from(),fe[ve].to())}function se(G){if(!G.somethingSelected())return ee(G);if(G.listSelections().length>1)return j(G);var fe=G.getCursor("start"),ve=G.getCursor("end"),Ge=G.state.markedSelection;if(!Ge.length)return he(G,fe,ve);var qe=Ge[0].find(),q=Ge[Ge.length-1].find();if(!qe||!q||ve.line-fe.line<=I||Q(fe,q.to)>=0||Q(ve,qe.from)<=0)return j(G);for(;Q(fe,qe.from)>0;)Ge.shift().clear(),qe=Ge[0].find();for(Q(fe,qe.from)<0&&(qe.to.line-fe.line<I?(Ge.shift().clear(),he(G,fe,qe.to,0)):he(G,fe,qe.from,0));Q(ve,q.to)<0;)Ge.pop().clear(),q=Ge[Ge.length-1].find();Q(ve,q.to)>0&&(ve.line-q.from.line<I?(Ge.pop().clear(),he(G,q.from,ve)):he(G,q.to,ve))}})}()),markSelection.exports}requireMarkSelection();const configPanel={panel:null,editor:null,popupWindow:null,shortcuts:[{key:"Ctrl+Enter",description:"Execute code block"},{key:"Ctrl+Alt+Enter",description:"Execute code block (without add auto out)"},{key:"Ctrl+Space",description:"Autocomplete"},{key:"Ctrl+;",description:"Stop Hydra (hush)"},{key:"Alt+X",description:"Toggle Comment"},{key:"Alt+↑",description:"Increment value"},{key:"Alt+↓",description:"Decrement value"},{key:"Alt+I",description:"Show definition"},{key:"Alt+H",description:"Hide/Show code"},{key:"Ctrl+S",description:"Save Code"},{key:"Escape",description:"Close tooltips/panel"},{key:"Ctrl+K",description:"Color picker in .color()"},{key:"Alt+1/2/3/4/5",description:"Render output 0/1/2/3/all"}],init:function(T){this.editor=T,this.panel=document.getElementById("config-panel"),this.setupEventListeners(),this.loadSettings(),this.updateShortcutsList()},setupEventListeners:function(){const T=document.getElementById("config-toggle"),b=document.getElementById("config-close"),d=document.getElementById("font-select"),m=document.getElementById("font-size"),S=document.getElementById("theme-select"),I=document.getElementById("open-popup"),ae=document.getElementById("show-about"),Q=document.getElementById("about-modal"),he=document.getElementById("close-about");T.addEventListener("click",()=>this.togglePanel()),b.addEventListener("click",()=>this.togglePanel()),d.addEventListener("change",ee=>{this.setFont(ee.target.value),this.saveSettings()}),m.addEventListener("input",ee=>{const j=ee.target.value;document.getElementById("font-size-value").textContent=j+"px",this.setFontSize(j),this.saveSettings()}),S.addEventListener("change",ee=>{this.editor.setOption("theme",ee.target.value),this.saveSettings()}),I.addEventListener("click",()=>{this.openCanvasPopup()}),ae.addEventListener("click",()=>{Q.classList.add("show")}),he.addEventListener("click",()=>{Q.classList.remove("show")}),Q.addEventListener("click",ee=>{ee.target===Q&&Q.classList.remove("show")}),document.addEventListener("keydown",ee=>{ee.key==="Escape"&&(Q.classList.contains("show")?Q.classList.remove("show"):this.panel.classList.contains("open")&&this.togglePanel())})},openCanvasPopup:function(){this.popupWindow&&!this.popupWindow.closed&&this.popupWindow.close();const T=document.getElementById("canvas"),b=T.width||window.innerWidth,d=T.height||window.innerHeight;this.popupWindow=window.open("","HydraCanvas",`width=${b},height=${d+50},resizable=yes,scrollbars=no,status=no,menubar=no,toolbar=no`),this.popupWindow.document.write(`
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Hydra Canvas</title>
                <style>
                    body {
                        margin: 0;
                        padding: 0;
                        background-color: #000;
                        overflow: hidden;
                    }
                    #popup-canvas {
                        display: block;
                        width: 100vw;
                        height: 100vh;
                    }
                </style>
            </head>
            <body>
                <canvas id="popup-canvas"></canvas>
            </body>
            </html>
        `),this.popupWindow.document.close(),this.startCanvasSync()},startCanvasSync:function(){if(!this.popupWindow||this.popupWindow.closed)return;const T=document.getElementById("canvas"),b=this.popupWindow.document.getElementById("popup-canvas"),d=()=>{if(!this.popupWindow||this.popupWindow.closed){this.popupWindow=null;return}try{console.log("Syncing canvas..."),b.width=T.width,b.height=T.height,b.getContext("2d").drawImage(T,0,0)}catch(m){console.log("Sync error:",m)}requestAnimationFrame(d)};d(),this.popupWindow.addEventListener("beforeunload",()=>{this.popupWindow=null})},togglePanel:function(){this.panel.classList.toggle("open")},setFont:function(T){const b=document.querySelector(".CodeMirror");b.style.fontFamily=`${T}, monospace`},setFontSize:function(T){this.editor.getWrapperElement().style.fontSize=T+"px",this.editor.refresh()},updateShortcutsList:function(){const T=document.getElementById("shortcuts-list");T.innerHTML="",this.shortcuts.forEach(b=>{const d=document.createElement("div");d.className="shortcut-item",d.innerHTML=`
                <span class="shortcut-key">${b.key}</span>
                <span class="shortcut-desc">${b.description}</span>
            `,T.appendChild(d)})},loadSettings:function(){const T=JSON.parse(localStorage.getItem("editor-settings")||"{}");if(T.font&&(document.getElementById("font-select").value=T.font,this.setFont(T.font)),T.fontSize){const b=document.getElementById("font-size");b.value=T.fontSize,document.getElementById("font-size-value").textContent=T.fontSize+"px",this.setFontSize(T.fontSize)}T.theme&&(document.getElementById("theme-select").value=T.theme,this.editor.setOption("theme",T.theme))},saveSettings:function(){const T={font:document.getElementById("font-select").value,fontSize:document.getElementById("font-size").value,theme:document.getElementById("theme-select").value};localStorage.setItem("editor-settings",JSON.stringify(T))}},scriptRel="modulepreload",assetsURL=function(T){return"/apps/super-hydra-turbo-edition/"+T},seen={},__vitePreload=function(b,d,m){let S=Promise.resolve();if(d&&d.length>0){let ae=function(ee){return Promise.all(ee.map(j=>Promise.resolve(j).then(se=>({status:"fulfilled",value:se}),se=>({status:"rejected",reason:se}))))};document.getElementsByTagName("link");const Q=document.querySelector("meta[property=csp-nonce]"),he=(Q==null?void 0:Q.nonce)||(Q==null?void 0:Q.getAttribute("nonce"));S=ae(d.map(ee=>{if(ee=assetsURL(ee),ee in seen)return;seen[ee]=!0;const j=ee.endsWith(".css"),se=j?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${ee}"]${se}`))return;const G=document.createElement("link");if(G.rel=j?"stylesheet":scriptRel,j||(G.as="script"),G.crossOrigin="",G.href=ee,he&&G.setAttribute("nonce",he),document.head.appendChild(G),j)return new Promise((fe,ve)=>{G.addEventListener("load",fe),G.addEventListener("error",()=>ve(new Error(`Unable to preload CSS for ${ee}`)))})}))}function I(ae){const Q=new Event("vite:preloadError",{cancelable:!0});if(Q.payload=ae,window.dispatchEvent(Q),!Q.defaultPrevented)throw ae}return S.then(ae=>{for(const Q of ae||[])Q.status==="rejected"&&I(Q.reason);return b().catch(I)})};var Output=function({regl:T,precision:b,label:d="",width:m,height:S}){this.regl=T,this.precision=b,this.label=d,this.positionBuffer=this.regl.buffer([[-2,0],[0,-2],[2,2]]),this.draw=()=>{},this.init(),this.pingPongIndex=0,this.fbos=Array(2).fill().map(()=>this.regl.framebuffer({color:this.regl.texture({mag:"nearest",width:m,height:S,format:"rgba"}),depthStencil:!1}))};Output.prototype.resize=function(T,b){this.fbos.forEach(d=>{d.resize(T,b)})};Output.prototype.getCurrent=function(){return this.fbos[this.pingPongIndex]};Output.prototype.getTexture=function(){var T=this.pingPongIndex?0:1;return this.fbos[T]};Output.prototype.init=function(){return this.transformIndex=0,this.fragHeader=`
  precision ${this.precision} float;

  uniform float time;
  varying vec2 uv;
  `,this.fragBody="",this.vert=`
  precision ${this.precision} float;
  attribute vec2 position;
  varying vec2 uv;

  void main () {
    uv = position;
    gl_Position = vec4(2.0 * position - 1.0, 0, 1);
  }`,this.attributes={position:this.positionBuffer},this.uniforms={time:this.regl.prop("time"),resolution:this.regl.prop("resolution")},this.frag=`
       ${this.fragHeader}

      void main () {
        vec4 c = vec4(0, 0, 0, 0);
        vec2 st = uv;
        ${this.fragBody}
        gl_FragColor = c;
      }
  `,this};Output.prototype.render=function(T){let b=T[0];var d=this,m=Object.assign(b.uniforms,{prevBuffer:()=>d.fbos[d.pingPongIndex]});d.draw=d.regl({frag:b.frag,vert:d.vert,attributes:d.attributes,uniforms:m,count:3,framebuffer:()=>(d.pingPongIndex=d.pingPongIndex?0:1,d.fbos[d.pingPongIndex])})};Output.prototype.tick=function(T){this.draw(T)};var inherits_browser={exports:{}},hasRequiredInherits_browser;function requireInherits_browser(){return hasRequiredInherits_browser||(hasRequiredInherits_browser=1,typeof Object.create=="function"?inherits_browser.exports=function(b,d){d&&(b.super_=d,b.prototype=Object.create(d.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(b,d){if(d){b.super_=d;var m=function(){};m.prototype=d.prototype,b.prototype=new m,b.prototype.constructor=b}}),inherits_browser.exports}var events,hasRequiredEvents;function requireEvents(){if(hasRequiredEvents)return events;hasRequiredEvents=1;function T(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}events=T,T.EventEmitter=T,T.prototype._events=void 0,T.prototype._maxListeners=void 0,T.defaultMaxListeners=10,T.prototype.setMaxListeners=function(I){if(!d(I)||I<0||isNaN(I))throw TypeError("n must be a positive number");return this._maxListeners=I,this},T.prototype.emit=function(I){var ae,Q,he,ee,j,se;if(this._events||(this._events={}),I==="error"&&(!this._events.error||m(this._events.error)&&!this._events.error.length)){if(ae=arguments[1],ae instanceof Error)throw ae;var G=new Error('Uncaught, unspecified "error" event. ('+ae+")");throw G.context=ae,G}if(Q=this._events[I],S(Q))return!1;if(b(Q))switch(arguments.length){case 1:Q.call(this);break;case 2:Q.call(this,arguments[1]);break;case 3:Q.call(this,arguments[1],arguments[2]);break;default:ee=Array.prototype.slice.call(arguments,1),Q.apply(this,ee)}else if(m(Q))for(ee=Array.prototype.slice.call(arguments,1),se=Q.slice(),he=se.length,j=0;j<he;j++)se[j].apply(this,ee);return!0},T.prototype.addListener=function(I,ae){var Q;if(!b(ae))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",I,b(ae.listener)?ae.listener:ae),this._events[I]?m(this._events[I])?this._events[I].push(ae):this._events[I]=[this._events[I],ae]:this._events[I]=ae,m(this._events[I])&&!this._events[I].warned&&(S(this._maxListeners)?Q=T.defaultMaxListeners:Q=this._maxListeners,Q&&Q>0&&this._events[I].length>Q&&(this._events[I].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[I].length),typeof console.trace=="function"&&console.trace())),this},T.prototype.on=T.prototype.addListener,T.prototype.once=function(I,ae){if(!b(ae))throw TypeError("listener must be a function");var Q=!1;function he(){this.removeListener(I,he),Q||(Q=!0,ae.apply(this,arguments))}return he.listener=ae,this.on(I,he),this},T.prototype.removeListener=function(I,ae){var Q,he,ee,j;if(!b(ae))throw TypeError("listener must be a function");if(!this._events||!this._events[I])return this;if(Q=this._events[I],ee=Q.length,he=-1,Q===ae||b(Q.listener)&&Q.listener===ae)delete this._events[I],this._events.removeListener&&this.emit("removeListener",I,ae);else if(m(Q)){for(j=ee;j-- >0;)if(Q[j]===ae||Q[j].listener&&Q[j].listener===ae){he=j;break}if(he<0)return this;Q.length===1?(Q.length=0,delete this._events[I]):Q.splice(he,1),this._events.removeListener&&this.emit("removeListener",I,ae)}return this},T.prototype.removeAllListeners=function(I){var ae,Q;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[I]&&delete this._events[I],this;if(arguments.length===0){for(ae in this._events)ae!=="removeListener"&&this.removeAllListeners(ae);return this.removeAllListeners("removeListener"),this._events={},this}if(Q=this._events[I],b(Q))this.removeListener(I,Q);else if(Q)for(;Q.length;)this.removeListener(I,Q[Q.length-1]);return delete this._events[I],this},T.prototype.listeners=function(I){var ae;return!this._events||!this._events[I]?ae=[]:b(this._events[I])?ae=[this._events[I]]:ae=this._events[I].slice(),ae},T.prototype.listenerCount=function(I){if(this._events){var ae=this._events[I];if(b(ae))return 1;if(ae)return ae.length}return 0},T.listenerCount=function(I,ae){return I.listenerCount(ae)};function b(I){return typeof I=="function"}function d(I){return typeof I=="number"}function m(I){return typeof I=="object"&&I!==null}function S(I){return I===void 0}return events}var browser,hasRequiredBrowser;function requireBrowser(){return hasRequiredBrowser||(hasRequiredBrowser=1,browser=globalThis.performance&&globalThis.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date}),browser}var raf={exports:{}},performanceNow$1={exports:{}},performanceNow=performanceNow$1.exports,hasRequiredPerformanceNow;function requirePerformanceNow(){return hasRequiredPerformanceNow||(hasRequiredPerformanceNow=1,(function(){var T,b,d,m,S,I;typeof performance<"u"&&performance!==null&&performance.now?performanceNow$1.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(performanceNow$1.exports=function(){return(T()-S)/1e6},b=process.hrtime,T=function(){var ae;return ae=b(),ae[0]*1e9+ae[1]},m=T(),I=process.uptime()*1e9,S=m-I):Date.now?(performanceNow$1.exports=function(){return Date.now()-d},d=Date.now()):(performanceNow$1.exports=function(){return new Date().getTime()-d},d=new Date().getTime())}).call(performanceNow)),performanceNow$1.exports}var hasRequiredRaf;function requireRaf(){if(hasRequiredRaf)return raf.exports;hasRequiredRaf=1;for(var T=requirePerformanceNow(),b=typeof window>"u"?globalThis:window,d=["moz","webkit"],m="AnimationFrame",S=b["request"+m],I=b["cancel"+m]||b["cancelRequest"+m],ae=0;!S&&ae<d.length;ae++)S=b[d[ae]+"Request"+m],I=b[d[ae]+"Cancel"+m]||b[d[ae]+"CancelRequest"+m];if(!S||!I){var Q=0,he=0,ee=[],j=1e3/60;S=function(se){if(ee.length===0){var G=T(),fe=Math.max(0,j-(G-Q));Q=fe+G,setTimeout(function(){var ve=ee.slice(0);ee.length=0;for(var Ge=0;Ge<ve.length;Ge++)if(!ve[Ge].cancelled)try{ve[Ge].callback(Q)}catch(qe){setTimeout(function(){throw qe},0)}},Math.round(fe))}return ee.push({handle:++he,callback:se,cancelled:!1}),he},I=function(se){for(var G=0;G<ee.length;G++)ee[G].handle===se&&(ee[G].cancelled=!0)}}return raf.exports=function(se){return S.call(b,se)},raf.exports.cancel=function(){I.apply(b,arguments)},raf.exports.polyfill=function(se){se||(se=b),se.requestAnimationFrame=S,se.cancelAnimationFrame=I},raf.exports}var rafLoop,hasRequiredRafLoop;function requireRafLoop(){if(hasRequiredRafLoop)return rafLoop;hasRequiredRafLoop=1;var T=requireInherits_browser(),b=requireEvents().EventEmitter,d=requireBrowser(),m=requireRaf();rafLoop=S;function S(I){if(!(this instanceof S))return new S(I);this.running=!1,this.last=d(),this._frame=0,this._tick=this.tick.bind(this),I&&this.on("tick",I)}return T(S,b),S.prototype.start=function(){if(!this.running)return this.running=!0,this.last=d(),this._frame=m(this._tick),this},S.prototype.stop=function(){return this.running=!1,this._frame!==0&&m.cancel(this._frame),this._frame=0,this},S.prototype.tick=function(){this._frame=m(this._tick);var I=d(),ae=I-this.last;this.emit("tick",ae),this.last=I},rafLoop}var rafLoopExports=requireRafLoop();const loop=getDefaultExportFromCjs(rafLoopExports);function Webcam(T){return navigator.mediaDevices.enumerateDevices().then(b=>b.filter(d=>d.kind==="videoinput")).then(b=>{let d={audio:!1,video:!0};return b[T]&&(d.video={deviceId:{exact:b[T].deviceId}}),window.navigator.mediaDevices.getUserMedia(d)}).then(b=>{const d=document.createElement("video");return d.setAttribute("autoplay",""),d.setAttribute("muted",""),d.setAttribute("playsinline",""),d.srcObject=b,new Promise((m,S)=>{d.addEventListener("loadedmetadata",()=>{d.play().then(()=>m({video:d}))})})}).catch(console.log.bind(console))}function Screen(T){return new Promise(function(b,d){navigator.mediaDevices.getDisplayMedia(T).then(m=>{const S=document.createElement("video");S.srcObject=m,S.addEventListener("loadedmetadata",()=>{S.play(),b({video:S})})}).catch(m=>d(m))})}class HydraSource{constructor({regl:b,width:d,height:m,pb:S,label:I=""}){this.label=I,this.regl=b,this.src=null,this.dynamic=!0,this.width=d,this.height=m,this.tex=this.regl.texture({shape:[1,1]}),this.pb=S}init(b,d){"src"in b&&(this.src=b.src,this.tex=this.regl.texture({data:this.src,...d})),"dynamic"in b&&(this.dynamic=b.dynamic)}initCam(b,d){const m=this;Webcam(b).then(S=>{m.src=S.video,m.dynamic=!0,m.tex=m.regl.texture({data:m.src,...d})}).catch(S=>console.log("could not get camera",S))}initVideo(b="",d){const m=document.createElement("video");m.crossOrigin="anonymous",m.autoplay=!0,m.loop=!0,m.muted=!0,m.addEventListener("loadeddata",()=>{this.src=m,m.play(),this.tex=this.regl.texture({data:this.src,...d}),this.dynamic=!0}),m.src=b}initImage(b="",d){const m=document.createElement("img");m.crossOrigin="anonymous",m.src=b,m.onload=()=>{this.src=m,this.dynamic=!1,this.tex=this.regl.texture({data:this.src,...d})}}initStream(b,d){let m=this;b&&this.pb&&(this.pb.initSource(b),this.pb.on("got video",function(S,I){S===b&&(m.src=I,m.dynamic=!0,m.tex=m.regl.texture({data:m.src,...d}))}))}initScreen(b=0,d){const m=this;Screen().then(function(S){m.src=S.video,m.tex=m.regl.texture({data:m.src,...d}),m.dynamic=!0}).catch(S=>console.log("could not get screen",S))}resize(b,d){this.width=b,this.height=d}clear(){this.src&&this.src.srcObject&&this.src.srcObject.getTracks&&this.src.srcObject.getTracks().forEach(b=>b.stop()),this.src=null,this.tex=this.regl.texture({shape:[1,1]})}tick(b){this.src!==null&&this.dynamic===!0&&(this.src.videoWidth&&this.src.videoWidth!==this.tex.width&&(console.log(this.src.videoWidth,this.src.videoHeight,this.tex.width,this.tex.height),this.tex.resize(this.src.videoWidth,this.src.videoHeight)),this.src.width&&this.src.width!==this.tex.width&&this.tex.resize(this.src.width,this.src.height),this.tex.subimage(this.src))}getTexture(){return this.tex}}const mouse={};function mouseButtons(T){if(typeof T=="object"){if("buttons"in T)return T.buttons;if("which"in T){var b=T.which;if(b===2)return 4;if(b===3)return 2;if(b>0)return 1<<b-1}else if("button"in T){var b=T.button;if(b===1)return 4;if(b===2)return 2;if(b>=0)return 1<<b}}return 0}mouse.buttons=mouseButtons;function mouseElement(T){return T.target||T.srcElement||window}mouse.element=mouseElement;function mouseRelativeX(T){return typeof T=="object"&&"pageX"in T?T.pageX:0}mouse.x=mouseRelativeX;function mouseRelativeY(T){return typeof T=="object"&&"pageY"in T?T.pageY:0}mouse.y=mouseRelativeY;function mouseListen(T,b){b||(b=T,T=window);var d=0,m=0,S=0,I={shift:!1,alt:!1,control:!1,meta:!1},ae=!1;function Q(A){var U=!1;return"altKey"in A&&(U=U||A.altKey!==I.alt,I.alt=!!A.altKey),"shiftKey"in A&&(U=U||A.shiftKey!==I.shift,I.shift=!!A.shiftKey),"ctrlKey"in A&&(U=U||A.ctrlKey!==I.control,I.control=!!A.ctrlKey),"metaKey"in A&&(U=U||A.metaKey!==I.meta,I.meta=!!A.metaKey),U}function he(A,U){var h=mouse.x(U),_=mouse.y(U);"buttons"in U&&(A=U.buttons|0),(A!==d||h!==m||_!==S||Q(U))&&(d=A|0,m=h||0,S=_||0,b&&b(d,m,S,I))}function ee(A){he(0,A)}function j(){(d||m||S||I.shift||I.alt||I.meta||I.control)&&(m=S=0,d=0,I.shift=I.alt=I.control=I.meta=!1,b&&b(0,0,0,I))}function se(A){Q(A)&&b&&b(d,m,S,I)}function G(A){mouse.buttons(A)===0?he(0,A):he(d,A)}function fe(A){he(d|mouse.buttons(A),A)}function ve(A){he(d&~mouse.buttons(A),A)}function Ge(){ae||(ae=!0,T.addEventListener("mousemove",G),T.addEventListener("mousedown",fe),T.addEventListener("mouseup",ve),T.addEventListener("mouseleave",ee),T.addEventListener("mouseenter",ee),T.addEventListener("mouseout",ee),T.addEventListener("mouseover",ee),T.addEventListener("blur",j),T.addEventListener("keyup",se),T.addEventListener("keydown",se),T.addEventListener("keypress",se),T!==window&&(window.addEventListener("blur",j),window.addEventListener("keyup",se),window.addEventListener("keydown",se),window.addEventListener("keypress",se)))}function qe(){ae&&(ae=!1,T.removeEventListener("mousemove",G),T.removeEventListener("mousedown",fe),T.removeEventListener("mouseup",ve),T.removeEventListener("mouseleave",ee),T.removeEventListener("mouseenter",ee),T.removeEventListener("mouseout",ee),T.removeEventListener("mouseover",ee),T.removeEventListener("blur",j),T.removeEventListener("keyup",se),T.removeEventListener("keydown",se),T.removeEventListener("keypress",se),T!==window&&(window.removeEventListener("blur",j),window.removeEventListener("keyup",se),window.removeEventListener("keydown",se),window.removeEventListener("keypress",se)))}Ge();var q={element:T};return Object.defineProperties(q,{enabled:{get:function(){return ae},set:function(A){A?Ge():qe()},enumerable:!0},buttons:{get:function(){return d},enumerable:!0},x:{get:function(){return m},enumerable:!0},y:{get:function(){return S},enumerable:!0},mods:{get:function(){return I},enumerable:!0}}),q}var meyda_min$1={exports:{}},meyda_min=meyda_min$1.exports,hasRequiredMeyda_min;function requireMeyda_min(){return hasRequiredMeyda_min||(hasRequiredMeyda_min=1,function(T,b){(function(d,m){T.exports=m()})(meyda_min,function(){function d(C,E,p){for(var Z,be=0,Pe=E.length;be<Pe;be++)!Z&&be in E||(Z||(Z=Array.prototype.slice.call(E,0,be)),Z[be]=E[be]);return C.concat(Z||Array.prototype.slice.call(E))}var m=Object.freeze({__proto__:null,blackman:function(C){for(var E=new Float32Array(C),p=2*Math.PI/(C-1),Z=2*p,be=0;be<C/2;be++)E[be]=.42-.5*Math.cos(be*p)+.08*Math.cos(be*Z);for(be=Math.ceil(C/2);be>0;be--)E[C-be]=E[be-1];return E},hamming:function(C){for(var E=new Float32Array(C),p=0;p<C;p++)E[p]=.54-.46*Math.cos(2*Math.PI*(p/C-1));return E},hanning:function(C){for(var E=new Float32Array(C),p=0;p<C;p++)E[p]=.5-.5*Math.cos(2*Math.PI*p/(C-1));return E},sine:function(C){for(var E=Math.PI/(C-1),p=new Float32Array(C),Z=0;Z<C;Z++)p[Z]=Math.sin(E*Z);return p}}),S={};function I(C){for(;C%2==0&&C>1;)C/=2;return C===1}function ae(C,E){if(E!=="rect"){if(E!==""&&E||(E="hanning"),S[E]||(S[E]={}),!S[E][C.length])try{S[E][C.length]=m[E](C.length)}catch{throw new Error("Invalid windowing function")}C=function(p,Z){for(var be=[],Pe=0;Pe<Math.min(p.length,Z.length);Pe++)be[Pe]=p[Pe]*Z[Pe];return be}(C,S[E][C.length])}return C}function Q(C,E,p){for(var Z=new Float32Array(C),be=0;be<Z.length;be++)Z[be]=be*E/p,Z[be]=13*Math.atan(Z[be]/1315.8)+3.5*Math.atan(Math.pow(Z[be]/7518,2));return Z}function he(C){return Float32Array.from(C)}function ee(C){return 1125*Math.log(1+C/700)}function j(C,E,p){for(var Z,be=new Float32Array(C+2),Pe=new Float32Array(C+2),$e=E/2,Ve=ee(0),Ke=(ee($e)-Ve)/(C+1),Je=new Array(C+2),at=0;at<be.length;at++)be[at]=at*Ke,Pe[at]=(Z=be[at],700*(Math.exp(Z/1125)-1)),Je[at]=Math.floor((p+1)*Pe[at]/E);for(var Rt=new Array(C),st=0;st<Rt.length;st++){for(Rt[st]=new Array(p/2+1).fill(0),at=Je[st];at<Je[st+1];at++)Rt[st][at]=(at-Je[st])/(Je[st+1]-Je[st]);for(at=Je[st+1];at<Je[st+2];at++)Rt[st][at]=(Je[st+2]-at)/(Je[st+2]-Je[st+1])}return Rt}function se(C,E,p,Z,be,Pe,$e){Z===void 0&&(Z=5),be===void 0&&(be=2),Pe===void 0&&(Pe=!0),$e===void 0&&($e=440);var Ve=Math.floor(p/2)+1,Ke=new Array(p).fill(0).map(function(Ht,ut){return C*function(Mt,Vt){return Math.log2(16*Mt/Vt)}(E*ut/p,$e)});Ke[0]=Ke[1]-1.5*C;var Je,at,Rt,st=Ke.slice(1).map(function(Ht,ut){return Math.max(Ht-Ke[ut])},1).concat([1]),ft=Math.round(C/2),tt=new Array(C).fill(0).map(function(Ht,ut){return Ke.map(function(Mt){return(10*C+ft+Mt-ut)%C-ft})}),pt=tt.map(function(Ht,ut){return Ht.map(function(Mt,Vt){return Math.exp(-.5*Math.pow(2*tt[ut][Vt]/st[Vt],2))})});if(at=(Je=pt)[0].map(function(){return 0}),Rt=Je.reduce(function(Ht,ut){return ut.forEach(function(Mt,Vt){Ht[Vt]+=Math.pow(Mt,2)}),Ht},at).map(Math.sqrt),pt=Je.map(function(Ht,ut){return Ht.map(function(Mt,Vt){return Mt/(Rt[Vt]||1)})}),be){var Ct=Ke.map(function(Ht){return Math.exp(-.5*Math.pow((Ht/C-Z)/be,2))});pt=pt.map(function(Ht){return Ht.map(function(ut,Mt){return ut*Ct[Mt]})})}return Pe&&(pt=d(d([],pt.slice(3),!0),pt.slice(0,3))),pt.map(function(Ht){return Ht.slice(0,Ve)})}function G(C,E){for(var p=0,Z=0,be=0;be<E.length;be++)p+=Math.pow(be,C)*Math.abs(E[be]),Z+=E[be];return p/Z}function fe(C){var E=C.ampSpectrum,p=C.barkScale,Z=C.numberOfBarkBands,be=Z===void 0?24:Z;if(typeof E!="object"||typeof p!="object")throw new TypeError;var Pe=be,$e=new Float32Array(Pe),Ve=0,Ke=E,Je=new Int32Array(Pe+1);Je[0]=0;for(var at=p[Ke.length-1]/Pe,Rt=1,st=0;st<Ke.length;st++)for(;p[st]>at;)Je[Rt++]=st,at=Rt*p[Ke.length-1]/Pe;for(Je[Pe]=Ke.length-1,st=0;st<Pe;st++){for(var ft=0,tt=Je[st];tt<Je[st+1];tt++)ft+=Ke[tt];$e[st]=Math.pow(ft,.23)}for(st=0;st<$e.length;st++)Ve+=$e[st];return{specific:$e,total:Ve}}function ve(C){var E=C.ampSpectrum;if(typeof E!="object")throw new TypeError;for(var p=new Float32Array(E.length),Z=0;Z<p.length;Z++)p[Z]=Math.pow(E[Z],2);return p}function Ge(C){var E=C.ampSpectrum,p=C.melFilterBank,Z=C.bufferSize;if(typeof E!="object")throw new TypeError("Valid ampSpectrum is required to generate melBands");if(typeof p!="object")throw new TypeError("Valid melFilterBank is required to generate melBands");for(var be=ve({ampSpectrum:E}),Pe=p.length,$e=Array(Pe),Ve=new Float32Array(Pe),Ke=0;Ke<Ve.length;Ke++){$e[Ke]=new Float32Array(Z/2),Ve[Ke]=0;for(var Je=0;Je<Z/2;Je++)$e[Ke][Je]=p[Ke][Je]*be[Je],Ve[Ke]+=$e[Ke][Je];Ve[Ke]=Math.log(Ve[Ke]+1)}return Array.prototype.slice.call(Ve)}function qe(C){return C&&C.__esModule&&Object.prototype.hasOwnProperty.call(C,"default")?C.default:C}var q=null,A=qe(function(C,E){var p=C.length;return E=E||2,q&&q[p]||function(Z){(q=q||{})[Z]=new Array(Z*Z);for(var be=Math.PI/Z,Pe=0;Pe<Z;Pe++)for(var $e=0;$e<Z;$e++)q[Z][$e+Pe*Z]=Math.cos(be*($e+.5)*Pe)}(p),C.map(function(){return 0}).map(function(Z,be){return E*C.reduce(function(Pe,$e,Ve,Ke){return Pe+$e*q[p][Ve+be*p]},0)})}),U=Object.freeze({__proto__:null,amplitudeSpectrum:function(C){return C.ampSpectrum},buffer:function(C){return C.signal},chroma:function(C){var E=C.ampSpectrum,p=C.chromaFilterBank;if(typeof E!="object")throw new TypeError("Valid ampSpectrum is required to generate chroma");if(typeof p!="object")throw new TypeError("Valid chromaFilterBank is required to generate chroma");var Z=p.map(function(Pe,$e){return E.reduce(function(Ve,Ke,Je){return Ve+Ke*Pe[Je]},0)}),be=Math.max.apply(Math,Z);return be?Z.map(function(Pe){return Pe/be}):Z},complexSpectrum:function(C){return C.complexSpectrum},energy:function(C){var E=C.signal;if(typeof E!="object")throw new TypeError;for(var p=0,Z=0;Z<E.length;Z++)p+=Math.pow(Math.abs(E[Z]),2);return p},loudness:fe,melBands:Ge,mfcc:function(C){var E=C.ampSpectrum,p=C.melFilterBank,Z=C.numberOfMFCCCoefficients,be=C.bufferSize,Pe=Math.min(40,Math.max(1,Z||13));if(p.length<Pe)throw new Error("Insufficient filter bank for requested number of coefficients");var $e=Ge({ampSpectrum:E,melFilterBank:p,bufferSize:be});return A($e).slice(0,Pe)},perceptualSharpness:function(C){for(var E=fe({ampSpectrum:C.ampSpectrum,barkScale:C.barkScale}),p=E.specific,Z=0,be=0;be<p.length;be++)Z+=be<15?(be+1)*p[be+1]:.066*Math.exp(.171*(be+1));return Z*=.11/E.total},perceptualSpread:function(C){for(var E=fe({ampSpectrum:C.ampSpectrum,barkScale:C.barkScale}),p=0,Z=0;Z<E.specific.length;Z++)E.specific[Z]>p&&(p=E.specific[Z]);return Math.pow((E.total-p)/E.total,2)},powerSpectrum:ve,rms:function(C){var E=C.signal;if(typeof E!="object")throw new TypeError;for(var p=0,Z=0;Z<E.length;Z++)p+=Math.pow(E[Z],2);return p/=E.length,p=Math.sqrt(p)},spectralCentroid:function(C){var E=C.ampSpectrum;if(typeof E!="object")throw new TypeError;return G(1,E)},spectralCrest:function(C){var E=C.ampSpectrum;if(typeof E!="object")throw new TypeError;var p=0,Z=-1/0;return E.forEach(function(be){p+=Math.pow(be,2),Z=be>Z?be:Z}),p/=E.length,p=Math.sqrt(p),Z/p},spectralFlatness:function(C){var E=C.ampSpectrum;if(typeof E!="object")throw new TypeError;for(var p=0,Z=0,be=0;be<E.length;be++)p+=Math.log(E[be]),Z+=E[be];return Math.exp(p/E.length)*E.length/Z},spectralFlux:function(C){var E=C.signal,p=C.previousSignal,Z=C.bufferSize;if(typeof E!="object"||typeof p!="object")throw new TypeError;for(var be=0,Pe=-Z/2;Pe<E.length/2-1;Pe++)x=Math.abs(E[Pe])-Math.abs(p[Pe]),be+=(x+Math.abs(x))/2;return be},spectralKurtosis:function(C){var E=C.ampSpectrum;if(typeof E!="object")throw new TypeError;var p=E,Z=G(1,p),be=G(2,p),Pe=G(3,p),$e=G(4,p);return(-3*Math.pow(Z,4)+6*Z*be-4*Z*Pe+$e)/Math.pow(Math.sqrt(be-Math.pow(Z,2)),4)},spectralRolloff:function(C){var E=C.ampSpectrum,p=C.sampleRate;if(typeof E!="object")throw new TypeError;for(var Z=E,be=p/(2*(Z.length-1)),Pe=0,$e=0;$e<Z.length;$e++)Pe+=Z[$e];for(var Ve=.99*Pe,Ke=Z.length-1;Pe>Ve&&Ke>=0;)Pe-=Z[Ke],--Ke;return(Ke+1)*be},spectralSkewness:function(C){var E=C.ampSpectrum;if(typeof E!="object")throw new TypeError;var p=G(1,E),Z=G(2,E),be=G(3,E);return(2*Math.pow(p,3)-3*p*Z+be)/Math.pow(Math.sqrt(Z-Math.pow(p,2)),3)},spectralSlope:function(C){var E=C.ampSpectrum,p=C.sampleRate,Z=C.bufferSize;if(typeof E!="object")throw new TypeError;for(var be=0,Pe=0,$e=new Float32Array(E.length),Ve=0,Ke=0,Je=0;Je<E.length;Je++){be+=E[Je];var at=Je*p/Z;$e[Je]=at,Ve+=at*at,Pe+=at,Ke+=at*E[Je]}return(E.length*Ke-Pe*be)/(be*(Ve-Math.pow(Pe,2)))},spectralSpread:function(C){var E=C.ampSpectrum;if(typeof E!="object")throw new TypeError;return Math.sqrt(G(2,E)-Math.pow(G(1,E),2))},zcr:function(C){var E=C.signal;if(typeof E!="object")throw new TypeError;for(var p=0,Z=1;Z<E.length;Z++)(E[Z-1]>=0&&E[Z]<0||E[Z-1]<0&&E[Z]>=0)&&p++;return p}});function h(C){if(Array.isArray(C)){for(var E=0,p=Array(C.length);E<C.length;E++)p[E]=C[E];return p}return Array.from(C)}var _={},D={},W={bitReverseArray:function(C){if(_[C]===void 0){for(var E=(C-1).toString(2).length,p="0".repeat(E),Z={},be=0;be<C;be++){var Pe=be.toString(2);Pe=p.substr(Pe.length)+Pe,Pe=[].concat(h(Pe)).reverse().join(""),Z[be]=parseInt(Pe,2)}_[C]=Z}return _[C]},multiply:function(C,E){return{real:C.real*E.real-C.imag*E.imag,imag:C.real*E.imag+C.imag*E.real}},add:function(C,E){return{real:C.real+E.real,imag:C.imag+E.imag}},subtract:function(C,E){return{real:C.real-E.real,imag:C.imag-E.imag}},euler:function(C,E){var p=-2*Math.PI*C/E;return{real:Math.cos(p),imag:Math.sin(p)}},conj:function(C){return C.imag*=-1,C},constructComplexArray:function(C){var E={};E.real=C.real===void 0?C.slice():C.real.slice();var p=E.real.length;return D[p]===void 0&&(D[p]=Array.apply(null,Array(p)).map(Number.prototype.valueOf,0)),E.imag=D[p].slice(),E}},ie=function(C){var E={};C.real===void 0||C.imag===void 0?E=W.constructComplexArray(C):(E.real=C.real.slice(),E.imag=C.imag.slice());var p=E.real.length,Z=Math.log2(p);if(Math.round(Z)!=Z)throw new Error("Input size must be a power of 2.");if(E.real.length!=E.imag.length)throw new Error("Real and imaginary components must have the same length.");for(var be=W.bitReverseArray(p),Pe={real:[],imag:[]},$e=0;$e<p;$e++)Pe.real[be[$e]]=E.real[$e],Pe.imag[be[$e]]=E.imag[$e];for(var Ve=0;Ve<p;Ve++)E.real[Ve]=Pe.real[Ve],E.imag[Ve]=Pe.imag[Ve];for(var Ke=1;Ke<=Z;Ke++)for(var Je=Math.pow(2,Ke),at=0;at<Je/2;at++)for(var Rt=W.euler(at,Je),st=0;st<p/Je;st++){var ft=Je*st+at,tt=Je*st+at+Je/2,pt={real:E.real[ft],imag:E.imag[ft]},Ct={real:E.real[tt],imag:E.imag[tt]},Ht=W.multiply(Rt,Ct),ut=W.subtract(pt,Ht);E.real[tt]=ut.real,E.imag[tt]=ut.imag;var Mt=W.add(Ht,pt);E.real[ft]=Mt.real,E.imag[ft]=Mt.imag}return E},me=ie,Te=function(){function C(E,p){var Z=this;if(this._m=p,!E.audioContext)throw this._m.errors.noAC;if(E.bufferSize&&!I(E.bufferSize))throw this._m._errors.notPow2;if(!E.source)throw this._m._errors.noSource;this._m.audioContext=E.audioContext,this._m.bufferSize=E.bufferSize||this._m.bufferSize||256,this._m.hopSize=E.hopSize||this._m.hopSize||this._m.bufferSize,this._m.sampleRate=E.sampleRate||this._m.audioContext.sampleRate||44100,this._m.callback=E.callback,this._m.windowingFunction=E.windowingFunction||"hanning",this._m.featureExtractors=U,this._m.EXTRACTION_STARTED=E.startImmediately||!1,this._m.channel=typeof E.channel=="number"?E.channel:0,this._m.inputs=E.inputs||1,this._m.outputs=E.outputs||1,this._m.numberOfMFCCCoefficients=E.numberOfMFCCCoefficients||this._m.numberOfMFCCCoefficients||13,this._m.numberOfBarkBands=E.numberOfBarkBands||this._m.numberOfBarkBands||24,this._m.spn=this._m.audioContext.createScriptProcessor(this._m.bufferSize,this._m.inputs,this._m.outputs),this._m.spn.connect(this._m.audioContext.destination),this._m._featuresToExtract=E.featureExtractors||[],this._m.barkScale=Q(this._m.bufferSize,this._m.sampleRate,this._m.bufferSize),this._m.melFilterBank=j(Math.max(this._m.melBands,this._m.numberOfMFCCCoefficients),this._m.sampleRate,this._m.bufferSize),this._m.inputData=null,this._m.previousInputData=null,this._m.frame=null,this._m.previousFrame=null,this.setSource(E.source),this._m.spn.onaudioprocess=function(be){var Pe;Z._m.inputData!==null&&(Z._m.previousInputData=Z._m.inputData),Z._m.inputData=be.inputBuffer.getChannelData(Z._m.channel),Z._m.previousInputData?((Pe=new Float32Array(Z._m.previousInputData.length+Z._m.inputData.length-Z._m.hopSize)).set(Z._m.previousInputData.slice(Z._m.hopSize)),Pe.set(Z._m.inputData,Z._m.previousInputData.length-Z._m.hopSize)):Pe=Z._m.inputData;var $e=function(Ve,Ke,Je){if(Ve.length<Ke)throw new Error("Buffer is too short for frame length");if(Je<1)throw new Error("Hop length cannot be less that 1");if(Ke<1)throw new Error("Frame length cannot be less that 1");var at=1+Math.floor((Ve.length-Ke)/Je);return new Array(at).fill(0).map(function(Rt,st){return Ve.slice(st*Je,st*Je+Ke)})}(Pe,Z._m.bufferSize,Z._m.hopSize);$e.forEach(function(Ve){Z._m.frame=Ve;var Ke=Z._m.extract(Z._m._featuresToExtract,Z._m.frame,Z._m.previousFrame);typeof Z._m.callback=="function"&&Z._m.EXTRACTION_STARTED&&Z._m.callback(Ke),Z._m.previousFrame=Z._m.frame})}}return C.prototype.start=function(E){this._m._featuresToExtract=E||this._m._featuresToExtract,this._m.EXTRACTION_STARTED=!0},C.prototype.stop=function(){this._m.EXTRACTION_STARTED=!1},C.prototype.setSource=function(E){this._m.source&&this._m.source.disconnect(this._m.spn),this._m.source=E,this._m.source.connect(this._m.spn)},C.prototype.setChannel=function(E){E<=this._m.inputs?this._m.channel=E:console.error("Channel ".concat(E," does not exist. Make sure you've provided a value for 'inputs' that is greater than ").concat(E," when instantiating the MeydaAnalyzer"))},C.prototype.get=function(E){return this._m.inputData?this._m.extract(E||this._m._featuresToExtract,this._m.inputData,this._m.previousInputData):null},C}(),ke={audioContext:null,spn:null,bufferSize:512,sampleRate:44100,melBands:26,chromaBands:12,callback:null,windowingFunction:"hanning",featureExtractors:U,EXTRACTION_STARTED:!1,numberOfMFCCCoefficients:13,numberOfBarkBands:24,_featuresToExtract:[],windowing:ae,_errors:{notPow2:new Error("Meyda: Buffer size must be a power of 2, e.g. 64 or 512"),featureUndef:new Error("Meyda: No features defined."),invalidFeatureFmt:new Error("Meyda: Invalid feature format"),invalidInput:new Error("Meyda: Invalid input."),noAC:new Error("Meyda: No AudioContext specified."),noSource:new Error("Meyda: No source node specified.")},createMeydaAnalyzer:function(C){return new Te(C,Object.assign({},ke))},listAvailableFeatureExtractors:function(){return Object.keys(this.featureExtractors)},extract:function(C,E,p){var Z=this;if(!E)throw this._errors.invalidInput;if(typeof E!="object")throw this._errors.invalidInput;if(!C)throw this._errors.featureUndef;if(!I(E.length))throw this._errors.notPow2;this.barkScale!==void 0&&this.barkScale.length==this.bufferSize||(this.barkScale=Q(this.bufferSize,this.sampleRate,this.bufferSize)),this.melFilterBank!==void 0&&this.barkScale.length==this.bufferSize&&this.melFilterBank.length==this.melBands||(this.melFilterBank=j(Math.max(this.melBands,this.numberOfMFCCCoefficients),this.sampleRate,this.bufferSize)),this.chromaFilterBank!==void 0&&this.chromaFilterBank.length==this.chromaBands||(this.chromaFilterBank=se(this.chromaBands,this.sampleRate,this.bufferSize)),"buffer"in E&&E.buffer===void 0?this.signal=he(E):this.signal=E;var be=We(E,this.windowingFunction,this.bufferSize);if(this.signal=be.windowedSignal,this.complexSpectrum=be.complexSpectrum,this.ampSpectrum=be.ampSpectrum,p){var Pe=We(p,this.windowingFunction,this.bufferSize);this.previousSignal=Pe.windowedSignal,this.previousComplexSpectrum=Pe.complexSpectrum,this.previousAmpSpectrum=Pe.ampSpectrum}var $e=function(Ve){return Z.featureExtractors[Ve]({ampSpectrum:Z.ampSpectrum,chromaFilterBank:Z.chromaFilterBank,complexSpectrum:Z.complexSpectrum,signal:Z.signal,bufferSize:Z.bufferSize,sampleRate:Z.sampleRate,barkScale:Z.barkScale,melFilterBank:Z.melFilterBank,previousSignal:Z.previousSignal,previousAmpSpectrum:Z.previousAmpSpectrum,previousComplexSpectrum:Z.previousComplexSpectrum,numberOfMFCCCoefficients:Z.numberOfMFCCCoefficients,numberOfBarkBands:Z.numberOfBarkBands})};if(typeof C=="object")return C.reduce(function(Ve,Ke){var Je;return Object.assign({},Ve,((Je={})[Ke]=$e(Ke),Je))},{});if(typeof C=="string")return $e(C);throw this._errors.invalidFeatureFmt}},We=function(C,E,p){var Z={};C.buffer===void 0?Z.signal=he(C):Z.signal=C,Z.windowedSignal=ae(Z.signal,E),Z.complexSpectrum=me(Z.windowedSignal),Z.ampSpectrum=new Float32Array(p/2);for(var be=0;be<p/2;be++)Z.ampSpectrum[be]=Math.sqrt(Math.pow(Z.complexSpectrum.real[be],2)+Math.pow(Z.complexSpectrum.imag[be],2));return Z};return typeof window<"u"&&(window.Meyda=ke),ke})}(meyda_min$1)),meyda_min$1.exports}var meyda_minExports=requireMeyda_min();const Meyda=getDefaultExportFromCjs(meyda_minExports);class Audio{constructor({numBins:b=4,cutoff:d=2,smooth:m=.4,max:S=15,scale:I=10,isDrawing:ae=!1,parentEl:Q=document.body}){this.vol=0,this.scale=I,this.max=S,this.cutoff=d,this.smooth=m,this.setBins(b),this.beat={holdFrames:20,threshold:40,_cutoff:0,decay:.98,_framesSinceBeat:0},this.onBeat=()=>{},this.canvas=document.createElement("canvas"),this.canvas.width=100,this.canvas.height=80,this.canvas.style.width="100px",this.canvas.style.height="80px",this.canvas.style.position="absolute",this.canvas.style.right="0px",this.canvas.style.bottom="0px",Q.appendChild(this.canvas),this.isDrawing=ae,this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#DFFFFF",this.ctx.strokeStyle="#0ff",this.ctx.lineWidth=.5,window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then(he=>{this.stream=he,this.context=new AudioContext;let ee=this.context.createMediaStreamSource(he);this.meyda=Meyda.createMeydaAnalyzer({audioContext:this.context,source:ee,featureExtractors:["loudness"]})}).catch(he=>console.log("ERROR",he))}detectBeat(b){b>this.beat._cutoff&&b>this.beat.threshold?(this.onBeat(),this.beat._cutoff=b*1.2,this.beat._framesSinceBeat=0):this.beat._framesSinceBeat<=this.beat.holdFrames?this.beat._framesSinceBeat++:(this.beat._cutoff*=this.beat.decay,this.beat._cutoff=Math.max(this.beat._cutoff,this.beat.threshold))}tick(){if(this.meyda){var b=this.meyda.get();if(b&&b!==null){this.vol=b.loudness.total,this.detectBeat(this.vol);const d=(S,I)=>S+I;let m=Math.floor(b.loudness.specific.length/this.bins.length);this.prevBins=this.bins.slice(0),this.bins=this.bins.map((S,I)=>b.loudness.specific.slice(I*m,(I+1)*m).reduce(d)).map((S,I)=>S*(1-this.settings[I].smooth)+this.prevBins[I]*this.settings[I].smooth),this.fft=this.bins.map((S,I)=>Math.max(0,(S-this.settings[I].cutoff)/this.settings[I].scale)),this.isDrawing&&this.draw()}}}setCutoff(b){this.cutoff=b,this.settings=this.settings.map(d=>(d.cutoff=b,d))}setSmooth(b){this.smooth=b,this.settings=this.settings.map(d=>(d.smooth=b,d))}setBins(b){this.bins=Array(b).fill(0),this.prevBins=Array(b).fill(0),this.fft=Array(b).fill(0),this.settings=Array(b).fill(0).map(()=>({cutoff:this.cutoff,scale:this.scale,smooth:this.smooth})),this.bins.forEach((d,m)=>{window["a"+m]=(S=1,I=0)=>()=>a.fft[m]*S+I})}setScale(b){this.scale=b,this.settings=this.settings.map(d=>(d.scale=b,d))}setMax(b){this.max=b,console.log("set max is deprecated")}hide(){this.isDrawing=!1,this.canvas.style.display="none"}show(){this.isDrawing=!0,this.canvas.style.display="block"}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var b=this.canvas.width/this.bins.length,d=this.canvas.height/(this.max*2);this.bins.forEach((m,S)=>{var I=m*d;this.ctx.fillRect(S*b,this.canvas.height-I,b,I);var ae=this.canvas.height-d*this.settings[S].cutoff;this.ctx.beginPath(),this.ctx.moveTo(S*b,ae),this.ctx.lineTo((S+1)*b,ae),this.ctx.stroke();var Q=this.canvas.height-d*(this.settings[S].scale+this.settings[S].cutoff);this.ctx.beginPath(),this.ctx.moveTo(S*b,Q),this.ctx.lineTo((S+1)*b,Q),this.ctx.stroke()})}}class VideoRecorder{constructor(b){this.mediaSource=new MediaSource,this.stream=b,this.output=document.createElement("video"),this.output.autoplay=!0,this.output.loop=!0;let d=this;this.mediaSource.addEventListener("sourceopen",()=>{console.log("MediaSource opened"),d.sourceBuffer=d.mediaSource.addSourceBuffer('video/webm; codecs="vp8"'),console.log("Source buffer: ",sourceBuffer)})}start(){let b={mimeType:"video/webm;codecs=vp9"};this.recordedBlobs=[];try{this.mediaRecorder=new MediaRecorder(this.stream,b)}catch(d){console.log("Unable to create MediaRecorder with options Object: ",d);try{b={mimeType:"video/webm,codecs=vp9"},this.mediaRecorder=new MediaRecorder(this.stream,b)}catch(m){console.log("Unable to create MediaRecorder with options Object: ",m);try{b="video/vp8",this.mediaRecorder=new MediaRecorder(this.stream,b)}catch(S){alert(`MediaRecorder is not supported by this browser.

Try Firefox 29 or later, or Chrome 47 or later, with Enable experimental Web Platform features enabled from chrome://flags.`),console.error("Exception while creating MediaRecorder:",S);return}}}console.log("Created MediaRecorder",this.mediaRecorder,"with options",b),this.mediaRecorder.onstop=this._handleStop.bind(this),this.mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this.mediaRecorder.start(100),console.log("MediaRecorder started",this.mediaRecorder)}stop(){this.mediaRecorder.stop()}_handleStop(){const b=new Blob(this.recordedBlobs,{type:this.mediaRecorder.mimeType}),d=window.URL.createObjectURL(b);this.output.src=d;const m=document.createElement("a");m.style.display="none",m.href=d;let S=new Date;m.download=`hydra-${S.getFullYear()}-${S.getMonth()+1}-${S.getDate()}-${S.getHours()}.${S.getMinutes()}.${S.getSeconds()}.webm`,document.body.appendChild(m),m.click(),setTimeout(()=>{document.body.removeChild(m),window.URL.revokeObjectURL(d)},300)}_handleDataAvailable(b){b.data&&b.data.size>0&&this.recordedBlobs.push(b.data)}}const easing={linear:function(T){return T},easeInQuad:function(T){return T*T},easeOutQuad:function(T){return T*(2-T)},easeInOutQuad:function(T){return T<.5?2*T*T:-1+(4-2*T)*T},easeInCubic:function(T){return T*T*T},easeOutCubic:function(T){return--T*T*T+1},easeInOutCubic:function(T){return T<.5?4*T*T*T:(T-1)*(2*T-2)*(2*T-2)+1},easeInQuart:function(T){return T*T*T*T},easeOutQuart:function(T){return 1- --T*T*T*T},easeInOutQuart:function(T){return T<.5?8*T*T*T*T:1-8*--T*T*T*T},easeInQuint:function(T){return T*T*T*T*T},easeOutQuint:function(T){return 1+--T*T*T*T*T},easeInOutQuint:function(T){return T<.5?16*T*T*T*T*T:1+16*--T*T*T*T*T},sin:function(T){return(1+Math.sin(Math.PI*T-Math.PI/2))/2}};var map=(T,b,d,m,S)=>(T-b)*(S-m)/(d-b)+m;const ArrayUtils={init:()=>{Array.prototype.fast=function(T=1){return this._speed=T,this},Array.prototype.smooth=function(T=1){return this._smooth=T,this},Array.prototype.ease=function(T="linear"){return typeof T=="function"?(this._smooth=1,this._ease=T):easing[T]&&(this._smooth=1,this._ease=easing[T]),this},Array.prototype.offset=function(T=.5){return this._offset=T%1,this},Array.prototype.fit=function(T=0,b=1){let d=Math.min(...this),m=Math.max(...this);var S=this.map(I=>map(I,d,m,T,b));return S._speed=this._speed,S._smooth=this._smooth,S._ease=this._ease,S}},getValue:(T=[])=>({time:b,bpm:d})=>{let m=T._speed?T._speed:1,S=T._smooth?T._smooth:0,I=b*m*(d/60)+(T._offset||0);if(S!==0){let ae=T._ease?T._ease:easing.linear,Q=I-S/2,he=T[Math.floor(Q%T.length)],ee=T[Math.floor((Q+1)%T.length)],j=Math.min(Q%1/S,1);return ae(j)*(ee-he)+he}else return T[Math.floor(I%T.length)],T[Math.floor(I%T.length)]}},Sandbox=T=>{var b="",d=S(b),m=(I,ae)=>{b+=`
      var ${I} = ${ae}
    `,d=S(b)};return{addToContext:m,eval:I=>d.eval(I)};function S(I){globalThis.eval(I);var ae=function(Q){globalThis.eval(Q)};return{eval:ae}}};class EvalSandbox{constructor(b,d,m=[]){this.makeGlobal=d,this.sandbox=Sandbox(),this.parent=b;var S=Object.keys(b);S.forEach(I=>this.add(I)),this.userProps=m}add(b){this.makeGlobal&&(window[b]=this.parent[b])}set(b,d){this.makeGlobal&&(window[b]=d),this.parent[b]=d}tick(){this.makeGlobal&&this.userProps.forEach(b=>{this.parent[b]=window[b]})}eval(b){this.sandbox.eval(b)}}const DEFAULT_CONVERSIONS={float:{vec4:{name:"sum",args:[[1,1,1,1]]},vec2:{name:"sum",args:[[1,1]]}}},ensure_decimal_dot=T=>(T=T.toString(),T.indexOf(".")<0&&(T+="."),T);function formatArguments(T,b,d){const m=T.transform.inputs,S=T.userArgs,{generators:I}=T.synth,{src:ae}=I;return m.map((Q,he)=>{const ee={value:Q.default,type:Q.type,isUniform:!1,name:Q.name,vecLen:0};if(ee.type==="float"&&(ee.value=ensure_decimal_dot(Q.default)),Q.type.startsWith("vec"))try{ee.vecLen=Number.parseInt(Q.type.substr(3))}catch{console.log(`Error determining length of vector input type ${Q.type} (${Q.name})`)}if(S.length>he&&(ee.value=S[he],typeof S[he]=="function"?(ee.value=(G,fe,ve)=>{try{const Ge=S[he](fe);return typeof Ge=="number"?Ge:(console.warn("function does not return a number",S[he]),Q.default)}catch(Ge){return console.warn("ERROR",Ge),Q.default}},ee.isUniform=!0):S[he].constructor===Array&&(ee.value=(G,fe,ve)=>ArrayUtils.getValue(S[he])(fe),ee.isUniform=!0)),!(b<0)){if(ee.value&&ee.value.transforms){const G=ee.value.transforms[ee.value.transforms.length-1];if(G.transform.glsl_return_type!==Q.type){const fe=DEFAULT_CONVERSIONS[Q.type];if(typeof fe<"u"){const ve=fe[G.transform.glsl_return_type];if(typeof ve<"u"){const{name:Ge,args:qe}=ve;ee.value=ee.value[Ge](...qe)}}}ee.isUniform=!1}else if(ee.type==="float"&&typeof ee.value=="number")ee.value=ensure_decimal_dot(ee.value);else if(ee.type.startsWith("vec")&&typeof ee.value=="object"&&Array.isArray(ee.value))ee.isUniform=!1,ee.value=`${ee.type}(${ee.value.map(ensure_decimal_dot).join(", ")})`;else if(Q.type==="sampler2D"){var j=ee.value;ee.value=()=>j.getTexture(),ee.isUniform=!0}else if(ee.value.getTexture&&Q.type==="vec4"){var se=ee.value;ee.value=ae(se),ee.isUniform=!1}ee.isUniform&&(ee.name+=b)}return ee})}function generateGlsl(T){var b={uniforms:[],glslFunctions:[],fragColor:""},d=generateGlsl$1(T,b)("st");b.fragColor=d;let m={};return b.uniforms.forEach(S=>m[S.name]=S),b.uniforms=Object.values(m),b}function generateGlsl$1(T,b){var d=()=>"";return T.forEach(m=>{var S=formatArguments(m,b.uniforms.length);S.forEach(Q=>{Q.isUniform&&b.uniforms.push(Q)}),contains(m,b.glslFunctions)||b.glslFunctions.push(m);var I=d;if(m.transform.type==="src")d=Q=>`${shaderString(Q,m.name,S,b)}`;else if(m.transform.type==="coord")d=Q=>`${I(`${shaderString(Q,m.name,S,b)}`)}`;else if(m.transform.type==="color")d=Q=>`${shaderString(`${I(Q)}`,m.name,S,b)}`;else if(m.transform.type==="combine"){var ae=S[0].value&&S[0].value.transforms?Q=>`${generateGlsl$1(S[0].value.transforms,b)(Q)}`:S[0].isUniform?()=>S[0].name:()=>S[0].value;d=Q=>`${shaderString(`${I(Q)}, ${ae(Q)}`,m.name,S.slice(1),b)}`}else if(m.transform.type==="combineCoord"){var ae=S[0].value&&S[0].value.transforms?he=>`${generateGlsl$1(S[0].value.transforms,b)(he)}`:S[0].isUniform?()=>S[0].name:()=>S[0].value;d=he=>`${I(`${shaderString(`${he}, ${ae(he)}`,m.name,S.slice(1),b)}`)}`}}),d}function shaderString(T,b,d,m){const S=d.map(I=>I.isUniform?I.name:I.value&&I.value.transforms?`${generateGlsl$1(I.value.transforms,m)("st")}`:I.value).reduce((I,ae)=>`${I}, ${ae}`,"");return`${b}(${T}${S})`}function contains(T,b){for(var d=0;d<b.length;d++)if(T.name==b[d].name)return!0;return!1}const utilityGlsl={_luminance:{type:"util",glsl:`float _luminance(vec3 rgb){
      const vec3 W = vec3(0.2125, 0.7154, 0.0721);
      return dot(rgb, W);
    }`},_noise:{type:"util",glsl:`
    //	Simplex 3D Noise
    //	by Ian McEwan, Ashima Arts
    vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
  vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}

  float _noise(vec3 v){
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);

  // First corner
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;

  // Other corners
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );

    //  x0 = x0 - 0. + 0.0 * C
    vec3 x1 = x0 - i1 + 1.0 * C.xxx;
    vec3 x2 = x0 - i2 + 2.0 * C.xxx;
    vec3 x3 = x0 - 1. + 3.0 * C.xxx;

  // Permutations
    i = mod(i, 289.0 );
    vec4 p = permute( permute( permute(
               i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
             + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
             + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));

  // Gradients
  // ( N*N points uniformly over a square, mapped onto an octahedron.)
    float n_ = 1.0/7.0; // N=7
    vec3  ns = n_ * D.wyz - D.xzx;

    vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)

    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)

    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);

    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );

    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));

    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;

    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);

  //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;

  // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
  }
    `},_rgbToHsv:{type:"util",glsl:`vec3 _rgbToHsv(vec3 c){
            vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
            vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
            vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));

            float d = q.x - min(q.w, q.y);
            float e = 1.0e-10;
            return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
        }`},_hsvToRgb:{type:"util",glsl:`vec3 _hsvToRgb(vec3 c){
        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
    }`}};var GlslSource=function(T){return this.transforms=[],this.transforms.push(T),this.defaultOutput=T.defaultOutput,this.synth=T.synth,this.type="GlslSource",this.defaultUniforms=T.defaultUniforms,this};GlslSource.prototype.addTransform=function(T){this.transforms.push(T)};GlslSource.prototype.out=function(T){var b=T||this.defaultOutput,d=this.glsl(b);if(this.synth.currentFunctions=[],b)try{b.render(d)}catch(m){console.log("shader could not compile",m)}};GlslSource.prototype.glsl=function(){var T=[],b=[];return this.transforms.forEach(d=>{d.transform.type==="renderpass"?console.warn("no support for renderpass"):b.push(d)}),b.length>0&&T.push(this.compile(b)),T};GlslSource.prototype.compile=function(T){var b=generateGlsl(T,this.synth),d={};b.uniforms.forEach(S=>{d[S.name]=S.value});var m=`
  precision ${this.defaultOutput.precision} float;
  ${Object.values(b.uniforms).map(S=>{let I=S.type;switch(S.type){case"texture":I="sampler2D";break}return`
      uniform ${I} ${S.name};`}).join("")}
  uniform float time;
  uniform vec2 resolution;
  varying vec2 uv;
  uniform sampler2D prevBuffer;

  ${Object.values(utilityGlsl).map(S=>`
            ${S.glsl}
          `).join("")}

  ${b.glslFunctions.map(S=>`
            ${S.transform.glsl}
          `).join("")}

  void main () {
    vec4 c = vec4(1, 0, 0, 1);
    vec2 st = gl_FragCoord.xy/resolution.xy;
    gl_FragColor = ${b.fragColor};
  }
  `;return{frag:m,uniforms:Object.assign({},this.defaultUniforms,d)}};const glslFunctions=()=>[{name:"noise",type:"src",inputs:[{type:"float",name:"scale",default:10},{type:"float",name:"offset",default:.1}],glsl:"   return vec4(vec3(_noise(vec3(_st*scale, offset*time))), 1.0);"},{name:"voronoi",type:"src",inputs:[{type:"float",name:"scale",default:5},{type:"float",name:"speed",default:.3},{type:"float",name:"blending",default:.3}],glsl:`   vec3 color = vec3(.0);
   // Scale
   _st *= scale;
   // Tile the space
   vec2 i_st = floor(_st);
   vec2 f_st = fract(_st);
   float m_dist = 10.;  // minimun distance
   vec2 m_point;        // minimum point
   for (int j=-1; j<=1; j++ ) {
   for (int i=-1; i<=1; i++ ) {
   vec2 neighbor = vec2(float(i),float(j));
   vec2 p = i_st + neighbor;
   vec2 point = fract(sin(vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3))))*43758.5453);
   point = 0.5 + 0.5*sin(time*speed + 6.2831*point);
   vec2 diff = neighbor + point - f_st;
   float dist = length(diff);
   if( dist < m_dist ) {
   m_dist = dist;
   m_point = point;
   }
   }
   }
   // Assign a color using the closest point position
   color += dot(m_point,vec2(.3,.6));
   color *= 1.0 - blending*m_dist;
   return vec4(color, 1.0);`},{name:"osc",type:"src",inputs:[{type:"float",name:"frequency",default:60},{type:"float",name:"sync",default:.1},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st;
   float r = sin((st.x-offset/frequency+time*sync)*frequency)*0.5  + 0.5;
   float g = sin((st.x+time*sync)*frequency)*0.5 + 0.5;
   float b = sin((st.x+offset/frequency+time*sync)*frequency)*0.5  + 0.5;
   return vec4(r, g, b, 1.0);`},{name:"shape",type:"src",inputs:[{type:"float",name:"sides",default:3},{type:"float",name:"radius",default:.3},{type:"float",name:"smoothing",default:.01}],glsl:`   vec2 st = _st * 2. - 1.;
   // Angle and radius from the current pixel
   float a = atan(st.x,st.y)+3.1416;
   float r = (2.*3.1416)/sides;
   float d = cos(floor(.5+a/r)*r-a)*length(st);
   return vec4(vec3(1.0-smoothstep(radius,radius + smoothing + 0.0000001,d)), 1.0);`},{name:"gradient",type:"src",inputs:[{type:"float",name:"speed",default:0}],glsl:"   return vec4(_st, sin(time*speed), 1.0);"},{name:"src",type:"src",inputs:[{type:"sampler2D",name:"tex",default:NaN}],glsl:`   //  vec2 uv = gl_FragCoord.xy/vec2(1280., 720.);
   return texture2D(tex, fract(_st));`},{name:"solid",type:"src",inputs:[{type:"float",name:"r",default:0},{type:"float",name:"g",default:0},{type:"float",name:"b",default:0},{type:"float",name:"a",default:1}],glsl:"   return vec4(r, g, b, a);"},{name:"rotate",type:"coord",inputs:[{type:"float",name:"angle",default:10},{type:"float",name:"speed",default:0}],glsl:`   vec2 xy = _st - vec2(0.5);
   float ang = angle + speed *time;
   xy = mat2(cos(ang),-sin(ang), sin(ang),cos(ang))*xy;
   xy += 0.5;
   return xy;`},{name:"scale",type:"coord",inputs:[{type:"float",name:"amount",default:1.5},{type:"float",name:"xMult",default:1},{type:"float",name:"yMult",default:1},{type:"float",name:"offsetX",default:.5},{type:"float",name:"offsetY",default:.5}],glsl:`   vec2 xy = _st - vec2(offsetX, offsetY);
   xy*=(1.0/vec2(amount*xMult, amount*yMult));
   xy+=vec2(offsetX, offsetY);
   return xy;
   `},{name:"pixelate",type:"coord",inputs:[{type:"float",name:"pixelX",default:20},{type:"float",name:"pixelY",default:20}],glsl:`   vec2 xy = vec2(pixelX, pixelY);
   return (floor(_st * xy) + 0.5)/xy;`},{name:"posterize",type:"color",inputs:[{type:"float",name:"bins",default:3},{type:"float",name:"gamma",default:.6}],glsl:`   vec4 c2 = pow(_c0, vec4(gamma));
   c2 *= vec4(bins);
   c2 = floor(c2);
   c2/= vec4(bins);
   c2 = pow(c2, vec4(1.0/gamma));
   return vec4(c2.xyz, _c0.a);`},{name:"shift",type:"color",inputs:[{type:"float",name:"r",default:.5},{type:"float",name:"g",default:0},{type:"float",name:"b",default:0},{type:"float",name:"a",default:0}],glsl:`   vec4 c2 = vec4(_c0);
   c2.r = fract(c2.r + r);
   c2.g = fract(c2.g + g);
   c2.b = fract(c2.b + b);
   c2.a = fract(c2.a + a);
   return vec4(c2.rgba);`},{name:"repeat",type:"coord",inputs:[{type:"float",name:"repeatX",default:3},{type:"float",name:"repeatY",default:3},{type:"float",name:"offsetX",default:0},{type:"float",name:"offsetY",default:0}],glsl:`   vec2 st = _st * vec2(repeatX, repeatY);
   st.x += step(1., mod(st.y,2.0)) * offsetX;
   st.y += step(1., mod(st.x,2.0)) * offsetY;
   return fract(st);`},{name:"modulateRepeat",type:"combineCoord",inputs:[{type:"float",name:"repeatX",default:3},{type:"float",name:"repeatY",default:3},{type:"float",name:"offsetX",default:.5},{type:"float",name:"offsetY",default:.5}],glsl:`   vec2 st = _st * vec2(repeatX, repeatY);
   st.x += step(1., mod(st.y,2.0)) + _c0.r * offsetX;
   st.y += step(1., mod(st.x,2.0)) + _c0.g * offsetY;
   return fract(st);`},{name:"repeatX",type:"coord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y += step(1., mod(st.x,2.0))* offset;
   return fract(st);`},{name:"modulateRepeatX",type:"combineCoord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:.5}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y += step(1., mod(st.x,2.0)) + _c0.r * offset;
   return fract(st);`},{name:"repeatY",type:"coord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st * vec2(1.0, reps);
   //  float f =  mod(_st.y,2.0);
   st.x += step(1., mod(st.y,2.0))* offset;
   return fract(st);`},{name:"modulateRepeatY",type:"combineCoord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:.5}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.x += step(1., mod(st.y,2.0)) + _c0.r * offset;
   return fract(st);`},{name:"kaleid",type:"coord",inputs:[{type:"float",name:"nSides",default:4}],glsl:`   vec2 st = _st;
   st -= 0.5;
   float r = length(st);
   float a = atan(st.y, st.x);
   float pi = 2.*3.1416;
   a = mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return r*vec2(cos(a), sin(a));`},{name:"modulateKaleid",type:"combineCoord",inputs:[{type:"float",name:"nSides",default:4}],glsl:`   vec2 st = _st - 0.5;
   float r = length(st);
   float a = atan(st.y, st.x);
   float pi = 2.*3.1416;
   a = mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return (_c0.r+r)*vec2(cos(a), sin(a));`},{name:"scroll",type:"coord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"scrollY",default:.5},{type:"float",name:"speedX",default:0},{type:"float",name:"speedY",default:0}],glsl:`
   _st.x += scrollX + time*speedX;
   _st.y += scrollY + time*speedY;
   return fract(_st);`},{name:"scrollX",type:"coord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.x += scrollX + time*speed;
   return fract(_st);`},{name:"modulateScrollX",type:"combineCoord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.x += _c0.r*scrollX + time*speed;
   return fract(_st);`},{name:"scrollY",type:"coord",inputs:[{type:"float",name:"scrollY",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.y += scrollY + time*speed;
   return fract(_st);`},{name:"modulateScrollY",type:"combineCoord",inputs:[{type:"float",name:"scrollY",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.y += _c0.r*scrollY + time*speed;
   return fract(_st);`},{name:"add",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return (_c0+_c1)*amount + _c0*(1.0-amount);"},{name:"sub",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return (_c0-_c1)*amount + _c0*(1.0-amount);"},{name:"layer",type:"combine",inputs:[],glsl:"   return vec4(mix(_c0.rgb, _c1.rgb, _c1.a), clamp(_c0.a + _c1.a, 0.0, 1.0));"},{name:"blend",type:"combine",inputs:[{type:"float",name:"amount",default:.5}],glsl:"   return _c0*(1.0-amount)+_c1*amount;"},{name:"mult",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return _c0*(1.0-amount)+(_c0*_c1)*amount;"},{name:"diff",type:"combine",inputs:[],glsl:"   return vec4(abs(_c0.rgb-_c1.rgb), max(_c0.a, _c1.a));"},{name:"modulate",type:"combineCoord",inputs:[{type:"float",name:"amount",default:.1}],glsl:`   //  return fract(st+(_c0.xy-0.5)*amount);
   return _st + _c0.xy*amount;`},{name:"modulateScale",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:1},{type:"float",name:"offset",default:1}],glsl:`   vec2 xy = _st - vec2(0.5);
   xy*=(1.0/vec2(offset + multiple*_c0.r, offset + multiple*_c0.g));
   xy+=vec2(0.5);
   return xy;`},{name:"modulatePixelate",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:10},{type:"float",name:"offset",default:3}],glsl:`   vec2 xy = vec2(offset + _c0.x*multiple, offset + _c0.y*multiple);
   return (floor(_st * xy) + 0.5)/xy;`},{name:"modulateRotate",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:1},{type:"float",name:"offset",default:0}],glsl:`   vec2 xy = _st - vec2(0.5);
   float angle = offset + _c0.x * multiple;
   xy = mat2(cos(angle),-sin(angle), sin(angle),cos(angle))*xy;
   xy += 0.5;
   return xy;`},{name:"modulateHue",type:"combineCoord",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return _st + (vec2(_c0.g - _c0.r, _c0.b - _c0.g) * amount * 1.0/resolution);"},{name:"invert",type:"color",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return vec4((1.0-_c0.rgb)*amount + _c0.rgb*(1.0-amount), _c0.a);"},{name:"contrast",type:"color",inputs:[{type:"float",name:"amount",default:1.6}],glsl:`   vec4 c = (_c0-vec4(0.5))*vec4(amount) + vec4(0.5);
   return vec4(c.rgb, _c0.a);`},{name:"brightness",type:"color",inputs:[{type:"float",name:"amount",default:.4}],glsl:"   return vec4(_c0.rgb + vec3(amount), _c0.a);"},{name:"mask",type:"combine",inputs:[],glsl:`   float a = _luminance(_c1.rgb);
  return vec4(_c0.rgb*a, a*_c0.a);`},{name:"luma",type:"color",inputs:[{type:"float",name:"threshold",default:.5},{type:"float",name:"tolerance",default:.1}],glsl:`   float a = smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb));
   return vec4(_c0.rgb*a, a);`},{name:"thresh",type:"color",inputs:[{type:"float",name:"threshold",default:.5},{type:"float",name:"tolerance",default:.04}],glsl:"   return vec4(vec3(smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb))), _c0.a);"},{name:"color",type:"color",inputs:[{type:"float",name:"r",default:1},{type:"float",name:"g",default:1},{type:"float",name:"b",default:1},{type:"float",name:"a",default:1}],glsl:`   vec4 c = vec4(r, g, b, a);
   vec4 pos = step(0.0, c); // detect whether negative
   // if > 0, return r * _c0
   // if < 0 return (1.0-r) * _c0
   return vec4(mix((1.0-_c0)*abs(c), c*_c0, pos));`},{name:"saturate",type:"color",inputs:[{type:"float",name:"amount",default:2}],glsl:`   const vec3 W = vec3(0.2125, 0.7154, 0.0721);
   vec3 intensity = vec3(dot(_c0.rgb, W));
   return vec4(mix(intensity, _c0.rgb, amount), _c0.a);`},{name:"hue",type:"color",inputs:[{type:"float",name:"hue",default:.4}],glsl:`   vec3 c = _rgbToHsv(_c0.rgb);
   c.r += hue;
   //  c.r = fract(c.r);
   return vec4(_hsvToRgb(c), _c0.a);`},{name:"colorama",type:"color",inputs:[{type:"float",name:"amount",default:.005}],glsl:`   vec3 c = _rgbToHsv(_c0.rgb);
   c += vec3(amount);
   c = _hsvToRgb(c);
   c = fract(c);
   return vec4(c, _c0.a);`},{name:"prev",type:"src",inputs:[],glsl:"   return texture2D(prevBuffer, fract(_st));"},{name:"sum",type:"color",inputs:[{type:"vec4",name:"scale",default:1}],glsl:`   vec4 v = _c0 * s;
   return v.r + v.g + v.b + v.a;
   }
   float sum(vec2 _st, vec4 s) { // vec4 is not a typo, because argument type is not overloaded
   vec2 v = _st.xy * s.xy;
   return v.x + v.y;`},{name:"r",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.r * scale + offset);"},{name:"g",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.g * scale + offset);"},{name:"b",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.b * scale + offset);"},{name:"a",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.a * scale + offset);"}];class GeneratorFactory{constructor({defaultUniforms:b,defaultOutput:d,extendTransforms:m=[],changeListener:S=()=>{}}={}){this.defaultOutput=d,this.defaultUniforms=b,this.changeListener=S,this.extendTransforms=m,this.generators={},this.init()}init(){const b=glslFunctions();return this.glslTransforms={},this.generators=Object.entries(this.generators).reduce((d,[m,S])=>(this.changeListener({type:"remove",synth:this,method:m}),d),{}),this.sourceClass=class extends GlslSource{},Array.isArray(this.extendTransforms)?b.concat(this.extendTransforms):typeof this.extendTransforms=="object"&&this.extendTransforms.type&&b.push(this.extendTransforms),b.map(d=>this.setFunction(d))}_addMethod(b,d){const m=this;if(this.glslTransforms[b]=d,d.type==="src"){const S=(...I)=>new this.sourceClass({name:b,transform:d,userArgs:I,defaultOutput:this.defaultOutput,defaultUniforms:this.defaultUniforms,synth:m});return this.generators[b]=S,this.changeListener({type:"add",synth:this,method:b}),S}else this.sourceClass.prototype[b]=function(...S){return this.transforms.push({name:b,transform:d,userArgs:S,synth:m}),this}}setFunction(b){var d=processGlsl(b);d&&this._addMethod(b.name,d)}}const typeLookup={src:{returnType:"vec4",args:["vec2 _st"]},coord:{returnType:"vec2",args:["vec2 _st"]},color:{returnType:"vec4",args:["vec4 _c0"]},combine:{returnType:"vec4",args:["vec4 _c0","vec4 _c1"]},combineCoord:{returnType:"vec2",args:["vec2 _st","vec4 _c0"]}};function processGlsl(T){let b=typeLookup[T.type];if(b){let d=b.args.map(ae=>ae).join(", "),m=T.inputs.map(ae=>`${ae.type} ${ae.name}`).join(", "),S=`${d}${m.length>0?", "+m:""}`,I=`
  ${b.returnType} ${T.name}(${S}) {
      ${T.glsl}
  }
`;return(T.type==="combine"||T.type==="combineCoord")&&T.inputs.unshift({name:"color",type:"vec4"}),Object.assign({},T,{glsl:I})}else console.warn(`type ${T.type} not recognized`,T)}var regl$2={exports:{}},regl$1=regl$2.exports,hasRequiredRegl;function requireRegl(){return hasRequiredRegl||(hasRequiredRegl=1,function(T,b){(function(d,m){T.exports=m()})(regl$1,function(){var d=function(f){return f instanceof Uint8Array||f instanceof Uint16Array||f instanceof Uint32Array||f instanceof Int8Array||f instanceof Int16Array||f instanceof Int32Array||f instanceof Float32Array||f instanceof Float64Array||f instanceof Uint8ClampedArray},m=function(f,L){for(var z=Object.keys(L),re=0;re<z.length;++re)f[z[re]]=L[z[re]];return f},S=`
`;function I(f){return typeof atob<"u"?atob(f):"base64:"+f}function ae(f){var L=new Error("(regl) "+f);throw console.error(L),L}function Q(f,L){f||ae(L)}function he(f){return f?": "+f:""}function ee(f,L,z){f in L||ae("unknown parameter ("+f+")"+he(z)+". possible values: "+Object.keys(L).join())}function j(f,L){d(f)||ae("invalid parameter type"+he(L)+". must be a typed array")}function se(f,L){switch(L){case"number":return typeof f=="number";case"object":return typeof f=="object";case"string":return typeof f=="string";case"boolean":return typeof f=="boolean";case"function":return typeof f=="function";case"undefined":return typeof f>"u";case"symbol":return typeof f=="symbol"}}function G(f,L,z){se(f,L)||ae("invalid parameter type"+he(z)+". expected "+L+", got "+typeof f)}function fe(f,L){f>=0&&(f|0)===f||ae("invalid parameter type, ("+f+")"+he(L)+". must be a nonnegative integer")}function ve(f,L,z){L.indexOf(f)<0&&ae("invalid value"+he(z)+". must be one of: "+L)}var Ge=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function qe(f){Object.keys(f).forEach(function(L){Ge.indexOf(L)<0&&ae('invalid regl constructor argument "'+L+'". must be one of '+Ge)})}function q(f,L){for(f=f+"";f.length<L;)f=" "+f;return f}function A(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function U(f,L){this.number=f,this.line=L,this.errors=[]}function h(f,L,z){this.file=f,this.line=L,this.message=z}function _(){var f=new Error,L=(f.stack||f).toString(),z=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(L);if(z)return z[1];var re=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(L);return re?re[1]:"unknown"}function D(){var f=new Error,L=(f.stack||f).toString(),z=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(L);if(z)return z[1];var re=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(L);return re?re[1]:"unknown"}function W(f,L){var z=f.split(`
`),re=1,_e=0,pe={unknown:new A,0:new A};pe.unknown.name=pe[0].name=L||_(),pe.unknown.lines.push(new U(0,""));for(var ye=0;ye<z.length;++ye){var Fe=z[ye],Ie=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Fe);if(Ie)switch(Ie[1]){case"line":var Be=/(\d+)(\s+\d+)?/.exec(Ie[2]);Be&&(re=Be[1]|0,Be[2]&&(_e=Be[2]|0,_e in pe||(pe[_e]=new A)));break;case"define":var Le=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Ie[2]);Le&&(pe[_e].name=Le[1]?I(Le[2]):Le[2]);break}pe[_e].lines.push(new U(re++,Fe))}return Object.keys(pe).forEach(function(ze){var Xe=pe[ze];Xe.lines.forEach(function(Ne){Xe.index[Ne.number]=Ne})}),pe}function ie(f){var L=[];return f.split(`
`).forEach(function(z){if(!(z.length<5)){var re=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(z);re?L.push(new h(re[1]|0,re[2]|0,re[3].trim())):z.length>0&&L.push(new h("unknown",0,z))}}),L}function me(f,L){L.forEach(function(z){var re=f[z.file];if(re){var _e=re.index[z.line];if(_e){_e.errors.push(z),re.hasErrors=!0;return}}f.unknown.hasErrors=!0,f.unknown.lines[0].errors.push(z)})}function Te(f,L,z,re,_e){if(!f.getShaderParameter(L,f.COMPILE_STATUS)){var pe=f.getShaderInfoLog(L),ye=re===f.FRAGMENT_SHADER?"fragment":"vertex";be(z,"string",ye+" shader source must be a string",_e);var Fe=W(z,_e),Ie=ie(pe);me(Fe,Ie),Object.keys(Fe).forEach(function(Be){var Le=Fe[Be];if(!Le.hasErrors)return;var ze=[""],Xe=[""];function Ne(He,e){ze.push(He),Xe.push(e||"")}Ne("file number "+Be+": "+Le.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Le.lines.forEach(function(He){if(He.errors.length>0){Ne(q(He.number,4)+"|  ","background-color:yellow; font-weight:bold"),Ne(He.line+S,"color:red; background-color:yellow; font-weight:bold");var e=0;He.errors.forEach(function(t){var r=t.message,n=/^\s*'(.*)'\s*:\s*(.*)$/.exec(r);if(n){var i=n[1];switch(r=n[2],i){case"assign":i="=";break}e=Math.max(He.line.indexOf(i,e),0)}else e=0;Ne(q("| ",6)),Ne(q("^^^",e+3)+S,"font-weight:bold"),Ne(q("| ",6)),Ne(r+S,"font-weight:bold")}),Ne(q("| ",6)+S)}else Ne(q(He.number,4)+"|  "),Ne(He.line+S,"color:red")}),typeof document<"u"&&!window.chrome?(Xe[0]=ze.join("%c"),console.log.apply(console,Xe)):console.log(ze.join(""))}),Q.raise("Error compiling "+ye+" shader, "+Fe[0].name)}}function ke(f,L,z,re,_e){if(!f.getProgramParameter(L,f.LINK_STATUS)){var pe=f.getProgramInfoLog(L),ye=W(z,_e),Fe=W(re,_e),Ie='Error linking program with vertex shader, "'+Fe[0].name+'", and fragment shader "'+ye[0].name+'"';typeof document<"u"?console.log("%c"+Ie+S+"%c"+pe,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Ie+S+pe),Q.raise(Ie)}}function We(f){f._commandRef=_()}function C(f,L,z,re){We(f);function _e(Ie){return Ie?re.id(Ie):0}f._fragId=_e(f.static.frag),f._vertId=_e(f.static.vert);function pe(Ie,Be){Object.keys(Be).forEach(function(Le){Ie[re.id(Le)]=!0})}var ye=f._uniformSet={};pe(ye,L.static),pe(ye,L.dynamic);var Fe=f._attributeSet={};pe(Fe,z.static),pe(Fe,z.dynamic),f._hasCount="count"in f.static||"count"in f.dynamic||"elements"in f.static||"elements"in f.dynamic}function E(f,L){var z=D();ae(f+" in command "+(L||_())+(z==="unknown"?"":" called from "+z))}function p(f,L,z){f||E(L,z||_())}function Z(f,L,z,re){f in L||E("unknown parameter ("+f+")"+he(z)+". possible values: "+Object.keys(L).join(),re||_())}function be(f,L,z,re){se(f,L)||E("invalid parameter type"+he(z)+". expected "+L+", got "+typeof f,re||_())}function Pe(f){f()}function $e(f,L,z){f.texture?ve(f.texture._texture.internalformat,L,"unsupported texture format for attachment"):ve(f.renderbuffer._renderbuffer.format,z,"unsupported renderbuffer format for attachment")}var Ve=33071,Ke=9728,Je=9984,at=9985,Rt=9986,st=9987,ft=5120,tt=5121,pt=5122,Ct=5123,Ht=5124,ut=5125,Mt=5126,Vt=32819,ar=32820,Sr=33635,fr=34042,$t=36193,Pt={};Pt[ft]=Pt[tt]=1,Pt[pt]=Pt[Ct]=Pt[$t]=Pt[Sr]=Pt[Vt]=Pt[ar]=2,Pt[Ht]=Pt[ut]=Pt[Mt]=Pt[fr]=4;function nn(f,L){return f===ar||f===Vt||f===Sr?2:f===fr?4:Pt[f]*L}function _t(f){return!(f&f-1)&&!!f}function ri(f,L,z){var re,_e=L.width,pe=L.height,ye=L.channels;Q(_e>0&&_e<=z.maxTextureSize&&pe>0&&pe<=z.maxTextureSize,"invalid texture shape"),(f.wrapS!==Ve||f.wrapT!==Ve)&&Q(_t(_e)&&_t(pe),"incompatible wrap mode for texture, both width and height must be power of 2"),L.mipmask===1?_e!==1&&pe!==1&&Q(f.minFilter!==Je&&f.minFilter!==Rt&&f.minFilter!==at&&f.minFilter!==st,"min filter requires mipmap"):(Q(_t(_e)&&_t(pe),"texture must be a square power of 2 to support mipmapping"),Q(L.mipmask===(_e<<1)-1,"missing or incomplete mipmap data")),L.type===Mt&&(z.extensions.indexOf("oes_texture_float_linear")<0&&Q(f.minFilter===Ke&&f.magFilter===Ke,"filter not supported, must enable oes_texture_float_linear"),Q(!f.genMipmaps,"mipmap generation not supported with float textures"));var Fe=L.images;for(re=0;re<16;++re)if(Fe[re]){var Ie=_e>>re,Be=pe>>re;Q(L.mipmask&1<<re,"missing mipmap data");var Le=Fe[re];if(Q(Le.width===Ie&&Le.height===Be,"invalid shape for mip images"),Q(Le.format===L.format&&Le.internalformat===L.internalformat&&Le.type===L.type,"incompatible type for mip image"),!Le.compressed)if(Le.data){var ze=Math.ceil(nn(Le.type,ye)*Ie/Le.unpackAlignment)*Le.unpackAlignment;Q(Le.data.byteLength===ze*Be,"invalid data for image, buffer size is inconsistent with image format")}else Le.element||Le.copy}else f.genMipmaps||Q((L.mipmask&1<<re)===0,"extra mipmap data");L.compressed&&Q(!f.genMipmaps,"mipmap generation for compressed images not supported")}function qo(f,L,z,re){var _e=f.width,pe=f.height,ye=f.channels;Q(_e>0&&_e<=re.maxTextureSize&&pe>0&&pe<=re.maxTextureSize,"invalid texture shape"),Q(_e===pe,"cube map must be square"),Q(L.wrapS===Ve&&L.wrapT===Ve,"wrap mode not supported by cube map");for(var Fe=0;Fe<z.length;++Fe){var Ie=z[Fe];Q(Ie.width===_e&&Ie.height===pe,"inconsistent cube map face shape"),L.genMipmaps&&(Q(!Ie.compressed,"can not generate mipmap for compressed textures"),Q(Ie.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Be=Ie.images,Le=0;Le<16;++Le){var ze=Be[Le];if(ze){var Xe=_e>>Le,Ne=pe>>Le;Q(Ie.mipmask&1<<Le,"missing mipmap data"),Q(ze.width===Xe&&ze.height===Ne,"invalid shape for mip images"),Q(ze.format===f.format&&ze.internalformat===f.internalformat&&ze.type===f.type,"incompatible type for mip image"),ze.compressed||(ze.data?Q(ze.data.byteLength===Xe*Ne*Math.max(nn(ze.type,ye),ze.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):ze.element||ze.copy)}}}}var M=m(Q,{optional:Pe,raise:ae,commandRaise:E,command:p,parameter:ee,commandParameter:Z,constructor:qe,type:G,commandType:be,isTypedArray:j,nni:fe,oneOf:ve,shaderError:Te,linkError:ke,callSite:D,saveCommandRef:We,saveDrawInfo:C,framebufferFormat:$e,guessCommand:_,texture2D:ri,textureCube:qo}),Za=0,Uo=0,fa=5,an=6;function Yr(f,L){this.id=Za++,this.type=f,this.data=L}function Kr(f){return f.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function jt(f){if(f.length===0)return[];var L=f.charAt(0),z=f.charAt(f.length-1);if(f.length>1&&L===z&&(L==='"'||L==="'"))return['"'+Kr(f.substr(1,f.length-2))+'"'];var re=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(f);if(re)return jt(f.substr(0,re.index)).concat(jt(re[1])).concat(jt(f.substr(re.index+re[0].length)));var _e=f.split(".");if(_e.length===1)return['"'+Kr(f)+'"'];for(var pe=[],ye=0;ye<_e.length;++ye)pe=pe.concat(jt(_e[ye]));return pe}function on(f){return"["+jt(f).join("][")+"]"}function Vr(f,L){return new Yr(f,on(L+""))}function Mn(f){return typeof f=="function"&&!f._reglType||f instanceof Yr}function Fn(f,L){if(typeof f=="function")return new Yr(Uo,f);if(typeof f=="number"||typeof f=="boolean")return new Yr(fa,f);if(Array.isArray(f))return new Yr(an,f.map((z,re)=>Fn(z,L+"["+re+"]")));if(f instanceof Yr)return f;M(!1,"invalid option type in uniform "+L)}var nr={DynamicVariable:Yr,define:Vr,isDynamic:Mn,unbox:Fn,accessor:on},ca={next:typeof requestAnimationFrame=="function"?function(f){return requestAnimationFrame(f)}:function(f){return setTimeout(f,16)},cancel:typeof cancelAnimationFrame=="function"?function(f){return cancelAnimationFrame(f)}:clearTimeout},At=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Ja(){var f={"":0},L=[""];return{id:function(z){var re=f[z];return re||(re=f[z]=L.length,L.push(z),re)},str:function(z){return L[z]}}}function ht(f,L,z){var re=document.createElement("canvas");m(re.style,{border:0,margin:0,padding:0,top:0,left:0}),f.appendChild(re),f===document.body&&(re.style.position="absolute",m(f.style,{margin:0,padding:0}));function _e(){var Fe=window.innerWidth,Ie=window.innerHeight;if(f!==document.body){var Be=f.getBoundingClientRect();Fe=Be.right-Be.left,Ie=Be.bottom-Be.top}re.width=z*Fe,re.height=z*Ie,m(re.style,{width:Fe+"px",height:Ie+"px"})}var pe;f!==document.body&&typeof ResizeObserver=="function"?(pe=new ResizeObserver(function(){setTimeout(_e)}),pe.observe(f)):window.addEventListener("resize",_e,!1);function ye(){pe?pe.disconnect():window.removeEventListener("resize",_e),f.removeChild(re)}return _e(),{canvas:re,onDestroy:ye}}function sn(f,L){function z(re){try{return f.getContext(re,L)}catch{return null}}return z("webgl")||z("experimental-webgl")||z("webgl-experimental")}function cr(f){return typeof f.nodeName=="string"&&typeof f.appendChild=="function"&&typeof f.getBoundingClientRect=="function"}function Qt(f){return typeof f.drawArrays=="function"||typeof f.drawElements=="function"}function Kt(f){return typeof f=="string"?f.split():(M(Array.isArray(f),"invalid extension array"),f)}function _r(f){return typeof f=="string"?(M(typeof document<"u","not supported outside of DOM"),document.querySelector(f)):f}function wr(f){var L=f||{},z,re,_e,pe,ye={},Fe=[],Ie=[],Be=typeof window>"u"?1:window.devicePixelRatio,Le=!1,ze=function(He){He&&M.raise(He)},Xe=function(){};if(typeof L=="string"?(M(typeof document<"u","selector queries only supported in DOM enviroments"),z=document.querySelector(L),M(z,"invalid query string for element")):typeof L=="object"?cr(L)?z=L:Qt(L)?(pe=L,_e=pe.canvas):(M.constructor(L),"gl"in L?pe=L.gl:"canvas"in L?_e=_r(L.canvas):"container"in L&&(re=_r(L.container)),"attributes"in L&&(ye=L.attributes,M.type(ye,"object","invalid context attributes")),"extensions"in L&&(Fe=Kt(L.extensions)),"optionalExtensions"in L&&(Ie=Kt(L.optionalExtensions)),"onDone"in L&&(M.type(L.onDone,"function","invalid or missing onDone callback"),ze=L.onDone),"profile"in L&&(Le=!!L.profile),"pixelRatio"in L&&(Be=+L.pixelRatio,M(Be>0,"invalid pixel ratio"))):M.raise("invalid arguments to regl"),z&&(z.nodeName.toLowerCase()==="canvas"?_e=z:re=z),!pe){if(!_e){M(typeof document<"u","must manually specify webgl context outside of DOM environments");var Ne=ht(re||document.body,ze,Be);if(!Ne)return null;_e=Ne.canvas,Xe=Ne.onDestroy}ye.premultipliedAlpha===void 0&&(ye.premultipliedAlpha=!0),pe=sn(_e,ye)}return pe?{gl:pe,canvas:_e,container:re,extensions:Fe,optionalExtensions:Ie,pixelRatio:Be,profile:Le,onDone:ze,onDestroy:Xe}:(Xe(),ze("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Pr(f,L){var z={};function re(ye){M.type(ye,"string","extension name must be string");var Fe=ye.toLowerCase(),Ie;try{Ie=z[Fe]=f.getExtension(Fe)}catch{}return!!Ie}for(var _e=0;_e<L.extensions.length;++_e){var pe=L.extensions[_e];if(!re(pe))return L.onDestroy(),L.onDone('"'+pe+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return L.optionalExtensions.forEach(re),{extensions:z,restore:function(){Object.keys(z).forEach(function(ye){if(z[ye]&&!re(ye))throw new Error("(regl): error restoring extension "+ye)})}}}function qt(f,L){for(var z=Array(f),re=0;re<f;++re)z[re]=L(re);return z}var _i=5120,gr=5121,In=5122,da=5123,Br=5124,Xo=5125,Ei=5126;function eo(f){for(var L=16;L<=1<<28;L*=16)if(f<=L)return L;return 0}function Li(f){var L,z;return L=(f>65535)<<4,f>>>=L,z=(f>255)<<3,f>>>=z,L|=z,z=(f>15)<<2,f>>>=z,L|=z,z=(f>3)<<1,f>>>=z,L|=z,L|f>>1}function ln(){var f=qt(8,function(){return[]});function L(pe){var ye=eo(pe),Fe=f[Li(ye)>>2];return Fe.length>0?Fe.pop():new ArrayBuffer(ye)}function z(pe){f[Li(pe.byteLength)>>2].push(pe)}function re(pe,ye){var Fe=null;switch(pe){case _i:Fe=new Int8Array(L(ye),0,ye);break;case gr:Fe=new Uint8Array(L(ye),0,ye);break;case In:Fe=new Int16Array(L(2*ye),0,ye);break;case da:Fe=new Uint16Array(L(2*ye),0,ye);break;case Br:Fe=new Int32Array(L(4*ye),0,ye);break;case Xo:Fe=new Uint32Array(L(4*ye),0,ye);break;case Ei:Fe=new Float32Array(L(4*ye),0,ye);break;default:return null}return Fe.length!==ye?Fe.subarray(0,ye):Fe}function _e(pe){z(pe.buffer)}return{alloc:L,free:z,allocType:re,freeType:_e}}var Bt=ln();Bt.zero=ln();var Nn=3408,to=3410,Dr=3411,jo=3412,Ai=3413,Gr=3414,Hr=3415,ni=33901,ki=33902,Ri=3379,Pn=3386,Oi=34921,$r=36347,ha=36348,Mi=35661,Zt=35660,lt=34930,un=36349,pa=34076,Er=34024,v=7936,X=7937,Re=7938,Ue=35724,xe=34047,Qe=36063,zt=34852,Jt=3553,hr=34067,Fi=34069,Ks=33984,gt=6408,Yo=5126,Ko=5121,Ii=36160,Qr=36053,Vs=36064,$s=16384,va=function(f,L){var z=1;L.ext_texture_filter_anisotropic&&(z=f.getParameter(xe));var re=1,_e=1;L.webgl_draw_buffers&&(re=f.getParameter(zt),_e=f.getParameter(Qe));var pe=!!L.oes_texture_float;if(pe){var ye=f.createTexture();f.bindTexture(Jt,ye),f.texImage2D(Jt,0,gt,1,1,0,gt,Yo,null);var Fe=f.createFramebuffer();if(f.bindFramebuffer(Ii,Fe),f.framebufferTexture2D(Ii,Vs,Jt,ye,0),f.bindTexture(Jt,null),f.checkFramebufferStatus(Ii)!==Qr)pe=!1;else{f.viewport(0,0,1,1),f.clearColor(1,0,0,1),f.clear($s);var Ie=Bt.allocType(Yo,4);f.readPixels(0,0,1,1,gt,Yo,Ie),f.getError()?pe=!1:(f.deleteFramebuffer(Fe),f.deleteTexture(ye),pe=Ie[0]===1),Bt.freeType(Ie)}}var Be=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Le=!0;if(!Be){var ze=f.createTexture(),Xe=Bt.allocType(Ko,36);f.activeTexture(Ks),f.bindTexture(hr,ze),f.texImage2D(Fi,0,gt,3,3,0,gt,Ko,Xe),Bt.freeType(Xe),f.bindTexture(hr,null),f.deleteTexture(ze),Le=!f.getError()}return{colorBits:[f.getParameter(to),f.getParameter(Dr),f.getParameter(jo),f.getParameter(Ai)],depthBits:f.getParameter(Gr),stencilBits:f.getParameter(Hr),subpixelBits:f.getParameter(Nn),extensions:Object.keys(L).filter(function(Ne){return!!L[Ne]}),maxAnisotropic:z,maxDrawbuffers:re,maxColorAttachments:_e,pointSizeDims:f.getParameter(ni),lineWidthDims:f.getParameter(ki),maxViewportDims:f.getParameter(Pn),maxCombinedTextureUnits:f.getParameter(Mi),maxCubeMapSize:f.getParameter(pa),maxRenderbufferSize:f.getParameter(Er),maxTextureUnits:f.getParameter(lt),maxTextureSize:f.getParameter(Ri),maxAttributes:f.getParameter(Oi),maxVertexUniforms:f.getParameter($r),maxVertexTextureUnits:f.getParameter(Zt),maxVaryingVectors:f.getParameter(ha),maxFragmentUniforms:f.getParameter(un),glsl:f.getParameter(Ue),renderer:f.getParameter(X),vendor:f.getParameter(v),version:f.getParameter(Re),readFloat:pe,npotTextureCube:Le}};function Lr(f){return!!f&&typeof f=="object"&&Array.isArray(f.shape)&&Array.isArray(f.stride)&&typeof f.offset=="number"&&f.shape.length===f.stride.length&&(Array.isArray(f.data)||d(f.data))}var Tr=function(f){return Object.keys(f).map(function(L){return f[L]})},Ni={shape:eu,flatten:Jl};function Qs(f,L,z){for(var re=0;re<L;++re)z[re]=f[re]}function Zs(f,L,z,re){for(var _e=0,pe=0;pe<L;++pe)for(var ye=f[pe],Fe=0;Fe<z;++Fe)re[_e++]=ye[Fe]}function Vo(f,L,z,re,_e,pe){for(var ye=pe,Fe=0;Fe<L;++Fe)for(var Ie=f[Fe],Be=0;Be<z;++Be)for(var Le=Ie[Be],ze=0;ze<re;++ze)_e[ye++]=Le[ze]}function $o(f,L,z,re,_e){for(var pe=1,ye=z+1;ye<L.length;++ye)pe*=L[ye];var Fe=L[z];if(L.length-z===4){var Ie=L[z+1],Be=L[z+2],Le=L[z+3];for(ye=0;ye<Fe;++ye)Vo(f[ye],Ie,Be,Le,re,_e),_e+=pe}else for(ye=0;ye<Fe;++ye)$o(f[ye],L,z+1,re,_e),_e+=pe}function Jl(f,L,z,re){var _e=1;if(L.length)for(var pe=0;pe<L.length;++pe)_e*=L[pe];else _e=0;var ye=re||Bt.allocType(z,_e);switch(L.length){case 0:break;case 1:Qs(f,L[0],ye);break;case 2:Zs(f,L[0],L[1],ye);break;case 3:Vo(f,L[0],L[1],L[2],ye,0);break;default:$o(f,L,0,ye,0)}return ye}function eu(f){for(var L=[],z=f;z.length;z=z[0])L.push(z.length);return L}var ro={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},fn=5120,tu=5122,ru=5124,no=5121,ma=5123,nu=5125,iu=5126,au=5126,ii={int8:fn,int16:tu,int32:ru,uint8:no,uint16:ma,uint32:nu,float:iu,float32:au},Qo=35048,Js=35040,io={dynamic:Qo,stream:Js,static:35044},ao=Ni.flatten,Zo=Ni.shape,ga=35044,oo=35040,ya=5121,so=5126,cn=[];cn[5120]=1,cn[5122]=2,cn[5124]=4,cn[5121]=1,cn[5123]=2,cn[5125]=4,cn[5126]=4;function ai(f){return ro[Object.prototype.toString.call(f)]|0}function el(f,L){for(var z=0;z<L.length;++z)f[z]=L[z]}function Jo(f,L,z,re,_e,pe,ye){for(var Fe=0,Ie=0;Ie<z;++Ie)for(var Be=0;Be<re;++Be)f[Fe++]=L[_e*Ie+pe*Be+ye]}function zr(f,L,z,re){var _e=0,pe={};function ye(e){this.id=_e++,this.buffer=f.createBuffer(),this.type=e,this.usage=ga,this.byteLength=0,this.dimension=1,this.dtype=ya,this.persistentData=null,z.profile&&(this.stats={size:0})}ye.prototype.bind=function(){f.bindBuffer(this.type,this.buffer)},ye.prototype.destroy=function(){Xe(this)};var Fe=[];function Ie(e,t){var r=Fe.pop();return r||(r=new ye(e)),r.bind(),ze(r,t,oo,0,1,!1),r}function Be(e){Fe.push(e)}function Le(e,t,r){e.byteLength=t.byteLength,f.bufferData(e.type,t,r)}function ze(e,t,r,n,i,o){var s;if(e.usage=r,Array.isArray(t)){if(e.dtype=n||so,t.length>0){var l;if(Array.isArray(t[0])){s=Zo(t);for(var u=1,c=1;c<s.length;++c)u*=s[c];e.dimension=u,l=ao(t,s,e.dtype),Le(e,l,r),o?e.persistentData=l:Bt.freeType(l)}else if(typeof t[0]=="number"){e.dimension=i;var y=Bt.allocType(e.dtype,t.length);el(y,t),Le(e,y,r),o?e.persistentData=y:Bt.freeType(y)}else d(t[0])?(e.dimension=t[0].length,e.dtype=n||ai(t[0])||so,l=ao(t,[t.length,t[0].length],e.dtype),Le(e,l,r),o?e.persistentData=l:Bt.freeType(l)):M.raise("invalid buffer data")}}else if(d(t))e.dtype=n||ai(t),e.dimension=i,Le(e,t,r),o&&(e.persistentData=new Uint8Array(new Uint8Array(t.buffer)));else if(Lr(t)){s=t.shape;var R=t.stride,B=t.offset,O=0,H=0,ce=0,we=0;s.length===1?(O=s[0],H=1,ce=R[0],we=0):s.length===2?(O=s[0],H=s[1],ce=R[0],we=R[1]):M.raise("invalid shape"),e.dtype=n||ai(t.data)||so,e.dimension=H;var ge=Bt.allocType(e.dtype,O*H);Jo(ge,t.data,O,H,ce,we,B),Le(e,ge,r),o?e.persistentData=ge:Bt.freeType(ge)}else t instanceof ArrayBuffer?(e.dtype=ya,e.dimension=i,Le(e,t,r),o&&(e.persistentData=new Uint8Array(new Uint8Array(t)))):M.raise("invalid buffer data")}function Xe(e){L.bufferCount--,re(e);var t=e.buffer;M(t,"buffer must not be deleted already"),f.deleteBuffer(t),e.buffer=null,delete pe[e.id]}function Ne(e,t,r,n){L.bufferCount++;var i=new ye(t);pe[i.id]=i;function o(u){var c=ga,y=null,R=0,B=0,O=1;return Array.isArray(u)||d(u)||Lr(u)||u instanceof ArrayBuffer?y=u:typeof u=="number"?R=u|0:u&&(M.type(u,"object","buffer arguments must be an object, a number or an array"),"data"in u&&(M(y===null||Array.isArray(y)||d(y)||Lr(y),"invalid data for buffer"),y=u.data),"usage"in u&&(M.parameter(u.usage,io,"invalid buffer usage"),c=io[u.usage]),"type"in u&&(M.parameter(u.type,ii,"invalid buffer type"),B=ii[u.type]),"dimension"in u&&(M.type(u.dimension,"number","invalid dimension"),O=u.dimension|0),"length"in u&&(M.nni(R,"buffer length must be a nonnegative integer"),R=u.length|0)),i.bind(),y?ze(i,y,c,B,O,n):(R&&f.bufferData(i.type,R,c),i.dtype=B||ya,i.usage=c,i.dimension=O,i.byteLength=R),z.profile&&(i.stats.size=i.byteLength*cn[i.dtype]),o}function s(u,c){M(c+u.byteLength<=i.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+u.byteLength+" starting from offset "+c+" to a buffer of size "+i.byteLength),f.bufferSubData(i.type,c,u)}function l(u,c){var y=(c||0)|0,R;if(i.bind(),d(u)||u instanceof ArrayBuffer)s(u,y);else if(Array.isArray(u)){if(u.length>0)if(typeof u[0]=="number"){var B=Bt.allocType(i.dtype,u.length);el(B,u),s(B,y),Bt.freeType(B)}else if(Array.isArray(u[0])||d(u[0])){R=Zo(u);var O=ao(u,R,i.dtype);s(O,y),Bt.freeType(O)}else M.raise("invalid buffer data")}else if(Lr(u)){R=u.shape;var H=u.stride,ce=0,we=0,ge=0,Oe=0;R.length===1?(ce=R[0],we=1,ge=H[0],Oe=0):R.length===2?(ce=R[0],we=R[1],ge=H[0],Oe=H[1]):M.raise("invalid shape");var Ee=Array.isArray(u.data)?i.dtype:ai(u.data),Me=Bt.allocType(Ee,ce*we);Jo(Me,u.data,ce,we,ge,Oe,u.offset),s(Me,y),Bt.freeType(Me)}else M.raise("invalid data for buffer subdata");return o}return r||o(e),o._reglType="buffer",o._buffer=i,o.subdata=l,z.profile&&(o.stats=i.stats),o.destroy=function(){Xe(i)},o}function He(){Tr(pe).forEach(function(e){e.buffer=f.createBuffer(),f.bindBuffer(e.type,e.buffer),f.bufferData(e.type,e.persistentData||e.byteLength,e.usage)})}return z.profile&&(L.getTotalBufferSize=function(){var e=0;return Object.keys(pe).forEach(function(t){e+=pe[t].stats.size}),e}),{create:Ne,createStream:Ie,destroyStream:Be,clear:function(){Tr(pe).forEach(Xe),Fe.forEach(Xe)},getBuffer:function(e){return e&&e._buffer instanceof ye?e._buffer:null},restore:He,_initBuffer:ze}}var ou=0,su=0,es=1,tl=1,Bn=4,ts=4,Cr={points:ou,point:su,lines:es,line:tl,triangles:Bn,triangle:ts,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},lo=0,rs=1,Zr=4,lu=5120,Pi=5121,rl=5122,Bi=5123,ns=5124,Dn=5125,is=34963,uu=35040,fu=35044;function cu(f,L,z,re){var _e={},pe=0,ye={uint8:Pi,uint16:Bi};L.oes_element_index_uint&&(ye.uint32=Dn);function Fe(He){this.id=pe++,_e[this.id]=this,this.buffer=He,this.primType=Zr,this.vertCount=0,this.type=0}Fe.prototype.bind=function(){this.buffer.bind()};var Ie=[];function Be(He){var e=Ie.pop();return e||(e=new Fe(z.create(null,is,!0,!1)._buffer)),ze(e,He,uu,-1,-1,0,0),e}function Le(He){Ie.push(He)}function ze(He,e,t,r,n,i,o){He.buffer.bind();var s;if(e){var l=o;!o&&(!d(e)||Lr(e)&&!d(e.data))&&(l=L.oes_element_index_uint?Dn:Bi),z._initBuffer(He.buffer,e,t,l,3)}else f.bufferData(is,i,t),He.buffer.dtype=s||Pi,He.buffer.usage=t,He.buffer.dimension=3,He.buffer.byteLength=i;if(s=o,!o){switch(He.buffer.dtype){case Pi:case lu:s=Pi;break;case Bi:case rl:s=Bi;break;case Dn:case ns:s=Dn;break;default:M.raise("unsupported type for element array")}He.buffer.dtype=s}He.type=s,M(s!==Dn||!!L.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var u=n;u<0&&(u=He.buffer.byteLength,s===Bi?u>>=1:s===Dn&&(u>>=2)),He.vertCount=u;var c=r;if(r<0){c=Zr;var y=He.buffer.dimension;y===1&&(c=lo),y===2&&(c=rs),y===3&&(c=Zr)}He.primType=c}function Xe(He){re.elementsCount--,M(He.buffer!==null,"must not double destroy elements"),delete _e[He.id],He.buffer.destroy(),He.buffer=null}function Ne(He,e){var t=z.create(null,is,!0),r=new Fe(t._buffer);re.elementsCount++;function n(i){if(!i)t(),r.primType=Zr,r.vertCount=0,r.type=Pi;else if(typeof i=="number")t(i),r.primType=Zr,r.vertCount=i|0,r.type=Pi;else{var o=null,s=fu,l=-1,u=-1,c=0,y=0;Array.isArray(i)||d(i)||Lr(i)?o=i:(M.type(i,"object","invalid arguments for elements"),"data"in i&&(o=i.data,M(Array.isArray(o)||d(o)||Lr(o),"invalid data for element buffer")),"usage"in i&&(M.parameter(i.usage,io,"invalid element buffer usage"),s=io[i.usage]),"primitive"in i&&(M.parameter(i.primitive,Cr,"invalid element buffer primitive"),l=Cr[i.primitive]),"count"in i&&(M(typeof i.count=="number"&&i.count>=0,"invalid vertex count for elements"),u=i.count|0),"type"in i&&(M.parameter(i.type,ye,"invalid buffer type"),y=ye[i.type]),"length"in i?c=i.length|0:(c=u,y===Bi||y===rl?c*=2:(y===Dn||y===ns)&&(c*=4))),ze(r,o,s,l,u,c,y)}return n}return n(He),n._reglType="elements",n._elements=r,n.subdata=function(i,o){return t.subdata(i,o),n},n.destroy=function(){Xe(r)},n}return{create:Ne,createStream:Be,destroyStream:Le,getElements:function(He){return typeof He=="function"&&He._elements instanceof Fe?He._elements:null},clear:function(){Tr(_e).forEach(Xe)}}}var as=new Float32Array(1),du=new Uint32Array(as.buffer),nl=5123;function ba(f){for(var L=Bt.allocType(nl,f.length),z=0;z<f.length;++z)if(isNaN(f[z]))L[z]=65535;else if(f[z]===1/0)L[z]=31744;else if(f[z]===-1/0)L[z]=64512;else{as[0]=f[z];var re=du[0],_e=re>>>31<<15,pe=(re<<1>>>24)-127,ye=re>>13&1023;if(pe<-24)L[z]=_e;else if(pe<-14){var Fe=-14-pe;L[z]=_e+(ye+1024>>Fe)}else pe>15?L[z]=_e+31744:L[z]=_e+(pe+15<<10)+ye}return L}function Ut(f){return Array.isArray(f)||d(f)}var il=function(f){return!(f&f-1)&&!!f},hu=34467,Jr=3553,oi=34067,er=34069,si=6408,uo=6406,Gn=6407,xa=6409,Sa=6410,al=32854,wa=32855,os=36194,pu=32819,vu=32820,ol=33635,sl=34042,ss=6402,Hn=34041,Wr=35904,Di=35906,zn=36193,fo=33776,Mr=33777,dn=33778,Ta=33779,ll=35986,ls=35987,ul=34798,us=35840,co=35841,li=35842,qr=35843,fs=36196,ui=5121,cs=5123,ds=5125,Ca=5126,fl=10242,cl=10243,_a=10497,ho=33071,dl=33648,hs=10240,po=10241,vo=9728,mo=9729,Ar=9984,ps=9985,go=9986,Ea=9987,hl=33170,La=4352,vs=4353,mu=4354,gu=34046,yu=3317,fi=37440,Gi=37441,Hi=37443,yo=37444,ci=33984,pl=[Ar,go,ps,Ea],zi=[0,xa,Sa,Gn,si],ur={};ur[xa]=ur[uo]=ur[ss]=1,ur[Hn]=ur[Sa]=2,ur[Gn]=ur[Wr]=3,ur[si]=ur[Di]=4;function Fr(f){return"[object "+f+"]"}var pr=Fr("HTMLCanvasElement"),hn=Fr("OffscreenCanvas"),pn=Fr("CanvasRenderingContext2D"),Aa=Fr("ImageBitmap"),vl=Fr("HTMLImageElement"),ms=Fr("HTMLVideoElement"),ka=Object.keys(ro).concat([pr,hn,pn,Aa,vl,ms]),di=[];di[ui]=1,di[Ca]=4,di[zn]=2,di[cs]=2,di[ds]=4;var ir=[];ir[al]=2,ir[wa]=2,ir[os]=2,ir[Hn]=4,ir[fo]=.5,ir[Mr]=.5,ir[dn]=1,ir[Ta]=1,ir[ll]=.5,ir[ls]=1,ir[ul]=1,ir[us]=.5,ir[co]=.25,ir[li]=.5,ir[qr]=.25,ir[fs]=.5;function Ra(f){return Array.isArray(f)&&(f.length===0||typeof f[0]=="number")}function ml(f){if(!Array.isArray(f))return!1;var L=f.length;return!(L===0||!Ut(f[0]))}function vn(f){return Object.prototype.toString.call(f)}function gs(f){return vn(f)===pr}function bo(f){return vn(f)===hn}function ys(f){return vn(f)===pn}function Wi(f){return vn(f)===Aa}function xo(f){return vn(f)===vl}function gl(f){return vn(f)===ms}function qi(f){if(!f)return!1;var L=vn(f);return ka.indexOf(L)>=0?!0:Ra(f)||ml(f)||Lr(f)}function yl(f){return ro[Object.prototype.toString.call(f)]|0}function bu(f,L){var z=L.length;switch(f.type){case ui:case cs:case ds:case Ca:var re=Bt.allocType(f.type,z);re.set(L),f.data=re;break;case zn:f.data=ba(L);break;default:M.raise("unsupported texture type, must specify a typed array")}}function bl(f,L){return Bt.allocType(f.type===zn?Ca:f.type,L)}function So(f,L){f.type===zn?(f.data=ba(L),Bt.freeType(L)):f.data=L}function bs(f,L,z,re,_e,pe){for(var ye=f.width,Fe=f.height,Ie=f.channels,Be=ye*Fe*Ie,Le=bl(f,Be),ze=0,Xe=0;Xe<Fe;++Xe)for(var Ne=0;Ne<ye;++Ne)for(var He=0;He<Ie;++He)Le[ze++]=L[z*Ne+re*Xe+_e*He+pe];So(f,Le)}function mn(f,L,z,re,_e,pe){var ye;if(typeof ir[f]<"u"?ye=ir[f]:ye=ur[f]*di[L],pe&&(ye*=6),_e){for(var Fe=0,Ie=z;Ie>=1;)Fe+=ye*Ie*Ie,Ie/=2;return Fe}else return ye*z*re}function Oa(f,L,z,re,_e,pe,ye){var Fe={"don't care":La,"dont care":La,nice:mu,fast:vs},Ie={repeat:_a,clamp:ho,mirror:dl},Be={nearest:vo,linear:mo},Le=m({mipmap:Ea,"nearest mipmap nearest":Ar,"linear mipmap nearest":ps,"nearest mipmap linear":go,"linear mipmap linear":Ea},Be),ze={none:0,browser:yo},Xe={uint8:ui,rgba4:pu,rgb565:ol,"rgb5 a1":vu},Ne={alpha:uo,luminance:xa,"luminance alpha":Sa,rgb:Gn,rgba:si,rgba4:al,"rgb5 a1":wa,rgb565:os},He={};L.ext_srgb&&(Ne.srgb=Wr,Ne.srgba=Di),L.oes_texture_float&&(Xe.float32=Xe.float=Ca),L.oes_texture_half_float&&(Xe.float16=Xe["half float"]=zn),L.webgl_depth_texture&&(m(Ne,{depth:ss,"depth stencil":Hn}),m(Xe,{uint16:cs,uint32:ds,"depth stencil":sl})),L.webgl_compressed_texture_s3tc&&m(He,{"rgb s3tc dxt1":fo,"rgba s3tc dxt1":Mr,"rgba s3tc dxt3":dn,"rgba s3tc dxt5":Ta}),L.webgl_compressed_texture_atc&&m(He,{"rgb atc":ll,"rgba atc explicit alpha":ls,"rgba atc interpolated alpha":ul}),L.webgl_compressed_texture_pvrtc&&m(He,{"rgb pvrtc 4bppv1":us,"rgb pvrtc 2bppv1":co,"rgba pvrtc 4bppv1":li,"rgba pvrtc 2bppv1":qr}),L.webgl_compressed_texture_etc1&&(He["rgb etc1"]=fs);var e=Array.prototype.slice.call(f.getParameter(hu));Object.keys(He).forEach(function(P){var de=He[P];e.indexOf(de)>=0&&(Ne[P]=de)});var t=Object.keys(Ne);z.textureFormats=t;var r=[];Object.keys(Ne).forEach(function(P){var de=Ne[P];r[de]=P});var n=[];Object.keys(Xe).forEach(function(P){var de=Xe[P];n[de]=P});var i=[];Object.keys(Be).forEach(function(P){var de=Be[P];i[de]=P});var o=[];Object.keys(Le).forEach(function(P){var de=Le[P];o[de]=P});var s=[];Object.keys(Ie).forEach(function(P){var de=Ie[P];s[de]=P});var l=t.reduce(function(P,de){var le=Ne[de];return le===xa||le===uo||le===xa||le===Sa||le===ss||le===Hn||L.ext_srgb&&(le===Wr||le===Di)?P[le]=le:le===wa||de.indexOf("rgba")>=0?P[le]=si:P[le]=Gn,P},{});function u(){this.internalformat=si,this.format=si,this.type=ui,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=yo,this.width=0,this.height=0,this.channels=0}function c(P,de){P.internalformat=de.internalformat,P.format=de.format,P.type=de.type,P.compressed=de.compressed,P.premultiplyAlpha=de.premultiplyAlpha,P.flipY=de.flipY,P.unpackAlignment=de.unpackAlignment,P.colorSpace=de.colorSpace,P.width=de.width,P.height=de.height,P.channels=de.channels}function y(P,de){if(!(typeof de!="object"||!de)){if("premultiplyAlpha"in de&&(M.type(de.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),P.premultiplyAlpha=de.premultiplyAlpha),"flipY"in de&&(M.type(de.flipY,"boolean","invalid texture flip"),P.flipY=de.flipY),"alignment"in de&&(M.oneOf(de.alignment,[1,2,4,8],"invalid texture unpack alignment"),P.unpackAlignment=de.alignment),"colorSpace"in de&&(M.parameter(de.colorSpace,ze,"invalid colorSpace"),P.colorSpace=ze[de.colorSpace]),"type"in de){var le=de.type;M(L.oes_texture_float||!(le==="float"||le==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),M(L.oes_texture_half_float||!(le==="half float"||le==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),M(L.webgl_depth_texture||!(le==="uint16"||le==="uint32"||le==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),M.parameter(le,Xe,"invalid texture type"),P.type=Xe[le]}var je=P.width,bt=P.height,F=P.channels,w=!1;"shape"in de?(M(Array.isArray(de.shape)&&de.shape.length>=2,"shape must be an array"),je=de.shape[0],bt=de.shape[1],de.shape.length===3&&(F=de.shape[2],M(F>0&&F<=4,"invalid number of channels"),w=!0),M(je>=0&&je<=z.maxTextureSize,"invalid width"),M(bt>=0&&bt<=z.maxTextureSize,"invalid height")):("radius"in de&&(je=bt=de.radius,M(je>=0&&je<=z.maxTextureSize,"invalid radius")),"width"in de&&(je=de.width,M(je>=0&&je<=z.maxTextureSize,"invalid width")),"height"in de&&(bt=de.height,M(bt>=0&&bt<=z.maxTextureSize,"invalid height")),"channels"in de&&(F=de.channels,M(F>0&&F<=4,"invalid number of channels"),w=!0)),P.width=je|0,P.height=bt|0,P.channels=F|0;var K=!1;if("format"in de){var ne=de.format;M(L.webgl_depth_texture||!(ne==="depth"||ne==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),M.parameter(ne,Ne,"invalid texture format");var oe=P.internalformat=Ne[ne];P.format=l[oe],ne in Xe&&("type"in de||(P.type=Xe[ne])),ne in He&&(P.compressed=!0),K=!0}!w&&K?P.channels=ur[P.format]:w&&!K?P.channels!==zi[P.format]&&(P.format=P.internalformat=zi[P.channels]):K&&w&&M(P.channels===ur[P.format],"number of channels inconsistent with specified format")}}function R(P){f.pixelStorei(fi,P.flipY),f.pixelStorei(Gi,P.premultiplyAlpha),f.pixelStorei(Hi,P.colorSpace),f.pixelStorei(yu,P.unpackAlignment)}function B(){u.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function O(P,de){var le=null;if(qi(de)?le=de:de&&(M.type(de,"object","invalid pixel data type"),y(P,de),"x"in de&&(P.xOffset=de.x|0),"y"in de&&(P.yOffset=de.y|0),qi(de.data)&&(le=de.data)),M(!P.compressed||le instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),de.copy){M(!le,"can not specify copy and data field for the same texture");var je=_e.viewportWidth,bt=_e.viewportHeight;P.width=P.width||je-P.xOffset,P.height=P.height||bt-P.yOffset,P.needsCopy=!0,M(P.xOffset>=0&&P.xOffset<je&&P.yOffset>=0&&P.yOffset<bt&&P.width>0&&P.width<=je&&P.height>0&&P.height<=bt,"copy texture read out of bounds")}else if(!le)P.width=P.width||1,P.height=P.height||1,P.channels=P.channels||4;else if(d(le))P.channels=P.channels||4,P.data=le,!("type"in de)&&P.type===ui&&(P.type=yl(le));else if(Ra(le))P.channels=P.channels||4,bu(P,le),P.alignment=1,P.needsFree=!0;else if(Lr(le)){var F=le.data;!Array.isArray(F)&&P.type===ui&&(P.type=yl(F));var w=le.shape,K=le.stride,ne,oe,$,V,J,N;w.length===3?($=w[2],N=K[2]):(M(w.length===2,"invalid ndarray pixel data, must be 2 or 3D"),$=1,N=1),ne=w[0],oe=w[1],V=K[0],J=K[1],P.alignment=1,P.width=ne,P.height=oe,P.channels=$,P.format=P.internalformat=zi[$],P.needsFree=!0,bs(P,F,V,J,N,le.offset)}else if(gs(le)||bo(le)||ys(le))gs(le)||bo(le)?P.element=le:P.element=le.canvas,P.width=P.element.width,P.height=P.element.height,P.channels=4;else if(Wi(le))P.element=le,P.width=le.width,P.height=le.height,P.channels=4;else if(xo(le))P.element=le,P.width=le.naturalWidth,P.height=le.naturalHeight,P.channels=4;else if(gl(le))P.element=le,P.width=le.videoWidth,P.height=le.videoHeight,P.channels=4;else if(ml(le)){var Y=P.width||le[0].length,k=P.height||le.length,te=P.channels;Ut(le[0][0])?te=te||le[0][0].length:te=te||1;for(var ue=Ni.shape(le),Ce=1,Ae=0;Ae<ue.length;++Ae)Ce*=ue[Ae];var Se=bl(P,Ce);Ni.flatten(le,ue,"",Se),So(P,Se),P.alignment=1,P.width=Y,P.height=k,P.channels=te,P.format=P.internalformat=zi[te],P.needsFree=!0}P.type===Ca?M(z.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):P.type===zn&&M(z.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function H(P,de,le){var je=P.element,bt=P.data,F=P.internalformat,w=P.format,K=P.type,ne=P.width,oe=P.height;R(P),je?f.texImage2D(de,le,w,w,K,je):P.compressed?f.compressedTexImage2D(de,le,F,ne,oe,0,bt):P.needsCopy?(re(),f.copyTexImage2D(de,le,w,P.xOffset,P.yOffset,ne,oe,0)):f.texImage2D(de,le,w,ne,oe,0,w,K,bt||null)}function ce(P,de,le,je,bt){var F=P.element,w=P.data,K=P.internalformat,ne=P.format,oe=P.type,$=P.width,V=P.height;R(P),F?f.texSubImage2D(de,bt,le,je,ne,oe,F):P.compressed?f.compressedTexSubImage2D(de,bt,le,je,K,$,V,w):P.needsCopy?(re(),f.copyTexSubImage2D(de,bt,le,je,P.xOffset,P.yOffset,$,V)):f.texSubImage2D(de,bt,le,je,$,V,ne,oe,w)}var we=[];function ge(){return we.pop()||new B}function Oe(P){P.needsFree&&Bt.freeType(P.data),B.call(P),we.push(P)}function Ee(){u.call(this),this.genMipmaps=!1,this.mipmapHint=La,this.mipmask=0,this.images=Array(16)}function Me(P,de,le){var je=P.images[0]=ge();P.mipmask=1,je.width=P.width=de,je.height=P.height=le,je.channels=P.channels=4}function Ye(P,de){var le=null;if(qi(de))le=P.images[0]=ge(),c(le,P),O(le,de),P.mipmask=1;else if(y(P,de),Array.isArray(de.mipmap))for(var je=de.mipmap,bt=0;bt<je.length;++bt)le=P.images[bt]=ge(),c(le,P),le.width>>=bt,le.height>>=bt,O(le,je[bt]),P.mipmask|=1<<bt;else le=P.images[0]=ge(),c(le,P),O(le,de),P.mipmask=1;c(P,P.images[0]),P.compressed&&(P.internalformat===fo||P.internalformat===Mr||P.internalformat===dn||P.internalformat===Ta)&&M(P.width%4===0&&P.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ze(P,de){for(var le=P.images,je=0;je<le.length;++je){if(!le[je])return;H(le[je],de,je)}}var ct=[];function rt(){var P=ct.pop()||new Ee;u.call(P),P.mipmask=0;for(var de=0;de<16;++de)P.images[de]=null;return P}function kt(P){for(var de=P.images,le=0;le<de.length;++le)de[le]&&Oe(de[le]),de[le]=null;ct.push(P)}function yt(){this.minFilter=vo,this.magFilter=vo,this.wrapS=ho,this.wrapT=ho,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=La}function Ft(P,de){if("min"in de){var le=de.min;M.parameter(le,Le),P.minFilter=Le[le],pl.indexOf(P.minFilter)>=0&&!("faces"in de)&&(P.genMipmaps=!0)}if("mag"in de){var je=de.mag;M.parameter(je,Be),P.magFilter=Be[je]}var bt=P.wrapS,F=P.wrapT;if("wrap"in de){var w=de.wrap;typeof w=="string"?(M.parameter(w,Ie),bt=F=Ie[w]):Array.isArray(w)&&(M.parameter(w[0],Ie),M.parameter(w[1],Ie),bt=Ie[w[0]],F=Ie[w[1]])}else{if("wrapS"in de){var K=de.wrapS;M.parameter(K,Ie),bt=Ie[K]}if("wrapT"in de){var ne=de.wrapT;M.parameter(ne,Ie),F=Ie[ne]}}if(P.wrapS=bt,P.wrapT=F,"anisotropic"in de){var oe=de.anisotropic;M(typeof oe=="number"&&oe>=1&&oe<=z.maxAnisotropic,"aniso samples must be between 1 and "),P.anisotropic=de.anisotropic}if("mipmap"in de){var $=!1;switch(typeof de.mipmap){case"string":M.parameter(de.mipmap,Fe,"invalid mipmap hint"),P.mipmapHint=Fe[de.mipmap],P.genMipmaps=!0,$=!0;break;case"boolean":$=P.genMipmaps=de.mipmap;break;case"object":M(Array.isArray(de.mipmap),"invalid mipmap type"),P.genMipmaps=!1,$=!0;break;default:M.raise("invalid mipmap type")}$&&!("min"in de)&&(P.minFilter=Ar)}}function It(P,de){f.texParameteri(de,po,P.minFilter),f.texParameteri(de,hs,P.magFilter),f.texParameteri(de,fl,P.wrapS),f.texParameteri(de,cl,P.wrapT),L.ext_texture_filter_anisotropic&&f.texParameteri(de,gu,P.anisotropic),P.genMipmaps&&(f.hint(hl,P.mipmapHint),f.generateMipmap(de))}var Et=0,Gt={},Nt=z.maxTextureUnits,Tt=Array(Nt).map(function(){return null});function nt(P){u.call(this),this.mipmask=0,this.internalformat=si,this.id=Et++,this.refCount=1,this.target=P,this.texture=f.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new yt,ye.profile&&(this.stats={size:0})}function Lt(P){f.activeTexture(ci),f.bindTexture(P.target,P.texture)}function St(){var P=Tt[0];P?f.bindTexture(P.target,P.texture):f.bindTexture(Jr,null)}function ot(P){var de=P.texture;M(de,"must not double destroy texture");var le=P.unit,je=P.target;le>=0&&(f.activeTexture(ci+le),f.bindTexture(je,null),Tt[le]=null),f.deleteTexture(de),P.texture=null,P.params=null,P.pixels=null,P.refCount=0,delete Gt[P.id],pe.textureCount--}m(nt.prototype,{bind:function(){var P=this;P.bindCount+=1;var de=P.unit;if(de<0){for(var le=0;le<Nt;++le){var je=Tt[le];if(je){if(je.bindCount>0)continue;je.unit=-1}Tt[le]=P,de=le;break}de>=Nt&&M.raise("insufficient number of texture units"),ye.profile&&pe.maxTextureUnits<de+1&&(pe.maxTextureUnits=de+1),P.unit=de,f.activeTexture(ci+de),f.bindTexture(P.target,P.texture)}return de},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ot(this)}});function mt(P,de){var le=new nt(Jr);Gt[le.id]=le,pe.textureCount++;function je(w,K){var ne=le.texInfo;yt.call(ne);var oe=rt();return typeof w=="number"?typeof K=="number"?Me(oe,w|0,K|0):Me(oe,w|0,w|0):w?(M.type(w,"object","invalid arguments to regl.texture"),Ft(ne,w),Ye(oe,w)):Me(oe,1,1),ne.genMipmaps&&(oe.mipmask=(oe.width<<1)-1),le.mipmask=oe.mipmask,c(le,oe),M.texture2D(ne,oe,z),le.internalformat=oe.internalformat,je.width=oe.width,je.height=oe.height,Lt(le),Ze(oe,Jr),It(ne,Jr),St(),kt(oe),ye.profile&&(le.stats.size=mn(le.internalformat,le.type,oe.width,oe.height,ne.genMipmaps,!1)),je.format=r[le.internalformat],je.type=n[le.type],je.mag=i[ne.magFilter],je.min=o[ne.minFilter],je.wrapS=s[ne.wrapS],je.wrapT=s[ne.wrapT],je}function bt(w,K,ne,oe){M(!!w,"must specify image data");var $=K|0,V=ne|0,J=oe|0,N=ge();return c(N,le),N.width=0,N.height=0,O(N,w),N.width=N.width||(le.width>>J)-$,N.height=N.height||(le.height>>J)-V,M(le.type===N.type&&le.format===N.format&&le.internalformat===N.internalformat,"incompatible format for texture.subimage"),M($>=0&&V>=0&&$+N.width<=le.width&&V+N.height<=le.height,"texture.subimage write out of bounds"),M(le.mipmask&1<<J,"missing mipmap data"),M(N.data||N.element||N.needsCopy,"missing image data"),Lt(le),ce(N,Jr,$,V,J),St(),Oe(N),je}function F(w,K){var ne=w|0,oe=K|0||ne;if(ne===le.width&&oe===le.height)return je;je.width=le.width=ne,je.height=le.height=oe,Lt(le);for(var $=0;le.mipmask>>$;++$){var V=ne>>$,J=oe>>$;if(!V||!J)break;f.texImage2D(Jr,$,le.format,V,J,0,le.format,le.type,null)}return St(),ye.profile&&(le.stats.size=mn(le.internalformat,le.type,ne,oe,!1,!1)),je}return je(P,de),je.subimage=bt,je.resize=F,je._reglType="texture2d",je._texture=le,ye.profile&&(je.stats=le.stats),je.destroy=function(){le.decRef()},je}function vt(P,de,le,je,bt,F){var w=new nt(oi);Gt[w.id]=w,pe.cubeCount++;var K=new Array(6);function ne(V,J,N,Y,k,te){var ue,Ce=w.texInfo;for(yt.call(Ce),ue=0;ue<6;++ue)K[ue]=rt();if(typeof V=="number"||!V){var Ae=V|0||1;for(ue=0;ue<6;++ue)Me(K[ue],Ae,Ae)}else if(typeof V=="object")if(J)Ye(K[0],V),Ye(K[1],J),Ye(K[2],N),Ye(K[3],Y),Ye(K[4],k),Ye(K[5],te);else if(Ft(Ce,V),y(w,V),"faces"in V){var Se=V.faces;for(M(Array.isArray(Se)&&Se.length===6,"cube faces must be a length 6 array"),ue=0;ue<6;++ue)M(typeof Se[ue]=="object"&&!!Se[ue],"invalid input for cube map face"),c(K[ue],w),Ye(K[ue],Se[ue])}else for(ue=0;ue<6;++ue)Ye(K[ue],V);else M.raise("invalid arguments to cube map");for(c(w,K[0]),z.npotTextureCube||M(il(w.width)&&il(w.height),"your browser does not support non power or two texture dimensions"),Ce.genMipmaps?w.mipmask=(K[0].width<<1)-1:w.mipmask=K[0].mipmask,M.textureCube(w,Ce,K,z),w.internalformat=K[0].internalformat,ne.width=K[0].width,ne.height=K[0].height,Lt(w),ue=0;ue<6;++ue)Ze(K[ue],er+ue);for(It(Ce,oi),St(),ye.profile&&(w.stats.size=mn(w.internalformat,w.type,ne.width,ne.height,Ce.genMipmaps,!0)),ne.format=r[w.internalformat],ne.type=n[w.type],ne.mag=i[Ce.magFilter],ne.min=o[Ce.minFilter],ne.wrapS=s[Ce.wrapS],ne.wrapT=s[Ce.wrapT],ue=0;ue<6;++ue)kt(K[ue]);return ne}function oe(V,J,N,Y,k){M(!!J,"must specify image data"),M(typeof V=="number"&&V===(V|0)&&V>=0&&V<6,"invalid face");var te=N|0,ue=Y|0,Ce=k|0,Ae=ge();return c(Ae,w),Ae.width=0,Ae.height=0,O(Ae,J),Ae.width=Ae.width||(w.width>>Ce)-te,Ae.height=Ae.height||(w.height>>Ce)-ue,M(w.type===Ae.type&&w.format===Ae.format&&w.internalformat===Ae.internalformat,"incompatible format for texture.subimage"),M(te>=0&&ue>=0&&te+Ae.width<=w.width&&ue+Ae.height<=w.height,"texture.subimage write out of bounds"),M(w.mipmask&1<<Ce,"missing mipmap data"),M(Ae.data||Ae.element||Ae.needsCopy,"missing image data"),Lt(w),ce(Ae,er+V,te,ue,Ce),St(),Oe(Ae),ne}function $(V){var J=V|0;if(J!==w.width){ne.width=w.width=J,ne.height=w.height=J,Lt(w);for(var N=0;N<6;++N)for(var Y=0;w.mipmask>>Y;++Y)f.texImage2D(er+N,Y,w.format,J>>Y,J>>Y,0,w.format,w.type,null);return St(),ye.profile&&(w.stats.size=mn(w.internalformat,w.type,ne.width,ne.height,!1,!0)),ne}}return ne(P,de,le,je,bt,F),ne.subimage=oe,ne.resize=$,ne._reglType="textureCube",ne._texture=w,ye.profile&&(ne.stats=w.stats),ne.destroy=function(){w.decRef()},ne}function Wt(){for(var P=0;P<Nt;++P)f.activeTexture(ci+P),f.bindTexture(Jr,null),Tt[P]=null;Tr(Gt).forEach(ot),pe.cubeCount=0,pe.textureCount=0}ye.profile&&(pe.getTotalTextureSize=function(){var P=0;return Object.keys(Gt).forEach(function(de){P+=Gt[de].stats.size}),P});function Xt(){for(var P=0;P<Nt;++P){var de=Tt[P];de&&(de.bindCount=0,de.unit=-1,Tt[P]=null)}Tr(Gt).forEach(function(le){le.texture=f.createTexture(),f.bindTexture(le.target,le.texture);for(var je=0;je<32;++je)if((le.mipmask&1<<je)!==0)if(le.target===Jr)f.texImage2D(Jr,je,le.internalformat,le.width>>je,le.height>>je,0,le.internalformat,le.type,null);else for(var bt=0;bt<6;++bt)f.texImage2D(er+bt,je,le.internalformat,le.width>>je,le.height>>je,0,le.internalformat,le.type,null);It(le.texInfo,le.target)})}function Rn(){for(var P=0;P<Nt;++P){var de=Tt[P];de&&(de.bindCount=0,de.unit=-1,Tt[P]=null),f.activeTexture(ci+P),f.bindTexture(Jr,null),f.bindTexture(oi,null)}}return{create2D:mt,createCube:vt,clear:Wt,getTexture:function(P){return null},restore:Xt,refresh:Rn}}var Wn=36161,hi=32854,xs=32855,Ui=36194,Ss=33189,qn=36168,Xi=34041,Un=35907,ji=34836,pi=34842,ws=34843,Ir=[];Ir[hi]=2,Ir[xs]=2,Ir[Ui]=2,Ir[Ss]=2,Ir[qn]=1,Ir[Xi]=4,Ir[Un]=4,Ir[ji]=16,Ir[pi]=8,Ir[ws]=6;function Ts(f,L,z){return Ir[f]*L*z}var xu=function(f,L,z,re,_e){var pe={rgba4:hi,rgb565:Ui,"rgb5 a1":xs,depth:Ss,stencil:qn,"depth stencil":Xi};L.ext_srgb&&(pe.srgba=Un),L.ext_color_buffer_half_float&&(pe.rgba16f=pi,pe.rgb16f=ws),L.webgl_color_buffer_float&&(pe.rgba32f=ji);var ye=[];Object.keys(pe).forEach(function(Ne){var He=pe[Ne];ye[He]=Ne});var Fe=0,Ie={};function Be(Ne){this.id=Fe++,this.refCount=1,this.renderbuffer=Ne,this.format=hi,this.width=0,this.height=0,_e.profile&&(this.stats={size:0})}Be.prototype.decRef=function(){--this.refCount<=0&&Le(this)};function Le(Ne){var He=Ne.renderbuffer;M(He,"must not double destroy renderbuffer"),f.bindRenderbuffer(Wn,null),f.deleteRenderbuffer(He),Ne.renderbuffer=null,Ne.refCount=0,delete Ie[Ne.id],re.renderbufferCount--}function ze(Ne,He){var e=new Be(f.createRenderbuffer());Ie[e.id]=e,re.renderbufferCount++;function t(n,i){var o=0,s=0,l=hi;if(typeof n=="object"&&n){var u=n;if("shape"in u){var c=u.shape;M(Array.isArray(c)&&c.length>=2,"invalid renderbuffer shape"),o=c[0]|0,s=c[1]|0}else"radius"in u&&(o=s=u.radius|0),"width"in u&&(o=u.width|0),"height"in u&&(s=u.height|0);"format"in u&&(M.parameter(u.format,pe,"invalid renderbuffer format"),l=pe[u.format])}else typeof n=="number"?(o=n|0,typeof i=="number"?s=i|0:s=o):n?M.raise("invalid arguments to renderbuffer constructor"):o=s=1;if(M(o>0&&s>0&&o<=z.maxRenderbufferSize&&s<=z.maxRenderbufferSize,"invalid renderbuffer size"),!(o===e.width&&s===e.height&&l===e.format))return t.width=e.width=o,t.height=e.height=s,e.format=l,f.bindRenderbuffer(Wn,e.renderbuffer),f.renderbufferStorage(Wn,l,o,s),M(f.getError()===0,"invalid render buffer format"),_e.profile&&(e.stats.size=Ts(e.format,e.width,e.height)),t.format=ye[e.format],t}function r(n,i){var o=n|0,s=i|0||o;return o===e.width&&s===e.height||(M(o>0&&s>0&&o<=z.maxRenderbufferSize&&s<=z.maxRenderbufferSize,"invalid renderbuffer size"),t.width=e.width=o,t.height=e.height=s,f.bindRenderbuffer(Wn,e.renderbuffer),f.renderbufferStorage(Wn,e.format,o,s),M(f.getError()===0,"invalid render buffer format"),_e.profile&&(e.stats.size=Ts(e.format,e.width,e.height))),t}return t(Ne,He),t.resize=r,t._reglType="renderbuffer",t._renderbuffer=e,_e.profile&&(t.stats=e.stats),t.destroy=function(){e.decRef()},t}_e.profile&&(re.getTotalRenderbufferSize=function(){var Ne=0;return Object.keys(Ie).forEach(function(He){Ne+=Ie[He].stats.size}),Ne});function Xe(){Tr(Ie).forEach(function(Ne){Ne.renderbuffer=f.createRenderbuffer(),f.bindRenderbuffer(Wn,Ne.renderbuffer),f.renderbufferStorage(Wn,Ne.format,Ne.width,Ne.height)}),f.bindRenderbuffer(Wn,null)}return{create:ze,clear:function(){Tr(Ie).forEach(Le)},restore:Xe}},yr=36160,gn=36161,vi=3553,wo=34069,xl=36064,Sl=36096,wl=36128,Tl=33306,br=36053,or=36054,vr=36055,sr=36057,Ma=36061,Su=36193,To=5121,wu=5126,Cl=6407,_l=6408,Cs=6402,El=[Cl,_l],Fa=[];Fa[_l]=4,Fa[Cl]=3;var Co=[];Co[To]=1,Co[wu]=4,Co[Su]=2;var _s=32854,Es=32855,Ll=36194,Al=33189,Ls=36168,As=34041,Ia=35907,Tu=34836,_o=34842,yn=34843,kl=[_s,Es,Ll,Ia,_o,yn,Tu],Yi={};Yi[br]="complete",Yi[or]="incomplete attachment",Yi[sr]="incomplete dimensions",Yi[vr]="incomplete, missing attachment",Yi[Ma]="unsupported";function Rl(f,L,z,re,_e,pe){var ye={cur:null,next:null,dirty:!1,setFBO:null},Fe=["rgba"],Ie=["rgba4","rgb565","rgb5 a1"];L.ext_srgb&&Ie.push("srgba"),L.ext_color_buffer_half_float&&Ie.push("rgba16f","rgb16f"),L.webgl_color_buffer_float&&Ie.push("rgba32f");var Be=["uint8"];L.oes_texture_half_float&&Be.push("half float","float16"),L.oes_texture_float&&Be.push("float","float32");function Le(B,O,H){this.target=B,this.texture=O,this.renderbuffer=H;var ce=0,we=0;O?(ce=O.width,we=O.height):H&&(ce=H.width,we=H.height),this.width=ce,this.height=we}function ze(B){B&&(B.texture&&B.texture._texture.decRef(),B.renderbuffer&&B.renderbuffer._renderbuffer.decRef())}function Xe(B,O,H){if(B)if(B.texture){var ce=B.texture._texture,we=Math.max(1,ce.width),ge=Math.max(1,ce.height);M(we===O&&ge===H,"inconsistent width/height for supplied texture"),ce.refCount+=1}else{var Oe=B.renderbuffer._renderbuffer;M(Oe.width===O&&Oe.height===H,"inconsistent width/height for renderbuffer"),Oe.refCount+=1}}function Ne(B,O){O&&(O.texture?f.framebufferTexture2D(yr,B,O.target,O.texture._texture.texture,0):f.framebufferRenderbuffer(yr,B,gn,O.renderbuffer._renderbuffer.renderbuffer))}function He(B){var O=vi,H=null,ce=null,we=B;typeof B=="object"&&(we=B.data,"target"in B&&(O=B.target|0)),M.type(we,"function","invalid attachment data");var ge=we._reglType;return ge==="texture2d"?(H=we,M(O===vi)):ge==="textureCube"?(H=we,M(O>=wo&&O<wo+6,"invalid cube map target")):ge==="renderbuffer"?(ce=we,O=gn):M.raise("invalid regl object for attachment"),new Le(O,H,ce)}function e(B,O,H,ce,we){if(H){var ge=re.create2D({width:B,height:O,format:ce,type:we});return ge._texture.refCount=0,new Le(vi,ge,null)}else{var Oe=_e.create({width:B,height:O,format:ce});return Oe._renderbuffer.refCount=0,new Le(gn,null,Oe)}}function t(B){return B&&(B.texture||B.renderbuffer)}function r(B,O,H){B&&(B.texture?B.texture.resize(O,H):B.renderbuffer&&B.renderbuffer.resize(O,H),B.width=O,B.height=H)}var n=0,i={};function o(){this.id=n++,i[this.id]=this,this.framebuffer=f.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function s(B){B.colorAttachments.forEach(ze),ze(B.depthAttachment),ze(B.stencilAttachment),ze(B.depthStencilAttachment)}function l(B){var O=B.framebuffer;M(O,"must not double destroy framebuffer"),f.deleteFramebuffer(O),B.framebuffer=null,pe.framebufferCount--,delete i[B.id]}function u(B){var O;f.bindFramebuffer(yr,B.framebuffer);var H=B.colorAttachments;for(O=0;O<H.length;++O)Ne(xl+O,H[O]);for(O=H.length;O<z.maxColorAttachments;++O)f.framebufferTexture2D(yr,xl+O,vi,null,0);f.framebufferTexture2D(yr,Tl,vi,null,0),f.framebufferTexture2D(yr,Sl,vi,null,0),f.framebufferTexture2D(yr,wl,vi,null,0),Ne(Sl,B.depthAttachment),Ne(wl,B.stencilAttachment),Ne(Tl,B.depthStencilAttachment);var ce=f.checkFramebufferStatus(yr);!f.isContextLost()&&ce!==br&&M.raise("framebuffer configuration not supported, status = "+Yi[ce]),f.bindFramebuffer(yr,ye.next?ye.next.framebuffer:null),ye.cur=ye.next,f.getError()}function c(B,O){var H=new o;pe.framebufferCount++;function ce(ge,Oe){var Ee;M(ye.next!==H,"can not update framebuffer which is currently in use");var Me=0,Ye=0,Ze=!0,ct=!0,rt=null,kt=!0,yt="rgba",Ft="uint8",It=1,Et=null,Gt=null,Nt=null,Tt=!1;if(typeof ge=="number")Me=ge|0,Ye=Oe|0||Me;else if(!ge)Me=Ye=1;else{M.type(ge,"object","invalid arguments for framebuffer");var nt=ge;if("shape"in nt){var Lt=nt.shape;M(Array.isArray(Lt)&&Lt.length>=2,"invalid shape for framebuffer"),Me=Lt[0],Ye=Lt[1]}else"radius"in nt&&(Me=Ye=nt.radius),"width"in nt&&(Me=nt.width),"height"in nt&&(Ye=nt.height);("color"in nt||"colors"in nt)&&(rt=nt.color||nt.colors,Array.isArray(rt)&&M(rt.length===1||L.webgl_draw_buffers,"multiple render targets not supported")),rt||("colorCount"in nt&&(It=nt.colorCount|0,M(It>0,"invalid color buffer count")),"colorTexture"in nt&&(kt=!!nt.colorTexture,yt="rgba4"),"colorType"in nt&&(Ft=nt.colorType,kt?(M(L.oes_texture_float||!(Ft==="float"||Ft==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),M(L.oes_texture_half_float||!(Ft==="half float"||Ft==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Ft==="half float"||Ft==="float16"?(M(L.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),yt="rgba16f"):(Ft==="float"||Ft==="float32")&&(M(L.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),yt="rgba32f"),M.oneOf(Ft,Be,"invalid color type")),"colorFormat"in nt&&(yt=nt.colorFormat,Fe.indexOf(yt)>=0?kt=!0:Ie.indexOf(yt)>=0?kt=!1:kt?M.oneOf(nt.colorFormat,Fe,"invalid color format for texture"):M.oneOf(nt.colorFormat,Ie,"invalid color format for renderbuffer"))),("depthTexture"in nt||"depthStencilTexture"in nt)&&(Tt=!!(nt.depthTexture||nt.depthStencilTexture),M(!Tt||L.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in nt&&(typeof nt.depth=="boolean"?Ze=nt.depth:(Et=nt.depth,ct=!1)),"stencil"in nt&&(typeof nt.stencil=="boolean"?ct=nt.stencil:(Gt=nt.stencil,Ze=!1)),"depthStencil"in nt&&(typeof nt.depthStencil=="boolean"?Ze=ct=nt.depthStencil:(Nt=nt.depthStencil,Ze=!1,ct=!1))}var St=null,ot=null,mt=null,vt=null;if(Array.isArray(rt))St=rt.map(He);else if(rt)St=[He(rt)];else for(St=new Array(It),Ee=0;Ee<It;++Ee)St[Ee]=e(Me,Ye,kt,yt,Ft);M(L.webgl_draw_buffers||St.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),M(St.length<=z.maxColorAttachments,"too many color attachments, not supported"),Me=Me||St[0].width,Ye=Ye||St[0].height,Et?ot=He(Et):Ze&&!ct&&(ot=e(Me,Ye,Tt,"depth","uint32")),Gt?mt=He(Gt):ct&&!Ze&&(mt=e(Me,Ye,!1,"stencil","uint8")),Nt?vt=He(Nt):!Et&&!Gt&&ct&&Ze&&(vt=e(Me,Ye,Tt,"depth stencil","depth stencil")),M(!!Et+!!Gt+!!Nt<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Wt=null;for(Ee=0;Ee<St.length;++Ee)if(Xe(St[Ee],Me,Ye),M(!St[Ee]||St[Ee].texture&&El.indexOf(St[Ee].texture._texture.format)>=0||St[Ee].renderbuffer&&kl.indexOf(St[Ee].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ee+" is invalid"),St[Ee]&&St[Ee].texture){var Xt=Fa[St[Ee].texture._texture.format]*Co[St[Ee].texture._texture.type];Wt===null?Wt=Xt:M(Wt===Xt,"all color attachments much have the same number of bits per pixel.")}return Xe(ot,Me,Ye),M(!ot||ot.texture&&ot.texture._texture.format===Cs||ot.renderbuffer&&ot.renderbuffer._renderbuffer.format===Al,"invalid depth attachment for framebuffer object"),Xe(mt,Me,Ye),M(!mt||mt.renderbuffer&&mt.renderbuffer._renderbuffer.format===Ls,"invalid stencil attachment for framebuffer object"),Xe(vt,Me,Ye),M(!vt||vt.texture&&vt.texture._texture.format===As||vt.renderbuffer&&vt.renderbuffer._renderbuffer.format===As,"invalid depth-stencil attachment for framebuffer object"),s(H),H.width=Me,H.height=Ye,H.colorAttachments=St,H.depthAttachment=ot,H.stencilAttachment=mt,H.depthStencilAttachment=vt,ce.color=St.map(t),ce.depth=t(ot),ce.stencil=t(mt),ce.depthStencil=t(vt),ce.width=H.width,ce.height=H.height,u(H),ce}function we(ge,Oe){M(ye.next!==H,"can not resize a framebuffer which is currently in use");var Ee=Math.max(ge|0,1),Me=Math.max(Oe|0||Ee,1);if(Ee===H.width&&Me===H.height)return ce;for(var Ye=H.colorAttachments,Ze=0;Ze<Ye.length;++Ze)r(Ye[Ze],Ee,Me);return r(H.depthAttachment,Ee,Me),r(H.stencilAttachment,Ee,Me),r(H.depthStencilAttachment,Ee,Me),H.width=ce.width=Ee,H.height=ce.height=Me,u(H),ce}return ce(B,O),m(ce,{resize:we,_reglType:"framebuffer",_framebuffer:H,destroy:function(){l(H),s(H)},use:function(ge){ye.setFBO({framebuffer:ce},ge)}})}function y(B){var O=Array(6);function H(we){var ge;M(O.indexOf(ye.next)<0,"can not update framebuffer which is currently in use");var Oe={color:null},Ee=0,Me=null,Ye="rgba",Ze="uint8",ct=1;if(typeof we=="number")Ee=we|0;else if(!we)Ee=1;else{M.type(we,"object","invalid arguments for framebuffer");var rt=we;if("shape"in rt){var kt=rt.shape;M(Array.isArray(kt)&&kt.length>=2,"invalid shape for framebuffer"),M(kt[0]===kt[1],"cube framebuffer must be square"),Ee=kt[0]}else"radius"in rt&&(Ee=rt.radius|0),"width"in rt?(Ee=rt.width|0,"height"in rt&&M(rt.height===Ee,"must be square")):"height"in rt&&(Ee=rt.height|0);("color"in rt||"colors"in rt)&&(Me=rt.color||rt.colors,Array.isArray(Me)&&M(Me.length===1||L.webgl_draw_buffers,"multiple render targets not supported")),Me||("colorCount"in rt&&(ct=rt.colorCount|0,M(ct>0,"invalid color buffer count")),"colorType"in rt&&(M.oneOf(rt.colorType,Be,"invalid color type"),Ze=rt.colorType),"colorFormat"in rt&&(Ye=rt.colorFormat,M.oneOf(rt.colorFormat,Fe,"invalid color format for texture"))),"depth"in rt&&(Oe.depth=rt.depth),"stencil"in rt&&(Oe.stencil=rt.stencil),"depthStencil"in rt&&(Oe.depthStencil=rt.depthStencil)}var yt;if(Me)if(Array.isArray(Me))for(yt=[],ge=0;ge<Me.length;++ge)yt[ge]=Me[ge];else yt=[Me];else{yt=Array(ct);var Ft={radius:Ee,format:Ye,type:Ze};for(ge=0;ge<ct;++ge)yt[ge]=re.createCube(Ft)}for(Oe.color=Array(yt.length),ge=0;ge<yt.length;++ge){var It=yt[ge];M(typeof It=="function"&&It._reglType==="textureCube","invalid cube map"),Ee=Ee||It.width,M(It.width===Ee&&It.height===Ee,"invalid cube map shape"),Oe.color[ge]={target:wo,data:yt[ge]}}for(ge=0;ge<6;++ge){for(var Et=0;Et<yt.length;++Et)Oe.color[Et].target=wo+ge;ge>0&&(Oe.depth=O[0].depth,Oe.stencil=O[0].stencil,Oe.depthStencil=O[0].depthStencil),O[ge]?O[ge](Oe):O[ge]=c(Oe)}return m(H,{width:Ee,height:Ee,color:yt})}function ce(we){var ge,Oe=we|0;if(M(Oe>0&&Oe<=z.maxCubeMapSize,"invalid radius for cube fbo"),Oe===H.width)return H;var Ee=H.color;for(ge=0;ge<Ee.length;++ge)Ee[ge].resize(Oe);for(ge=0;ge<6;++ge)O[ge].resize(Oe);return H.width=H.height=Oe,H}return H(B),m(H,{faces:O,resize:ce,_reglType:"framebufferCube",destroy:function(){O.forEach(function(we){we.destroy()})}})}function R(){ye.cur=null,ye.next=null,ye.dirty=!0,Tr(i).forEach(function(B){B.framebuffer=f.createFramebuffer(),u(B)})}return m(ye,{getFramebuffer:function(B){if(typeof B=="function"&&B._reglType==="framebuffer"){var O=B._framebuffer;if(O instanceof o)return O}return null},create:c,createCube:y,clear:function(){Tr(i).forEach(l)},restore:R})}var kr=5126,Dt=34962;function Rr(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=kr,this.offset=0,this.stride=0,this.divisor=0}function Xn(f,L,z,re,_e){for(var pe=z.maxAttributes,ye=new Array(pe),Fe=0;Fe<pe;++Fe)ye[Fe]=new Rr;var Ie=0,Be={},Le={Record:Rr,scope:{},state:ye,currentVAO:null,targetVAO:null,restore:Xe()?i:function(){},createVAO:o,getVAO:He,destroyBuffer:ze,setVAO:Xe()?e:t,clear:Xe()?r:function(){}};function ze(s){for(var l=0;l<ye.length;++l){var u=ye[l];u.buffer===s&&(f.disableVertexAttribArray(l),u.buffer=null)}}function Xe(){return L.oes_vertex_array_object}function Ne(){return L.angle_instanced_arrays}function He(s){return typeof s=="function"&&s._vao?s._vao:null}function e(s){if(s!==Le.currentVAO){var l=Xe();s?l.bindVertexArrayOES(s.vao):l.bindVertexArrayOES(null),Le.currentVAO=s}}function t(s){if(s!==Le.currentVAO){if(s)s.bindAttrs();else for(var l=Ne(),u=0;u<ye.length;++u){var c=ye[u];c.buffer?(f.enableVertexAttribArray(u),f.vertexAttribPointer(u,c.size,c.type,c.normalized,c.stride,c.offfset),l&&c.divisor&&l.vertexAttribDivisorANGLE(u,c.divisor)):(f.disableVertexAttribArray(u),f.vertexAttrib4f(u,c.x,c.y,c.z,c.w))}Le.currentVAO=s}}function r(){Tr(Be).forEach(function(s){s.destroy()})}function n(){this.id=++Ie,this.attributes=[];var s=Xe();s?this.vao=s.createVertexArrayOES():this.vao=null,Be[this.id]=this,this.buffers=[]}n.prototype.bindAttrs=function(){for(var s=Ne(),l=this.attributes,u=0;u<l.length;++u){var c=l[u];c.buffer?(f.enableVertexAttribArray(u),f.bindBuffer(Dt,c.buffer.buffer),f.vertexAttribPointer(u,c.size,c.type,c.normalized,c.stride,c.offset),s&&c.divisor&&s.vertexAttribDivisorANGLE(u,c.divisor)):(f.disableVertexAttribArray(u),f.vertexAttrib4f(u,c.x,c.y,c.z,c.w))}for(var y=l.length;y<pe;++y)f.disableVertexAttribArray(y)},n.prototype.refresh=function(){var s=Xe();s&&(s.bindVertexArrayOES(this.vao),this.bindAttrs(),Le.currentVAO=this)},n.prototype.destroy=function(){if(this.vao){var s=Xe();this===Le.currentVAO&&(Le.currentVAO=null,s.bindVertexArrayOES(null)),s.deleteVertexArrayOES(this.vao),this.vao=null}Be[this.id]&&(delete Be[this.id],re.vaoCount-=1)};function i(){var s=Xe();s&&Tr(Be).forEach(function(l){l.refresh()})}function o(s){var l=new n;re.vaoCount+=1;function u(c){M(Array.isArray(c),"arguments to vertex array constructor must be an array"),M(c.length<pe,"too many attributes"),M(c.length>0,"must specify at least one attribute");var y={},R=l.attributes;R.length=c.length;for(var B=0;B<c.length;++B){var O=c[B],H=R[B]=new Rr,ce=O.data||O;if(Array.isArray(ce)||d(ce)||Lr(ce)){var we;l.buffers[B]&&(we=l.buffers[B],d(ce)&&we._buffer.byteLength>=ce.byteLength?we.subdata(ce):(we.destroy(),l.buffers[B]=null)),l.buffers[B]||(we=l.buffers[B]=_e.create(O,Dt,!1,!0)),H.buffer=_e.getBuffer(we),H.size=H.buffer.dimension|0,H.normalized=!1,H.type=H.buffer.dtype,H.offset=0,H.stride=0,H.divisor=0,H.state=1,y[B]=1}else _e.getBuffer(O)?(H.buffer=_e.getBuffer(O),H.size=H.buffer.dimension|0,H.normalized=!1,H.type=H.buffer.dtype,H.offset=0,H.stride=0,H.divisor=0,H.state=1):_e.getBuffer(O.buffer)?(H.buffer=_e.getBuffer(O.buffer),H.size=(+O.size||H.buffer.dimension)|0,H.normalized=!!O.normalized||!1,"type"in O?(M.parameter(O.type,ii,"invalid buffer type"),H.type=ii[O.type]):H.type=H.buffer.dtype,H.offset=(O.offset||0)|0,H.stride=(O.stride||0)|0,H.divisor=(O.divisor||0)|0,H.state=1,M(H.size>=1&&H.size<=4,"size must be between 1 and 4"),M(H.offset>=0,"invalid offset"),M(H.stride>=0&&H.stride<=255,"stride must be between 0 and 255"),M(H.divisor>=0,"divisor must be positive"),M(!H.divisor||!!L.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in O?(M(B>0,"first attribute must not be a constant"),H.x=+O.x||0,H.y=+O.y||0,H.z=+O.z||0,H.w=+O.w||0,H.state=2):M(!1,"invalid attribute spec for location "+B)}for(var ge=0;ge<l.buffers.length;++ge)!y[ge]&&l.buffers[ge]&&(l.buffers[ge].destroy(),l.buffers[ge]=null);return l.refresh(),u}return u.destroy=function(){for(var c=0;c<l.buffers.length;++c)l.buffers[c]&&l.buffers[c].destroy();l.buffers.length=0,l.destroy()},u._vao=l,u._reglType="vao",u(s)}return Le}var bn=35632,Ol=35633,ks=35718,Ml=35721;function Cu(f,L,z,re){var _e={},pe={};function ye(e,t,r,n){this.name=e,this.id=t,this.location=r,this.info=n}function Fe(e,t){for(var r=0;r<e.length;++r)if(e[r].id===t.id){e[r].location=t.location;return}e.push(t)}function Ie(e,t,r){var n=e===bn?_e:pe,i=n[t];if(!i){var o=L.str(t);i=f.createShader(e),f.shaderSource(i,o),f.compileShader(i),M.shaderError(f,i,o,e,r),n[t]=i}return i}var Be={},Le=[],ze=0;function Xe(e,t){this.id=ze++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,re.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Ne(e,t,r){var n,i,o=Ie(bn,e.fragId),s=Ie(Ol,e.vertId),l=e.program=f.createProgram();if(f.attachShader(l,o),f.attachShader(l,s),r)for(n=0;n<r.length;++n){var u=r[n];f.bindAttribLocation(l,u[0],u[1])}f.linkProgram(l),M.linkError(f,l,L.str(e.fragId),L.str(e.vertId),t);var c=f.getProgramParameter(l,ks);re.profile&&(e.stats.uniformsCount=c);var y=e.uniforms;for(n=0;n<c;++n)if(i=f.getActiveUniform(l,n),i)if(i.size>1)for(var R=0;R<i.size;++R){var B=i.name.replace("[0]","["+R+"]");Fe(y,new ye(B,L.id(B),f.getUniformLocation(l,B),i))}else Fe(y,new ye(i.name,L.id(i.name),f.getUniformLocation(l,i.name),i));var O=f.getProgramParameter(l,Ml);re.profile&&(e.stats.attributesCount=O);var H=e.attributes;for(n=0;n<O;++n)i=f.getActiveAttrib(l,n),i&&Fe(H,new ye(i.name,L.id(i.name),f.getAttribLocation(l,i.name),i))}re.profile&&(z.getMaxUniformsCount=function(){var e=0;return Le.forEach(function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)}),e},z.getMaxAttributesCount=function(){var e=0;return Le.forEach(function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)}),e});function He(){_e={},pe={};for(var e=0;e<Le.length;++e)Ne(Le[e],null,Le[e].attributes.map(function(t){return[t.location,t.name]}))}return{clear:function(){var e=f.deleteShader.bind(f);Tr(_e).forEach(e),_e={},Tr(pe).forEach(e),pe={},Le.forEach(function(t){f.deleteProgram(t.program)}),Le.length=0,Be={},z.shaderCount=0},program:function(e,t,r,n){M.command(e>=0,"missing vertex shader",r),M.command(t>=0,"missing fragment shader",r);var i=Be[t];i||(i=Be[t]={});var o=i[e];if(o&&(o.refCount++,!n))return o;var s=new Xe(t,e);return z.shaderCount++,Ne(s,r,n),o||(i[e]=s),Le.push(s),m(s,{destroy:function(){if(s.refCount--,s.refCount<=0){f.deleteProgram(s.program);var l=Le.indexOf(s);Le.splice(l,1),z.shaderCount--}i[s.vertId].refCount<=0&&(f.deleteShader(pe[s.vertId]),delete pe[s.vertId],delete Be[s.fragId][s.vertId]),Object.keys(Be[s.fragId]).length||(f.deleteShader(_e[s.fragId]),delete _e[s.fragId],delete Be[s.fragId])}})},restore:He,shader:Ie,frag:-1,vert:-1}}var Rs=6408,xn=5121,Fl=3333,Ki=5126;function jn(f,L,z,re,_e,pe,ye){function Fe(Le){var ze;L.next===null?(M(_e.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),ze=xn):(M(L.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),ze=L.next.colorAttachments[0].texture._texture.type,pe.oes_texture_float?(M(ze===xn||ze===Ki,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),ze===Ki&&M(ye.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):M(ze===xn,"Reading from a framebuffer is only allowed for the type 'uint8'"));var Xe=0,Ne=0,He=re.framebufferWidth,e=re.framebufferHeight,t=null;d(Le)?t=Le:Le&&(M.type(Le,"object","invalid arguments to regl.read()"),Xe=Le.x|0,Ne=Le.y|0,M(Xe>=0&&Xe<re.framebufferWidth,"invalid x offset for regl.read"),M(Ne>=0&&Ne<re.framebufferHeight,"invalid y offset for regl.read"),He=(Le.width||re.framebufferWidth-Xe)|0,e=(Le.height||re.framebufferHeight-Ne)|0,t=Le.data||null),t&&(ze===xn?M(t instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):ze===Ki&&M(t instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),M(He>0&&He+Xe<=re.framebufferWidth,"invalid width for read pixels"),M(e>0&&e+Ne<=re.framebufferHeight,"invalid height for read pixels"),z();var r=He*e*4;return t||(ze===xn?t=new Uint8Array(r):ze===Ki&&(t=t||new Float32Array(r))),M.isTypedArray(t,"data buffer for regl.read() must be a typedarray"),M(t.byteLength>=r,"data buffer for regl.read() too small"),f.pixelStorei(Fl,4),f.readPixels(Xe,Ne,He,e,Rs,ze,t),t}function Ie(Le){var ze;return L.setFBO({framebuffer:Le.framebuffer},function(){ze=Fe(Le)}),ze}function Be(Le){return!Le||!("framebuffer"in Le)?Fe(Le):Ie(Le)}return Be}function mi(f){return Array.prototype.slice.call(f)}function gi(f){return mi(f).join("")}function _u(){var f=0,L=[],z=[];function re(ze){for(var Xe=0;Xe<z.length;++Xe)if(z[Xe]===ze)return L[Xe];var Ne="g"+f++;return L.push(Ne),z.push(ze),Ne}function _e(){var ze=[];function Xe(){ze.push.apply(ze,mi(arguments))}var Ne=[];function He(){var e="v"+f++;return Ne.push(e),arguments.length>0&&(ze.push(e,"="),ze.push.apply(ze,mi(arguments)),ze.push(";")),e}return m(Xe,{def:He,toString:function(){return gi([Ne.length>0?"var "+Ne.join(",")+";":"",gi(ze)])}})}function pe(){var ze=_e(),Xe=_e(),Ne=ze.toString,He=Xe.toString;function e(t,r){Xe(t,r,"=",ze.def(t,r),";")}return m(function(){ze.apply(ze,mi(arguments))},{def:ze.def,entry:ze,exit:Xe,save:e,set:function(t,r,n){e(t,r),ze(t,r,"=",n,";")},toString:function(){return Ne()+He()}})}function ye(){var ze=gi(arguments),Xe=pe(),Ne=pe(),He=Xe.toString,e=Ne.toString;return m(Xe,{then:function(){return Xe.apply(Xe,mi(arguments)),this},else:function(){return Ne.apply(Ne,mi(arguments)),this},toString:function(){var t=e();return t&&(t="else{"+t+"}"),gi(["if(",ze,"){",He(),"}",t])}})}var Fe=_e(),Ie={};function Be(ze,Xe){var Ne=[];function He(){var i="a"+Ne.length;return Ne.push(i),i}Xe=Xe||0;for(var e=0;e<Xe;++e)He();var t=pe(),r=t.toString,n=Ie[ze]=m(t,{arg:He,toString:function(){return gi(["function(",Ne.join(),"){",r(),"}"])}});return n}function Le(){var ze=['"use strict";',Fe,"return {"];Object.keys(Ie).forEach(function(He){ze.push('"',He,'":',Ie[He].toString(),",")}),ze.push("}");var Xe=gi(ze).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Ne=Function.apply(null,L.concat(Xe));return Ne.apply(null,z)}return{global:Fe,link:re,block:_e,proc:Be,scope:pe,cond:ye,compile:Le}}var Sn="xyzw".split(""),Eo=5121,yi=1,Os=2,Lo=0,Ms=1,Fs=2,Vi=3,Na=4,Il=5,Nl=6,Is="dither",bi="blend.enable",Ao="blend.color",$i="blend.equation",ko="blend.func",Ro="depth.enable",Ns="depth.func",Pl="depth.range",Ps="depth.mask",lr="colorMask",Pa="cull.enable",Bs="cull.face",Oo="frontFace",Mo="lineWidth",xi="polygonOffset.enable",Qi="polygonOffset.offset",Ds="sample.alpha",Gs="sample.enable",Fo="sample.coverage",Si="stencil.enable",Hs="stencil.mask",Zi="stencil.func",Io="stencil.opFront",wn="stencil.opBack",Bl="scissor.enable",Tn="scissor.box",en="viewport",Ji="profile",Yn="framebuffer",Cn="vert",_n="frag",Ur="elements",Xr="primitive",Kn="count",No="offset",Ba="instances",Nr="vao",Vn="Width",wi="Height",ea=Yn+Vn,Ti=Yn+wi,Eu=en+Vn,Lu=en+wi,Dl="drawingBuffer",mr=Dl+Vn,zs=Dl+wi,Au=[ko,$i,Zi,Io,wn,Fo,en,Tn,Qi],ta=34962,ku=34963,Gl=35632,Hl=35633,Ws=3553,Ru=34067,Ou=2884,Mu=3042,$n=3024,Da=2960,Po=2929,Ga=3089,En=32823,Fu=32926,Iu=32928,Qn=5126,Ha=35664,za=35665,Wa=35666,ra=5124,Ln=35667,na=35668,ia=35669,qa=35670,Bo=35671,Zn=35672,Ua=35673,Xa=35674,aa=35675,Jn=35676,ja=35678,Ya=35680,oa=4,sa=1028,ei=1029,zl=2304,Ka=2305,Wl=32775,Nu=32776,ql=519,An=7680,Ul=0,Do=1,la=32774,Va=513,Xl=36160,jl=36064,tn={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Yl=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],ua={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ti={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},qs={frag:Gl,vert:Hl},Us={cw:zl,ccw:Ka};function Go(f){return Array.isArray(f)||d(f)||Lr(f)}function Xs(f){return f.sort(function(L,z){return L===en?-1:z===en?1:L<z?-1:1})}function dr(f,L,z,re){this.thisDep=f,this.contextDep=L,this.propDep=z,this.append=re}function kn(f){return f&&!(f.thisDep||f.contextDep||f.propDep)}function tr(f){return new dr(!1,!1,!1,f)}function xr(f,L){var z=f.type;if(z===Lo){var re=f.data.length;return new dr(!0,re>=1,re>=2,L)}else if(z===Na){var _e=f.data;return new dr(_e.thisDep,_e.contextDep,_e.propDep,L)}else{if(z===Il)return new dr(!1,!1,!1,L);if(z===Nl){for(var pe=!1,ye=!1,Fe=!1,Ie=0;Ie<f.data.length;++Ie){var Be=f.data[Ie];if(Be.type===Ms)Fe=!0;else if(Be.type===Fs)ye=!0;else if(Be.type===Vi)pe=!0;else if(Be.type===Lo){pe=!0;var Le=Be.data;Le>=1&&(ye=!0),Le>=2&&(Fe=!0)}else Be.type===Na&&(pe=pe||Be.data.thisDep,ye=ye||Be.data.contextDep,Fe=Fe||Be.data.propDep)}return new dr(pe,ye,Fe,L)}else return new dr(z===Vi,z===Fs,z===Ms,L)}}var Ci=new dr(!1,!1,!1,function(){});function Kl(f,L,z,re,_e,pe,ye,Fe,Ie,Be,Le,ze,Xe,Ne,He){var e=Be.Record,t={add:32774,subtract:32778,"reverse subtract":32779};z.ext_blend_minmax&&(t.min=Wl,t.max=Nu);var r=z.angle_instanced_arrays,n=z.webgl_draw_buffers,i={dirty:!0,profile:He.profile},o={},s=[],l={},u={};function c(F){return F.replace(".","_")}function y(F,w,K){var ne=c(F);s.push(F),o[ne]=i[ne]=!!K,l[ne]=w}function R(F,w,K){var ne=c(F);s.push(F),Array.isArray(K)?(i[ne]=K.slice(),o[ne]=K.slice()):i[ne]=o[ne]=K,u[ne]=w}y(Is,$n),y(bi,Mu),R(Ao,"blendColor",[0,0,0,0]),R($i,"blendEquationSeparate",[la,la]),R(ko,"blendFuncSeparate",[Do,Ul,Do,Ul]),y(Ro,Po,!0),R(Ns,"depthFunc",Va),R(Pl,"depthRange",[0,1]),R(Ps,"depthMask",!0),R(lr,lr,[!0,!0,!0,!0]),y(Pa,Ou),R(Bs,"cullFace",ei),R(Oo,Oo,Ka),R(Mo,Mo,1),y(xi,En),R(Qi,"polygonOffset",[0,0]),y(Ds,Fu),y(Gs,Iu),R(Fo,"sampleCoverage",[1,!1]),y(Si,Da),R(Hs,"stencilMask",-1),R(Zi,"stencilFunc",[ql,0,-1]),R(Io,"stencilOpSeparate",[sa,An,An,An]),R(wn,"stencilOpSeparate",[ei,An,An,An]),y(Bl,Ga),R(Tn,"scissor",[0,0,f.drawingBufferWidth,f.drawingBufferHeight]),R(en,en,[0,0,f.drawingBufferWidth,f.drawingBufferHeight]);var B={gl:f,context:Xe,strings:L,next:o,current:i,draw:ze,elements:pe,buffer:_e,shader:Le,attributes:Be.state,vao:Be,uniforms:Ie,framebuffer:Fe,extensions:z,timer:Ne,isBufferArgs:Go},O={primTypes:Cr,compareFuncs:ua,blendFuncs:tn,blendEquations:t,stencilOps:ti,glTypes:ii,orientationType:Us};M.optional(function(){B.isArrayLike=Ut}),n&&(O.backBuffer=[ei],O.drawBuffer=qt(re.maxDrawbuffers,function(F){return F===0?[0]:qt(F,function(w){return jl+w})}));var H=0;function ce(){var F=_u(),w=F.link,K=F.global;F.id=H++,F.batchId="0";var ne=w(B),oe=F.shared={props:"a0"};Object.keys(B).forEach(function(Y){oe[Y]=K.def(ne,".",Y)}),M.optional(function(){F.CHECK=w(M),F.commandStr=M.guessCommand(),F.command=w(F.commandStr),F.assert=function(Y,k,te){Y("if(!(",k,"))",this.CHECK,".commandRaise(",w(te),",",this.command,");")},O.invalidBlendCombinations=Yl});var $=F.next={},V=F.current={};Object.keys(u).forEach(function(Y){Array.isArray(i[Y])&&($[Y]=K.def(oe.next,".",Y),V[Y]=K.def(oe.current,".",Y))});var J=F.constants={};Object.keys(O).forEach(function(Y){J[Y]=K.def(JSON.stringify(O[Y]))}),F.invoke=function(Y,k){switch(k.type){case Lo:var te=["this",oe.context,oe.props,F.batchId];return Y.def(w(k.data),".call(",te.slice(0,Math.max(k.data.length+1,4)),")");case Ms:return Y.def(oe.props,k.data);case Fs:return Y.def(oe.context,k.data);case Vi:return Y.def("this",k.data);case Na:return k.data.append(F,Y),k.data.ref;case Il:return k.data.toString();case Nl:return k.data.map(function(ue){return F.invoke(Y,ue)})}},F.attribCache={};var N={};return F.scopeAttrib=function(Y){var k=L.id(Y);if(k in N)return N[k];var te=Be.scope[k];te||(te=Be.scope[k]=new e);var ue=N[k]=w(te);return ue},F}function we(F){var w=F.static,K=F.dynamic,ne;if(Ji in w){var oe=!!w[Ji];ne=tr(function(V,J){return oe}),ne.enable=oe}else if(Ji in K){var $=K[Ji];ne=xr($,function(V,J){return V.invoke(J,$)})}return ne}function ge(F,w){var K=F.static,ne=F.dynamic;if(Yn in K){var oe=K[Yn];return oe?(oe=Fe.getFramebuffer(oe),M.command(oe,"invalid framebuffer object"),tr(function(V,J){var N=V.link(oe),Y=V.shared;J.set(Y.framebuffer,".next",N);var k=Y.context;return J.set(k,"."+ea,N+".width"),J.set(k,"."+Ti,N+".height"),N})):tr(function(V,J){var N=V.shared;J.set(N.framebuffer,".next","null");var Y=N.context;return J.set(Y,"."+ea,Y+"."+mr),J.set(Y,"."+Ti,Y+"."+zs),"null"})}else if(Yn in ne){var $=ne[Yn];return xr($,function(V,J){var N=V.invoke(J,$),Y=V.shared,k=Y.framebuffer,te=J.def(k,".getFramebuffer(",N,")");M.optional(function(){V.assert(J,"!"+N+"||"+te,"invalid framebuffer object")}),J.set(k,".next",te);var ue=Y.context;return J.set(ue,"."+ea,te+"?"+te+".width:"+ue+"."+mr),J.set(ue,"."+Ti,te+"?"+te+".height:"+ue+"."+zs),te})}else return null}function Oe(F,w,K){var ne=F.static,oe=F.dynamic;function $(N){if(N in ne){var Y=ne[N];M.commandType(Y,"object","invalid "+N,K.commandStr);var k=!0,te=Y.x|0,ue=Y.y|0,Ce,Ae;return"width"in Y?(Ce=Y.width|0,M.command(Ce>=0,"invalid "+N,K.commandStr)):k=!1,"height"in Y?(Ae=Y.height|0,M.command(Ae>=0,"invalid "+N,K.commandStr)):k=!1,new dr(!k&&w&&w.thisDep,!k&&w&&w.contextDep,!k&&w&&w.propDep,function(it,wt){var et=it.shared.context,dt=Ce;"width"in Y||(dt=wt.def(et,".",ea,"-",te));var xt=Ae;return"height"in Y||(xt=wt.def(et,".",Ti,"-",ue)),[te,ue,dt,xt]})}else if(N in oe){var Se=oe[N],De=xr(Se,function(it,wt){var et=it.invoke(wt,Se);M.optional(function(){it.assert(wt,et+"&&typeof "+et+'==="object"',"invalid "+N)});var dt=it.shared.context,xt=wt.def(et,".x|0"),Ot=wt.def(et,".y|0"),rr=wt.def('"width" in ',et,"?",et,".width|0:","(",dt,".",ea,"-",xt,")"),Or=wt.def('"height" in ',et,"?",et,".height|0:","(",dt,".",Ti,"-",Ot,")");return M.optional(function(){it.assert(wt,rr+">=0&&"+Or+">=0","invalid "+N)}),[xt,Ot,rr,Or]});return w&&(De.thisDep=De.thisDep||w.thisDep,De.contextDep=De.contextDep||w.contextDep,De.propDep=De.propDep||w.propDep),De}else return w?new dr(w.thisDep,w.contextDep,w.propDep,function(it,wt){var et=it.shared.context;return[0,0,wt.def(et,".",ea),wt.def(et,".",Ti)]}):null}var V=$(en);if(V){var J=V;V=new dr(V.thisDep,V.contextDep,V.propDep,function(N,Y){var k=J.append(N,Y),te=N.shared.context;return Y.set(te,"."+Eu,k[2]),Y.set(te,"."+Lu,k[3]),k})}return{viewport:V,scissor_box:$(Tn)}}function Ee(F,w){var K=F.static,ne=typeof K[_n]=="string"&&typeof K[Cn]=="string";if(ne){if(Object.keys(w.dynamic).length>0)return null;var oe=w.static,$=Object.keys(oe);if($.length>0&&typeof oe[$[0]]=="number"){for(var V=[],J=0;J<$.length;++J)M(typeof oe[$[J]]=="number","must specify all vertex attribute locations when using vaos"),V.push([oe[$[J]]|0,$[J]]);return V}}return null}function Me(F,w,K){var ne=F.static,oe=F.dynamic;function $(k){if(k in ne){var te=L.id(ne[k]);M.optional(function(){Le.shader(qs[k],te,M.guessCommand())});var ue=tr(function(){return te});return ue.id=te,ue}else if(k in oe){var Ce=oe[k];return xr(Ce,function(Ae,Se){var De=Ae.invoke(Se,Ce),it=Se.def(Ae.shared.strings,".id(",De,")");return M.optional(function(){Se(Ae.shared.shader,".shader(",qs[k],",",it,",",Ae.command,");")}),it})}return null}var V=$(_n),J=$(Cn),N=null,Y;return kn(V)&&kn(J)?(N=Le.program(J.id,V.id,null,K),Y=tr(function(k,te){return k.link(N)})):Y=new dr(V&&V.thisDep||J&&J.thisDep,V&&V.contextDep||J&&J.contextDep,V&&V.propDep||J&&J.propDep,function(k,te){var ue=k.shared.shader,Ce;V?Ce=V.append(k,te):Ce=te.def(ue,".",_n);var Ae;J?Ae=J.append(k,te):Ae=te.def(ue,".",Cn);var Se=ue+".program("+Ae+","+Ce;return M.optional(function(){Se+=","+k.command}),te.def(Se+")")}),{frag:V,vert:J,progVar:Y,program:N}}function Ye(F,w){var K=F.static,ne=F.dynamic;function oe(){if(Ur in K){var k=K[Ur];Go(k)?k=pe.getElements(pe.create(k,!0)):k&&(k=pe.getElements(k),M.command(k,"invalid elements",w.commandStr));var te=tr(function(Ce,Ae){if(k){var Se=Ce.link(k);return Ce.ELEMENTS=Se,Se}return Ce.ELEMENTS=null,null});return te.value=k,te}else if(Ur in ne){var ue=ne[Ur];return xr(ue,function(Ce,Ae){var Se=Ce.shared,De=Se.isBufferArgs,it=Se.elements,wt=Ce.invoke(Ae,ue),et=Ae.def("null"),dt=Ae.def(De,"(",wt,")"),xt=Ce.cond(dt).then(et,"=",it,".createStream(",wt,");").else(et,"=",it,".getElements(",wt,");");return M.optional(function(){Ce.assert(xt.else,"!"+wt+"||"+et,"invalid elements")}),Ae.entry(xt),Ae.exit(Ce.cond(dt).then(it,".destroyStream(",et,");")),Ce.ELEMENTS=et,et})}return null}var $=oe();function V(){if(Xr in K){var k=K[Xr];return M.commandParameter(k,Cr,"invalid primitve",w.commandStr),tr(function(ue,Ce){return Cr[k]})}else if(Xr in ne){var te=ne[Xr];return xr(te,function(ue,Ce){var Ae=ue.constants.primTypes,Se=ue.invoke(Ce,te);return M.optional(function(){ue.assert(Ce,Se+" in "+Ae,"invalid primitive, must be one of "+Object.keys(Cr))}),Ce.def(Ae,"[",Se,"]")})}else if($)return kn($)?$.value?tr(function(ue,Ce){return Ce.def(ue.ELEMENTS,".primType")}):tr(function(){return oa}):new dr($.thisDep,$.contextDep,$.propDep,function(ue,Ce){var Ae=ue.ELEMENTS;return Ce.def(Ae,"?",Ae,".primType:",oa)});return null}function J(k,te){if(k in K){var ue=K[k]|0;return M.command(!te||ue>=0,"invalid "+k,w.commandStr),tr(function(Ae,Se){return te&&(Ae.OFFSET=ue),ue})}else if(k in ne){var Ce=ne[k];return xr(Ce,function(Ae,Se){var De=Ae.invoke(Se,Ce);return te&&(Ae.OFFSET=De,M.optional(function(){Ae.assert(Se,De+">=0","invalid "+k)})),De})}else if(te&&$)return tr(function(Ae,Se){return Ae.OFFSET="0",0});return null}var N=J(No,!0);function Y(){if(Kn in K){var k=K[Kn]|0;return M.command(typeof k=="number"&&k>=0,"invalid vertex count",w.commandStr),tr(function(){return k})}else if(Kn in ne){var te=ne[Kn];return xr(te,function(Ae,Se){var De=Ae.invoke(Se,te);return M.optional(function(){Ae.assert(Se,"typeof "+De+'==="number"&&'+De+">=0&&"+De+"===("+De+"|0)","invalid vertex count")}),De})}else if($)if(kn($)){if($)return N?new dr(N.thisDep,N.contextDep,N.propDep,function(Ae,Se){var De=Se.def(Ae.ELEMENTS,".vertCount-",Ae.OFFSET);return M.optional(function(){Ae.assert(Se,De+">=0","invalid vertex offset/element buffer too small")}),De}):tr(function(Ae,Se){return Se.def(Ae.ELEMENTS,".vertCount")});var ue=tr(function(){return-1});return M.optional(function(){ue.MISSING=!0}),ue}else{var Ce=new dr($.thisDep||N.thisDep,$.contextDep||N.contextDep,$.propDep||N.propDep,function(Ae,Se){var De=Ae.ELEMENTS;return Ae.OFFSET?Se.def(De,"?",De,".vertCount-",Ae.OFFSET,":-1"):Se.def(De,"?",De,".vertCount:-1")});return M.optional(function(){Ce.DYNAMIC=!0}),Ce}return null}return{elements:$,primitive:V(),count:Y(),instances:J(Ba,!1),offset:N}}function Ze(F,w){var K=F.static,ne=F.dynamic,oe={};return s.forEach(function($){var V=c($);function J(N,Y){if($ in K){var k=N(K[$]);oe[V]=tr(function(){return k})}else if($ in ne){var te=ne[$];oe[V]=xr(te,function(ue,Ce){return Y(ue,Ce,ue.invoke(Ce,te))})}}switch($){case Pa:case bi:case Is:case Si:case Ro:case Bl:case xi:case Ds:case Gs:case Ps:return J(function(N){return M.commandType(N,"boolean",$,w.commandStr),N},function(N,Y,k){return M.optional(function(){N.assert(Y,"typeof "+k+'==="boolean"',"invalid flag "+$,N.commandStr)}),k});case Ns:return J(function(N){return M.commandParameter(N,ua,"invalid "+$,w.commandStr),ua[N]},function(N,Y,k){var te=N.constants.compareFuncs;return M.optional(function(){N.assert(Y,k+" in "+te,"invalid "+$+", must be one of "+Object.keys(ua))}),Y.def(te,"[",k,"]")});case Pl:return J(function(N){return M.command(Ut(N)&&N.length===2&&typeof N[0]=="number"&&typeof N[1]=="number"&&N[0]<=N[1],"depth range is 2d array",w.commandStr),N},function(N,Y,k){M.optional(function(){N.assert(Y,N.shared.isArrayLike+"("+k+")&&"+k+".length===2&&typeof "+k+'[0]==="number"&&typeof '+k+'[1]==="number"&&'+k+"[0]<="+k+"[1]","depth range must be a 2d array")});var te=Y.def("+",k,"[0]"),ue=Y.def("+",k,"[1]");return[te,ue]});case ko:return J(function(N){M.commandType(N,"object","blend.func",w.commandStr);var Y="srcRGB"in N?N.srcRGB:N.src,k="srcAlpha"in N?N.srcAlpha:N.src,te="dstRGB"in N?N.dstRGB:N.dst,ue="dstAlpha"in N?N.dstAlpha:N.dst;return M.commandParameter(Y,tn,V+".srcRGB",w.commandStr),M.commandParameter(k,tn,V+".srcAlpha",w.commandStr),M.commandParameter(te,tn,V+".dstRGB",w.commandStr),M.commandParameter(ue,tn,V+".dstAlpha",w.commandStr),M.command(Yl.indexOf(Y+", "+te)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Y+", "+te+")",w.commandStr),[tn[Y],tn[te],tn[k],tn[ue]]},function(N,Y,k){var te=N.constants.blendFuncs;M.optional(function(){N.assert(Y,k+"&&typeof "+k+'==="object"',"invalid blend func, must be an object")});function ue(et,dt){var xt=Y.def('"',et,dt,'" in ',k,"?",k,".",et,dt,":",k,".",et);return M.optional(function(){N.assert(Y,xt+" in "+te,"invalid "+$+"."+et+dt+", must be one of "+Object.keys(tn))}),xt}var Ce=ue("src","RGB"),Ae=ue("dst","RGB");M.optional(function(){var et=N.constants.invalidBlendCombinations;N.assert(Y,et+".indexOf("+Ce+'+", "+'+Ae+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Se=Y.def(te,"[",Ce,"]"),De=Y.def(te,"[",ue("src","Alpha"),"]"),it=Y.def(te,"[",Ae,"]"),wt=Y.def(te,"[",ue("dst","Alpha"),"]");return[Se,it,De,wt]});case $i:return J(function(N){if(typeof N=="string")return M.commandParameter(N,t,"invalid "+$,w.commandStr),[t[N],t[N]];if(typeof N=="object")return M.commandParameter(N.rgb,t,$+".rgb",w.commandStr),M.commandParameter(N.alpha,t,$+".alpha",w.commandStr),[t[N.rgb],t[N.alpha]];M.commandRaise("invalid blend.equation",w.commandStr)},function(N,Y,k){var te=N.constants.blendEquations,ue=Y.def(),Ce=Y.def(),Ae=N.cond("typeof ",k,'==="string"');return M.optional(function(){function Se(De,it,wt){N.assert(De,wt+" in "+te,"invalid "+it+", must be one of "+Object.keys(t))}Se(Ae.then,$,k),N.assert(Ae.else,k+"&&typeof "+k+'==="object"',"invalid "+$),Se(Ae.else,$+".rgb",k+".rgb"),Se(Ae.else,$+".alpha",k+".alpha")}),Ae.then(ue,"=",Ce,"=",te,"[",k,"];"),Ae.else(ue,"=",te,"[",k,".rgb];",Ce,"=",te,"[",k,".alpha];"),Y(Ae),[ue,Ce]});case Ao:return J(function(N){return M.command(Ut(N)&&N.length===4,"blend.color must be a 4d array",w.commandStr),qt(4,function(Y){return+N[Y]})},function(N,Y,k){return M.optional(function(){N.assert(Y,N.shared.isArrayLike+"("+k+")&&"+k+".length===4","blend.color must be a 4d array")}),qt(4,function(te){return Y.def("+",k,"[",te,"]")})});case Hs:return J(function(N){return M.commandType(N,"number",V,w.commandStr),N|0},function(N,Y,k){return M.optional(function(){N.assert(Y,"typeof "+k+'==="number"',"invalid stencil.mask")}),Y.def(k,"|0")});case Zi:return J(function(N){M.commandType(N,"object",V,w.commandStr);var Y=N.cmp||"keep",k=N.ref||0,te="mask"in N?N.mask:-1;return M.commandParameter(Y,ua,$+".cmp",w.commandStr),M.commandType(k,"number",$+".ref",w.commandStr),M.commandType(te,"number",$+".mask",w.commandStr),[ua[Y],k,te]},function(N,Y,k){var te=N.constants.compareFuncs;M.optional(function(){function Se(){N.assert(Y,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Se(k+"&&typeof ",k,'==="object"'),Se('!("cmp" in ',k,")||(",k,".cmp in ",te,")")});var ue=Y.def('"cmp" in ',k,"?",te,"[",k,".cmp]",":",An),Ce=Y.def(k,".ref|0"),Ae=Y.def('"mask" in ',k,"?",k,".mask|0:-1");return[ue,Ce,Ae]});case Io:case wn:return J(function(N){M.commandType(N,"object",V,w.commandStr);var Y=N.fail||"keep",k=N.zfail||"keep",te=N.zpass||"keep";return M.commandParameter(Y,ti,$+".fail",w.commandStr),M.commandParameter(k,ti,$+".zfail",w.commandStr),M.commandParameter(te,ti,$+".zpass",w.commandStr),[$===wn?ei:sa,ti[Y],ti[k],ti[te]]},function(N,Y,k){var te=N.constants.stencilOps;M.optional(function(){N.assert(Y,k+"&&typeof "+k+'==="object"',"invalid "+$)});function ue(Ce){return M.optional(function(){N.assert(Y,'!("'+Ce+'" in '+k+")||("+k+"."+Ce+" in "+te+")","invalid "+$+"."+Ce+", must be one of "+Object.keys(ti))}),Y.def('"',Ce,'" in ',k,"?",te,"[",k,".",Ce,"]:",An)}return[$===wn?ei:sa,ue("fail"),ue("zfail"),ue("zpass")]});case Qi:return J(function(N){M.commandType(N,"object",V,w.commandStr);var Y=N.factor|0,k=N.units|0;return M.commandType(Y,"number",V+".factor",w.commandStr),M.commandType(k,"number",V+".units",w.commandStr),[Y,k]},function(N,Y,k){M.optional(function(){N.assert(Y,k+"&&typeof "+k+'==="object"',"invalid "+$)});var te=Y.def(k,".factor|0"),ue=Y.def(k,".units|0");return[te,ue]});case Bs:return J(function(N){var Y=0;return N==="front"?Y=sa:N==="back"&&(Y=ei),M.command(!!Y,V,w.commandStr),Y},function(N,Y,k){return M.optional(function(){N.assert(Y,k+'==="front"||'+k+'==="back"',"invalid cull.face")}),Y.def(k,'==="front"?',sa,":",ei)});case Mo:return J(function(N){return M.command(typeof N=="number"&&N>=re.lineWidthDims[0]&&N<=re.lineWidthDims[1],"invalid line width, must be a positive number between "+re.lineWidthDims[0]+" and "+re.lineWidthDims[1],w.commandStr),N},function(N,Y,k){return M.optional(function(){N.assert(Y,"typeof "+k+'==="number"&&'+k+">="+re.lineWidthDims[0]+"&&"+k+"<="+re.lineWidthDims[1],"invalid line width")}),k});case Oo:return J(function(N){return M.commandParameter(N,Us,V,w.commandStr),Us[N]},function(N,Y,k){return M.optional(function(){N.assert(Y,k+'==="cw"||'+k+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Y.def(k+'==="cw"?'+zl+":"+Ka)});case lr:return J(function(N){return M.command(Ut(N)&&N.length===4,"color.mask must be length 4 array",w.commandStr),N.map(function(Y){return!!Y})},function(N,Y,k){return M.optional(function(){N.assert(Y,N.shared.isArrayLike+"("+k+")&&"+k+".length===4","invalid color.mask")}),qt(4,function(te){return"!!"+k+"["+te+"]"})});case Fo:return J(function(N){M.command(typeof N=="object"&&N,V,w.commandStr);var Y="value"in N?N.value:1,k=!!N.invert;return M.command(typeof Y=="number"&&Y>=0&&Y<=1,"sample.coverage.value must be a number between 0 and 1",w.commandStr),[Y,k]},function(N,Y,k){M.optional(function(){N.assert(Y,k+"&&typeof "+k+'==="object"',"invalid sample.coverage")});var te=Y.def('"value" in ',k,"?+",k,".value:1"),ue=Y.def("!!",k,".invert");return[te,ue]})}}),oe}function ct(F,w){var K=F.static,ne=F.dynamic,oe={};return Object.keys(K).forEach(function($){var V=K[$],J;if(typeof V=="number"||typeof V=="boolean")J=tr(function(){return V});else if(typeof V=="function"){var N=V._reglType;N==="texture2d"||N==="textureCube"?J=tr(function(Y){return Y.link(V)}):N==="framebuffer"||N==="framebufferCube"?(M.command(V.color.length>0,'missing color attachment for framebuffer sent to uniform "'+$+'"',w.commandStr),J=tr(function(Y){return Y.link(V.color[0])})):M.commandRaise('invalid data for uniform "'+$+'"',w.commandStr)}else Ut(V)?J=tr(function(Y){var k=Y.global.def("[",qt(V.length,function(te){return M.command(typeof V[te]=="number"||typeof V[te]=="boolean","invalid uniform "+$,Y.commandStr),V[te]}),"]");return k}):M.commandRaise('invalid or missing data for uniform "'+$+'"',w.commandStr);J.value=V,oe[$]=J}),Object.keys(ne).forEach(function($){var V=ne[$];oe[$]=xr(V,function(J,N){return J.invoke(N,V)})}),oe}function rt(F,w){var K=F.static,ne=F.dynamic,oe={};return Object.keys(K).forEach(function($){var V=K[$],J=L.id($),N=new e;if(Go(V))N.state=yi,N.buffer=_e.getBuffer(_e.create(V,ta,!1,!0)),N.type=0;else{var Y=_e.getBuffer(V);if(Y)N.state=yi,N.buffer=Y,N.type=0;else if(M.command(typeof V=="object"&&V,"invalid data for attribute "+$,w.commandStr),"constant"in V){var k=V.constant;N.buffer="null",N.state=Os,typeof k=="number"?N.x=k:(M.command(Ut(k)&&k.length>0&&k.length<=4,"invalid constant for attribute "+$,w.commandStr),Sn.forEach(function(it,wt){wt<k.length&&(N[it]=k[wt])}))}else{Go(V.buffer)?Y=_e.getBuffer(_e.create(V.buffer,ta,!1,!0)):Y=_e.getBuffer(V.buffer),M.command(!!Y,'missing buffer for attribute "'+$+'"',w.commandStr);var te=V.offset|0;M.command(te>=0,'invalid offset for attribute "'+$+'"',w.commandStr);var ue=V.stride|0;M.command(ue>=0&&ue<256,'invalid stride for attribute "'+$+'", must be integer betweeen [0, 255]',w.commandStr);var Ce=V.size|0;M.command(!("size"in V)||Ce>0&&Ce<=4,'invalid size for attribute "'+$+'", must be 1,2,3,4',w.commandStr);var Ae=!!V.normalized,Se=0;"type"in V&&(M.commandParameter(V.type,ii,"invalid type for attribute "+$,w.commandStr),Se=ii[V.type]);var De=V.divisor|0;"divisor"in V&&(M.command(De===0||r,'cannot specify divisor for attribute "'+$+'", instancing not supported',w.commandStr),M.command(De>=0,'invalid divisor for attribute "'+$+'"',w.commandStr)),M.optional(function(){var it=w.commandStr,wt=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(V).forEach(function(et){M.command(wt.indexOf(et)>=0,'unknown parameter "'+et+'" for attribute pointer "'+$+'" (valid parameters are '+wt+")",it)})}),N.buffer=Y,N.state=yi,N.size=Ce,N.normalized=Ae,N.type=Se||Y.dtype,N.offset=te,N.stride=ue,N.divisor=De}}oe[$]=tr(function(it,wt){var et=it.attribCache;if(J in et)return et[J];var dt={isStream:!1};return Object.keys(N).forEach(function(xt){dt[xt]=N[xt]}),N.buffer&&(dt.buffer=it.link(N.buffer),dt.type=dt.type||dt.buffer+".dtype"),et[J]=dt,dt})}),Object.keys(ne).forEach(function($){var V=ne[$];function J(N,Y){var k=N.invoke(Y,V),te=N.shared,ue=N.constants,Ce=te.isBufferArgs,Ae=te.buffer;M.optional(function(){N.assert(Y,k+"&&(typeof "+k+'==="object"||typeof '+k+'==="function")&&('+Ce+"("+k+")||"+Ae+".getBuffer("+k+")||"+Ae+".getBuffer("+k+".buffer)||"+Ce+"("+k+'.buffer)||("constant" in '+k+"&&(typeof "+k+'.constant==="number"||'+te.isArrayLike+"("+k+".constant))))",'invalid dynamic attribute "'+$+'"')});var Se={isStream:Y.def(!1)},De=new e;De.state=yi,Object.keys(De).forEach(function(dt){Se[dt]=Y.def(""+De[dt])});var it=Se.buffer,wt=Se.type;Y("if(",Ce,"(",k,")){",Se.isStream,"=true;",it,"=",Ae,".createStream(",ta,",",k,");",wt,"=",it,".dtype;","}else{",it,"=",Ae,".getBuffer(",k,");","if(",it,"){",wt,"=",it,".dtype;",'}else if("constant" in ',k,"){",Se.state,"=",Os,";","if(typeof "+k+'.constant === "number"){',Se[Sn[0]],"=",k,".constant;",Sn.slice(1).map(function(dt){return Se[dt]}).join("="),"=0;","}else{",Sn.map(function(dt,xt){return Se[dt]+"="+k+".constant.length>"+xt+"?"+k+".constant["+xt+"]:0;"}).join(""),"}}else{","if(",Ce,"(",k,".buffer)){",it,"=",Ae,".createStream(",ta,",",k,".buffer);","}else{",it,"=",Ae,".getBuffer(",k,".buffer);","}",wt,'="type" in ',k,"?",ue.glTypes,"[",k,".type]:",it,".dtype;",Se.normalized,"=!!",k,".normalized;");function et(dt){Y(Se[dt],"=",k,".",dt,"|0;")}return et("size"),et("offset"),et("stride"),et("divisor"),Y("}}"),Y.exit("if(",Se.isStream,"){",Ae,".destroyStream(",it,");","}"),Se}oe[$]=xr(V,J)}),oe}function kt(F,w){var K=F.static,ne=F.dynamic;if(Nr in K){var oe=K[Nr];return oe!==null&&Be.getVAO(oe)===null&&(oe=Be.createVAO(oe)),tr(function(V){return V.link(Be.getVAO(oe))})}else if(Nr in ne){var $=ne[Nr];return xr($,function(V,J){var N=V.invoke(J,$);return J.def(V.shared.vao+".getVAO("+N+")")})}return null}function yt(F){var w=F.static,K=F.dynamic,ne={};return Object.keys(w).forEach(function(oe){var $=w[oe];ne[oe]=tr(function(V,J){return typeof $=="number"||typeof $=="boolean"?""+$:V.link($)})}),Object.keys(K).forEach(function(oe){var $=K[oe];ne[oe]=xr($,function(V,J){return V.invoke(J,$)})}),ne}function Ft(F,w,K,ne,oe){var $=F.static,V=F.dynamic;M.optional(function(){var et=[Yn,Cn,_n,Ur,Xr,No,Kn,Ba,Ji,Nr].concat(s);function dt(xt){Object.keys(xt).forEach(function(Ot){M.command(et.indexOf(Ot)>=0,'unknown parameter "'+Ot+'"',oe.commandStr)})}dt($),dt(V)});var J=Ee(F,w),N=ge(F),Y=Oe(F,N,oe),k=Ye(F,oe),te=Ze(F,oe),ue=Me(F,oe,J);function Ce(et){var dt=Y[et];dt&&(te[et]=dt)}Ce(en),Ce(c(Tn));var Ae=Object.keys(te).length>0,Se={framebuffer:N,draw:k,shader:ue,state:te,dirty:Ae,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Se.profile=we(F),Se.uniforms=ct(K,oe),Se.drawVAO=Se.scopeVAO=kt(F),!Se.drawVAO&&ue.program&&!J&&z.angle_instanced_arrays){var De=!0,it=ue.program.attributes.map(function(et){var dt=w.static[et];return De=De&&!!dt,dt});if(De&&it.length>0){var wt=Be.getVAO(Be.createVAO(it));Se.drawVAO=new dr(null,null,null,function(et,dt){return et.link(wt)}),Se.useVAO=!0}}return J?Se.useVAO=!0:Se.attributes=rt(w,oe),Se.context=yt(ne),Se}function It(F,w,K){var ne=F.shared,oe=ne.context,$=F.scope();Object.keys(K).forEach(function(V){w.save(oe,"."+V);var J=K[V],N=J.append(F,w);Array.isArray(N)?$(oe,".",V,"=[",N.join(),"];"):$(oe,".",V,"=",N,";")}),w($)}function Et(F,w,K,ne){var oe=F.shared,$=oe.gl,V=oe.framebuffer,J;n&&(J=w.def(oe.extensions,".webgl_draw_buffers"));var N=F.constants,Y=N.drawBuffer,k=N.backBuffer,te;K?te=K.append(F,w):te=w.def(V,".next"),ne||w("if(",te,"!==",V,".cur){"),w("if(",te,"){",$,".bindFramebuffer(",Xl,",",te,".framebuffer);"),n&&w(J,".drawBuffersWEBGL(",Y,"[",te,".colorAttachments.length]);"),w("}else{",$,".bindFramebuffer(",Xl,",null);"),n&&w(J,".drawBuffersWEBGL(",k,");"),w("}",V,".cur=",te,";"),ne||w("}")}function Gt(F,w,K){var ne=F.shared,oe=ne.gl,$=F.current,V=F.next,J=ne.current,N=ne.next,Y=F.cond(J,".dirty");s.forEach(function(k){var te=c(k);if(!(te in K.state)){var ue,Ce;if(te in V){ue=V[te],Ce=$[te];var Ae=qt(i[te].length,function(De){return Y.def(ue,"[",De,"]")});Y(F.cond(Ae.map(function(De,it){return De+"!=="+Ce+"["+it+"]"}).join("||")).then(oe,".",u[te],"(",Ae,");",Ae.map(function(De,it){return Ce+"["+it+"]="+De}).join(";"),";"))}else{ue=Y.def(N,".",te);var Se=F.cond(ue,"!==",J,".",te);Y(Se),te in l?Se(F.cond(ue).then(oe,".enable(",l[te],");").else(oe,".disable(",l[te],");"),J,".",te,"=",ue,";"):Se(oe,".",u[te],"(",ue,");",J,".",te,"=",ue,";")}}}),Object.keys(K.state).length===0&&Y(J,".dirty=false;"),w(Y)}function Nt(F,w,K,ne){var oe=F.shared,$=F.current,V=oe.current,J=oe.gl;Xs(Object.keys(K)).forEach(function(N){var Y=K[N];if(!(ne&&!ne(Y))){var k=Y.append(F,w);if(l[N]){var te=l[N];kn(Y)?k?w(J,".enable(",te,");"):w(J,".disable(",te,");"):w(F.cond(k).then(J,".enable(",te,");").else(J,".disable(",te,");")),w(V,".",N,"=",k,";")}else if(Ut(k)){var ue=$[N];w(J,".",u[N],"(",k,");",k.map(function(Ce,Ae){return ue+"["+Ae+"]="+Ce}).join(";"),";")}else w(J,".",u[N],"(",k,");",V,".",N,"=",k,";")}})}function Tt(F,w){r&&(F.instancing=w.def(F.shared.extensions,".angle_instanced_arrays"))}function nt(F,w,K,ne,oe){var $=F.shared,V=F.stats,J=$.current,N=$.timer,Y=K.profile;function k(){return typeof performance>"u"?"Date.now()":"performance.now()"}var te,ue;function Ce(et){te=w.def(),et(te,"=",k(),";"),typeof oe=="string"?et(V,".count+=",oe,";"):et(V,".count++;"),Ne&&(ne?(ue=w.def(),et(ue,"=",N,".getNumPendingQueries();")):et(N,".beginQuery(",V,");"))}function Ae(et){et(V,".cpuTime+=",k(),"-",te,";"),Ne&&(ne?et(N,".pushScopeStats(",ue,",",N,".getNumPendingQueries(),",V,");"):et(N,".endQuery();"))}function Se(et){var dt=w.def(J,".profile");w(J,".profile=",et,";"),w.exit(J,".profile=",dt,";")}var De;if(Y){if(kn(Y)){Y.enable?(Ce(w),Ae(w.exit),Se("true")):Se("false");return}De=Y.append(F,w),Se(De)}else De=w.def(J,".profile");var it=F.block();Ce(it),w("if(",De,"){",it,"}");var wt=F.block();Ae(wt),w.exit("if(",De,"){",wt,"}")}function Lt(F,w,K,ne,oe){var $=F.shared;function V(N){switch(N){case Ha:case Ln:case Bo:return 2;case za:case na:case Zn:return 3;case Wa:case ia:case Ua:return 4;default:return 1}}function J(N,Y,k){var te=$.gl,ue=w.def(N,".location"),Ce=w.def($.attributes,"[",ue,"]"),Ae=k.state,Se=k.buffer,De=[k.x,k.y,k.z,k.w],it=["buffer","normalized","offset","stride"];function wt(){w("if(!",Ce,".buffer){",te,".enableVertexAttribArray(",ue,");}");var dt=k.type,xt;if(k.size?xt=w.def(k.size,"||",Y):xt=Y,w("if(",Ce,".type!==",dt,"||",Ce,".size!==",xt,"||",it.map(function(rr){return Ce+"."+rr+"!=="+k[rr]}).join("||"),"){",te,".bindBuffer(",ta,",",Se,".buffer);",te,".vertexAttribPointer(",[ue,xt,dt,k.normalized,k.stride,k.offset],");",Ce,".type=",dt,";",Ce,".size=",xt,";",it.map(function(rr){return Ce+"."+rr+"="+k[rr]+";"}).join(""),"}"),r){var Ot=k.divisor;w("if(",Ce,".divisor!==",Ot,"){",F.instancing,".vertexAttribDivisorANGLE(",[ue,Ot],");",Ce,".divisor=",Ot,";}")}}function et(){w("if(",Ce,".buffer){",te,".disableVertexAttribArray(",ue,");",Ce,".buffer=null;","}if(",Sn.map(function(dt,xt){return Ce+"."+dt+"!=="+De[xt]}).join("||"),"){",te,".vertexAttrib4f(",ue,",",De,");",Sn.map(function(dt,xt){return Ce+"."+dt+"="+De[xt]+";"}).join(""),"}")}Ae===yi?wt():Ae===Os?et():(w("if(",Ae,"===",yi,"){"),wt(),w("}else{"),et(),w("}"))}ne.forEach(function(N){var Y=N.name,k=K.attributes[Y],te;if(k){if(!oe(k))return;te=k.append(F,w)}else{if(!oe(Ci))return;var ue=F.scopeAttrib(Y);M.optional(function(){F.assert(w,ue+".state","missing attribute "+Y)}),te={},Object.keys(new e).forEach(function(Ce){te[Ce]=w.def(ue,".",Ce)})}J(F.link(N),V(N.info.type),te)})}function St(F,w,K,ne,oe){for(var $=F.shared,V=$.gl,J,N=0;N<ne.length;++N){var Y=ne[N],k=Y.name,te=Y.info.type,ue=K.uniforms[k],Ce=F.link(Y),Ae=Ce+".location",Se;if(ue){if(!oe(ue))continue;if(kn(ue)){var De=ue.value;if(M.command(De!==null&&typeof De<"u",'missing uniform "'+k+'"',F.commandStr),te===ja||te===Ya){M.command(typeof De=="function"&&(te===ja&&(De._reglType==="texture2d"||De._reglType==="framebuffer")||te===Ya&&(De._reglType==="textureCube"||De._reglType==="framebufferCube")),"invalid texture for uniform "+k,F.commandStr);var it=F.link(De._texture||De.color[0]._texture);w(V,".uniform1i(",Ae,",",it+".bind());"),w.exit(it,".unbind();")}else if(te===Xa||te===aa||te===Jn){M.optional(function(){M.command(Ut(De),"invalid matrix for uniform "+k,F.commandStr),M.command(te===Xa&&De.length===4||te===aa&&De.length===9||te===Jn&&De.length===16,"invalid length for matrix uniform "+k,F.commandStr)});var wt=F.global.def("new Float32Array(["+Array.prototype.slice.call(De)+"])"),et=2;te===aa?et=3:te===Jn&&(et=4),w(V,".uniformMatrix",et,"fv(",Ae,",false,",wt,");")}else{switch(te){case Qn:M.commandType(De,"number","uniform "+k,F.commandStr),J="1f";break;case Ha:M.command(Ut(De)&&De.length===2,"uniform "+k,F.commandStr),J="2f";break;case za:M.command(Ut(De)&&De.length===3,"uniform "+k,F.commandStr),J="3f";break;case Wa:M.command(Ut(De)&&De.length===4,"uniform "+k,F.commandStr),J="4f";break;case qa:M.commandType(De,"boolean","uniform "+k,F.commandStr),J="1i";break;case ra:M.commandType(De,"number","uniform "+k,F.commandStr),J="1i";break;case Bo:M.command(Ut(De)&&De.length===2,"uniform "+k,F.commandStr),J="2i";break;case Ln:M.command(Ut(De)&&De.length===2,"uniform "+k,F.commandStr),J="2i";break;case Zn:M.command(Ut(De)&&De.length===3,"uniform "+k,F.commandStr),J="3i";break;case na:M.command(Ut(De)&&De.length===3,"uniform "+k,F.commandStr),J="3i";break;case Ua:M.command(Ut(De)&&De.length===4,"uniform "+k,F.commandStr),J="4i";break;case ia:M.command(Ut(De)&&De.length===4,"uniform "+k,F.commandStr),J="4i";break}w(V,".uniform",J,"(",Ae,",",Ut(De)?Array.prototype.slice.call(De):De,");")}continue}else Se=ue.append(F,w)}else{if(!oe(Ci))continue;Se=w.def($.uniforms,"[",L.id(k),"]")}te===ja?(M(!Array.isArray(Se),"must specify a scalar prop for textures"),w("if(",Se,"&&",Se,'._reglType==="framebuffer"){',Se,"=",Se,".color[0];","}")):te===Ya&&(M(!Array.isArray(Se),"must specify a scalar prop for cube maps"),w("if(",Se,"&&",Se,'._reglType==="framebufferCube"){',Se,"=",Se,".color[0];","}")),M.optional(function(){function Or(On,zu){F.assert(w,On,'bad data or missing for uniform "'+k+'".  '+zu)}function Gu(On){M(!Array.isArray(Se),"must not specify an array type for uniform"),Or("typeof "+Se+'==="'+On+'"',"invalid type, expected "+On)}function rn(On,zu){Array.isArray(Se)?M(Se.length===On,"must have length "+On):Or($.isArrayLike+"("+Se+")&&"+Se+".length==="+On,"invalid vector, should have length "+On,F.commandStr)}function Hu(On){M(!Array.isArray(Se),"must not specify a value type"),Or("typeof "+Se+'==="function"&&'+Se+'._reglType==="texture'+(On===Ws?"2d":"Cube")+'"',"invalid texture type",F.commandStr)}switch(te){case ra:Gu("number");break;case Ln:rn(2);break;case na:rn(3);break;case ia:rn(4);break;case Qn:Gu("number");break;case Ha:rn(2);break;case za:rn(3);break;case Wa:rn(4);break;case qa:Gu("boolean");break;case Bo:rn(2);break;case Zn:rn(3);break;case Ua:rn(4);break;case Xa:rn(4);break;case aa:rn(9);break;case Jn:rn(16);break;case ja:Hu(Ws);break;case Ya:Hu(Ru);break}});var dt=1;switch(te){case ja:case Ya:var xt=w.def(Se,"._texture");w(V,".uniform1i(",Ae,",",xt,".bind());"),w.exit(xt,".unbind();");continue;case ra:case qa:J="1i";break;case Ln:case Bo:J="2i",dt=2;break;case na:case Zn:J="3i",dt=3;break;case ia:case Ua:J="4i",dt=4;break;case Qn:J="1f";break;case Ha:J="2f",dt=2;break;case za:J="3f",dt=3;break;case Wa:J="4f",dt=4;break;case Xa:J="Matrix2fv";break;case aa:J="Matrix3fv";break;case Jn:J="Matrix4fv";break}if(w(V,".uniform",J,"(",Ae,","),J.charAt(0)==="M"){var Ot=Math.pow(te-Xa+2,2),rr=F.global.def("new Float32Array(",Ot,")");Array.isArray(Se)?w("false,(",qt(Ot,function(Or){return rr+"["+Or+"]="+Se[Or]}),",",rr,")"):w("false,(Array.isArray(",Se,")||",Se," instanceof Float32Array)?",Se,":(",qt(Ot,function(Or){return rr+"["+Or+"]="+Se+"["+Or+"]"}),",",rr,")")}else dt>1?w(qt(dt,function(Or){return Array.isArray(Se)?Se[Or]:Se+"["+Or+"]"})):(M(!Array.isArray(Se),"uniform value must not be an array"),w(Se));w(");")}}function ot(F,w,K,ne){var oe=F.shared,$=oe.gl,V=oe.draw,J=ne.draw;function N(){var xt=J.elements,Ot,rr=w;return xt?((xt.contextDep&&ne.contextDynamic||xt.propDep)&&(rr=K),Ot=xt.append(F,rr)):Ot=rr.def(V,".",Ur),Ot&&rr("if("+Ot+")"+$+".bindBuffer("+ku+","+Ot+".buffer.buffer);"),Ot}function Y(){var xt=J.count,Ot,rr=w;return xt?((xt.contextDep&&ne.contextDynamic||xt.propDep)&&(rr=K),Ot=xt.append(F,rr),M.optional(function(){xt.MISSING&&F.assert(w,"false","missing vertex count"),xt.DYNAMIC&&F.assert(rr,Ot+">=0","missing vertex count")})):(Ot=rr.def(V,".",Kn),M.optional(function(){F.assert(rr,Ot+">=0","missing vertex count")})),Ot}var k=N();function te(xt){var Ot=J[xt];return Ot?Ot.contextDep&&ne.contextDynamic||Ot.propDep?Ot.append(F,K):Ot.append(F,w):w.def(V,".",xt)}var ue=te(Xr),Ce=te(No),Ae=Y();if(typeof Ae=="number"){if(Ae===0)return}else K("if(",Ae,"){"),K.exit("}");var Se,De;r&&(Se=te(Ba),De=F.instancing);var it=k+".type",wt=J.elements&&kn(J.elements);function et(){function xt(){K(De,".drawElementsInstancedANGLE(",[ue,Ae,it,Ce+"<<(("+it+"-"+Eo+")>>1)",Se],");")}function Ot(){K(De,".drawArraysInstancedANGLE(",[ue,Ce,Ae,Se],");")}k?wt?xt():(K("if(",k,"){"),xt(),K("}else{"),Ot(),K("}")):Ot()}function dt(){function xt(){K($+".drawElements("+[ue,Ae,it,Ce+"<<(("+it+"-"+Eo+")>>1)"]+");")}function Ot(){K($+".drawArrays("+[ue,Ce,Ae]+");")}k?wt?xt():(K("if(",k,"){"),xt(),K("}else{"),Ot(),K("}")):Ot()}r&&(typeof Se!="number"||Se>=0)?typeof Se=="string"?(K("if(",Se,">0){"),et(),K("}else if(",Se,"<0){"),dt(),K("}")):et():dt()}function mt(F,w,K,ne,oe){var $=ce(),V=$.proc("body",oe);return M.optional(function(){$.commandStr=w.commandStr,$.command=$.link(w.commandStr)}),r&&($.instancing=V.def($.shared.extensions,".angle_instanced_arrays")),F($,V,K,ne),$.compile().body}function vt(F,w,K,ne){Tt(F,w),K.useVAO?K.drawVAO?w(F.shared.vao,".setVAO(",K.drawVAO.append(F,w),");"):w(F.shared.vao,".setVAO(",F.shared.vao,".targetVAO);"):(w(F.shared.vao,".setVAO(null);"),Lt(F,w,K,ne.attributes,function(){return!0})),St(F,w,K,ne.uniforms,function(){return!0}),ot(F,w,w,K)}function Wt(F,w){var K=F.proc("draw",1);Tt(F,K),It(F,K,w.context),Et(F,K,w.framebuffer),Gt(F,K,w),Nt(F,K,w.state),nt(F,K,w,!1,!0);var ne=w.shader.progVar.append(F,K);if(K(F.shared.gl,".useProgram(",ne,".program);"),w.shader.program)vt(F,K,w,w.shader.program);else{K(F.shared.vao,".setVAO(null);");var oe=F.global.def("{}"),$=K.def(ne,".id"),V=K.def(oe,"[",$,"]");K(F.cond(V).then(V,".call(this,a0);").else(V,"=",oe,"[",$,"]=",F.link(function(J){return mt(vt,F,w,J,1)}),"(",ne,");",V,".call(this,a0);"))}Object.keys(w.state).length>0&&K(F.shared.current,".dirty=true;")}function Xt(F,w,K,ne){F.batchId="a1",Tt(F,w);function oe(){return!0}Lt(F,w,K,ne.attributes,oe),St(F,w,K,ne.uniforms,oe),ot(F,w,w,K)}function Rn(F,w,K,ne){Tt(F,w);var oe=K.contextDep,$=w.def(),V="a0",J="a1",N=w.def();F.shared.props=N,F.batchId=$;var Y=F.scope(),k=F.scope();w(Y.entry,"for(",$,"=0;",$,"<",J,";++",$,"){",N,"=",V,"[",$,"];",k,"}",Y.exit);function te(it){return it.contextDep&&oe||it.propDep}function ue(it){return!te(it)}if(K.needsContext&&It(F,k,K.context),K.needsFramebuffer&&Et(F,k,K.framebuffer),Nt(F,k,K.state,te),K.profile&&te(K.profile)&&nt(F,k,K,!1,!0),ne)K.useVAO?K.drawVAO?te(K.drawVAO)?k(F.shared.vao,".setVAO(",K.drawVAO.append(F,k),");"):Y(F.shared.vao,".setVAO(",K.drawVAO.append(F,Y),");"):Y(F.shared.vao,".setVAO(",F.shared.vao,".targetVAO);"):(Y(F.shared.vao,".setVAO(null);"),Lt(F,Y,K,ne.attributes,ue),Lt(F,k,K,ne.attributes,te)),St(F,Y,K,ne.uniforms,ue),St(F,k,K,ne.uniforms,te),ot(F,Y,k,K);else{var Ce=F.global.def("{}"),Ae=K.shader.progVar.append(F,k),Se=k.def(Ae,".id"),De=k.def(Ce,"[",Se,"]");k(F.shared.gl,".useProgram(",Ae,".program);","if(!",De,"){",De,"=",Ce,"[",Se,"]=",F.link(function(it){return mt(Xt,F,K,it,2)}),"(",Ae,");}",De,".call(this,a0[",$,"],",$,");")}}function P(F,w){var K=F.proc("batch",2);F.batchId="0",Tt(F,K);var ne=!1,oe=!0;Object.keys(w.context).forEach(function(Ce){ne=ne||w.context[Ce].propDep}),ne||(It(F,K,w.context),oe=!1);var $=w.framebuffer,V=!1;$?($.propDep?ne=V=!0:$.contextDep&&ne&&(V=!0),V||Et(F,K,$)):Et(F,K,null),w.state.viewport&&w.state.viewport.propDep&&(ne=!0);function J(Ce){return Ce.contextDep&&ne||Ce.propDep}Gt(F,K,w),Nt(F,K,w.state,function(Ce){return!J(Ce)}),(!w.profile||!J(w.profile))&&nt(F,K,w,!1,"a1"),w.contextDep=ne,w.needsContext=oe,w.needsFramebuffer=V;var N=w.shader.progVar;if(N.contextDep&&ne||N.propDep)Rn(F,K,w,null);else{var Y=N.append(F,K);if(K(F.shared.gl,".useProgram(",Y,".program);"),w.shader.program)Rn(F,K,w,w.shader.program);else{K(F.shared.vao,".setVAO(null);");var k=F.global.def("{}"),te=K.def(Y,".id"),ue=K.def(k,"[",te,"]");K(F.cond(ue).then(ue,".call(this,a0,a1);").else(ue,"=",k,"[",te,"]=",F.link(function(Ce){return mt(Rn,F,w,Ce,2)}),"(",Y,");",ue,".call(this,a0,a1);"))}}Object.keys(w.state).length>0&&K(F.shared.current,".dirty=true;")}function de(F,w){var K=F.proc("scope",3);F.batchId="a2";var ne=F.shared,oe=ne.current;It(F,K,w.context),w.framebuffer&&w.framebuffer.append(F,K),Xs(Object.keys(w.state)).forEach(function(V){var J=w.state[V],N=J.append(F,K);Ut(N)?N.forEach(function(Y,k){K.set(F.next[V],"["+k+"]",Y)}):K.set(ne.next,"."+V,N)}),nt(F,K,w,!0,!0),[Ur,No,Kn,Ba,Xr].forEach(function(V){var J=w.draw[V];J&&K.set(ne.draw,"."+V,""+J.append(F,K))}),Object.keys(w.uniforms).forEach(function(V){var J=w.uniforms[V].append(F,K);Array.isArray(J)&&(J="["+J.join()+"]"),K.set(ne.uniforms,"["+L.id(V)+"]",J)}),Object.keys(w.attributes).forEach(function(V){var J=w.attributes[V].append(F,K),N=F.scopeAttrib(V);Object.keys(new e).forEach(function(Y){K.set(N,"."+Y,J[Y])})}),w.scopeVAO&&K.set(ne.vao,".targetVAO",w.scopeVAO.append(F,K));function $(V){var J=w.shader[V];J&&K.set(ne.shader,"."+V,J.append(F,K))}$(Cn),$(_n),Object.keys(w.state).length>0&&(K(oe,".dirty=true;"),K.exit(oe,".dirty=true;")),K("a1(",F.shared.context,",a0,",F.batchId,");")}function le(F){if(!(typeof F!="object"||Ut(F))){for(var w=Object.keys(F),K=0;K<w.length;++K)if(nr.isDynamic(F[w[K]]))return!0;return!1}}function je(F,w,K){var ne=w.static[K];if(!ne||!le(ne))return;var oe=F.global,$=Object.keys(ne),V=!1,J=!1,N=!1,Y=F.global.def("{}");$.forEach(function(te){var ue=ne[te];if(nr.isDynamic(ue)){typeof ue=="function"&&(ue=ne[te]=nr.unbox(ue));var Ce=xr(ue,null);V=V||Ce.thisDep,N=N||Ce.propDep,J=J||Ce.contextDep}else{switch(oe(Y,".",te,"="),typeof ue){case"number":oe(ue);break;case"string":oe('"',ue,'"');break;case"object":Array.isArray(ue)&&oe("[",ue.join(),"]");break;default:oe(F.link(ue));break}oe(";")}});function k(te,ue){$.forEach(function(Ce){var Ae=ne[Ce];if(nr.isDynamic(Ae)){var Se=te.invoke(ue,Ae);ue(Y,".",Ce,"=",Se,";")}})}w.dynamic[K]=new nr.DynamicVariable(Na,{thisDep:V,contextDep:J,propDep:N,ref:Y,append:k}),delete w.static[K]}function bt(F,w,K,ne,oe){var $=ce();$.stats=$.link(oe),Object.keys(w.static).forEach(function(J){je($,w,J)}),Au.forEach(function(J){je($,F,J)});var V=Ft(F,w,K,ne,$);return Wt($,V),de($,V),P($,V),m($.compile(),{destroy:function(){V.shader.program.destroy()}})}return{next:o,current:i,procs:function(){var F=ce(),w=F.proc("poll"),K=F.proc("refresh"),ne=F.block();w(ne),K(ne);var oe=F.shared,$=oe.gl,V=oe.next,J=oe.current;ne(J,".dirty=false;"),Et(F,w),Et(F,K,null,!0);var N;r&&(N=F.link(r)),z.oes_vertex_array_object&&K(F.link(z.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Y=0;Y<re.maxAttributes;++Y){var k=K.def(oe.attributes,"[",Y,"]"),te=F.cond(k,".buffer");te.then($,".enableVertexAttribArray(",Y,");",$,".bindBuffer(",ta,",",k,".buffer.buffer);",$,".vertexAttribPointer(",Y,",",k,".size,",k,".type,",k,".normalized,",k,".stride,",k,".offset);").else($,".disableVertexAttribArray(",Y,");",$,".vertexAttrib4f(",Y,",",k,".x,",k,".y,",k,".z,",k,".w);",k,".buffer=null;"),K(te),r&&K(N,".vertexAttribDivisorANGLE(",Y,",",k,".divisor);")}return K(F.shared.vao,".currentVAO=null;",F.shared.vao,".setVAO(",F.shared.vao,".targetVAO);"),Object.keys(l).forEach(function(ue){var Ce=l[ue],Ae=ne.def(V,".",ue),Se=F.block();Se("if(",Ae,"){",$,".enable(",Ce,")}else{",$,".disable(",Ce,")}",J,".",ue,"=",Ae,";"),K(Se),w("if(",Ae,"!==",J,".",ue,"){",Se,"}")}),Object.keys(u).forEach(function(ue){var Ce=u[ue],Ae=i[ue],Se,De,it=F.block();if(it($,".",Ce,"("),Ut(Ae)){var wt=Ae.length;Se=F.global.def(V,".",ue),De=F.global.def(J,".",ue),it(qt(wt,function(et){return Se+"["+et+"]"}),");",qt(wt,function(et){return De+"["+et+"]="+Se+"["+et+"];"}).join("")),w("if(",qt(wt,function(et){return Se+"["+et+"]!=="+De+"["+et+"]"}).join("||"),"){",it,"}")}else Se=ne.def(V,".",ue),De=ne.def(J,".",ue),it(Se,");",J,".",ue,"=",Se,";"),w("if(",Se,"!==",De,"){",it,"}");K(it)}),F.compile()}(),compile:bt}}function Ho(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Pu=34918,Bu=34919,Vl=35007,Yt=function(f,L){if(!L.ext_disjoint_timer_query)return null;var z=[];function re(){return z.pop()||L.ext_disjoint_timer_query.createQueryEXT()}function _e(r){z.push(r)}var pe=[];function ye(r){var n=re();L.ext_disjoint_timer_query.beginQueryEXT(Vl,n),pe.push(n),Ne(pe.length-1,pe.length,r)}function Fe(){L.ext_disjoint_timer_query.endQueryEXT(Vl)}function Ie(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Be=[];function Le(){return Be.pop()||new Ie}function ze(r){Be.push(r)}var Xe=[];function Ne(r,n,i){var o=Le();o.startQueryIndex=r,o.endQueryIndex=n,o.sum=0,o.stats=i,Xe.push(o)}var He=[],e=[];function t(){var r,n,i=pe.length;if(i!==0){e.length=Math.max(e.length,i+1),He.length=Math.max(He.length,i+1),He[0]=0,e[0]=0;var o=0;for(r=0,n=0;n<pe.length;++n){var s=pe[n];L.ext_disjoint_timer_query.getQueryObjectEXT(s,Bu)?(o+=L.ext_disjoint_timer_query.getQueryObjectEXT(s,Pu),_e(s)):pe[r++]=s,He[n+1]=o,e[n+1]=r}for(pe.length=r,r=0,n=0;n<Xe.length;++n){var l=Xe[n],u=l.startQueryIndex,c=l.endQueryIndex;l.sum+=He[c]-He[u];var y=e[u],R=e[c];R===y?(l.stats.gpuTime+=l.sum/1e6,ze(l)):(l.startQueryIndex=y,l.endQueryIndex=R,Xe[r++]=l)}Xe.length=r}}return{beginQuery:ye,endQuery:Fe,pushScopeStats:Ne,update:t,getNumPendingQueries:function(){return pe.length},clear:function(){z.push.apply(z,pe);for(var r=0;r<z.length;r++)L.ext_disjoint_timer_query.deleteQueryEXT(z[r]);pe.length=0,z.length=0},restore:function(){pe.length=0,z.length=0}}},Du=16384,js=256,$a=1024,jr=34962,Qa="webglcontextlost",zo="webglcontextrestored",Ys=1,$l=2,Ql=3;function Wo(f,L){for(var z=0;z<f.length;++z)if(f[z]===L)return z;return-1}function Zl(f){var L=wr(f);if(!L)return null;var z=L.gl,re=z.getContextAttributes(),_e=z.isContextLost(),pe=Pr(z,L);if(!pe)return null;var ye=Ja(),Fe=Ho(),Ie=pe.extensions,Be=Yt(z,Ie),Le=At(),ze=z.drawingBufferWidth,Xe=z.drawingBufferHeight,Ne={tick:0,time:0,viewportWidth:ze,viewportHeight:Xe,framebufferWidth:ze,framebufferHeight:Xe,drawingBufferWidth:ze,drawingBufferHeight:Xe,pixelRatio:L.pixelRatio},He={},e={elements:null,primitive:4,count:-1,offset:0,instances:-1},t=va(z,Ie),r=zr(z,Fe,L,i),n=Xn(z,Ie,t,Fe,r);function i(ot){return n.destroyBuffer(ot)}var o=cu(z,Ie,r,Fe),s=Cu(z,ye,Fe,L),l=Oa(z,Ie,t,function(){y.procs.poll()},Ne,Fe,L),u=xu(z,Ie,t,Fe,L),c=Rl(z,Ie,t,l,u,Fe),y=Kl(z,ye,Ie,t,r,o,l,c,He,n,s,e,Ne,Be,L),R=jn(z,c,y.procs.poll,Ne,re,Ie,t),B=y.next,O=z.canvas,H=[],ce=[],we=[],ge=[L.onDestroy],Oe=null;function Ee(){if(H.length===0){Be&&Be.update(),Oe=null;return}Oe=ca.next(Ee),Nt();for(var ot=H.length-1;ot>=0;--ot){var mt=H[ot];mt&&mt(Ne,null,0)}z.flush(),Be&&Be.update()}function Me(){!Oe&&H.length>0&&(Oe=ca.next(Ee))}function Ye(){Oe&&(ca.cancel(Ee),Oe=null)}function Ze(ot){ot.preventDefault(),_e=!0,Ye(),ce.forEach(function(mt){mt()})}function ct(ot){z.getError(),_e=!1,pe.restore(),s.restore(),r.restore(),l.restore(),u.restore(),c.restore(),n.restore(),Be&&Be.restore(),y.procs.refresh(),Me(),we.forEach(function(mt){mt()})}O&&(O.addEventListener(Qa,Ze,!1),O.addEventListener(zo,ct,!1));function rt(){H.length=0,Ye(),O&&(O.removeEventListener(Qa,Ze),O.removeEventListener(zo,ct)),s.clear(),c.clear(),u.clear(),l.clear(),o.clear(),r.clear(),n.clear(),Be&&Be.clear(),ge.forEach(function(ot){ot()})}function kt(ot){M(!!ot,"invalid args to regl({...})"),M.type(ot,"object","invalid args to regl({...})");function mt(oe){var $=m({},oe);delete $.uniforms,delete $.attributes,delete $.context,delete $.vao,"stencil"in $&&$.stencil.op&&($.stencil.opBack=$.stencil.opFront=$.stencil.op,delete $.stencil.op);function V(J){if(J in $){var N=$[J];delete $[J],Object.keys(N).forEach(function(Y){$[J+"."+Y]=N[Y]})}}return V("blend"),V("depth"),V("cull"),V("stencil"),V("polygonOffset"),V("scissor"),V("sample"),"vao"in oe&&($.vao=oe.vao),$}function vt(oe,$){var V={},J={};return Object.keys(oe).forEach(function(N){var Y=oe[N];if(nr.isDynamic(Y)){J[N]=nr.unbox(Y,N);return}else if($&&Array.isArray(Y)){for(var k=0;k<Y.length;++k)if(nr.isDynamic(Y[k])){J[N]=nr.unbox(Y,N);return}}V[N]=Y}),{dynamic:J,static:V}}var Wt=vt(ot.context||{},!0),Xt=vt(ot.uniforms||{},!0),Rn=vt(ot.attributes||{},!1),P=vt(mt(ot),!1),de={gpuTime:0,cpuTime:0,count:0},le=y.compile(P,Rn,Xt,Wt,de),je=le.draw,bt=le.batch,F=le.scope,w=[];function K(oe){for(;w.length<oe;)w.push(null);return w}function ne(oe,$){var V;if(_e&&M.raise("context lost"),typeof oe=="function")return F.call(this,null,oe,0);if(typeof $=="function")if(typeof oe=="number")for(V=0;V<oe;++V)F.call(this,null,$,V);else if(Array.isArray(oe))for(V=0;V<oe.length;++V)F.call(this,oe[V],$,V);else return F.call(this,oe,$,0);else if(typeof oe=="number"){if(oe>0)return bt.call(this,K(oe|0),oe|0)}else if(Array.isArray(oe)){if(oe.length)return bt.call(this,oe,oe.length)}else return je.call(this,oe)}return m(ne,{stats:de,destroy:function(){le.destroy()}})}var yt=c.setFBO=kt({framebuffer:nr.define.call(null,Ys,"framebuffer")});function Ft(ot,mt){var vt=0;y.procs.poll();var Wt=mt.color;Wt&&(z.clearColor(+Wt[0]||0,+Wt[1]||0,+Wt[2]||0,+Wt[3]||0),vt|=Du),"depth"in mt&&(z.clearDepth(+mt.depth),vt|=js),"stencil"in mt&&(z.clearStencil(mt.stencil|0),vt|=$a),M(!!vt,"called regl.clear with no buffer specified"),z.clear(vt)}function It(ot){if(M(typeof ot=="object"&&ot,"regl.clear() takes an object as input"),"framebuffer"in ot)if(ot.framebuffer&&ot.framebuffer_reglType==="framebufferCube")for(var mt=0;mt<6;++mt)yt(m({framebuffer:ot.framebuffer.faces[mt]},ot),Ft);else yt(ot,Ft);else Ft(null,ot)}function Et(ot){M.type(ot,"function","regl.frame() callback must be a function"),H.push(ot);function mt(){var vt=Wo(H,ot);M(vt>=0,"cannot cancel a frame twice");function Wt(){var Xt=Wo(H,Wt);H[Xt]=H[H.length-1],H.length-=1,H.length<=0&&Ye()}H[vt]=Wt}return Me(),{cancel:mt}}function Gt(){var ot=B.viewport,mt=B.scissor_box;ot[0]=ot[1]=mt[0]=mt[1]=0,Ne.viewportWidth=Ne.framebufferWidth=Ne.drawingBufferWidth=ot[2]=mt[2]=z.drawingBufferWidth,Ne.viewportHeight=Ne.framebufferHeight=Ne.drawingBufferHeight=ot[3]=mt[3]=z.drawingBufferHeight}function Nt(){Ne.tick+=1,Ne.time=nt(),Gt(),y.procs.poll()}function Tt(){l.refresh(),Gt(),y.procs.refresh(),Be&&Be.update()}function nt(){return(At()-Le)/1e3}Tt();function Lt(ot,mt){M.type(mt,"function","listener callback must be a function");var vt;switch(ot){case"frame":return Et(mt);case"lost":vt=ce;break;case"restore":vt=we;break;case"destroy":vt=ge;break;default:M.raise("invalid event, must be one of frame,lost,restore,destroy")}return vt.push(mt),{cancel:function(){for(var Wt=0;Wt<vt.length;++Wt)if(vt[Wt]===mt){vt[Wt]=vt[vt.length-1],vt.pop();return}}}}var St=m(kt,{clear:It,prop:nr.define.bind(null,Ys),context:nr.define.bind(null,$l),this:nr.define.bind(null,Ql),draw:kt({}),buffer:function(ot){return r.create(ot,jr,!1,!1)},elements:function(ot){return o.create(ot,!1)},texture:l.create2D,cube:l.createCube,renderbuffer:u.create,framebuffer:c.create,framebufferCube:c.createCube,vao:n.createVAO,attributes:re,frame:Et,on:Lt,limits:t,hasExtension:function(ot){return t.extensions.indexOf(ot.toLowerCase())>=0},read:R,destroy:rt,_gl:z,_refresh:Tt,poll:function(){Nt(),Be&&Be.update()},now:nt,stats:Fe});return L.onDone(null,St),St}return Zl})}(regl$2)),regl$2.exports}var reglExports=requireRegl();const regl=getDefaultExportFromCjs(reglExports),Mouse=mouseListen();class HydraRenderer{constructor({pb:b=null,width:d=1280,height:m=720,numSources:S=4,numOutputs:I=4,makeGlobal:ae=!0,autoLoop:Q=!0,detectAudio:he=!0,enableStreamCapture:ee=!0,canvas:j,precision:se,extendTransforms:G={}}={}){if(ArrayUtils.init(),this.pb=b,this.width=d,this.height=m,this.renderAll=!1,this.detectAudio=he,this._initCanvas(j),this.synth={time:0,bpm:30,width:this.width,height:this.height,fps:void 0,stats:{fps:0},speed:1,mouse:Mouse,render:this._render.bind(this),setResolution:this.setResolution.bind(this),update:ve=>{},hush:this.hush.bind(this),tick:this.tick.bind(this)},ae&&(window.loadScript=this.loadScript),this.timeSinceLastUpdate=0,this._time=0,se&&["lowp","mediump","highp"].includes(se.toLowerCase()))this.precision=se.toLowerCase();else{let ve=(/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!window.MSStream;this.precision=ve?"highp":"mediump"}if(this.extendTransforms=G,this.saveFrame=!1,this.captureStream=null,this.generator=void 0,this._initRegl(),this._initOutputs(I),this._initSources(S),this._generateGlslTransforms(),this.synth.screencap=()=>{this.saveFrame=!0},ee)try{this.captureStream=this.canvas.captureStream(25),this.synth.vidRecorder=new VideoRecorder(this.captureStream)}catch(ve){console.warn(`[hydra-synth warning]
new MediaSource() is not currently supported on iOS.`),console.error(ve)}he&&this._initAudio(),Q&&loop(this.tick.bind(this)).start(),this.sandbox=new EvalSandbox(this.synth,ae,["speed","update","bpm","fps"])}eval(b){this.sandbox.eval(b)}getScreenImage(b){this.imageCallback=b,this.saveFrame=!0}hush(){this.s.forEach(b=>{b.clear()}),this.o.forEach(b=>{this.synth.solid(0,0,0,0).out(b)}),this.synth.render(this.o[0]),this.sandbox.set("update",b=>{})}loadScript(b=""){return new Promise((m,S)=>{var I=document.createElement("script");I.onload=function(){console.log(`loaded script ${b}`),m()},I.onerror=ae=>{console.log(`error loading script ${b}`,"log-error"),m()},I.src=b,document.head.appendChild(I)})}setResolution(b,d){this.canvas.width=b,this.canvas.height=d,this.width=b,this.height=d,this.sandbox.set("width",b),this.sandbox.set("height",d),console.log(this.width),this.o.forEach(m=>{m.resize(b,d)}),this.s.forEach(m=>{m.resize(b,d)}),this.regl._refresh(),console.log(this.canvas.width)}canvasToImage(b){const d=document.createElement("a");d.style.display="none";let m=new Date;d.download=`hydra-${m.getFullYear()}-${m.getMonth()+1}-${m.getDate()}-${m.getHours()}.${m.getMinutes()}.${m.getSeconds()}.png`,document.body.appendChild(d);var S=this;this.canvas.toBlob(I=>{S.imageCallback?(S.imageCallback(I),delete S.imageCallback):(d.href=URL.createObjectURL(I),console.log(d.href),d.click())},"image/png"),setTimeout(()=>{document.body.removeChild(d),window.URL.revokeObjectURL(d.href)},300)}_initAudio(){this.synth.a=new Audio({numBins:4,parentEl:this.canvas.parentNode})}_initCanvas(b){b?(this.canvas=b,this.width=b.width,this.height=b.height):(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.imageRendering="pixelated",document.body.appendChild(this.canvas))}_initRegl(){this.regl=regl({canvas:this.canvas,pixelRatio:1}),this.regl.clear({color:[0,0,0,1]}),this.renderAll=this.regl({frag:`
      precision ${this.precision} float;
      varying vec2 uv;
      uniform sampler2D tex0;
      uniform sampler2D tex1;
      uniform sampler2D tex2;
      uniform sampler2D tex3;

      void main () {
        vec2 st = vec2(1.0 - uv.x, uv.y);
        st*= vec2(2);
        vec2 q = floor(st).xy*(vec2(2.0, 1.0));
        int quad = int(q.x) + int(q.y);
        st.x += step(1., mod(st.y,2.0));
        st.y += step(1., mod(st.x,2.0));
        st = fract(st);
        if(quad==0){
          gl_FragColor = texture2D(tex0, st);
        } else if(quad==1){
          gl_FragColor = texture2D(tex1, st);
        } else if (quad==2){
          gl_FragColor = texture2D(tex2, st);
        } else {
          gl_FragColor = texture2D(tex3, st);
        }

      }
      `,vert:`
      precision ${this.precision} float;
      attribute vec2 position;
      varying vec2 uv;

      void main () {
        uv = position;
        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);
      }`,attributes:{position:[[-2,0],[0,-2],[2,2]]},uniforms:{tex0:this.regl.prop("tex0"),tex1:this.regl.prop("tex1"),tex2:this.regl.prop("tex2"),tex3:this.regl.prop("tex3")},count:3,depth:{enable:!1}}),this.renderFbo=this.regl({frag:`
      precision ${this.precision} float;
      varying vec2 uv;
      uniform vec2 resolution;
      uniform sampler2D tex0;

      void main () {
        gl_FragColor = texture2D(tex0, vec2(1.0 - uv.x, uv.y));
      }
      `,vert:`
      precision ${this.precision} float;
      attribute vec2 position;
      varying vec2 uv;

      void main () {
        uv = position;
        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);
      }`,attributes:{position:[[-2,0],[0,-2],[2,2]]},uniforms:{tex0:this.regl.prop("tex0"),resolution:this.regl.prop("resolution")},count:3,depth:{enable:!1}})}_initOutputs(b){const d=this;this.o=Array(b).fill().map((m,S)=>{var I=new Output({regl:this.regl,width:this.width,height:this.height,precision:this.precision,label:`o${S}`});return I.id=S,d.synth["o"+S]=I,I}),this.output=this.o[0]}_initSources(b){this.s=[];for(var d=0;d<b;d++)this.createSource(d)}createSource(b){let d=new HydraSource({regl:this.regl,pb:this.pb,width:this.width,height:this.height,label:`s${b}`});return this.synth["s"+this.s.length]=d,this.s.push(d),d}_generateGlslTransforms(){var b=this;this.generator=new GeneratorFactory({defaultOutput:this.o[0],defaultUniforms:this.o[0].uniforms,extendTransforms:this.extendTransforms,changeListener:({type:d,method:m,synth:S})=>{d==="add"&&(b.synth[m]=S.generators[m],b.sandbox&&b.sandbox.add(m))}}),this.synth.setFunction=this.generator.setFunction.bind(this.generator)}_render(b){b?(this.output=b,this.isRenderingAll=!1):this.isRenderingAll=!0}tick(b,d){if(this.sandbox.tick(),this.detectAudio===!0&&this.synth.a.tick(),this.sandbox.set("time",this.synth.time+=b*.001*this.synth.speed),this.timeSinceLastUpdate+=b,!this.synth.fps||this.timeSinceLastUpdate>=1e3/this.synth.fps){if(this.synth.stats.fps=Math.ceil(1e3/this.timeSinceLastUpdate),this.synth.update)try{this.synth.update(this.timeSinceLastUpdate)}catch(m){console.log(m)}for(let m=0;m<this.s.length;m++)this.s[m].tick(this.synth.time);for(let m=0;m<this.o.length;m++)this.o[m].tick({time:this.synth.time,mouse:this.synth.mouse,bpm:this.synth.bpm,resolution:[this.canvas.width,this.canvas.height]});this.isRenderingAll?this.renderAll({tex0:this.o[0].getCurrent(),tex1:this.o[1].getCurrent(),tex2:this.o[2].getCurrent(),tex3:this.o[3].getCurrent(),resolution:[this.canvas.width,this.canvas.height]}):this.renderFbo({tex0:this.output.getCurrent(),resolution:[this.canvas.width,this.canvas.height]}),this.timeSinceLastUpdate=0}this.saveFrame===!0&&(this.canvasToImage(),this.saveFrame=!1)}}const hydraUtils={hydra:null,isInitialized:!1,extensionsLoaded:!1,init:function(){if(!this.isInitialized)if(typeof HydraRenderer<"u"){this.setupHydra(),this.isInitialized=!0;return}else console.error("Hydra is not defined. Please ensure Hydra is loaded before using hydraUtils.")},setupHydra:function(){const canvas=document.getElementById("canvas");this.hydra=new HydraRenderer({canvas,detectAudio:!0,enableStreamCapture:!0,width:canvas.clientWidth,height:canvas.clientHeight}),eval("setResolution(canvas.clientWidth, canvas.clientHeight)"),eval("a.show()"),window.hydraSynth=this.hydra,this.loadHydraExtensions()},async loadHydraExtensions(){if(!this.extensionsLoaded)try{console.log("🔄 Loading Hydra extensions..."),await __vitePreload(()=>import("./hydra_extra_shader-X2H_kiQe.js"),[]),console.log("✅ Hydra Extra Shaders loaded"),await __vitePreload(()=>import("./hydraFractal-Dxhf6r4P.js"),[]),console.log("✅ Hydra Fractals loaded"),await __vitePreload(()=>import("./antlia-math-C4FlbSWj.js"),[]),console.log("✅ Hydra Antlia Math loaded"),await __vitePreload(()=>import("./antlia-shape-BzonWVmP.js"),[]),console.log("✅ Hydra Antlia Shapes loaded"),await __vitePreload(()=>import("./hydraFCS-C7pUOJt8.js"),[]),console.log("✅ Hydra FCS loaded"),await __vitePreload(()=>import("./databending-MuD-zwFE.js"),[]),console.log("✅ Hydra Databending loaded"),this.extensionsLoaded=!0,console.log("🎉 All Hydra extensions loaded successfully!")}catch(T){console.error("❌ Error loading Hydra extensions:",T)}},getBlock:function(T,b){const d=T.lineCount();let m=b,S=b;for(;m>0&&T.getLine(m-1).trim()!=="";)m--;for(;S<d-1&&T.getLine(S+1).trim()!=="";)S++;return{startLine:m,endLine:S}},evaluateCode:function(code){try{eval(code)}catch(T){this.showErrorFlash(T.message),console.error("Error evaluating code:",T)}},showErrorFlash:function(T){const b=document.querySelector(".error-flash");b&&b.remove();const d=document.createElement("div");d.className="error-flash",d.textContent=`Erreur: ${T}`,document.body.appendChild(d),setTimeout(()=>{d.parentNode&&d.remove()},3e3)},stopHydra:function(){eval("hush()")},incrementValue(T,b){const d=T.getCursor(),m=T.getLine(d.line);let S=d.ch,I=d.ch;for(;S>0&&/[\d\.\-]/.test(m.charAt(S-1));)S--;for(;I<m.length&&/[\d\.]/.test(m.charAt(I));)I++;let ae=m.substring(S,I);if(/^\.\d+$/.test(ae)&&(ae="0"+ae),/^-?\d+(\.\d+)?$/.test(ae)){let he;if(ae.includes(".")){const ee=parseFloat(ae),j=ae.split(".")[1]||"",se=j.length>0?j.length:1,G=se>1?.01:.1;he=(ee+b*G).toFixed(se)}else{const ee=parseInt(ae,10);Math.abs(ee)>300?he=(ee+b*100).toString():he=(ee+b).toString()}T.replaceRange(he,{line:d.line,ch:S},{line:d.line,ch:I}),T.setCursor({line:d.line,ch:S+he.length})}},saveEditorContent(T){let b=T.getValue(),d="";d||(d=`hydraCode_${new Date().toISOString().replace(/[:.-]/g,"")}.js`);const m=new Blob([b],{type:"text/plain"}),S=URL.createObjectURL(m),I=document.createElement("a");I.href=S,I.download=d,I.click()},switchOutput(T=null){if(T===null)this.evaluateCode("render()"),document.getElementById("output-src").textContent="all";else{document.getElementById("output-src").textContent=`o${T}`;const b=`render(o${T})`;this.evaluateCode(b)}}},hydraAutocomplete={sources:[{text:"noise(10,0.1)",displayText:"noise"},{text:"voronoi(5,0.3,0.3)",displayText:"voronoi"},{text:"osc(60,0.1,0)",displayText:"osc"},{text:"shape(3,0.3,0.01)",displayText:"shape"},{text:"gradient(0)",displayText:"gradient"},{text:"solid(1,1,1,1)",displayText:"solid"},{text:"src(o0)",displayText:"src"}],implicitCurves:[{text:"iCardioid(1.0,1.0)",displayText:"iCardioid"},{text:"iBicorn(1.0,1.0,1.0)",displayText:"iBicorn"},{text:"iAstroid(1.0,1.0,1.0)",displayText:"iAstroid"},{text:"iCircle(1.0)",displayText:"iCircle"},{text:"iCassOval(1.0,1.0,1.0,1.0)",displayText:"iCassOval"},{text:"iSextic(1.0,1.0,1.0)",displayText:"iSextic"},{text:"iCochleoid(1.0,1.0,1.0)",displayText:"iCochleoid"},{text:"iCissoid(1.0,1.0,10.0)",displayText:"iCissoid"},{text:"iSluzeConchoid(1.0,3.0,1.0)",displayText:"iSluzeConchoid"},{text:"iDevil(1.0,4.0,1.0,3.0)",displayText:"iDevil"},{text:"iDFolium(1.0,3.0)",displayText:"iDFolium"},{text:"iSpiral(1.0,3.0,1.0)",displayText:"iSpiral"},{text:"iFermatSpiral(1.0,1.0,1.0)",displayText:"iFermatSpiral"},{text:"iFreethNephroid(1.0,1.0,2.0)",displayText:"iFreethNephroid"},{text:"iInvoluteCircle(1.0,10.0)",displayText:"iInvoluteCircle"}],parametricCurves:[{text:"pAstroid(1.0)",displayText:"pAstroid"},{text:"pSpiral()",displayText:"pSpiral"},{text:"pCardioid(1.0,2.0)",displayText:"pCardioid"},{text:"pConchoid(1.0)",displayText:"pConchoid"},{text:"pEpicycloid(1.0,1.0)",displayText:"pEpicycloid"},{text:"pDescartesFolium(1.0,1.0)",displayText:"pDescartesFolium"},{text:"pHypocycloid(1.0,2.0)",displayText:"pHypocycloid"},{text:"pHypotrochoid(1.0,2.0,1.0)",displayText:"pHypotrochoid"},{text:"pInvoluteCircle(1.0)",displayText:"pInvoluteCircle"},{text:"pCircle(1.0)",displayText:"pCircle"},{text:"pLissajous(5.0,1.0,1.0,0.0)",displayText:"pLissajous"},{text:"pNephroid(1.0)",displayText:"pNephroid"},{text:"pPlateau(2.0,1.0)",displayText:"pPlateau"},{text:"pTalbot(1.0)",displayText:"pTalbot"}],parametricSurfaces:[{text:"pSphere(1.0,1.0)",displayText:"pSphere"},{text:"pMobiusStrip(1.0,1.0)",displayText:"pMobiusStrip"},{text:"pCylinder(1.0,1.0)",displayText:"pCylinder"},{text:"pKleinBottle(1.0,1.0)",displayText:"pKleinBottle"},{text:"pCrossCap(1.0,1.0)",displayText:"pCrossCap"},{text:"pSteiner(1.0,1.0)",displayText:"pSteiner"},{text:"pTorus(1.0,1.0,0.5)",displayText:"pTorus"}],implicitSurfaces:[{text:"iSphere()",displayText:"iSphere"},{text:"iCube()",displayText:"iCube"},{text:"iTorus(0.5,1.0)",displayText:"iTorus"},{text:"iPlane(1.0,1.0,1.0)",displayText:"iPlane"},{text:"iSteiner(1.0)",displayText:"iSteiner"},{text:"iWineGlass(3.2)",displayText:"iWineGlass"},{text:"iGenus2()",displayText:"iGenus2"}],inverseParametricSurfaces:[{text:"ipSphere(1.0)",displayText:"ipSphere"},{text:"ipTorus(1.0)",displayText:"ipTorus"},{text:"ipMobiusStrip()",displayText:"ipMobiusStrip"},{text:"ipCylinder()",displayText:"ipCylinder"},{text:"ipKleinBottle()",displayText:"ipKleinBottle"},{text:"ipCrossCap(1.0)",displayText:"ipCrossCap"}],parametricHypersurfaces:[{text:"hpSphere(1.0)",displayText:"hpSphere"},{text:"hpTorus(1.0,0.5)",displayText:"hpTorus"},{text:"hpCone(1.0)",displayText:"hpCone"},{text:"hpConeOblique(1.0,1.0,1.0,1.0)",displayText:"hpConeOblique"}],explicitCurves:[{text:"eCircle(1.0,1.0)",displayText:"eCircle"},{text:"eBicorn(1.0)",displayText:"eBicorn"},{text:"eCatenary(1.0)",displayText:"eCatenary"},{text:"eCissoid(1.0,2.0)",displayText:"eCissoid"},{text:"eLame(2.0,2.5,3.0,2.0)",displayText:"eLame"},{text:"eNewton(2.0,0.4,1.0,0.8)",displayText:"eNewton"},{text:"ePearl(2.0,1.0,1.0,1.0,1.0,1.0)",displayText:"ePearl"},{text:"ePear(2.0,2.0,9.0)",displayText:"ePear"},{text:"eStrophoid(2.0,5.0)",displayText:"eStrophoid"},{text:"eTrisectrix(2.0,1.0)",displayText:"eTrisectrix"}],noise:[{text:"whitenoise(10.0,0.0)",displayText:"whitenoise"},{text:"colornoise(10.0,0.0)",displayText:"colornoise"},{text:"unoise(10.0,0.1)",displayText:"unoise"},{text:"turb(10.0,0.1,3.0)",displayText:"turb"},{text:"uturb(10.0,0.1,3.0)",displayText:"uturb"},{text:"warp(10.0,0.1,2.0,3.0,1.0)",displayText:"warp"},{text:"cwarp(10.0,0.1,2.0,3.0,1.0,0.5)",displayText:"cwarp"},{text:"ncontour(0.5,0.1,3,5.0,0.5,2.0)",displayText:"ncontour"}],art:[{text:"brick(0.25,0.08,0.01)",displayText:"brick"},{text:"checker(10.0)",displayText:"checker"},{text:"concentric(100.0,0.5,0.5)",displayText:"concentric"},{text:"hextile(10.0)",displayText:"hextile"},{text:"lissa(0.0,10.0,3.0,0.025)",displayText:"lissa"},{text:"pulse(0.5,0.05,0.001)",displayText:"pulse"},{text:"pulsetrain(3.0,0.5,0.05,0.001)",displayText:"pulsetrain"},{text:"spiral(1.0,5.0,0.1)",displayText:"spiral"},{text:"wave(0.0,10.0,3.0,0.025)",displayText:"wave"}],pattern:[{text:"blinking(5.0,5.0,0.5,0.03)",displayText:"blinking"},{text:"blobs(0.1,0.2,0.05)",displayText:"blobs"},{text:"concentric2(5.0,2.0,0.5,1.0)",displayText:"concentric2"},{text:"phasenoise(0,0.1,5.0,0.5,0.03)",displayText:"phasenoise"},{text:"sdfmove(0.73,1.0,-0.5)",displayText:"sdfmove"},{text:"smoothsun(0.3,0.2,1.0,0.5)",displayText:"smoothsun"}],antliaShapes:[{text:"circle(0.3,0.007)",displayText:"circle"},{text:"square(0.25,0)",displayText:"square"},{text:"rectangle(0.3,[1,1],0)",displayText:"rectangle"},{text:"triangle(0.3,0.007)",displayText:"triangle"},{text:"horiz(0.3,0.0007)",displayText:"horiz"},{text:"vert(0.3,0.0007)",displayText:"vert"},{text:"leftdiag(0.3,0.0007)",displayText:"leftdiag"},{text:"rightdiag(0.3,0.0007)",displayText:"rightdiag"},{text:"firstquad(1,1,1,1)",displayText:"firstquad"},{text:"secondquad(1,1,1,1)",displayText:"secondquad"},{text:"thirdquad(1,1,1,1)",displayText:"thirdquad"},{text:"fourthquad(1,1,1,1)",displayText:"fourthquad"},{text:"quad(0,1,1,1,1)",displayText:"quad"},{text:"star(0.3,5,0.007)",displayText:"star"},{text:"grid(8,4,0.05,0.001)",displayText:"grid"}],initSources:[{text:"s0.initCam()",displayText:"SrcWebCam"},{text:'s0.initImage("")',displayText:"SrcImage"},{text:'s0.initVideo("")',displayText:"SrcVideo"},{text:"s0.initScreen()",displayText:"SrcScreen"}],transformations:[{text:"add()",displayText:"add"},{text:"sub()",displayText:"sub"},{text:"mult()",displayText:"mult"},{text:"blend()",displayText:"blend"},{text:"diff()",displayText:"diff"},{text:"layer()",displayText:"layer"},{text:"mask()",displayText:"mask"},{text:"modulate()",displayText:"modulate"},{text:"modulateRepeat(src(o0),3,3,0.5,0.5)",displayText:"modulateRepeat"},{text:"modulateRepeatX(src(o0),3,0.5)",displayText:"modulateRepeatX"},{text:"modulateRepeatY(src(o0),3,0.5)",displayText:"modulateRepeatY"},{text:"modulateRotate(src(o0),1,0)",displayText:"modulateRotate"},{text:"modulateScale(src(o0),1,1)",displayText:"modulateScale"},{text:"modulatePixelate(src(o0),10,3)",displayText:"modulatePixelate"},{text:"modulateHue(src(o0),1)",displayText:"modulateHue"},{text:"modulateKaleid(src(o0),4)",displayText:"modulateKaleid"},{text:"modulateScrollX(src(o0),0.5,0)",displayText:"modulateScrollX"},{text:"modulateScrollY(src(o0),0.5,0)",displayText:"modulateScrollY"},{text:"out(o0)",displayText:"out"}],effects:[{text:"brightness(0.4)",displayText:"brightness"},{text:"contrast(1.6)",displayText:"contrast"},{text:"color(1,1,1)",displayText:"color"},{text:"colorama(0.005)",displayText:"colorama"},{text:"sum(1)",displayText:"sum"},{text:"r(1,0)",displayText:"r"},{text:"g(1,0)",displayText:"g"},{text:"b(1,0)",displayText:"b"},{text:"a(1,0)",displayText:"a"},{text:"invert(1)",displayText:"invert"},{text:"luma(0.5,0.1)",displayText:"luma"},{text:"posterize(3,0.6)",displayText:"posterize"},{text:"saturate(2)",displayText:"saturate"},{text:"hue(0.4)",displayText:"hue"},{text:"shift(0.1,0.1,0.1,0.1)",displayText:"shift"},{text:"thresh(0.5,0.04)",displayText:"thresh"},{text:"kaleid(4)",displayText:"kaleid"},{text:"pixelate(20,20)",displayText:"pixelate"},{text:"repeat(3,3,0,0)",displayText:"repeat"},{text:"repeatX(3,0)",displayText:"repeatX"},{text:"repeatY(3,0)",displayText:"repeatY"},{text:"rotate(10,0)",displayText:"rotate"},{text:"scale(1, screenRatio)",displayText:"scale"},{text:"scroll(0.5,0.5,0,0)",displayText:"scroll"},{text:"scrollX(0.5,0)",displayText:"scrollX"},{text:"scrollY(0.5,0)",displayText:"scrollY"}],colorEffects:[{text:"sepia(1.0)",displayText:"sepia"},{text:"levels(3.0,1.0)",displayText:"levels"},{text:"monotone(3.0,0.6,1.0)",displayText:"monotone"},{text:"hsvshift(0.0,1.0,1.0)",displayText:"hsvshift"},{text:"grarose(1.0)",displayText:"grarose"},{text:"grawave(1.0)",displayText:"grawave"},{text:"colcross(1.0)",displayText:"colcross"},{text:"coldot(1.0)",displayText:"coldot"},{text:"colboost(1.0)",displayText:"colboost"},{text:"colreflect(1.0)",displayText:"colreflect"}],databending:[{text:"databend(0.5,0.1,0.3)",displayText:"databend"},{text:"rgbshift(1.0,0.05,0.2)",displayText:"rgbshift"},{text:"pixelcorrupt(1.0,16.0,0.4)",displayText:"pixelcorrupt"},{text:"compress(1.0,8.0,0.3)",displayText:"compress"},{text:"glitchcoord(0.1,10.0,0.5)",displayText:"glitchcoord"},{text:"pixelsort(0.2,0.5,0.0)",displayText:"pixelsort"},{text:"memcorrupt(0.15,32.0,0.3)",displayText:"memcorrupt"},{text:"interlace(0.1,200.0,0.05)",displayText:"interlace"}],screenSpaceShaders:[{text:"dither()",displayText:"dither"},{text:"dither2()",displayText:"dither2"},{text:"dither4()",displayText:"dither4"},{text:"ditherrnd()",displayText:"ditherrnd"},{text:"ditherrndcolor()",displayText:"ditherrndcolor"},{text:"erode()",displayText:"erode"},{text:"dilate()",displayText:"dilate"},{text:"blur()",displayText:"blur"},{text:"blurmore()",displayText:"blurmore"},{text:"sharpen()",displayText:"sharpen"},{text:"emboss()",displayText:"emboss"},{text:"edge()",displayText:"edge"},{text:"sobelx()",displayText:"sobelx"},{text:"sobely()",displayText:"sobely"},{text:"pxsort(0.2, 0, 0, 1)",displayText:"pxsort"},{text:"pysort(0.2, 0, 0, 1)",displayText:"pysort"}],fractalEffects:[{text:"mirrorX(0,1)",displayText:"mirrorX"},{text:"mirrorY(0,1)",displayText:"mirrorY"},{text:"mirrorX2(0,1)",displayText:"mirrorX2"},{text:"mirrorY2(0,1)",displayText:"mirrorY2"},{text:"mirrorWrap()",displayText:"mirrorWrap"},{text:"polar(1.0, 1.0, 0.5, 0.5)",displayText:"polar"},{text:"inversion()",displayText:"inversion"}],utilities:[{text:"render(o0)",displayText:"render"},{text:"update = () => {}",displayText:"update"},{text:"setResolution(1920,1080)",displayText:"setResolution"},{text:"setFunction({})",displayText:"setFunction"},{text:"setBins(4)",displayText:"setBins"},{text:"setCutoff(4)",displayText:"setCutoff"},{text:"setSmooth(0.8)",displayText:"setSmooth"},{text:"setScale(2)",displayText:"setScale"},{text:"hide()",displayText:"hide"},{text:"show()",displayText:"show"}],mathFunctions:[{text:"()=>Math.sin(time)",displayText:"time"},{text:"()=>sinrange(time, 0,1,1,1)",displayText:"sinrange"},{text:"()=>cosrange(time, 0,1,1)",displayText:"cosrange"},{text:"()=>sinrange(time, 0,1,1)",displayText:"tanrange"},{text:"()=>sawrange(time, 0,1,1)",displayText:"sawrange"},{text:"()=>mouse.x",displayText:"mouse.x"},{text:"()=>mouse.y",displayText:"mouse.y"},{text:"()=>a.fft[0]",displayText:"a0"},{text:"()=>a.fft[1]",displayText:"a1"},{text:"()=>a.fft[2]",displayText:"a2"},{text:"()=>a.fft[3]",displayText:"a3"},{text:"Math.sin()",displayText:"sin"},{text:"Math.cos()",displayText:"cos"},{text:"Math.tan()",displayText:"tan"},{text:"saw()",displayText:"saw"},{text:"()=>sawt()",displayText:"sawt"},{text:"()=>bouncet(time, 3, 1, 8)",displayText:"bouncet"},{text:"Math.random()",displayText:"random"},{text:"rand(0,1)",displayText:"rand"},{text:"Math.PI",displayText:"Math.PI"},{text:"Math.abs()",displayText:"abs"},{text:"Math.floor()",displayText:"floor"},{text:"Math.ceil()",displayText:"ceil"},{text:"Math.round()",displayText:"round"},{text:"Math.min()",displayText:"min"},{text:"Math.max()",displayText:"max"},{text:"screenRatio",displayText:"sr"}],space:[{text:"invtile(0.5)",displayText:"invtile"},{text:"invsqrt(0.5)",displayText:"invsqrt"},{text:"abslog(1.0)",displayText:"abslog"},{text:"swave(1.0)",displayText:"swave"},{text:"centermag(0.4,0.2,0,0)",displayText:"centermag"}],arrayMethods:[{text:"smooth()",displayText:"smooth"},{text:"fast(1)",displayText:"fast"},{text:'ease("linear")',displayText:"ease"},{text:"offset(0)",displayText:"offset"},{text:"fit(0,1)",displayText:"fit"}],createSeparator:function(T){return{text:"",displayText:T,className:"autocomplete-separator",render:function(b,d,m){b.className+=" autocomplete-separator",b.innerHTML=`<span class="separator-text">${m.displayText}</span>`,b.style.pointerEvents="none",b.style.cursor="default",b.setAttribute("data-separator","true"),b.setAttribute("aria-disabled","true")},hint:function(){return!1},disabled:!0,separator:!0}},hint:function(T,b){const d=T.getCursor(),S=T.getLine(d.line).slice(0,d.ch),I=T.getTokenAt(d),ae=d.ch,Q=[this.createSeparator("🔥 Sources"),...this.sources,this.createSeparator("🌊 Noise Functions"),...this.noise,this.createSeparator("🎨 Art Patterns"),...this.art,this.createSeparator("✨ Soft Patterns"),...this.pattern,this.createSeparator("🔷 Antlia Shapes"),...this.antliaShapes,this.createSeparator("� Implicit Curves FCS"),...this.implicitCurves,this.createSeparator("🌐 Parametric Surfaces FCS"),...this.parametricSurfaces,this.createSeparator("�📺 Init Sources"),...this.initSources,this.createSeparator("🔄 Transformations"),...this.transformations,this.createSeparator("⚡ Effects"),...this.effects,this.createSeparator("🌌 Space Effects"),...this.space,this.createSeparator("🌈 Color Effects"),...this.colorEffects,this.createSeparator("💾 DataBending"),...this.databending,this.createSeparator("🌁 Screen Space Shaders"),...this.screenSpaceShaders,this.createSeparator("🪞 Fractal Effects"),...this.fractalEffects,this.createSeparator("🛠️ Utilities"),...this.utilities,this.createSeparator("🧮 Math & Audio"),...this.mathFunctions],he=[this.createSeparator("🔥 Sources"),...this.sources,this.createSeparator("🌊 Noise Functions"),...this.noise,this.createSeparator("🎨 Art Patterns"),...this.art,this.createSeparator("✨ Soft Patterns"),...this.pattern,this.createSeparator("🔷 Antlia Shapes"),...this.antliaShapes,this.createSeparator("� Implicit Curves FCS"),...this.implicitCurves,this.createSeparator("🌐 Parametric Surfaces FCS"),...this.parametricSurfaces,this.createSeparator("�📺 Init Sources"),...this.initSources,this.createSeparator("🛠️ Utilities"),...this.utilities];if(S.trim()==="")return{list:he.filter(G=>G.className==="autocomplete-separator"?!0:G.displayText.includes(I.string)),from:b.Pos(d.line,S.lastIndexOf("(")+1),to:b.Pos(d.line,d.ch)};if(/\]\s*\.\s*\w*$/.test(S)){const se=I.string.slice(0,ae-I.start).replace(/[^a-zA-Z]/g,""),G=S.lastIndexOf(".");return{list:[this.createSeparator("🔗 Array Methods"),...this.arrayMethods.filter(ve=>ve.displayText.includes(se))],from:b.Pos(d.line,G+1),to:b.Pos(d.line,d.ch)}}if(/\.\s*\w*$/.test(S)){const se=I.string.slice(0,ae-I.start).replace(/[^a-zA-Z]/g,""),G=S.lastIndexOf("."),fe=this.transformations.filter(Te=>Te.displayText.includes(se)),ve=this.effects.filter(Te=>Te.displayText.includes(se)),Ge=this.colorEffects.filter(Te=>Te.displayText.includes(se)),qe=this.fractalEffects.filter(Te=>Te.displayText.includes(se)),q=this.screenSpaceShaders.filter(Te=>Te.displayText.includes(se)),A=this.space.filter(Te=>Te.displayText.includes(se)),U=this.parametricCurves.filter(Te=>Te.displayText.includes(se)),h=this.implicitSurfaces.filter(Te=>Te.displayText.includes(se)),_=this.inverseParametricSurfaces.filter(Te=>Te.displayText.includes(se)),D=this.parametricHypersurfaces.filter(Te=>Te.displayText.includes(se)),W=this.explicitCurves.filter(Te=>Te.displayText.includes(se)),ie=this.databending.filter(Te=>Te.displayText.includes(se)),me=[];return fe.length>0&&(me.push(this.createSeparator("🔄 Transformations")),me.push(...fe)),ve.length>0&&(me.push(this.createSeparator("⚡ Effects")),me.push(...ve)),Ge.length>0&&(me.push(this.createSeparator("🌈 Color Effects")),me.push(...Ge)),ie.length>0&&(me.push(this.createSeparator("💾 DataBending")),me.push(...ie)),h.length>0&&(me.push(this.createSeparator("↕️ Implicit Surfaces FCS")),me.push(...h)),qe.length>0&&(me.push(this.createSeparator("🪞 Fractal Effects")),me.push(...qe)),q.length>0&&(me.push(this.createSeparator("🌁 Screen Space Shaders")),me.push(...q)),A.length>0&&(me.push(this.createSeparator("🌌 Space Effects")),me.push(...A)),U.length>0&&(me.push(this.createSeparator("📊 Parametric Curves FCS")),me.push(...U)),_.length>0&&(me.push(this.createSeparator("🔄 Inverse Parametric Surfaces FCS")),me.push(..._)),D.length>0&&(me.push(this.createSeparator("🌀 Parametric Hypersurfaces FCS")),me.push(...D)),W.length>0&&(me.push(this.createSeparator("📈 Explicit Curves FCS")),me.push(...W)),{list:me,from:b.Pos(d.line,G+1),to:b.Pos(d.line,d.ch)}}const ee=I.string.slice(0,ae-I.start).replace(/[^a-zA-Z]/g,"");return{list:ee!==""?Q.filter(se=>se.displayText.includes(ee)):Q,from:b.Pos(d.line,d.ch-ee.length),to:b.Pos(d.line,d.ch)}}};class HydraColorPicker{constructor(){this.hiddenInput=null,this.createHiddenInput()}createHiddenInput(){this.hiddenInput=document.createElement("input"),this.hiddenInput.type="color",this.hiddenInput.style.position="absolute",this.hiddenInput.style.left="-9999px",this.hiddenInput.style.opacity="0",this.hiddenInput.style.pointerEvents="none",this.hiddenInput.tabIndex=-1,document.body.appendChild(this.hiddenInput)}detectColorFunction(b){const d=b.getCursor(),m=b.getLine(d.line),S=/\.color\s*\(/g;let I;for(;(I=S.exec(m))!==null;){const ae=I.index,Q=I.index+I[0].length-1;let he=1,ee=Q,j=!1;for(let se=Q+1;se<m.length&&he>0;se++)if(m[se]==="(")he++;else if(m[se]===")"&&(he--,he===0)){ee=se,j=!0;break}if(d.ch>Q&&d.ch<=(j?ee:m.length)){const se=m.substring(Q+1,j?ee:m.length),G=this.parseColorValues(se);return{found:!0,start:{line:d.line,ch:ae},end:{line:d.line,ch:j?ee+1:m.length},openParenPos:Q+1,closeParenPos:j?ee:m.length,currentValues:G,isEmpty:se.trim()===""}}}return{found:!1}}parseColorValues(b){const d=b.trim();if(d==="")return{r:1,g:0,b:0};const m=d.split(",").map(S=>{const I=parseFloat(S.trim());return isNaN(I)?0:Math.max(0,Math.min(1,I))});return{r:m[0]!==void 0?m[0]:1,g:m[1]!==void 0?m[1]:0,b:m[2]!==void 0?m[2]:0}}openNativeColorPicker(b,d,m){if(!d||!d.found){console.log("Place your cursor in a .color() function to use the color picker");return}const S=this.rgbToHex(d.currentValues.r,d.currentValues.g,d.currentValues.b);this.hiddenInput.value=S,this.handleColorChange&&(this.hiddenInput.removeEventListener("change",this.handleColorChange),this.hiddenInput.removeEventListener("input",this.handleColorChange)),this.handleColorChange=I=>{const ae=I.target.value,Q=this.hexToRgb(ae);m&&m(Q.r,Q.g,Q.b,d),this.hiddenInput.removeEventListener("change",this.handleColorChange),this.hiddenInput.removeEventListener("input",this.handleColorChange)},this.hiddenInput.addEventListener("change",this.handleColorChange),this.hiddenInput.addEventListener("input",this.handleColorChange);try{this.hiddenInput.showPicker?this.hiddenInput.showPicker():(console.log("showPicker() not supported, using fallback..."),this.openColorPickerFallback(b,d,m))}catch(I){console.log("Could not open color picker:",I),this.openColorPickerFallback(b,d,m)}}openColorPickerFallback(b,d,m){const S=document.createElement("div");S.style.cssText=`
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #0f1419, #1a1b26);
            border: 2px solid #4A90C2;
            border-radius: 8px;
            padding: 15px;
            z-index: 9999;
            font-family: 'Fira Code', monospace;
            color: #E8F4FD;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
        `;const I=document.createElement("div");I.textContent="🎨 Color Picker",I.style.cssText="margin-bottom: 10px; text-align: center; font-weight: bold;";const ae=document.createElement("input");ae.type="color",ae.value=this.rgbToHex(d.currentValues.r,d.currentValues.g,d.currentValues.b),ae.style.cssText=`
            width: 80px; 
            height: 40px; 
            border: 2px solid #6BBFDF; 
            border-radius: 6px;
            cursor: pointer;
            display: block;
            margin: 0 auto 10px auto;
        `;const Q=document.createElement("div");Q.textContent="Press Escape to cancel",Q.style.cssText="font-size: 11px; text-align: center; opacity: 0.7;",S.appendChild(I),S.appendChild(ae),S.appendChild(Q),document.body.appendChild(S),ae.addEventListener("change",j=>{const se=this.hexToRgb(j.target.value);m(se.r,se.g,se.b,d),document.body.removeChild(S)}),ae.focus();const he=j=>{j.key==="Escape"&&(document.body.contains(S)&&document.body.removeChild(S),document.removeEventListener("keydown",he),document.removeEventListener("click",ee))},ee=j=>{S.contains(j.target)||(document.body.contains(S)&&document.body.removeChild(S),document.removeEventListener("keydown",he),document.removeEventListener("click",ee))};document.addEventListener("keydown",he),setTimeout(()=>{document.addEventListener("click",ee)},100)}rgbToHex(b,d,m){const S=I=>{const ae=Math.round(Math.max(0,Math.min(255,I*255))).toString(16);return ae.length===1?"0"+ae:ae};return`#${S(b)}${S(d)}${S(m)}`}hexToRgb(b){const d=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(b);return d?{r:parseInt(d[1],16)/255,g:parseInt(d[2],16)/255,b:parseInt(d[3],16)/255}:{r:0,g,b:0}}}const hydraColorPicker=new HydraColorPicker,sources={noise:`noise(scale, offset)
Generates Perlin noise. 
scale: noise scale (default: 10)
offset: noise offset (default: 0.1)`,voronoi:`voronoi(scale, speed, blending)
Generates a Voronoi pattern. 
scale: pattern scale (default: 5)
speed: animation speed (default: 0.3)
blending: edge smoothing (default: 0.3)`,osc:`osc(frequency, sync, offset)
Sinusoidal oscillator. 
frequency: oscillation frequency (default: 60)
sync: synchronization (default: 0.1)
offset: phase offset (default: 0)`,shape:`shape(sides, radius, smoothing)
Creates a geometric shape. 
sides: number of sides (default: 3)
radius: shape radius (default: 0.3)
smoothing: edge smoothing (default: 0.01)`,gradient:`gradient(speed)
Generates an animated gradient. 
speed: animation speed (default: 0)`,solid:`solid(r, g, b, a)
Creates a solid color. 
r,g,b: color components (0-1)
a: alpha channel (default: 1)`,src:`src(input)
Retrieves a video source. 
input: source name (o0-o3, s0-s3)`,whitenoise:`whitenoise(size, dynamic)
Black and white high frequency noise.
size: float (default: 10.0)
dynamic: float (default: 0.0)`,colornoise:`colornoise(size, dynamic)
Colored high frequency noise.
size: float (default: 10.0)
dynamic: float (default: 0.0)`,unoise:`unoise(scale, offset)
Unsigned Perlin noise scaled to 0..1.
scale: float (default: 10.0)
offset: float (default: 0.1)`,turb:`turb(scale, offset, octaves)
Turbulent noise (signed value).
scale: float (default: 10.0)
offset: float (default: 0.1)
octaves: float (default: 3.0)`,uturb:`uturb(scale, offset, octaves)
Unsigned turbulent noise scaled to 0..1.
scale: float (default: 10.0)
offset: float (default: 0.1)
octaves: float (default: 3.0)`,warp:`warp(scalei, offset, octaves, octavesinner, scale)
Domain warping noise.
scalei: float (default: 10.0)
offset: float (default: 0.1)
octaves: float (default: 2.0)
octavesinner: float (default: 3.0)
scale: float (default: 1.0)`,cwarp:`cwarp(scalei, offset, octaves, octavesinner, scale, focus)
Centered domain warping noise.
scalei: float (default: 10.0)
offset: float (default: 0.1)
octaves: float (default: 2.0)
octavesinner: float (default: 3.0)
scale: float (default: 1.0)
focus: float (default: 0.5)`,ncontour:`ncontour(thresh, smooth, octaves, scale, speed, step)
Contour from noise.
thresh: float (default: 0.5)
smooth: float (default: 0.1)
octaves: int (default: 3)
scale: float (default: 5.0)
speed: float (default: 0.5)
step: float (default: 2.0)`,brick:`brick(width, height, gap)
Brick pattern.

see: Ebert, Musgrave, Peachey, Perlin Worley
"Texturing and Modeling – A Procedural Approach"
Darwyn Peachey, Building Procedural Textures, page 37

width: float (default: 0.25)
height: float (default: 0.08)
gap: float (default: 0.01)`,checker:`checker()
Checkerboard pattern.

repeats: float (default: 10.0)`,concentric:`concentric(scale, centerX, centerY)
Concentric circles pattern.

scale: float (default: 100.0)
centerX: float (default: 0.5)
centerY: float (default: 0.5)`,hextile:`hextile(tiles)
Hex tiles pattern.

tiles: float (default: 10.0)`,lissa:`lissa(time, frequ, loops, thick)
Lissajous curve pattern.

time: float (default: 0.0)
frequ: float (default: 10.0)
loops: float (default: 3.0)
thick: float (default: 0.025)`,pulse:`pulse(edge, width, epsilon)
Pulse pattern.

edge: float (default: 0.5)
width: float (default: 0.05)
epsilon: float (default: 0.001)`,pulsetrain:`pulsetrain(train, edge, width, epsilon)
Pulse train pattern.

train: float (default: 3.0)
edge: float (default: 0.5)
width: float (default: 0.05)
epsilon: float (default: 0.001)`,spiral:`spiral(a, b, thickness)
Spiral pattern.

a: float (default: 1.0)
b: float (default: 5.0)
thickness: float (default: 0.1)`,wave:`wave(time, frequ, loops, thick)
Wave pattern.

time: float (default: 0.0)
frequ: float (default: 10.0)
loops: float (default: 3.0)
thick: float (default: 0.025)`,blinking:`blinking(tiles, scale, speed, phase)
Blinking grid: Looks like a grid of colorful square lamps.
tiles: float (default: 5.0)
scale: float (default: 5.0)
speed: float (default: 0.5)
phase: float (default: 0.03)`,blobs:`blobs(speed, tresh, soft)
Three blobs are dancing around.
speed: float (default: 0.1)
tresh: float (default: 0.2)
soft: float (default: 0.05)`,concentric2:`concentric2(base, octaves, ampscale, speed)
Harmonic concentric rings pattern.
base: float (default: 5.0)
octaves: float (default: 2.0)
ampscale: float (default: 0.5)
speed: float (default: 1.0)`,phasenoise:`phasenoise(base, range, scale, speed, phase)
Noise in HSV with phase shifting.
base: float (default: 0.0)
range: float (default: 0.1)
scale: float (default: 5.0)
speed: float (default: 0.5)
phase: float (default: 0.03)`,sdfmove:`sdfmove(speed1, speed2, speed3)
Moving ramp pattern.
speed1: float (default: 0.73)
speed2: float (default: 1.0)
speed3: float (default: -0.5)`,smoothsun:`smoothsun(threshold, border, speed, ampscale)
Smooth sun pattern.
threshold: float (default: 0.3)
border: float (default: 0.2)
speed: float (default: 1.0)
ampscale: float (default: 0.5)`,iCardioid:`iCardioid(freq, a)
Cardioid implicit curve.
freq: animation frequency (default: 1.0)
a: shape parameter (default: 1.0)`,iBicorn:`iBicorn(freq, a_exp, a)
Bicorn implicit curve.
freq: animation frequency (default: 1.0)
a_exp: exponent parameter (default: 1.0)
a: shape parameter (default: 1.0)`,iAstroid:`iAstroid(freq, wrap, amp)
Astroid implicit curve.
freq: animation frequency (default: 1.0)
wrap: wrap parameter (default: 1.0)
amp: amplitude (default: 1.0)`,iCircle:`iCircle(freq)
Circle implicit curve.
freq: animation frequency (default: 1.0)`,iCassOval:`iCassOval(freq, mult, a, c)
Cassini oval implicit curve.
freq: animation frequency (default: 1.0)
mult: multiplier (default: 1.0)
a: shape parameter (default: 1.0)
c: constant (default: 1.0)`,iSextic:`iSextic(freq1, freq2, a)
Sextic curve.
freq1: first frequency (default: 1.0)
freq2: second frequency (default: 1.0)
a: shape parameter (default: 1.0)`,iCochleoid:`iCochleoid(freq1, freq2, a)
Cochleoid curve.
freq1: first frequency (default: 1.0)
freq2: second frequency (default: 1.0)
a: shape parameter (default: 1.0)`,iCissoid:`iCissoid(freq, a, wrap)
Cissoid curve.
freq: animation frequency (default: 1.0)
a: shape parameter (default: 1.0)
wrap: wrap parameter (default: 10.0)`,iSluzeConchoid:`iSluzeConchoid(freq, a, k)
Conchoid of de Sluze.
freq: animation frequency (default: 1.0)
a: shape parameter (default: 3.0)
k: constant (default: 1.0)`,iDevil:`iDevil(freq, wrap, k, a)
Devil curve.
freq: animation frequency (default: 1.0)
wrap: wrap parameter (default: 4.0)
k: shape parameter (default: 1.0)
a: scale parameter (default: 3.0)`,iDFolium:`iDFolium(freq, a)
Descartes folium.
freq: animation frequency (default: 1.0)
a: shape parameter (default: 3.0)`,iSpiral:`iSpiral(freq, a, b)
Spiral curve.
freq: animation frequency (default: 1.0)
a: spiral parameter (default: 3.0)
b: decay parameter (default: 1.0)`,iFermatSpiral:`iFermatSpiral(freq, a, b)
Fermat spiral.
freq: animation frequency (default: 1.0)
a: scale parameter (default: 1.0)
b: spiral parameter (default: 1.0)`,iFreethNephroid:`iFreethNephroid(freq1, freq2, a)
Freeth nephroid.
freq1: first frequency (default: 1.0)
freq2: second frequency (default: 1.0)
a: scale parameter (default: 2.0)`,iInvoluteCircle:`iInvoluteCircle(freq, wrap)
Involute of circle.
freq: animation frequency (default: 1.0)
wrap: wrap parameter (default: 10.0)`,pSphere:`pSphere(freq, a)
Parametric sphere.
freq: animation frequency (default: 1.0)
a: radius (default: 1.0)`,pMobiusStrip:`pMobiusStrip(freq, a)
Mobius strip.
freq: animation frequency (default: 1.0)
a: width parameter (default: 1.0)`,pCylinder:`pCylinder(freq, a)
Parametric cylinder.
freq: animation frequency (default: 1.0)
a: radius (default: 1.0)`,pKleinBottle:`pKleinBottle(freq, aa)
Klein bottle.
freq: animation frequency (default: 1.0)
aa: shape parameter (default: 1.0)`,pCrossCap:`pCrossCap(freq, aa)
Cross cap surface.
freq: animation frequency (default: 1.0)
aa: scale parameter (default: 1.0)`,pSteiner:`pSteiner(freq, aa)
Steiner surface.
freq: animation frequency (default: 1.0)
aa: scale parameter (default: 1.0)`,pTorus:`pTorus(freq, a, c)
Parametric torus.
freq: animation frequency (default: 1.0)
a: tube radius (default: 1.0)
c: torus radius (default: 0.5)`},initSources={initCam:`s0.initCam()
Initializes webcam as video source`,initImage:`s0.initImage(url)
Initializes an image as video source`,initVideo:`s0.initVideo(url)
Initializes a video as video source`,initScreen:`s0.initScreen()
Initializes screen capture as video source`},transformations={add:`add(texture, amount)
Adds a texture with another. 
texture: texture to add 
amount: addition strength (default: 1)`,sub:`sub(texture, amount)
Subtracts a texture from another. 
texture: texture to subtract 
amount: subtraction strength (default: 1)`,mult:`mult(texture, amount)
Multiplies a texture with another. 
texture: multiplicative texture 
amount: multiplication strength (default: 1)`,blend:`blend(texture, amount)
Blends a texture with another. 
texture: texture to blend 
amount: blend strength (default: 0.5)`,diff:`diff(texture)
Creates absolute difference between two textures. 
texture: texture to compare`,layer:`layer(texture)
Layers a texture on top of another. 
texture: texture to layer`,mask:`mask(texture)
Masks a texture with another. 
texture: masking texture (black = transparent, white = opaque)`,modulate:`modulate(texture, amount)
Modulates UV coordinates with a texture. 
texture: modulation texture 
amount: modulation intensity (default: 0.1)`,modulateRepeat:`modulateRepeat(texture, repeatX, repeatY, offsetX, offsetY)
Repeats texture using brightness of another. 
texture: modulation texture 
repeatX/Y: number of repetitions (default: 3) 
offsetX/Y: offset (default: 0.5)`,modulateRotate:`modulateRotate(texture, multiple, offset)
Rotates texture based on brightness of another. 
texture: modulation texture 
multiple: rotation multiplier (default: 1) 
offset: rotation offset (default: 0)`,modulateScale:`modulateScale(texture, multiple, offset)
Scales texture based on brightness of another. 
texture: modulation texture 
multiple: scale multiplier (default: 1) 
offset: scale offset (default: 1)`,modulatePixelate:`modulatePixelate(texture, multiple, offset)
Pixelates texture based on brightness of another. 
texture: modulation texture 
multiple: pixelation multiplier (default: 10) 
offset: pixelation offset (default: 3)`,modulateKaleid:`modulateKaleid(texture, nSides)
Applies modulated kaleidoscope effect. 
texture: modulation texture 
nSides: number of sides (default: 4)`,modulateScrollX:`modulateScrollX(texture, scrollX, speed)
Modulated horizontal scrolling. 
texture: modulation texture 
scrollX: scroll amount (default: 0.5) 
speed: scroll speed (default: 0)`,modulateScrollY:`modulateScrollY(texture, scrollY, speed)
Modulated vertical scrolling. 
texture: modulation texture 
scrollY: scroll amount (default: 0.5) 
speed: scroll speed (default: 0)`,out:`out(buffer)
Sends result to an output buffer. 
buffer: destination buffer (o0-o3, default: o0)`},effects={brightness:`brightness(amount)
Adjusts brightness. 
amount: brightness level (default: 0.4)`,contrast:`contrast(amount)
Adjusts contrast. 
amount: contrast level (default: 1.6)`,color:`color(r, g, b)
Adjusts RGB colors. 
r, g, b: channel multipliers (default: 1)`,colorama:`colorama(amount)
Shifts HSV colors. 
amount: shift intensity (default: 0.005)`,invert:`invert(amount)
Inverts colors. 
amount: inversion intensity (default: 1)`,luma:`luma(threshold, tolerance)
Filters by brightness. 
threshold: threshold (default: 0.5) 
tolerance: tolerance (default: 0.1)`,posterize:`posterize(bins, gamma)
Reduces number of colors. 
bins: number of levels (default: 3) 
gamma: gamma adjustment (default: 0.6)`,saturate:`saturate(amount)
Adjusts saturation. 
amount: saturation level (default: 2)`,hue:`hue(amount)
Shifts hue. 
amount: shift amount (default: 0.4)`,thresh:`thresh(threshold, tolerance)
Thresholds pixels. 
threshold: threshold (default: 0.5) 
tolerance: tolerance (default: 0.04)`,kaleid:`kaleid(nSides)
Kaleidoscope effect. 
nSides: number of sides (default: 4)`,pixelate:`pixelate(pixelX, pixelY)
Pixelates the image. 
pixelX, pixelY: pixel size (default: 20, 20)`,repeat:`repeat(repeatX, repeatY, offsetX, offsetY)
Repeats the image. 
repeatX, repeatY: number of repetitions (default: 3, 3) 
offsetX, offsetY: offset (default: 0, 0)`,repeatX:`repeatX(reps, offset)
Repeats image horizontally. 
reps: number of repetitions (default: 3) 
offset: offset (default: 0)`,repeatY:`repeatY(reps, offset)
Repeats image vertically. 
reps: number of repetitions (default: 3) 
offset: offset (default: 0)`,rotate:`rotate(angle, speed)
Rotates the image. 
angle: angle in radians (default: 10) 
speed: rotation speed (default: 0)`,scale:`scale(amount, xMult, yMult, offsetX, offsetY)
Scales the image. 
amount: size (default: 1.5) 
xMult, yMult: x/y multipliers (default: 1, 1) 
offsetX, offsetY: center offset (default: 0.5, 0.5)`,scrollX:`scrollX(scrollX, speed)
Horizontal scrolling. 
scrollX: scroll amount (default: 0.5) 
speed: speed (default: 0)`,scrollY:`scrollY(scrollY, speed)
Vertical scrolling. 
scrollY: scroll amount (default: 0.5) 
speed: speed (default: 0)`},utilities={render:`render(buffer)
Displays a buffer on screen. 
buffer: buffer to render (default: o0)`,update:`update = callback => {...}
Adds a function to execute each frame`,setResolution:`setResolution(width, height)
Adjusts canvas resolution`,setFunction:`setFunction(objects)
Defines custom functions`,setBins:`setBins(numBins)
Sets number of bins for audio analysis`,setCutoff:`setCutoff(cutoff)
Sets threshold value for audio analysis`,setSmooth:`setSmooth(smooth)
Sets smoothing for audio analysis`,setScale:`setScale(scale)
Sets scale for audio analysis`,hide:`hide()
Hides the canvas`,show:`show()
Shows the canvas`},arrayMethods={smooth:`array.smooth()
Smoothes transitions between values in an array`,fast:`array.fast(speed)
Controls value change speed. 
speed: speed (default: 1)`,ease:`array.ease(easing)
Applies easing function. 
easing: easing type (default: "linear")`,offset:`array.offset(amount)
Shifts values by a constant. 
amount: offset value`,fit:`array.fit(low, high)
Rescales values to a range. 
low, high: destination range`},mathFunctions={time:`time
Variable that increments automatically`,sinrange:`sinrange(x, min, max, freq)
Sine wave in a range. 
x: time or value 
min: minimum value (default: 0)
max: maximum value (default: 1)
freq: frequency (default: 1)`,cosrange:`cosrange(x, min, max, freq)
Cosine wave in a range. 
x: time or value 
min: minimum value (default: 0)
max: maximum value (default: 1)
freq: frequency (default: 1)`,tanrange:`tanrange(x, min, max, freq)
Tangent wave in a range. 
x: time or value 
min: minimum value (default: 0)
max: maximum value (default: 1)
freq: frequency (default: 1)`,mouse:`mouse
Mouse position (x and y between 0 and 1)`,"a.fft":`a.fft[index]
Accesses audio frequency analysis`,sin:`Math.sin(x)
Calculates sine of x`,cos:`Math.cos(x)
Calculates cosine of x`,tan:`Math.tan(x, amp=3, freq=1)
Calculates tangent of x`,saw:`Math.saw(x)
Generates sawtooth wave. 
x: time or value`,sawt:`Math.sawt(amp=3, freq=1)
Generates sawtooth wave with time. 
x: time or value`,random:`Math.random()
Generates random number between 0 and 1`,"Math.PI":`Math.PI
Constant π (3.14159...)`,rand:`rand(min, max)
Generates random number between min and max. 
min: minimum value (default: 0) 
max: maximum value (default: 1)`,bouncet:`bouncet(t, amp=3, freq=1, bouncing=8)
Generates bouncing effect. 
t: time or value 
amp: amplitude (default: 3) 
freq: frequency (default: 1) 
bouncing: number of bounces (default: 8)`,screenRatio:`screenRatio
Aspect ratio of the screen (height/width)`},colorEffects={sepia:`sepia(amount)
Applies sepia tone effect. 
amount: sepia intensity (default: 1.0)`,levels:`levels(levels, amount)
Reduces color levels while preserving light-dark dynamics. 
levels: number of color levels (default: 3.0) 
amount: effect intensity (default: 1.0)`,monotone:`monotone(levels, hue, amount)
Creates monotone effect with specified hue. 
levels: number of levels (default: 3.0) 
hue: color hue 0-1 (default: 0.6) 
amount: effect intensity (default: 1.0)`,hsvshift:`hsvshift(hue, saturation, value)
Shifts HSV color values. 
hue: hue shift 0-1 (default: 0.0) 
saturation: saturation multiplier (default: 1.0) 
value: brightness multiplier (default: 1.0)`,grarose:`grarose(amount)
Applies rose gradient to grayscale conversion. 
amount: gradient intensity (default: 1.0)`,grawave:`grawave(amount)
Applies wave gradient creating color bands. 
amount: gradient intensity (default: 1.0)`,colcross:`colcross(amount)
Applies RGB cross product for strong color effects. 
amount: effect intensity (default: 1.0)`,coldot:`coldot(amount)
Applies RGB dot product of rotated channels. 
amount: effect intensity (default: 1.0)`,colboost:`colboost(amount)
Boosts colors using vector operations. 
amount: boost intensity (default: 1.0)`,colreflect:`colreflect(amount)
Creates color reflection effect. 
amount: reflection intensity (default: 1.0)`,databend:`databend(amount, shift, corruption)
Simulates digital data corruption with bit shifting. 
amount: corruption intensity (default: 0.5) 
shift: channel shift amount (default: 0.1) 
corruption: digital noise level (default: 0.3)`,rgbshift:`rgbshift(amount, offset, chaos)
Separates and corrupts RGB channels. 
amount: effect intensity (default: 1.0) 
offset: channel separation (default: 0.05) 
chaos: corruption chaos level (default: 0.2)`,pixelcorrupt:`pixelcorrupt(amount, blocksize, corruption)
Corrupts pixels in blocks with various digital artifacts. 
amount: effect intensity (default: 1.0) 
blocksize: corruption block size (default: 16.0) 
corruption: corruption probability (default: 0.4)`,compress:`compress(amount, quality, blockiness)
Simulates JPEG-like compression artifacts. 
amount: effect intensity (default: 1.0) 
quality: compression quality levels (default: 8.0) 
blockiness: blocking artifact intensity (default: 0.3)`},screenSpaceShaders={dither:`dither()
Applies black and white ordered dithering.`,dither2:`dither2()
Applies ordered dithering with a 2x2 Bayer matrix for color reduction.`,dither4:`dither4()
Applies ordered dithering with a 4x4 Bayer matrix to preserve more colors.`,ditherrnd:`ditherrnd()
Applies black and white random dithering.`,ditherrndcolor:`ditherrndcolor()
Applies random dithering preserving some colors.`,erode:`erode()
Morphological erode operator.`,dilate:`dilate()
Morphological dilate operator.`,blur:`blur()
Applies a 3x3 Gaussian blur.`,blurmore:`blurmore()
Applies a 5x5 Gaussian blur.`,sharpen:`sharpen()
Applies a sharpening filter.`,emboss:`emboss()
Applies an embossing filter.`,edge:`edge()
Applies an edge detection filter.`,sobelx:`sobelx()
Applies a Sobel filter in the X direction.`,sobely:`sobely()
Applies a Sobel filter in the Y direction.`,pxsort:`pxsort(threshold, frame, dirX, dirY)
Sorts pixels horizontally by brightness.
threshold: (default 0.2)
frame: (default 0)
dirX: (default 0)
dirY: (default 1)`,pysort:`pysort(threshold, frame, dirX, dirY)
Sorts pixels vertically by brightness.
threshold: (default 0.2)
frame: (default 0)
dirX: (default 0)
dirY: (default 1)`},fractalEffects={mirrorX:`mirrorX(pos, coverage)
Mirrors image horizontally from position. 
pos: mirror position (default: 0) 
coverage: effect coverage (default: 1) 
Result: [1234|4321]`,mirrorY:`mirrorY(pos, coverage)
Mirrors image vertically from position. 
pos: mirror position (default: 0) 
coverage: effect coverage (default: 1) 
Same as mirrorX but on Y axis`,mirrorX2:`mirrorX2(pos, coverage)
Mirrors image horizontally from other side. 
pos: mirror position (default: 0) 
coverage: effect coverage (default: 1) 
Result: [8765|5678]`,mirrorY2:`mirrorY2(pos, coverage)
Mirrors image vertically from other side. 
pos: mirror position (default: 0) 
coverage: effect coverage (default: 1) 
Same as mirrorX2 but on Y axis`,mirrorWrap:`mirrorWrap()
Mirrors any out of bounds coordinates. 
Input: [-8,-7,-6,-5,-4,-3,-2,-1] [1,2,3,4,5,6,7,8] [9,10,11,12,13,14,15,16] 
Result: [87654321] [12345678] [87654321]`,polar:`polar(radius, angle, centerX, centerY)
Applies polar transformation. 
radius: radius multiplier (default: 1.0) 
angle: angle multiplier (default: 1.0) 
centerX: horizontal center (default: 0.5) 
centerY: vertical center (default: 0.5)`,inversion:`inversion()
Applies circular inversion transformation. 
Useful for creating fractal-like patterns.`,glitchcoord:`glitchcoord(amount, frequency, chaos)
Applies digital glitch distortions to coordinates. 
amount: distortion strength (default: 0.1) 
frequency: scanline frequency (default: 10.0) 
chaos: chaos factor (default: 0.5)`,pixelsort:`pixelsort(amount, threshold, direction)
Applies pixel sorting effect to coordinates. 
amount: sorting displacement (default: 0.2) 
threshold: sorting trigger threshold (default: 0.5) 
direction: sort direction 0=horizontal, 1=vertical (default: 0.0)`,memcorrupt:`memcorrupt(amount, blocksize, corruption)
Simulates memory corruption on coordinate space. 
amount: corruption strength (default: 0.15) 
blocksize: memory block size (default: 32.0) 
corruption: corruption probability (default: 0.3)`,interlace:`interlace(amount, lines, drift)
Applies interlace corruption effect. 
amount: effect strength (default: 0.1) 
lines: number of scanlines (default: 200.0) 
drift: horizontal drift amount (default: 0.05)`},antliaShapes={circle:`circle(s, smooth)
Creates a circular shape mask.
s: size (default: 0.3)
smooth: edge smoothing (default: 0.007)`,square:`square(s, smooth)
Creates a square shape mask.
s: size (default: 0.25)
smooth: edge smoothing (default: 0)`,rectangle:`rectangle(s, ratio, smooth)
Creates a rectangular shape mask.
s: size (default: 0.3)
ratio: aspect ratio array [width, height] (default: [1,1])
smooth: edge smoothing (default: 0)`,triangle:`triangle(s, smooth)
Creates a triangular shape mask.
s: size (default: 0.3)
smooth: edge smoothing (default: 0.007)`,horiz:`horiz(s, smooth)
Creates a horizontal strip.
s: size (default: 0.3)
smooth: edge smoothing (default: 0.0007)`,vert:`vert(s, smooth)
Creates a vertical strip.
s: size (default: 0.3)
smooth: edge smoothing (default: 0.0007)`,leftdiag:`leftdiag(s, smooth)
Creates a left diagonal strip.
s: size (default: 0.3)
smooth: edge smoothing (default: 0.0007)`,rightdiag:`rightdiag(s, smooth)
Creates a right diagonal strip.
s: size (default: 0.3)
smooth: edge smoothing (default: 0.0007)`,firstquad:`firstquad(r, g, b, a)
Creates a solid color in the first quadrant (top-right).
r,g,b,a: color components (default: 1,1,1,1)`,secondquad:`secondquad(r, g, b, a)
Creates a solid color in the second quadrant (top-left).
r,g,b,a: color components (default: 1,1,1,1)`,thirdquad:`thirdquad(r, g, b, a)
Creates a solid color in the third quadrant (bottom-left).
r,g,b,a: color components (default: 1,1,1,1)`,fourthquad:`fourthquad(r, g, b, a)
Creates a solid color in the fourth quadrant (bottom-right).
r,g,b,a: color components (default: 1,1,1,1)`,quad:`quad(i, r, g, b, a)
Creates a solid color in the specified quadrant.
i: quadrant index (0-3)
r,g,b,a: color components (default: 1,1,1,1)`,star:`star(s, v, smooth)
Creates a star shape.
s: size (default: 0.3)
v: number of points (default: 5)
smooth: edge smoothing (default: 0.007)`,grid:`grid(x, y, b, smooth)
Creates a grid pattern.
x: horizontal divisions (default: 8)
y: vertical divisions (default: 4)
b: border thickness (default: 0.05)
smooth: edge smoothing (default: 0.001)`},parametricCurves={pAstroid:`pAstroid(a)
Parametric astroid curve.
a: scale parameter (default: 1.0)`,pSpiral:`pSpiral()
Parametric spiral curve.`,pCardioid:`pCardioid(a, p)
Parametric cardioid curve.
a: scale parameter (default: 1.0)
p: parameter (default: 2.0)`,pConchoid:`pConchoid(a)
Parametric conchoid curve.
a: shape parameter (default: 1.0)`,pEpicycloid:`pEpicycloid(a, b)
Parametric epicycloid curve.
a: radius parameter (default: 1.0)
b: radius parameter (default: 1.0)`,pDescartesFolium:`pDescartesFolium(a, b)
Parametric Descartes folium.
a: scale parameter (default: 1.0)
b: shape parameter (default: 1.0)`,pHypocycloid:`pHypocycloid(a, b)
Parametric hypocycloid curve.
a: radius parameter (default: 1.0)
b: frequency parameter (default: 2.0)`,pHypotrochoid:`pHypotrochoid(a, b, d)
Parametric hypotrochoid curve.
a: radius parameter (default: 1.0)
b: frequency parameter (default: 2.0)
d: distance parameter (default: 1.0)`,pInvoluteCircle:`pInvoluteCircle(a)
Parametric involute of circle.
a: radius parameter (default: 1.0)`,pCircle:`pCircle(a)
Parametric circle.
a: radius (default: 1.0)`,pLissajous:`pLissajous(a, n, b, phase)
Parametric Lissajous curve.
a: amplitude parameter (default: 5.0)
n: frequency parameter (default: 1.0)
b: amplitude parameter (default: 1.0)
phase: phase shift (default: 0.0)`,pNephroid:`pNephroid(a)
Parametric nephroid curve.
a: radius parameter (default: 1.0)`,pPlateau:`pPlateau(m, n)
Parametric Plateau curve.
m: parameter (default: 2.0)
n: parameter (default: 1.0)`,pTalbot:`pTalbot(a)
Parametric Talbot curve.
a: scale parameter (default: 1.0)`},implicitSurfaces={iSphere:`iSphere()
Implicit sphere surface.`,iCube:`iCube()
Implicit cube surface.`,iTorus:`iTorus(c, a)
Implicit torus surface.
c: minor radius (default: 0.5)
a: major radius (default: 1.0)`,iPlane:`iPlane(nx, ny, nz)
Implicit plane surface.
nx: normal x component (default: 1.0)
ny: normal y component (default: 1.0)
nz: normal z component (default: 1.0)`,iSteiner:`iSteiner(a)
Implicit Steiner surface.
a: shape parameter (default: 1.0)`,iWineGlass:`iWineGlass(k)
Implicit wine glass surface.
k: shape parameter (default: 3.2)`,iGenus2:`iGenus2()
Implicit genus-2 surface.`},inverseParametricSurfaces={ipSphere:`ipSphere(a)
Inverse parametric sphere.
a: radius parameter (default: 1.0)`,ipTorus:`ipTorus(a)
Inverse parametric torus.
a: shape parameter (default: 1.0)`,ipMobiusStrip:`ipMobiusStrip()
Inverse parametric Mobius strip.`,ipCylinder:`ipCylinder()
Inverse parametric cylinder.`,ipKleinBottle:`ipKleinBottle()
Inverse parametric Klein bottle.`,ipCrossCap:`ipCrossCap(a)
Inverse parametric cross cap.
a: scale parameter (default: 1.0)`},parametricHypersurfaces={hpSphere:`hpSphere(a)
Parametric hypersphere.
a: radius parameter (default: 1.0)`,hpTorus:`hpTorus(c, a)
Parametric hypertorus.
c: major radius (default: 1.0)
a: minor radius (default: 0.5)`,hpCone:`hpCone(c)
Parametric hypercone.
c: shape parameter (default: 1.0)`,hpConeOblique:`hpConeOblique(c, vx, vy, vz)
Parametric oblique hypercone.
c: shape parameter (default: 1.0)
vx: direction x (default: 1.0)
vy: direction y (default: 1.0)
vz: direction z (default: 1.0)`},explicitCurves={eCircle:`eCircle(freq, a)
Explicit circle curve.
freq: animation frequency (default: 1.0)
a: radius (default: 1.0)`,eBicorn:`eBicorn(freq)
Explicit bicorn curve.
freq: animation frequency (default: 1.0)`,eCatenary:`eCatenary(freq)
Explicit catenary curve.
freq: animation frequency (default: 1.0)`,eCissoid:`eCissoid(freq, a)
Explicit cissoid curve.
freq: animation frequency (default: 1.0)
a: shape parameter (default: 2.0)`,eLame:`eLame(freq, n, a, b)
Explicit Lamé curve.
freq: animation frequency (default: 2.0)
n: exponent (default: 2.5)
a: scale parameter (default: 3.0)
b: shape parameter (default: 2.0)`,eNewton:`eNewton(freq, g, a, b)
Explicit Newton diverging parabola.
freq: animation frequency (default: 2.0)
g: parameter (default: 0.4)
a: scale parameter (default: 1.0)
b: shape parameter (default: 0.8)`,ePearl:`ePearl(freq, k, a, n, m, p)
Explicit pearls of Sluze.
freq: animation frequency (default: 2.0)
k: scale parameter (default: 1.0)
a: shape parameter (default: 1.0)
n: exponent (default: 1.0)
m: power (default: 1.0)
p: parameter (default: 1.0)`,ePear:`ePear(freq, b, a)
Explicit pear-shaped quartic.
freq: animation frequency (default: 2.0)
b: scale parameter (default: 2.0)
a: shape parameter (default: 9.0)`,eStrophoid:`eStrophoid(freq, a)
Explicit strophoid curve.
freq: animation frequency (default: 2.0)
a: shape parameter (default: 5.0)`,eTrisectrix:`eTrisectrix(freq, a)
Explicit trisectrix of Maclaurin.
freq: animation frequency (default: 2.0)
a: scale parameter (default: 1.0)`},definitions={...sources,...initSources,...transformations,...effects,...colorEffects,...screenSpaceShaders,...fractalEffects,...antliaShapes,...utilities,...arrayMethods,...mathFunctions,...parametricCurves,...implicitSurfaces,...inverseParametricSurfaces,...parametricHypersurfaces,...explicitCurves};function showHydraDefinition(T){const b=T.getCursor(),d=T.getLine(b.line),S=T.getTokenAt(b).string,I=b.ch;document.querySelectorAll(".CodeMirror-tooltip").forEach(ee=>removeTooltip(ee));function Q(ee,j){const se=/([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/g,G=[];let fe;for(;(fe=se.exec(ee))!==null;){const qe=fe[1],q=fe.index,A=fe.index+fe[0].length-1;let U=1,h=A;for(let _=A+1;_<ee.length&&U>0;_++)ee[_]==="("?U++:ee[_]===")"&&U--,h=_;G.push({name:qe,start:q,openParen:A,closeParen:h})}let ve=null,Ge=-1;for(const qe of G)if(j>=qe.openParen&&j<=qe.closeParen){const q=qe.openParen;q>Ge&&(Ge=q,ve=qe.name)}return ve}let he=S;if(S.includes(".")){const ee=S.split(".");he=ee[ee.length-1]}if(!definitions[he]||!he.match(/^[a-zA-Z_]/)){const ee=Q(d,I);ee&&(he=ee)}if(definitions[he]){const ee=definitions[he],j=makeTooltip(T,b,ee);setTimeout(()=>removeTooltip(j),7e3)}}function makeTooltip(T,b,d){const m=document.createElement("div");m.className="CodeMirror-tooltip hydra-tooltip",m.textContent=d,document.body.appendChild(m);const S=T.cursorCoords(b,"page").left,I=S+m.offsetWidth,ae=document.documentElement.clientWidth;return I>ae?m.style.left=`${ae-m.offsetWidth-16}px`:m.style.left=`${S}px`,m.style.top=`${T.cursorCoords(b,"page").bottom}px`,m}function removeTooltip(T){T&&T.parentNode&&T.parentNode.removeChild(T)}function removeAllTooltips(){document.querySelectorAll(".CodeMirror-tooltip").forEach(b=>removeTooltip(b))}document.addEventListener("DOMContentLoaded",()=>{const T=localStorage.getItem("hydra-editor-content"),d=CodeMirror(document.getElementById("editor"),{value:T||"osc(20, 0.1, 0).out()",mode:"javascript",theme:"cobalt",keyMap:"sublime",lineNumbers:!1,autofocus:!0,autoCloseBrackets:!0,styleActiveLine:!0,styleSelectedText:!0,indentUnit:2,tabSize:2,matchBrackets:!0,autoCloseBrackets:!0,lineWrapping:!0});function m(){const j=d.getValue();localStorage.setItem("hydra-editor-content",j)}configPanel.init(d);const S=["initCam","initImage","initVideo","initScreen","render","setResolution","setBin","setCutoff","setSmooth","setScale","hide","show","p5","P5","hush"];function I(j){var{startLine:se,endLine:G}=hydraUtils.getBlock(j,j.getCursor().line);let fe=j.getRange({line:se,ch:0},{line:G,ch:j.getLine(G).length});const ve=S.some(qe=>fe.includes(qe));!/\.out\s*\(.*\)\s*;?$/m.test(fe)&&!ve&&(fe=fe.trim(),fe+=".out()",j.replaceRange(fe,{line:se,ch:0},{line:G,ch:j.getLine(G).length})),hydraUtils.evaluateCode(fe),Q(se,G),m()}function ae(j){var{startLine:se,endLine:G}=hydraUtils.getBlock(j,j.getCursor().line);let fe=j.getRange({line:se,ch:0},{line:G,ch:j.getLine(G).length});hydraUtils.evaluateCode(fe),Q(se,G),m()}function Q(j,se){for(let G=j;G<=se;G++){const fe=d.markText({line:G,ch:0},{line:G,ch:d.getLine(G).length},{className:"flash-highlight"});setTimeout(()=>fe.clear(),200)}}function he(){console.log("Toggling editor visibility"),document.getElementById("editor").classList.toggle("hideEditor")}function ee(j){const se=hydraColorPicker.detectColorFunction(j);se.found?hydraColorPicker.openNativeColorPicker(j,se,(G,fe,ve,Ge)=>{const qe=`${G.toFixed(2)}, ${fe.toFixed(2)}, ${ve.toFixed(2)}`,q={line:Ge.start.line,ch:Ge.openParenPos},A={line:Ge.start.line,ch:Ge.closeParenPos};j.replaceRange(qe,q,A),I(j)}):console.log("Place your cursor in a .color() function to use the color picker")}d.addKeyMap({"Ctrl-Enter":function(j){I(j)},"Ctrl-Alt-Enter":function(j){ae(j)},"Cmd-Enter":function(j){I(j)},"Cmd-Alt-Enter":function(j){ae(j)},"Ctrl-Space":"autocomplete","Cmd-Space":"autocomplete","Ctrl-;":()=>{hydraUtils.stopHydra()},"Cmd-;":()=>{hydraUtils.stopHydra()},"Alt-X":j=>{j.toggleComment()},"Alt-Up":j=>{hydraUtils.incrementValue(j,1),I(j)},"Alt-Down":j=>{hydraUtils.incrementValue(j,-1),I(j)},"Alt-I":j=>{showHydraDefinition(j)},Esc:()=>{removeAllTooltips()},"Alt-H":j=>{he()},"Ctrl-S":j=>{hydraUtils.saveEditorContent(j)},"Cmd-S":j=>{hydraUtils.saveEditorContent(j)},"Ctrl-K":j=>{ee(j)},"Cmd-K":j=>{ee(j)},"Alt-1":()=>{hydraUtils.switchOutput(0)},"Alt-2":()=>{hydraUtils.switchOutput(1)},"Alt-3":()=>{hydraUtils.switchOutput(2)},"Alt-4":()=>{hydraUtils.switchOutput(3)},"Alt-5":()=>{hydraUtils.switchOutput()},"Alt-P":()=>{configPanel.togglePanel()}}),d.setOption("hintOptions",{hint:j=>hydraAutocomplete.hint(j,CodeMirror),completeSingle:!0}),window.addEventListener("beforeunload",()=>{m()});try{hydraUtils.init(),console.log("Hydra initialized successfully.")}catch(j){console.error("Error initializing Hydra:",j)}});
