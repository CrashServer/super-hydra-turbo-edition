(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const S of document.querySelectorAll('link[rel="modulepreload"]'))m(S);new MutationObserver(S=>{for(const P of S)if(P.type==="childList")for(const ie of P.addedNodes)ie.tagName==="LINK"&&ie.rel==="modulepreload"&&m(ie)}).observe(document,{childList:!0,subtree:!0});function d(S){const P={};return S.integrity&&(P.integrity=S.integrity),S.referrerPolicy&&(P.referrerPolicy=S.referrerPolicy),S.crossOrigin==="use-credentials"?P.credentials="include":S.crossOrigin==="anonymous"?P.credentials="omit":P.credentials="same-origin",P}function m(S){if(S.ep)return;S.ep=!0;const P=d(S);fetch(S.href,P)}})();function getDefaultExportFromCjs(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}var codemirror$1={exports:{}},codemirror=codemirror$1.exports,hasRequiredCodemirror;function requireCodemirror(){return hasRequiredCodemirror||(hasRequiredCodemirror=1,function(b,y){(function(d,m){b.exports=m()})(codemirror,function(){var d=navigator.userAgent,m=navigator.platform,S=/gecko\/\d/i.test(d),P=/MSIE \d/.test(d),ie=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(d),Q=/Edge\/(\d+)/.exec(d),he=P||ie||Q,te=he&&(P?document.documentMode||6:+(Q||ie)[1]),z=!Q&&/WebKit\//.test(d),ue=z&&/Qt\/\d+\.\d+/.test(d),D=!Q&&/Chrome\/(\d+)/.exec(d),se=D&&+D[1],ve=/Opera\//.test(d),Ge=/Apple Computer/.test(navigator.vendor),qe=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(d),q=/PhantomJS/.test(d),A=Ge&&(/Mobile\/\w+/.test(d)||navigator.maxTouchPoints>2),j=/Android/.test(d),h=A||j||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(d),_=A||/Mac/.test(m),G=/\bCrOS\b/.test(d),U=/win/i.test(m),ae=ve&&d.match(/Version\/(\d*\.\d*)/);ae&&(ae=Number(ae[1])),ae&&ae>=15&&(ve=!1,z=!0);var we=_&&(ue||ve&&(ae==null||ae<12.11)),Ne=S||he&&te>=9;function ke(e){return new RegExp("(^|\\s)"+e+"(?:$|\\s)\\s*")}var We=function(e,t){var r=e.className,n=ke(t).exec(r);if(n){var i=r.slice(n.index+n[0].length);e.className=r.slice(0,n.index)+(i?n[1]+i:"")}};function C(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function E(e,t){return C(e).appendChild(t)}function p(e,t,r,n){var i=document.createElement(e);if(r&&(i.className=r),n&&(i.style.cssText=n),typeof t=="string")i.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)i.appendChild(t[o]);return i}function Z(e,t,r,n){var i=p(e,t,r,n);return i.setAttribute("role","presentation"),i}var ye;document.createRange?ye=function(e,t,r,n){var i=document.createRange();return i.setEnd(n||e,r),i.setStart(e,t),i}:ye=function(e,t,r){var n=document.body.createTextRange();try{n.moveToElementText(e.parentNode)}catch{return n}return n.collapse(!0),n.moveEnd("character",r),n.moveStart("character",t),n};function Pe(e,t){if(t.nodeType==3&&(t=t.parentNode),e.contains)return e.contains(t);do if(t.nodeType==11&&(t=t.host),t==e)return!0;while(t=t.parentNode)}function Ve(e){var t=e.ownerDocument||e,r;try{r=e.activeElement}catch{r=t.body||null}for(;r&&r.shadowRoot&&r.shadowRoot.activeElement;)r=r.shadowRoot.activeElement;return r}function $e(e,t){var r=e.className;ke(t).test(r)||(e.className+=(r?" ":"")+t)}function Ye(e,t){for(var r=e.split(" "),n=0;n<r.length;n++)r[n]&&!ke(r[n]).test(t)&&(t+=" "+r[n]);return t}var Je=function(e){e.select()};A?Je=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:he&&(Je=function(e){try{e.select()}catch{}});function at(e){return e.display.wrapper.ownerDocument}function Ot(e){return st(e.display.wrapper)}function st(e){return e.getRootNode?e.getRootNode():e.ownerDocument}function ut(e){return at(e).defaultView}function tt(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function pt(e,t,r){t||(t={});for(var n in e)e.hasOwnProperty(n)&&(r!==!1||!t.hasOwnProperty(n))&&(t[n]=e[n]);return t}function Ct(e,t,r,n,i){t==null&&(t=e.search(/[^\s\u00a0]/),t==-1&&(t=e.length));for(var o=n||0,s=i||0;;){var l=e.indexOf("	",o);if(l<0||l>=t)return s+(t-o);s+=l-o,s+=r-s%r,o=l+1}}var Ht=function(){this.id=null,this.f=null,this.time=0,this.handler=tt(this.onTimeout,this)};Ht.prototype.onTimeout=function(e){e.id=0,e.time<=+new Date?e.f():setTimeout(e.handler,e.time-+new Date)},Ht.prototype.set=function(e,t){this.f=t;var r=+new Date+e;(!this.id||r<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,e),this.time=r)};function ft(e,t){for(var r=0;r<e.length;++r)if(e[r]==t)return r;return-1}var Mt=50,$t={toString:function(){return"CodeMirror.Pass"}},ar={scroll:!1},Sr={origin:"*mouse"},ur={origin:"+move"};function Vt(e,t,r){for(var n=0,i=0;;){var o=e.indexOf("	",n);o==-1&&(o=e.length);var s=o-n;if(o==e.length||i+s>=t)return n+Math.min(s,t-i);if(i+=o-n,i+=r-i%r,n=o+1,i>=t)return n}}var Nt=[""];function nn(e){for(;Nt.length<=e;)Nt.push(_t(Nt)+" ");return Nt[e]}function _t(e){return e[e.length-1]}function ri(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=t(e[n],n);return r}function qo(e,t,r){for(var n=0,i=r(t);n<e.length&&r(e[n])<=i;)n++;e.splice(n,0,t)}function M(){}function Za(e,t){var r;return Object.create?r=Object.create(e):(M.prototype=e,r=new M),t&&pt(t,r),r}var Uo=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function ua(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||Uo.test(e))}function an(e,t){return t?t.source.indexOf("\\w")>-1&&ua(e)?!0:t.test(e):ua(e)}function Kr(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}var Yr=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function jt(e){return e.charCodeAt(0)>=768&&Yr.test(e)}function on(e,t,r){for(;(r<0?t>0:t<e.length)&&jt(e.charAt(t));)t+=r;return t}function $r(e,t,r){for(var n=t>r?-1:1;;){if(t==r)return t;var i=(t+r)/2,o=n<0?Math.ceil(i):Math.floor(i);if(o==t)return e(o)?t:r;e(o)?r=o:t=o+n}}function Mn(e,t,r,n){if(!e)return n(t,r,"ltr",0);for(var i=!1,o=0;o<e.length;++o){var s=e[o];(s.from<r&&s.to>t||t==r&&s.to==t)&&(n(Math.max(s.from,t),Math.min(s.to,r),s.level==1?"rtl":"ltr",o),i=!0)}i||n(t,r,"ltr")}var Fn=null;function nr(e,t,r){var n;Fn=null;for(var i=0;i<e.length;++i){var o=e[i];if(o.from<t&&o.to>t)return i;o.to==t&&(o.from!=o.to&&r=="before"?n=i:Fn=i),o.from==t&&(o.from!=o.to&&r!="before"?n=i:Fn=i)}return n??Fn}var ca=function(){var e="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",t="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function r(c){return c<=247?e.charAt(c):1424<=c&&c<=1524?"R":1536<=c&&c<=1785?t.charAt(c-1536):1774<=c&&c<=2220?"r":8192<=c&&c<=8203?"w":c==8204?"b":"L"}var n=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,i=/[stwN]/,o=/[LRr]/,s=/[Lb1n]/,l=/[1n]/;function f(c,w,O){this.level=c,this.from=w,this.to=O}return function(c,w){var O=w=="ltr"?"L":"R";if(c.length==0||w=="ltr"&&!n.test(c))return!1;for(var B=c.length,R=[],H=0;H<B;++H)R.push(r(c.charCodeAt(H)));for(var ce=0,Se=O;ce<B;++ce){var me=R[ce];me=="m"?R[ce]=Se:Se=me}for(var Oe=0,_e=O;Oe<B;++Oe){var Re=R[Oe];Re=="1"&&_e=="r"?R[Oe]="n":o.test(Re)&&(_e=Re,Re=="r"&&(R[Oe]="R"))}for(var Ke=1,Ze=R[0];Ke<B-1;++Ke){var ct=R[Ke];ct=="+"&&Ze=="1"&&R[Ke+1]=="1"?R[Ke]="1":ct==","&&Ze==R[Ke+1]&&(Ze=="1"||Ze=="n")&&(R[Ke]=Ze),Ze=ct}for(var rt=0;rt<B;++rt){var At=R[rt];if(At==",")R[rt]="N";else if(At=="%"){var yt=void 0;for(yt=rt+1;yt<B&&R[yt]=="%";++yt);for(var Ft=rt&&R[rt-1]=="!"||yt<B&&R[yt]=="1"?"1":"N",It=rt;It<yt;++It)R[It]=Ft;rt=yt-1}}for(var Et=0,Gt=O;Et<B;++Et){var Pt=R[Et];Gt=="L"&&Pt=="1"?R[Et]="L":o.test(Pt)&&(Gt=Pt)}for(var Tt=0;Tt<B;++Tt)if(i.test(R[Tt])){var nt=void 0;for(nt=Tt+1;nt<B&&i.test(R[nt]);++nt);for(var Lt=(Tt?R[Tt-1]:O)=="L",St=(nt<B?R[nt]:O)=="L",ot=Lt==St?Lt?"L":"R":O,mt=Tt;mt<nt;++mt)R[mt]=ot;Tt=nt-1}for(var vt=[],Wt,Xt=0;Xt<B;)if(s.test(R[Xt])){var On=Xt;for(++Xt;Xt<B&&s.test(R[Xt]);++Xt);vt.push(new f(0,On,Xt))}else{var N=Xt,de=vt.length,le=w=="rtl"?1:0;for(++Xt;Xt<B&&R[Xt]!="L";++Xt);for(var je=N;je<Xt;)if(l.test(R[je])){N<je&&(vt.splice(de,0,new f(1,N,je)),de+=le);var bt=je;for(++je;je<Xt&&l.test(R[je]);++je);vt.splice(de,0,new f(2,bt,je)),de+=le,N=je}else++je;N<Xt&&vt.splice(de,0,new f(1,N,Xt))}return w=="ltr"&&(vt[0].level==1&&(Wt=c.match(/^\s+/))&&(vt[0].from=Wt[0].length,vt.unshift(new f(0,0,Wt[0].length))),_t(vt).level==1&&(Wt=c.match(/\s+$/))&&(_t(vt).to-=Wt[0].length,vt.push(new f(0,B-Wt[0].length,B)))),w=="rtl"?vt.reverse():vt}}();function kt(e,t){var r=e.order;return r==null&&(r=e.order=ca(e.text,t)),r}var Ja=[],ht=function(e,t,r){if(e.addEventListener)e.addEventListener(t,r,!1);else if(e.attachEvent)e.attachEvent("on"+t,r);else{var n=e._handlers||(e._handlers={});n[t]=(n[t]||Ja).concat(r)}};function sn(e,t){return e._handlers&&e._handlers[t]||Ja}function cr(e,t,r){if(e.removeEventListener)e.removeEventListener(t,r,!1);else if(e.detachEvent)e.detachEvent("on"+t,r);else{var n=e._handlers,i=n&&n[t];if(i){var o=ft(i,r);o>-1&&(n[t]=i.slice(0,o).concat(i.slice(o+1)))}}}function Qt(e,t){var r=sn(e,t);if(r.length)for(var n=Array.prototype.slice.call(arguments,2),i=0;i<r.length;++i)r[i].apply(null,n)}function Yt(e,t,r){return typeof t=="string"&&(t={type:t,preventDefault:function(){this.defaultPrevented=!0}}),Qt(e,r||t.type,e,t),gr(t)||t.codemirrorIgnore}function _r(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var r=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),n=0;n<t.length;++n)ft(r,t[n])==-1&&r.push(t[n])}function wr(e,t){return sn(e,t).length>0}function Nr(e){e.prototype.on=function(t,r){ht(this,t,r)},e.prototype.off=function(t,r){cr(this,t,r)}}function qt(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function _i(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function gr(e){return e.defaultPrevented!=null?e.defaultPrevented:e.returnValue==!1}function In(e){qt(e),_i(e)}function da(e){return e.target||e.srcElement}function Br(e){var t=e.which;return t==null&&(e.button&1?t=1:e.button&2?t=3:e.button&4&&(t=2)),_&&e.ctrlKey&&t==1&&(t=3),t}var Xo=function(){if(he&&te<9)return!1;var e=p("div");return"draggable"in e||"dragDrop"in e}(),Ei;function eo(e){if(Ei==null){var t=p("span","​");E(e,p("span",[t,document.createTextNode("x")])),e.firstChild.offsetHeight!=0&&(Ei=t.offsetWidth<=1&&t.offsetHeight>2&&!(he&&te<8))}var r=Ei?p("span","​"):p("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");return r.setAttribute("cm-text",""),r}var Li;function ln(e){if(Li!=null)return Li;var t=E(e,document.createTextNode("AخA")),r=ye(t,0,1).getBoundingClientRect(),n=ye(t,1,2).getBoundingClientRect();return C(e),!r||r.left==r.right?!1:Li=n.right-r.right<3}var Bt=`

b`.split(/\n/).length!=3?function(e){for(var t=0,r=[],n=e.length;t<=n;){var i=e.indexOf(`
`,t);i==-1&&(i=e.length);var o=e.slice(t,e.charAt(i-1)=="\r"?i-1:i),s=o.indexOf("\r");s!=-1?(r.push(o.slice(0,s)),t+=s+1):(r.push(o),t=i+1)}return r}:function(e){return e.split(/\r\n?|\n/)},Pn=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch{return!1}}:function(e){var t;try{t=e.ownerDocument.selection.createRange()}catch{}return!t||t.parentElement()!=e?!1:t.compareEndPoints("StartToEnd",t)!=0},to=function(){var e=p("div");return"oncopy"in e?!0:(e.setAttribute("oncopy","return;"),typeof e.oncopy=="function")}(),Dr=null;function jo(e){if(Dr!=null)return Dr;var t=E(e,p("span","x")),r=t.getBoundingClientRect(),n=ye(t,0,1).getBoundingClientRect();return Dr=Math.abs(r.left-n.left)>1}var ki={},Gr={};function Hr(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),ki[e]=t}function ni(e,t){Gr[e]=t}function Ai(e){if(typeof e=="string"&&Gr.hasOwnProperty(e))e=Gr[e];else if(e&&typeof e.name=="string"&&Gr.hasOwnProperty(e.name)){var t=Gr[e.name];typeof t=="string"&&(t={name:t}),e=Za(t,e),e.name=t.name}else{if(typeof e=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return Ai("application/xml");if(typeof e=="string"&&/^[\w\-]+\/[\w\-]+\+json$/.test(e))return Ai("application/json")}return typeof e=="string"?{name:e}:e||{name:"null"}}function Oi(e,t){t=Ai(t);var r=ki[t.name];if(!r)return Oi(e,"text/plain");var n=r(e,t);if(Nn.hasOwnProperty(t.name)){var i=Nn[t.name];for(var o in i)i.hasOwnProperty(o)&&(n.hasOwnProperty(o)&&(n["_"+o]=n[o]),n[o]=i[o])}if(n.name=t.name,t.helperType&&(n.helperType=t.helperType),t.modeProps)for(var s in t.modeProps)n[s]=t.modeProps[s];return n}var Nn={};function Ri(e,t){var r=Nn.hasOwnProperty(e)?Nn[e]:Nn[e]={};pt(t,r)}function Vr(e,t){if(t===!0)return t;if(e.copyState)return e.copyState(t);var r={};for(var n in t){var i=t[n];i instanceof Array&&(i=i.concat([])),r[n]=i}return r}function ha(e,t){for(var r;e.innerMode&&(r=e.innerMode(t),!(!r||r.mode==e));)t=r.state,e=r.mode;return r||{mode:e,state:t}}function Mi(e,t,r){return e.startState?e.startState(t,r):!0}var Zt=function(e,t,r){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=r};Zt.prototype.eol=function(){return this.pos>=this.string.length},Zt.prototype.sol=function(){return this.pos==this.lineStart},Zt.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},Zt.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},Zt.prototype.eat=function(e){var t=this.string.charAt(this.pos),r;if(typeof e=="string"?r=t==e:r=t&&(e.test?e.test(t):e(t)),r)return++this.pos,t},Zt.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},Zt.prototype.eatSpace=function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},Zt.prototype.skipToEnd=function(){this.pos=this.string.length},Zt.prototype.skipTo=function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},Zt.prototype.backUp=function(e){this.pos-=e},Zt.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=Ct(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?Ct(this.string,this.lineStart,this.tabSize):0)},Zt.prototype.indentation=function(){return Ct(this.string,null,this.tabSize)-(this.lineStart?Ct(this.string,this.lineStart,this.tabSize):0)},Zt.prototype.match=function(e,t,r){if(typeof e=="string"){var n=function(s){return r?s.toLowerCase():s},i=this.string.substr(this.pos,e.length);if(n(i)==n(e))return t!==!1&&(this.pos+=e.length),!0}else{var o=this.string.slice(this.pos).match(e);return o&&o.index>0?null:(o&&t!==!1&&(this.pos+=o[0].length),o)}},Zt.prototype.current=function(){return this.string.slice(this.start,this.pos)},Zt.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},Zt.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)},Zt.prototype.baseToken=function(){var e=this.lineOracle;return e&&e.baseToken(this.pos)};function lt(e,t){if(t-=e.first,t<0||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var r=e;!r.lines;)for(var n=0;;++n){var i=r.children[n],o=i.chunkSize();if(t<o){r=i;break}t-=o}return r.lines[t]}function fn(e,t,r){var n=[],i=t.line;return e.iter(t.line,r.line+1,function(o){var s=o.text;i==r.line&&(s=s.slice(0,r.ch)),i==t.line&&(s=s.slice(t.ch)),n.push(s),++i}),n}function pa(e,t,r){var n=[];return e.iter(t,r,function(i){n.push(i.text)}),n}function Er(e,t){var r=t-e.height;if(r)for(var n=e;n;n=n.parent)n.height+=r}function v(e){if(e.parent==null)return null;for(var t=e.parent,r=ft(t.lines,e),n=t.parent;n;t=n,n=n.parent)for(var i=0;n.children[i]!=t;++i)r+=n.children[i].chunkSize();return r+t.first}function X(e,t){var r=e.first;e:do{for(var n=0;n<e.children.length;++n){var i=e.children[n],o=i.height;if(t<o){e=i;continue e}t-=o,r+=i.chunkSize()}return r}while(!e.lines);for(var s=0;s<e.lines.length;++s){var l=e.lines[s],f=l.height;if(t<f)break;t-=f}return r+s}function Ae(e,t){return t>=e.first&&t<e.first+e.size}function Ue(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function be(e,t,r){if(r===void 0&&(r=null),!(this instanceof be))return new be(e,t,r);this.line=e,this.ch=t,this.sticky=r}function Qe(e,t){return e.line-t.line||e.ch-t.ch}function zt(e,t){return e.sticky==t.sticky&&Qe(e,t)==0}function Jt(e){return be(e.line,e.ch)}function hr(e,t){return Qe(e,t)<0?t:e}function Fi(e,t){return Qe(e,t)<0?e:t}function Ys(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function gt(e,t){if(t.line<e.first)return be(e.first,0);var r=e.first+e.size-1;return t.line>r?be(r,lt(e,r).text.length):Ko(t,lt(e,t.line).text.length)}function Ko(e,t){var r=e.ch;return r==null||r>t?be(e.line,t):r<0?be(e.line,0):e}function Yo(e,t){for(var r=[],n=0;n<t.length;n++)r[n]=gt(e,t[n]);return r}var Ii=function(e,t){this.state=e,this.lookAhead=t},Qr=function(e,t,r,n){this.state=t,this.doc=e,this.line=r,this.maxLookAhead=n||0,this.baseTokens=null,this.baseTokenPos=1};Qr.prototype.lookAhead=function(e){var t=this.doc.getLine(this.line+e);return t!=null&&e>this.maxLookAhead&&(this.maxLookAhead=e),t},Qr.prototype.baseToken=function(e){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=e;)this.baseTokenPos+=2;var t=this.baseTokens[this.baseTokenPos+1];return{type:t&&t.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-e}},Qr.prototype.nextLine=function(){this.line++,this.maxLookAhead>0&&this.maxLookAhead--},Qr.fromSaved=function(e,t,r){return t instanceof Ii?new Qr(e,Vr(e.mode,t.state),r,t.lookAhead):new Qr(e,Vr(e.mode,t),r)},Qr.prototype.save=function(e){var t=e!==!1?Vr(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new Ii(t,this.maxLookAhead):t};function $s(e,t,r,n){var i=[e.state.modeGen],o={};Vo(e,t.text,e.doc.mode,r,function(c,w){return i.push(c,w)},o,n);for(var s=r.state,l=function(c){r.baseTokens=i;var w=e.state.overlays[c],O=1,B=0;r.state=!0,Vo(e,t.text,w.mode,r,function(R,H){for(var ce=O;B<R;){var Se=i[O];Se>R&&i.splice(O,1,R,i[O+1],Se),O+=2,B=Math.min(R,Se)}if(H)if(w.opaque)i.splice(ce,O-ce,R,"overlay "+H),O=ce+2;else for(;ce<O;ce+=2){var me=i[ce+1];i[ce+1]=(me?me+" ":"")+"overlay "+H}},o),r.state=s,r.baseTokens=null,r.baseTokenPos=1},f=0;f<e.state.overlays.length;++f)l(f);return{styles:i,classes:o.bgClass||o.textClass?o:null}}function Vs(e,t,r){if(!t.styles||t.styles[0]!=e.state.modeGen){var n=va(e,v(t)),i=t.text.length>e.options.maxHighlightLength&&Vr(e.doc.mode,n.state),o=$s(e,t,n);i&&(n.state=i),t.stateAfter=n.save(!i),t.styles=o.styles,o.classes?t.styleClasses=o.classes:t.styleClasses&&(t.styleClasses=null),r===e.doc.highlightFrontier&&(e.doc.modeFrontier=Math.max(e.doc.modeFrontier,++e.doc.highlightFrontier))}return t.styles}function va(e,t,r){var n=e.doc,i=e.display;if(!n.mode.startState)return new Qr(n,!0,t);var o=Jl(e,t,r),s=o>n.first&&lt(n,o-1).stateAfter,l=s?Qr.fromSaved(n,s,o):new Qr(n,Mi(n.mode),o);return n.iter(o,t,function(f){Lr(e,f.text,l);var c=l.line;f.stateAfter=c==t-1||c%5==0||c>=i.viewFrom&&c<i.viewTo?l.save():null,l.nextLine()}),r&&(n.modeFrontier=l.line),l}function Lr(e,t,r,n){var i=e.doc.mode,o=new Zt(t,e.options.tabSize,r);for(o.start=o.pos=n||0,t==""&&Tr(i,r.state);!o.eol();)Pi(i,o,r.state),o.start=o.pos}function Tr(e,t){if(e.blankLine)return e.blankLine(t);if(e.innerMode){var r=ha(e,t);if(r.mode.blankLine)return r.mode.blankLine(r.state)}}function Pi(e,t,r,n){for(var i=0;i<10;i++){n&&(n[0]=ha(e,r).mode);var o=e.token(t,r);if(t.pos>t.start)return o}throw new Error("Mode "+e.name+" failed to advance stream.")}var Qs=function(e,t,r){this.start=e.start,this.end=e.pos,this.string=e.current(),this.type=t||null,this.state=r};function Zs(e,t,r,n){var i=e.doc,o=i.mode,s;t=gt(i,t);var l=lt(i,t.line),f=va(e,t.line,r),c=new Zt(l.text,e.options.tabSize,f),w;for(n&&(w=[]);(n||c.pos<t.ch)&&!c.eol();)c.start=c.pos,s=Pi(o,c,f.state),n&&w.push(new Qs(c,s,Vr(i.mode,f.state)));return n?w:new Qs(c,s,f.state)}function $o(e,t){if(e)for(;;){var r=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!r)break;e=e.slice(0,r.index)+e.slice(r.index+r[0].length);var n=r[1]?"bgClass":"textClass";t[n]==null?t[n]=r[2]:new RegExp("(?:^|\\s)"+r[2]+"(?:$|\\s)").test(t[n])||(t[n]+=" "+r[2])}return e}function Vo(e,t,r,n,i,o,s){var l=r.flattenSpans;l==null&&(l=e.options.flattenSpans);var f=0,c=null,w=new Zt(t,e.options.tabSize,n),O,B=e.options.addModeClass&&[null];for(t==""&&$o(Tr(r,n.state),o);!w.eol();){if(w.pos>e.options.maxHighlightLength?(l=!1,s&&Lr(e,t,n,w.pos),w.pos=t.length,O=null):O=$o(Pi(r,w,n.state,B),o),B){var R=B[0].name;R&&(O="m-"+(O?R+" "+O:R))}if(!l||c!=O){for(;f<w.start;)f=Math.min(w.start,f+5e3),i(f,c);c=O}w.start=w.pos}for(;f<w.pos;){var H=Math.min(w.pos,f+5e3);i(H,c),f=H}}function Jl(e,t,r){for(var n,i,o=e.doc,s=r?-1:t-(e.doc.mode.innerMode?1e3:100),l=t;l>s;--l){if(l<=o.first)return o.first;var f=lt(o,l-1),c=f.stateAfter;if(c&&(!r||l+(c instanceof Ii?c.lookAhead:0)<=o.modeFrontier))return l;var w=Ct(f.text,null,e.options.tabSize);(i==null||n>w)&&(i=l-1,n=w)}return i}function ef(e,t){if(e.modeFrontier=Math.min(e.modeFrontier,t),!(e.highlightFrontier<t-10)){for(var r=e.first,n=t-1;n>r;n--){var i=lt(e,n).stateAfter;if(i&&(!(i instanceof Ii)||n+i.lookAhead<t)){r=n+1;break}}e.highlightFrontier=Math.min(e.highlightFrontier,r)}}var ro=!1,un=!1;function tf(){ro=!0}function rf(){un=!0}function no(e,t,r){this.marker=e,this.from=t,this.to=r}function ma(e,t){if(e)for(var r=0;r<e.length;++r){var n=e[r];if(n.marker==t)return n}}function nf(e,t){for(var r,n=0;n<e.length;++n)e[n]!=t&&(r||(r=[])).push(e[n]);return r}function af(e,t,r){var n=r&&window.WeakSet&&(r.markedSpans||(r.markedSpans=new WeakSet));n&&e.markedSpans&&n.has(e.markedSpans)?e.markedSpans.push(t):(e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],n&&n.add(e.markedSpans)),t.marker.attachLine(e)}function of(e,t,r){var n;if(e)for(var i=0;i<e.length;++i){var o=e[i],s=o.marker,l=o.from==null||(s.inclusiveLeft?o.from<=t:o.from<t);if(l||o.from==t&&s.type=="bookmark"&&(!r||!o.marker.insertLeft)){var f=o.to==null||(s.inclusiveRight?o.to>=t:o.to>t);(n||(n=[])).push(new no(s,o.from,f?null:o.to))}}return n}function ii(e,t,r){var n;if(e)for(var i=0;i<e.length;++i){var o=e[i],s=o.marker,l=o.to==null||(s.inclusiveRight?o.to>=t:o.to>t);if(l||o.from==t&&s.type=="bookmark"&&(!r||o.marker.insertLeft)){var f=o.from==null||(s.inclusiveLeft?o.from<=t:o.from<t);(n||(n=[])).push(new no(s,f?null:o.from-t,o.to==null?null:o.to-t))}}return n}function Qo(e,t){if(t.full)return null;var r=Ae(e,t.from.line)&&lt(e,t.from.line).markedSpans,n=Ae(e,t.to.line)&&lt(e,t.to.line).markedSpans;if(!r&&!n)return null;var i=t.from.ch,o=t.to.ch,s=Qe(t.from,t.to)==0,l=of(r,i,s),f=ii(n,o,s),c=t.text.length==1,w=_t(t.text).length+(c?i:0);if(l)for(var O=0;O<l.length;++O){var B=l[O];if(B.to==null){var R=ma(f,B.marker);R?c&&(B.to=R.to==null?null:R.to+w):B.to=i}}if(f)for(var H=0;H<f.length;++H){var ce=f[H];if(ce.to!=null&&(ce.to+=w),ce.from==null){var Se=ma(l,ce.marker);Se||(ce.from=w,c&&(l||(l=[])).push(ce))}else ce.from+=w,c&&(l||(l=[])).push(ce)}l&&(l=Js(l)),f&&f!=l&&(f=Js(f));var me=[l];if(!c){var Oe=t.text.length-2,_e;if(Oe>0&&l)for(var Re=0;Re<l.length;++Re)l[Re].to==null&&(_e||(_e=[])).push(new no(l[Re].marker,null,null));for(var Ke=0;Ke<Oe;++Ke)me.push(_e);me.push(f)}return me}function Js(e){for(var t=0;t<e.length;++t){var r=e[t];r.from!=null&&r.from==r.to&&r.marker.clearWhenEmpty!==!1&&e.splice(t--,1)}return e.length?e:null}function io(e,t,r){var n=null;if(e.iter(t.line,r.line+1,function(R){if(R.markedSpans)for(var H=0;H<R.markedSpans.length;++H){var ce=R.markedSpans[H].marker;ce.readOnly&&(!n||ft(n,ce)==-1)&&(n||(n=[])).push(ce)}}),!n)return null;for(var i=[{from:t,to:r}],o=0;o<n.length;++o)for(var s=n[o],l=s.find(0),f=0;f<i.length;++f){var c=i[f];if(!(Qe(c.to,l.from)<0||Qe(c.from,l.to)>0)){var w=[f,1],O=Qe(c.from,l.from),B=Qe(c.to,l.to);(O<0||!s.inclusiveLeft&&!O)&&w.push({from:c.from,to:l.from}),(B>0||!s.inclusiveRight&&!B)&&w.push({from:l.to,to:c.to}),i.splice.apply(i,w),f+=w.length-3}}return i}function ao(e){var t=e.markedSpans;if(t){for(var r=0;r<t.length;++r)t[r].marker.detachLine(e);e.markedSpans=null}}function Zo(e,t){if(t){for(var r=0;r<t.length;++r)t[r].marker.attachLine(e);e.markedSpans=t}}function ga(e){return e.inclusiveLeft?-1:0}function oo(e){return e.inclusiveRight?1:0}function ya(e,t){var r=e.lines.length-t.lines.length;if(r!=0)return r;var n=e.find(),i=t.find(),o=Qe(n.from,i.from)||ga(e)-ga(t);if(o)return-o;var s=Qe(n.to,i.to)||oo(e)-oo(t);return s||t.id-e.id}function so(e,t){var r=un&&e.markedSpans,n;if(r)for(var i=void 0,o=0;o<r.length;++o)i=r[o],i.marker.collapsed&&(t?i.from:i.to)==null&&(!n||ya(n,i.marker)<0)&&(n=i.marker);return n}function cn(e){return so(e,!0)}function ai(e){return so(e,!1)}function el(e,t){var r=un&&e.markedSpans,n;if(r)for(var i=0;i<r.length;++i){var o=r[i];o.marker.collapsed&&(o.from==null||o.from<t)&&(o.to==null||o.to>t)&&(!n||ya(n,o.marker)<0)&&(n=o.marker)}return n}function Jo(e,t,r,n,i){var o=lt(e,t),s=un&&o.markedSpans;if(s)for(var l=0;l<s.length;++l){var f=s[l];if(f.marker.collapsed){var c=f.marker.find(0),w=Qe(c.from,r)||ga(f.marker)-ga(i),O=Qe(c.to,n)||oo(f.marker)-oo(i);if(!(w>=0&&O<=0||w<=0&&O>=0)&&(w<=0&&(f.marker.inclusiveRight&&i.inclusiveLeft?Qe(c.to,r)>=0:Qe(c.to,r)>0)||w>=0&&(f.marker.inclusiveRight&&i.inclusiveLeft?Qe(c.from,n)<=0:Qe(c.from,n)<0)))return!0}}}function zr(e){for(var t;t=cn(e);)e=t.find(-1,!0).line;return e}function sf(e){for(var t;t=ai(e);)e=t.find(1,!0).line;return e}function lf(e){for(var t,r;t=ai(e);)e=t.find(1,!0).line,(r||(r=[])).push(e);return r}function es(e,t){var r=lt(e,t),n=zr(r);return r==n?t:v(n)}function tl(e,t){if(t>e.lastLine())return t;var r=lt(e,t),n;if(!Bn(e,r))return t;for(;n=ai(r);)r=n.find(1,!0).line;return v(r)+1}function Bn(e,t){var r=un&&t.markedSpans;if(r){for(var n=void 0,i=0;i<r.length;++i)if(n=r[i],!!n.marker.collapsed){if(n.from==null)return!0;if(!n.marker.widgetNode&&n.from==0&&n.marker.inclusiveLeft&&ts(e,t,n))return!0}}}function ts(e,t,r){if(r.to==null){var n=r.marker.find(1,!0);return ts(e,n.line,ma(n.line.markedSpans,r.marker))}if(r.marker.inclusiveRight&&r.to==t.text.length)return!0;for(var i=void 0,o=0;o<t.markedSpans.length;++o)if(i=t.markedSpans[o],i.marker.collapsed&&!i.marker.widgetNode&&i.from==r.to&&(i.to==null||i.to!=r.from)&&(i.marker.inclusiveLeft||r.marker.inclusiveRight)&&ts(e,t,i))return!0}function Cr(e){e=zr(e);for(var t=0,r=e.parent,n=0;n<r.lines.length;++n){var i=r.lines[n];if(i==e)break;t+=i.height}for(var o=r.parent;o;r=o,o=r.parent)for(var s=0;s<o.children.length;++s){var l=o.children[s];if(l==r)break;t+=l.height}return t}function lo(e){if(e.height==0)return 0;for(var t=e.text.length,r,n=e;r=cn(n);){var i=r.find(0,!0);n=i.from.line,t+=i.from.ch-i.to.ch}for(n=e;r=ai(n);){var o=r.find(0,!0);t-=n.text.length-o.from.ch,n=o.to.line,t+=n.text.length-o.to.ch}return t}function rs(e){var t=e.display,r=e.doc;t.maxLine=lt(r,r.first),t.maxLineLength=lo(t.maxLine),t.maxLineChanged=!0,r.iter(function(n){var i=lo(n);i>t.maxLineLength&&(t.maxLineLength=i,t.maxLine=n)})}var Zr=function(e,t,r){this.text=e,Zo(this,t),this.height=r?r(this):1};Zr.prototype.lineNo=function(){return v(this)},Nr(Zr);function ff(e,t,r,n){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),e.order!=null&&(e.order=null),ao(e),Zo(e,r);var i=n?n(e):1;i!=e.height&&Er(e,i)}function Ni(e){e.parent=null,ao(e)}var rl={},Bi={};function ns(e,t){if(!e||/^\s*$/.test(e))return null;var r=t.addModeClass?Bi:rl;return r[e]||(r[e]=e.replace(/\S+/g,"cm-$&"))}function Dn(e,t){var r=Z("span",null,null,z?"padding-right: .1px":null),n={pre:Z("pre",[r],"CodeMirror-line"),content:r,col:0,pos:0,cm:e,trailingSpace:!1,splitSpaces:e.getOption("lineWrapping")};t.measure={};for(var i=0;i<=(t.rest?t.rest.length:0);i++){var o=i?t.rest[i-1]:t.line,s=void 0;n.pos=0,n.addToken=uf,ln(e.display.measure)&&(s=kt(o,e.doc.direction))&&(n.addToken=df(n.addToken,s)),n.map=[];var l=t!=e.display.externalMeasured&&v(o);hf(o,n,Vs(e,o,l)),o.styleClasses&&(o.styleClasses.bgClass&&(n.bgClass=Ye(o.styleClasses.bgClass,n.bgClass||"")),o.styleClasses.textClass&&(n.textClass=Ye(o.styleClasses.textClass,n.textClass||""))),n.map.length==0&&n.map.push(0,0,n.content.appendChild(eo(e.display.measure))),i==0?(t.measure.map=n.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(n.map),(t.measure.caches||(t.measure.caches=[])).push({}))}if(z){var f=n.content.lastChild;(/\bcm-tab\b/.test(f.className)||f.querySelector&&f.querySelector(".cm-tab"))&&(n.content.className="cm-tab-wrap-hack")}return Qt(e,"renderLine",e,t.line,n.pre),n.pre.className&&(n.textClass=Ye(n.pre.className,n.textClass||"")),n}function is(e){var t=p("span","•","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t.setAttribute("aria-label",t.title),t}function uf(e,t,r,n,i,o,s){if(t){var l=e.splitSpaces?cf(t,e.trailingSpace):t,f=e.cm.state.specialChars,c=!1,w;if(!f.test(t))e.col+=t.length,w=document.createTextNode(l),e.map.push(e.pos,e.pos+t.length,w),he&&te<9&&(c=!0),e.pos+=t.length;else{w=document.createDocumentFragment();for(var O=0;;){f.lastIndex=O;var B=f.exec(t),R=B?B.index-O:t.length-O;if(R){var H=document.createTextNode(l.slice(O,O+R));he&&te<9?w.appendChild(p("span",[H])):w.appendChild(H),e.map.push(e.pos,e.pos+R,H),e.col+=R,e.pos+=R}if(!B)break;O+=R+1;var ce=void 0;if(B[0]=="	"){var Se=e.cm.options.tabSize,me=Se-e.col%Se;ce=w.appendChild(p("span",nn(me),"cm-tab")),ce.setAttribute("role","presentation"),ce.setAttribute("cm-text","	"),e.col+=me}else B[0]=="\r"||B[0]==`
`?(ce=w.appendChild(p("span",B[0]=="\r"?"␍":"␤","cm-invalidchar")),ce.setAttribute("cm-text",B[0]),e.col+=1):(ce=e.cm.options.specialCharPlaceholder(B[0]),ce.setAttribute("cm-text",B[0]),he&&te<9?w.appendChild(p("span",[ce])):w.appendChild(ce),e.col+=1);e.map.push(e.pos,e.pos+1,ce),e.pos++}}if(e.trailingSpace=l.charCodeAt(t.length-1)==32,r||n||i||c||o||s){var Oe=r||"";n&&(Oe+=n),i&&(Oe+=i);var _e=p("span",[w],Oe,o);if(s)for(var Re in s)s.hasOwnProperty(Re)&&Re!="style"&&Re!="class"&&_e.setAttribute(Re,s[Re]);return e.content.appendChild(_e)}e.content.appendChild(w)}}function cf(e,t){if(e.length>1&&!/  /.test(e))return e;for(var r=t,n="",i=0;i<e.length;i++){var o=e.charAt(i);o==" "&&r&&(i==e.length-1||e.charCodeAt(i+1)==32)&&(o=" "),n+=o,r=o==" "}return n}function df(e,t){return function(r,n,i,o,s,l,f){i=i?i+" cm-force-border":"cm-force-border";for(var c=r.pos,w=c+n.length;;){for(var O=void 0,B=0;B<t.length&&(O=t[B],!(O.to>c&&O.from<=c));B++);if(O.to>=w)return e(r,n,i,o,s,l,f);e(r,n.slice(0,O.to-c),i,o,null,l,f),o=null,n=n.slice(O.to-c),c=O.to}}}function as(e,t,r,n){var i=!n&&r.widgetNode;i&&e.map.push(e.pos,e.pos+t,i),!n&&e.cm.display.input.needsContentAttribute&&(i||(i=e.content.appendChild(document.createElement("span"))),i.setAttribute("cm-marker",r.id)),i&&(e.cm.display.input.setUneditable(i),e.content.appendChild(i)),e.pos+=t,e.trailingSpace=!1}function hf(e,t,r){var n=e.markedSpans,i=e.text,o=0;if(!n){for(var s=1;s<r.length;s+=2)t.addToken(t,i.slice(o,o=r[s]),ns(r[s+1],t.cm.options));return}for(var l=i.length,f=0,c=1,w="",O,B,R=0,H,ce,Se,me,Oe;;){if(R==f){H=ce=Se=B="",Oe=null,me=null,R=1/0;for(var _e=[],Re=void 0,Ke=0;Ke<n.length;++Ke){var Ze=n[Ke],ct=Ze.marker;if(ct.type=="bookmark"&&Ze.from==f&&ct.widgetNode)_e.push(ct);else if(Ze.from<=f&&(Ze.to==null||Ze.to>f||ct.collapsed&&Ze.to==f&&Ze.from==f)){if(Ze.to!=null&&Ze.to!=f&&R>Ze.to&&(R=Ze.to,ce=""),ct.className&&(H+=" "+ct.className),ct.css&&(B=(B?B+";":"")+ct.css),ct.startStyle&&Ze.from==f&&(Se+=" "+ct.startStyle),ct.endStyle&&Ze.to==R&&(Re||(Re=[])).push(ct.endStyle,Ze.to),ct.title&&((Oe||(Oe={})).title=ct.title),ct.attributes)for(var rt in ct.attributes)(Oe||(Oe={}))[rt]=ct.attributes[rt];ct.collapsed&&(!me||ya(me.marker,ct)<0)&&(me=Ze)}else Ze.from>f&&R>Ze.from&&(R=Ze.from)}if(Re)for(var At=0;At<Re.length;At+=2)Re[At+1]==R&&(ce+=" "+Re[At]);if(!me||me.from==f)for(var yt=0;yt<_e.length;++yt)as(t,0,_e[yt]);if(me&&(me.from||0)==f){if(as(t,(me.to==null?l+1:me.to)-f,me.marker,me.from==null),me.to==null)return;me.to==f&&(me=!1)}}if(f>=l)break;for(var Ft=Math.min(l,R);;){if(w){var It=f+w.length;if(!me){var Et=It>Ft?w.slice(0,Ft-f):w;t.addToken(t,Et,O?O+H:H,Se,f+Et.length==R?ce:"",B,Oe)}if(It>=Ft){w=w.slice(Ft-f),f=Ft;break}f=It,Se=""}w=i.slice(o,o=r[c++]),O=ns(r[c++],t.cm.options)}}}function nl(e,t,r){this.line=t,this.rest=lf(t),this.size=this.rest?v(_t(this.rest))-r+1:1,this.node=this.text=null,this.hidden=Bn(e,t)}function ba(e,t,r){for(var n=[],i,o=t;o<r;o=i){var s=new nl(e.doc,lt(e.doc,o),o);i=o+s.size,n.push(s)}return n}var Ut=null;function il(e){Ut?Ut.ops.push(e):e.ownsGroup=Ut={ops:[e],delayedCallbacks:[]}}function pf(e){var t=e.delayedCallbacks,r=0;do{for(;r<t.length;r++)t[r].call(null);for(var n=0;n<e.ops.length;n++){var i=e.ops[n];if(i.cursorActivityHandlers)for(;i.cursorActivityCalled<i.cursorActivityHandlers.length;)i.cursorActivityHandlers[i.cursorActivityCalled++].call(null,i.cm)}}while(r<t.length)}function Jr(e,t){var r=e.ownsGroup;if(r)try{pf(r)}finally{Ut=null,t(r)}}var oi=null;function er(e,t){var r=sn(e,t);if(r.length){var n=Array.prototype.slice.call(arguments,2),i;Ut?i=Ut.delayedCallbacks:oi?i=oi:(i=oi=[],setTimeout(si,0));for(var o=function(l){i.push(function(){return r[l].apply(null,n)})},s=0;s<r.length;++s)o(s)}}function si(){var e=oi;oi=null;for(var t=0;t<e.length;++t)e[t]()}function fo(e,t,r,n){for(var i=0;i<t.changes.length;i++){var o=t.changes[i];o=="text"?al(e,t):o=="gutter"?os(e,t,r,n):o=="class"?wa(e,t):o=="widget"&&vf(e,t,n)}t.changes=null}function Gn(e){return e.node==e.text&&(e.node=p("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),he&&te<8&&(e.node.style.zIndex=2)),e.node}function xa(e,t){var r=t.bgClass?t.bgClass+" "+(t.line.bgClass||""):t.line.bgClass;if(r&&(r+=" CodeMirror-linebackground"),t.background)r?t.background.className=r:(t.background.parentNode.removeChild(t.background),t.background=null);else if(r){var n=Gn(t);t.background=n.insertBefore(p("div",null,r),n.firstChild),e.display.input.setUneditable(t.background)}}function Sa(e,t){var r=e.display.externalMeasured;return r&&r.line==t.line?(e.display.externalMeasured=null,t.measure=r.measure,r.built):Dn(e,t)}function al(e,t){var r=t.text.className,n=Sa(e,t);t.text==t.node&&(t.node=n.pre),t.text.parentNode.replaceChild(n.pre,t.text),t.text=n.pre,n.bgClass!=t.bgClass||n.textClass!=t.textClass?(t.bgClass=n.bgClass,t.textClass=n.textClass,wa(e,t)):r&&(t.text.className=r)}function wa(e,t){xa(e,t),t.line.wrapClass?Gn(t).className=t.line.wrapClass:t.node!=t.text&&(t.node.className="");var r=t.textClass?t.textClass+" "+(t.line.textClass||""):t.line.textClass;t.text.className=r||""}function os(e,t,r,n){if(t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null),t.gutterBackground&&(t.node.removeChild(t.gutterBackground),t.gutterBackground=null),t.line.gutterClass){var i=Gn(t);t.gutterBackground=p("div",null,"CodeMirror-gutter-background "+t.line.gutterClass,"left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px; width: "+n.gutterTotalWidth+"px"),e.display.input.setUneditable(t.gutterBackground),i.insertBefore(t.gutterBackground,t.text)}var o=t.line.gutterMarkers;if(e.options.lineNumbers||o){var s=Gn(t),l=t.gutter=p("div",null,"CodeMirror-gutter-wrapper","left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px");if(l.setAttribute("aria-hidden","true"),e.display.input.setUneditable(l),s.insertBefore(l,t.text),t.line.gutterClass&&(l.className+=" "+t.line.gutterClass),e.options.lineNumbers&&(!o||!o["CodeMirror-linenumbers"])&&(t.lineNumber=l.appendChild(p("div",Ue(e.options,r),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+n.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),o)for(var f=0;f<e.display.gutterSpecs.length;++f){var c=e.display.gutterSpecs[f].className,w=o.hasOwnProperty(c)&&o[c];w&&l.appendChild(p("div",[w],"CodeMirror-gutter-elt","left: "+n.gutterLeft[c]+"px; width: "+n.gutterWidth[c]+"px"))}}}function vf(e,t,r){t.alignable&&(t.alignable=null);for(var n=ke("CodeMirror-linewidget"),i=t.node.firstChild,o=void 0;i;i=o)o=i.nextSibling,n.test(i.className)&&t.node.removeChild(i);ol(e,t,r)}function mf(e,t,r,n){var i=Sa(e,t);return t.text=t.node=i.pre,i.bgClass&&(t.bgClass=i.bgClass),i.textClass&&(t.textClass=i.textClass),wa(e,t),os(e,t,r,n),ol(e,t,n),t.node}function ol(e,t,r){if(sl(e,t.line,t,r,!0),t.rest)for(var n=0;n<t.rest.length;n++)sl(e,t.rest[n],t,r,!1)}function sl(e,t,r,n,i){if(t.widgets)for(var o=Gn(r),s=0,l=t.widgets;s<l.length;++s){var f=l[s],c=p("div",[f.node],"CodeMirror-linewidget"+(f.className?" "+f.className:""));f.handleMouseEvents||c.setAttribute("cm-ignore-events","true"),ss(f,c,r,n),e.display.input.setUneditable(c),i&&f.above?o.insertBefore(c,r.gutter||r.text):o.appendChild(c),er(f,"redraw")}}function ss(e,t,r,n){if(e.noHScroll){(r.alignable||(r.alignable=[])).push(t);var i=n.wrapperWidth;t.style.left=n.fixedPos+"px",e.coverGutter||(i-=n.gutterTotalWidth,t.style.paddingLeft=n.gutterTotalWidth+"px"),t.style.width=i+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-n.gutterTotalWidth+"px"))}function Hn(e){if(e.height!=null)return e.height;var t=e.doc.cm;if(!t)return 0;if(!Pe(document.body,e.node)){var r="position: relative;";e.coverGutter&&(r+="margin-left: -"+t.display.gutters.offsetWidth+"px;"),e.noHScroll&&(r+="width: "+t.display.wrapper.clientWidth+"px;"),E(t.display.measure,p("div",[e.node],null,r))}return e.height=e.node.parentNode.offsetHeight}function Wr(e,t){for(var r=da(t);r!=e.wrapper;r=r.parentNode)if(!r||r.nodeType==1&&r.getAttribute("cm-ignore-events")=="true"||r.parentNode==e.sizer&&r!=e.mover)return!0}function Di(e){return e.lineSpace.offsetTop}function zn(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function uo(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=E(e.measure,p("pre","x","CodeMirror-line-like")),r=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,n={left:parseInt(r.paddingLeft),right:parseInt(r.paddingRight)};return!isNaN(n.left)&&!isNaN(n.right)&&(e.cachedPaddingH=n),n}function Mr(e){return Mt-e.display.nativeBarWidth}function dn(e){return e.display.scroller.clientWidth-Mr(e)-e.display.barWidth}function Ta(e){return e.display.scroller.clientHeight-Mr(e)-e.display.barHeight}function ll(e,t,r){var n=e.options.lineWrapping,i=n&&dn(e);if(!t.measure.heights||n&&t.measure.width!=i){var o=t.measure.heights=[];if(n){t.measure.width=i;for(var s=t.text.firstChild.getClientRects(),l=0;l<s.length-1;l++){var f=s[l],c=s[l+1];Math.abs(f.bottom-c.bottom)>2&&o.push((f.bottom+c.top)/2-r.top)}}o.push(r.bottom-r.top)}}function ls(e,t,r){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};if(e.rest){for(var n=0;n<e.rest.length;n++)if(e.rest[n]==t)return{map:e.measure.maps[n],cache:e.measure.caches[n]};for(var i=0;i<e.rest.length;i++)if(v(e.rest[i])>r)return{map:e.measure.maps[i],cache:e.measure.caches[i],before:!0}}}function fl(e,t){t=zr(t);var r=v(t),n=e.display.externalMeasured=new nl(e.doc,t,r);n.lineN=r;var i=n.built=Dn(e,n);return n.text=i.pre,E(e.display.lineMeasure,i.pre),n}function fs(e,t,r,n){return qr(e,li(e,t),r,n)}function co(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[Fr(e,t)];var r=e.display.externalMeasured;if(r&&t>=r.lineN&&t<r.lineN+r.size)return r}function li(e,t){var r=v(t),n=co(e,r);n&&!n.text?n=null:n&&n.changes&&(fo(e,n,r,yo(e)),e.curOp.forceUpdate=!0),n||(n=fl(e,t));var i=ls(n,t,r);return{line:t,view:n,rect:null,map:i.map,cache:i.cache,before:i.before,hasHeights:!1}}function qr(e,t,r,n,i){t.before&&(r=-1);var o=r+(n||""),s;return t.cache.hasOwnProperty(o)?s=t.cache[o]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(ll(e,t.view,t.rect),t.hasHeights=!0),s=ds(e,t,r,n),s.bogus||(t.cache[o]=s)),{left:s.left,right:s.right,top:i?s.rtop:s.top,bottom:i?s.rbottom:s.bottom}}var us={left:0,right:0,top:0,bottom:0};function fi(e,t,r){for(var n,i,o,s,l,f,c=0;c<e.length;c+=3)if(l=e[c],f=e[c+1],t<l?(i=0,o=1,s="left"):t<f?(i=t-l,o=i+1):(c==e.length-3||t==f&&e[c+3]>t)&&(o=f-l,i=o-1,t>=f&&(s="right")),i!=null){if(n=e[c+2],l==f&&r==(n.insertLeft?"left":"right")&&(s=r),r=="left"&&i==0)for(;c&&e[c-2]==e[c-3]&&e[c-1].insertLeft;)n=e[(c-=3)+2],s="left";if(r=="right"&&i==f-l)for(;c<e.length-3&&e[c+3]==e[c+4]&&!e[c+5].insertLeft;)n=e[(c+=3)+2],s="right";break}return{node:n,start:i,end:o,collapse:s,coverStart:l,coverEnd:f}}function cs(e,t){var r=us;if(t=="left")for(var n=0;n<e.length&&(r=e[n]).left==r.right;n++);else for(var i=e.length-1;i>=0&&(r=e[i]).left==r.right;i--);return r}function ds(e,t,r,n){var i=fi(t.map,r,n),o=i.node,s=i.start,l=i.end,f=i.collapse,c;if(o.nodeType==3){for(var w=0;w<4;w++){for(;s&&jt(t.line.text.charAt(i.coverStart+s));)--s;for(;i.coverStart+l<i.coverEnd&&jt(t.line.text.charAt(i.coverStart+l));)++l;if(he&&te<9&&s==0&&l==i.coverEnd-i.coverStart?c=o.parentNode.getBoundingClientRect():c=cs(ye(o,s,l).getClientRects(),n),c.left||c.right||s==0)break;l=s,s=s-1,f="right"}he&&te<11&&(c=Ca(e.display.measure,c))}else{s>0&&(f=n="right");var O;e.options.lineWrapping&&(O=o.getClientRects()).length>1?c=O[n=="right"?O.length-1:0]:c=o.getBoundingClientRect()}if(he&&te<9&&!s&&(!c||!c.left&&!c.right)){var B=o.parentNode.getClientRects()[0];B?c={left:B.left,right:B.left+Hi(e.display),top:B.top,bottom:B.bottom}:c=us}for(var R=c.top-t.rect.top,H=c.bottom-t.rect.top,ce=(R+H)/2,Se=t.view.measure.heights,me=0;me<Se.length-1&&!(ce<Se[me]);me++);var Oe=me?Se[me-1]:0,_e=Se[me],Re={left:(f=="right"?c.right:c.left)-t.rect.left,right:(f=="left"?c.left:c.right)-t.rect.left,top:Oe,bottom:_e};return!c.left&&!c.right&&(Re.bogus=!0),e.options.singleCursorHeightPerLine||(Re.rtop=R,Re.rbottom=H),Re}function Ca(e,t){if(!window.screen||screen.logicalXDPI==null||screen.logicalXDPI==screen.deviceXDPI||!jo(e))return t;var r=screen.logicalXDPI/screen.deviceXDPI,n=screen.logicalYDPI/screen.deviceYDPI;return{left:t.left*r,right:t.right*r,top:t.top*n,bottom:t.bottom*n}}function ul(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function cl(e){e.display.externalMeasure=null,C(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)ul(e.display.view[t])}function _a(e){cl(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function ho(e){return D&&j?-(e.body.getBoundingClientRect().left-parseInt(getComputedStyle(e.body).marginLeft)):e.defaultView.pageXOffset||(e.documentElement||e.body).scrollLeft}function dl(e){return D&&j?-(e.body.getBoundingClientRect().top-parseInt(getComputedStyle(e.body).marginTop)):e.defaultView.pageYOffset||(e.documentElement||e.body).scrollTop}function hs(e){var t=zr(e),r=t.widgets,n=0;if(r)for(var i=0;i<r.length;++i)r[i].above&&(n+=Hn(r[i]));return n}function po(e,t,r,n,i){if(!i){var o=hs(t);r.top+=o,r.bottom+=o}if(n=="line")return r;n||(n="local");var s=Cr(t);if(n=="local"?s+=Di(e.display):s-=e.display.viewOffset,n=="page"||n=="window"){var l=e.display.lineSpace.getBoundingClientRect();s+=l.top+(n=="window"?0:dl(at(e)));var f=l.left+(n=="window"?0:ho(at(e)));r.left+=f,r.right+=f}return r.top+=s,r.bottom+=s,r}function vo(e,t,r){if(r=="div")return t;var n=t.left,i=t.top;if(r=="page")n-=ho(at(e)),i-=dl(at(e));else if(r=="local"||!r){var o=e.display.sizer.getBoundingClientRect();n+=o.left,i+=o.top}var s=e.display.lineSpace.getBoundingClientRect();return{left:n-s.left,top:i-s.top}}function mo(e,t,r,n,i){return n||(n=lt(e.doc,t.line)),po(e,n,fs(e,n,t.ch,i),r)}function kr(e,t,r,n,i,o){n=n||lt(e.doc,t.line),i||(i=li(e,n));function s(H,ce){var Se=qr(e,i,H,ce?"right":"left",o);return ce?Se.left=Se.right:Se.right=Se.left,po(e,n,Se,r)}var l=kt(n,e.doc.direction),f=t.ch,c=t.sticky;if(f>=n.text.length?(f=n.text.length,c="before"):f<=0&&(f=0,c="after"),!l)return s(c=="before"?f-1:f,c=="before");function w(H,ce,Se){var me=l[ce],Oe=me.level==1;return s(Se?H-1:H,Oe!=Se)}var O=nr(l,f,c),B=Fn,R=w(f,O,c=="before");return B!=null&&(R.other=w(f,B,c!="before")),R}function ps(e,t){var r=0;t=gt(e.doc,t),e.options.lineWrapping||(r=Hi(e.display)*t.ch);var n=lt(e.doc,t.line),i=Cr(n)+Di(e.display);return{left:r,right:r,top:i,bottom:i+n.height}}function go(e,t,r,n,i){var o=be(e,t,r);return o.xRel=i,n&&(o.outside=n),o}function Ea(e,t,r){var n=e.doc;if(r+=e.display.viewOffset,r<0)return go(n.first,0,null,-1,-1);var i=X(n,r),o=n.first+n.size-1;if(i>o)return go(n.first+n.size-1,lt(n,o).text.length,null,1,1);t<0&&(t=0);for(var s=lt(n,i);;){var l=gf(e,s,i,t,r),f=el(s,l.ch+(l.xRel>0||l.outside>0?1:0));if(!f)return l;var c=f.find(1);if(c.line==i)return c;s=lt(n,i=c.line)}}function hl(e,t,r,n){n-=hs(t);var i=t.text.length,o=$r(function(s){return qr(e,r,s-1).bottom<=n},i,0);return i=$r(function(s){return qr(e,r,s).top>n},o,i),{begin:o,end:i}}function La(e,t,r,n){r||(r=li(e,t));var i=po(e,t,qr(e,r,n),"line").top;return hl(e,t,r,i)}function vs(e,t,r,n){return e.bottom<=r?!1:e.top>r?!0:(n?e.left:e.right)>t}function gf(e,t,r,n,i){i-=Cr(t);var o=li(e,t),s=hs(t),l=0,f=t.text.length,c=!0,w=kt(t,e.doc.direction);if(w){var O=(e.options.lineWrapping?bf:yf)(e,t,r,o,w,n,i);c=O.level!=1,l=c?O.from:O.to-1,f=c?O.to:O.from-1}var B=null,R=null,H=$r(function(Ke){var Ze=qr(e,o,Ke);return Ze.top+=s,Ze.bottom+=s,vs(Ze,n,i,!1)?(Ze.top<=i&&Ze.left<=n&&(B=Ke,R=Ze),!0):!1},l,f),ce,Se,me=!1;if(R){var Oe=n-R.left<R.right-n,_e=Oe==c;H=B+(_e?0:1),Se=_e?"after":"before",ce=Oe?R.left:R.right}else{!c&&(H==f||H==l)&&H++,Se=H==0?"after":H==t.text.length?"before":qr(e,o,H-(c?1:0)).bottom+s<=i==c?"after":"before";var Re=kr(e,be(r,H,Se),"line",t,o);ce=Re.left,me=i<Re.top?-1:i>=Re.bottom?1:0}return H=on(t.text,H,1),go(r,H,Se,me,n-ce)}function yf(e,t,r,n,i,o,s){var l=$r(function(O){var B=i[O],R=B.level!=1;return vs(kr(e,be(r,R?B.to:B.from,R?"before":"after"),"line",t,n),o,s,!0)},0,i.length-1),f=i[l];if(l>0){var c=f.level!=1,w=kr(e,be(r,c?f.from:f.to,c?"after":"before"),"line",t,n);vs(w,o,s,!0)&&w.top>s&&(f=i[l-1])}return f}function bf(e,t,r,n,i,o,s){var l=hl(e,t,n,s),f=l.begin,c=l.end;/\s/.test(t.text.charAt(c-1))&&c--;for(var w=null,O=null,B=0;B<i.length;B++){var R=i[B];if(!(R.from>=c||R.to<=f)){var H=R.level!=1,ce=qr(e,n,H?Math.min(c,R.to)-1:Math.max(f,R.from)).right,Se=ce<o?o-ce+1e9:ce-o;(!w||O>Se)&&(w=R,O=Se)}}return w||(w=i[i.length-1]),w.from<f&&(w={from:f,to:w.to,level:w.level}),w.to>c&&(w={from:w.from,to:c,level:w.level}),w}var ui;function Gi(e){if(e.cachedTextHeight!=null)return e.cachedTextHeight;if(ui==null){ui=p("pre",null,"CodeMirror-line-like");for(var t=0;t<49;++t)ui.appendChild(document.createTextNode("x")),ui.appendChild(p("br"));ui.appendChild(document.createTextNode("x"))}E(e.measure,ui);var r=ui.offsetHeight/50;return r>3&&(e.cachedTextHeight=r),C(e.measure),r||1}function Hi(e){if(e.cachedCharWidth!=null)return e.cachedCharWidth;var t=p("span","xxxxxxxxxx"),r=p("pre",[t],"CodeMirror-line-like");E(e.measure,r);var n=t.getBoundingClientRect(),i=(n.right-n.left)/10;return i>2&&(e.cachedCharWidth=i),i||10}function yo(e){for(var t=e.display,r={},n={},i=t.gutters.clientLeft,o=t.gutters.firstChild,s=0;o;o=o.nextSibling,++s){var l=e.display.gutterSpecs[s].className;r[l]=o.offsetLeft+o.clientLeft+i,n[l]=o.clientWidth}return{fixedPos:ci(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:r,gutterWidth:n,wrapperWidth:t.wrapper.clientWidth}}function ci(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function pl(e){var t=Gi(e.display),r=e.options.lineWrapping,n=r&&Math.max(5,e.display.scroller.clientWidth/Hi(e.display)-3);return function(i){if(Bn(e.doc,i))return 0;var o=0;if(i.widgets)for(var s=0;s<i.widgets.length;s++)i.widgets[s].height&&(o+=i.widgets[s].height);return r?o+(Math.ceil(i.text.length/n)||1)*t:o+t}}function zi(e){var t=e.doc,r=pl(e);t.iter(function(n){var i=r(n);i!=n.height&&Er(n,i)})}function fr(e,t,r,n){var i=e.display;if(!r&&da(t).getAttribute("cm-not-content")=="true")return null;var o,s,l=i.lineSpace.getBoundingClientRect();try{o=t.clientX-l.left,s=t.clientY-l.top}catch{return null}var f=Ea(e,o,s),c;if(n&&f.xRel>0&&(c=lt(e.doc,f.line).text).length==f.ch){var w=Ct(c,c.length,e.options.tabSize)-c.length;f=be(f.line,Math.max(0,Math.round((o-uo(e.display).left)/Hi(e.display))-w))}return f}function Fr(e,t){if(t>=e.display.viewTo||(t-=e.display.viewFrom,t<0))return null;for(var r=e.display.view,n=0;n<r.length;n++)if(t-=r[n].size,t<0)return n}function pr(e,t,r,n){t==null&&(t=e.doc.first),r==null&&(r=e.doc.first+e.doc.size),n||(n=0);var i=e.display;if(n&&r<i.viewTo&&(i.updateLineNumbers==null||i.updateLineNumbers>t)&&(i.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=i.viewTo)un&&es(e.doc,t)<i.viewTo&&pn(e);else if(r<=i.viewFrom)un&&tl(e.doc,r+n)>i.viewFrom?pn(e):(i.viewFrom+=n,i.viewTo+=n);else if(t<=i.viewFrom&&r>=i.viewTo)pn(e);else if(t<=i.viewFrom){var o=ka(e,r,r+n,1);o?(i.view=i.view.slice(o.index),i.viewFrom=o.lineN,i.viewTo+=n):pn(e)}else if(r>=i.viewTo){var s=ka(e,t,t,-1);s?(i.view=i.view.slice(0,s.index),i.viewTo=s.lineN):pn(e)}else{var l=ka(e,t,t,-1),f=ka(e,r,r+n,1);l&&f?(i.view=i.view.slice(0,l.index).concat(ba(e,l.lineN,f.lineN)).concat(i.view.slice(f.index)),i.viewTo+=n):pn(e)}var c=i.externalMeasured;c&&(r<c.lineN?c.lineN+=n:t<c.lineN+c.size&&(i.externalMeasured=null))}function hn(e,t,r){e.curOp.viewChanged=!0;var n=e.display,i=e.display.externalMeasured;if(i&&t>=i.lineN&&t<i.lineN+i.size&&(n.externalMeasured=null),!(t<n.viewFrom||t>=n.viewTo)){var o=n.view[Fr(e,t)];if(o.node!=null){var s=o.changes||(o.changes=[]);ft(s,r)==-1&&s.push(r)}}}function pn(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function ka(e,t,r,n){var i=Fr(e,t),o,s=e.display.view;if(!un||r==e.doc.first+e.doc.size)return{index:i,lineN:r};for(var l=e.display.viewFrom,f=0;f<i;f++)l+=s[f].size;if(l!=t){if(n>0){if(i==s.length-1)return null;o=l+s[i].size-t,i++}else o=l-t;t+=o,r+=o}for(;es(e.doc,r)!=r;){if(i==(n<0?0:s.length-1))return null;r+=n*s[i-(n<0?1:0)].size,i+=n}return{index:i,lineN:r}}function vl(e,t,r){var n=e.display,i=n.view;i.length==0||t>=n.viewTo||r<=n.viewFrom?(n.view=ba(e,t,r),n.viewFrom=t):(n.viewFrom>t?n.view=ba(e,t,n.viewFrom).concat(n.view):n.viewFrom<t&&(n.view=n.view.slice(Fr(e,t))),n.viewFrom=t,n.viewTo<r?n.view=n.view.concat(ba(e,n.viewTo,r)):n.viewTo>r&&(n.view=n.view.slice(0,Fr(e,r)))),n.viewTo=r}function ms(e){for(var t=e.display.view,r=0,n=0;n<t.length;n++){var i=t[n];!i.hidden&&(!i.node||i.changes)&&++r}return r}function Aa(e){e.display.input.showSelection(e.display.input.prepareSelection())}function di(e,t){t===void 0&&(t=!0);var r=e.doc,n={},i=n.cursors=document.createDocumentFragment(),o=n.selection=document.createDocumentFragment(),s=e.options.$customCursor;s&&(t=!0);for(var l=0;l<r.sel.ranges.length;l++)if(!(!t&&l==r.sel.primIndex)){var f=r.sel.ranges[l];if(!(f.from().line>=e.display.viewTo||f.to().line<e.display.viewFrom)){var c=f.empty();if(s){var w=s(e,f);w&&ir(e,w,i)}else(c||e.options.showCursorWhenSelecting)&&ir(e,f.head,i);c||ml(e,f,o)}}return n}function ir(e,t,r){var n=kr(e,t,"div",null,null,!e.options.singleCursorHeightPerLine),i=r.appendChild(p("div"," ","CodeMirror-cursor"));if(i.style.left=n.left+"px",i.style.top=n.top+"px",i.style.height=Math.max(0,n.bottom-n.top)*e.options.cursorHeight+"px",/\bcm-fat-cursor\b/.test(e.getWrapperElement().className)){var o=mo(e,t,"div",null,null),s=o.right-o.left;i.style.width=(s>0?s:e.defaultCharWidth())+"px"}if(n.other){var l=r.appendChild(p("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));l.style.display="",l.style.left=n.other.left+"px",l.style.top=n.other.top+"px",l.style.height=(n.other.bottom-n.other.top)*.85+"px"}}function Oa(e,t){return e.top-t.top||e.left-t.left}function ml(e,t,r){var n=e.display,i=e.doc,o=document.createDocumentFragment(),s=uo(e.display),l=s.left,f=Math.max(n.sizerWidth,dn(e)-n.sizer.offsetLeft)-s.right,c=i.direction=="ltr";function w(_e,Re,Ke,Ze){Re<0&&(Re=0),Re=Math.round(Re),Ze=Math.round(Ze),o.appendChild(p("div",null,"CodeMirror-selected","position: absolute; left: "+_e+`px;
                             top: `+Re+"px; width: "+(Ke??f-_e)+`px;
                             height: `+(Ze-Re)+"px"))}function O(_e,Re,Ke){var Ze=lt(i,_e),ct=Ze.text.length,rt,At;function yt(Et,Gt){return mo(e,be(_e,Et),"div",Ze,Gt)}function Ft(Et,Gt,Pt){var Tt=La(e,Ze,null,Et),nt=Gt=="ltr"==(Pt=="after")?"left":"right",Lt=Pt=="after"?Tt.begin:Tt.end-(/\s/.test(Ze.text.charAt(Tt.end-1))?2:1);return yt(Lt,nt)[nt]}var It=kt(Ze,i.direction);return Mn(It,Re||0,Ke??ct,function(Et,Gt,Pt,Tt){var nt=Pt=="ltr",Lt=yt(Et,nt?"left":"right"),St=yt(Gt-1,nt?"right":"left"),ot=Re==null&&Et==0,mt=Ke==null&&Gt==ct,vt=Tt==0,Wt=!It||Tt==It.length-1;if(St.top-Lt.top<=3){var Xt=(c?ot:mt)&&vt,On=(c?mt:ot)&&Wt,N=Xt?l:(nt?Lt:St).left,de=On?f:(nt?St:Lt).right;w(N,Lt.top,de-N,Lt.bottom)}else{var le,je,bt,F;nt?(le=c&&ot&&vt?l:Lt.left,je=c?f:Ft(Et,Pt,"before"),bt=c?l:Ft(Gt,Pt,"after"),F=c&&mt&&Wt?f:St.right):(le=c?Ft(Et,Pt,"before"):l,je=!c&&ot&&vt?f:Lt.right,bt=!c&&mt&&Wt?l:St.left,F=c?Ft(Gt,Pt,"after"):f),w(le,Lt.top,je-le,Lt.bottom),Lt.bottom<St.top&&w(l,Lt.bottom,null,St.top),w(bt,St.top,F-bt,St.bottom)}(!rt||Oa(Lt,rt)<0)&&(rt=Lt),Oa(St,rt)<0&&(rt=St),(!At||Oa(Lt,At)<0)&&(At=Lt),Oa(St,At)<0&&(At=St)}),{start:rt,end:At}}var B=t.from(),R=t.to();if(B.line==R.line)O(B.line,B.ch,R.ch);else{var H=lt(i,B.line),ce=lt(i,R.line),Se=zr(H)==zr(ce),me=O(B.line,B.ch,Se?H.text.length+1:null).end,Oe=O(R.line,Se?0:null,R.ch).start;Se&&(me.top<Oe.top-2?(w(me.right,me.top,null,me.bottom),w(l,Oe.top,Oe.left,Oe.bottom)):w(me.right,me.top,Oe.left-me.right,me.bottom)),me.bottom<Oe.top&&w(l,me.bottom,null,Oe.top)}r.appendChild(o)}function vn(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var r=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0?t.blinker=setInterval(function(){e.hasFocus()||Wi(e),t.cursorDiv.style.visibility=(r=!r)?"":"hidden"},e.options.cursorBlinkRate):e.options.cursorBlinkRate<0&&(t.cursorDiv.style.visibility="hidden")}}function gs(e){e.hasFocus()||(e.display.input.focus(),e.state.focused||ys(e))}function bo(e){e.state.delayingBlurEvent=!0,setTimeout(function(){e.state.delayingBlurEvent&&(e.state.delayingBlurEvent=!1,e.state.focused&&Wi(e))},100)}function ys(e,t){e.state.delayingBlurEvent&&!e.state.draggingText&&(e.state.delayingBlurEvent=!1),e.options.readOnly!="nocursor"&&(e.state.focused||(Qt(e,"focus",e,t),e.state.focused=!0,$e(e.display.wrapper,"CodeMirror-focused"),!e.curOp&&e.display.selForContextMenu!=e.doc.sel&&(e.display.input.reset(),z&&setTimeout(function(){return e.display.input.reset(!0)},20)),e.display.input.receivedFocus()),vn(e))}function Wi(e,t){e.state.delayingBlurEvent||(e.state.focused&&(Qt(e,"blur",e,t),e.state.focused=!1,We(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.display.shift=!1)},150))}function xo(e){for(var t=e.display,r=t.lineDiv.offsetTop,n=Math.max(0,t.scroller.getBoundingClientRect().top),i=t.lineDiv.getBoundingClientRect().top,o=0,s=0;s<t.view.length;s++){var l=t.view[s],f=e.options.lineWrapping,c=void 0,w=0;if(!l.hidden){if(i+=l.line.height,he&&te<8){var O=l.node.offsetTop+l.node.offsetHeight;c=O-r,r=O}else{var B=l.node.getBoundingClientRect();c=B.bottom-B.top,!f&&l.text.firstChild&&(w=l.text.firstChild.getBoundingClientRect().right-B.left-1)}var R=l.line.height-c;if((R>.005||R<-.005)&&(i<n&&(o-=R),Er(l.line,c),gl(l.line),l.rest))for(var H=0;H<l.rest.length;H++)gl(l.rest[H]);if(w>e.display.sizerWidth){var ce=Math.ceil(w/Hi(e.display));ce>e.display.maxLineLength&&(e.display.maxLineLength=ce,e.display.maxLine=l.line,e.display.maxLineChanged=!0)}}}Math.abs(o)>2&&(t.scroller.scrollTop+=o)}function gl(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t){var r=e.widgets[t],n=r.node.parentNode;n&&(r.height=n.offsetHeight)}}function qi(e,t,r){var n=r&&r.top!=null?Math.max(0,r.top):e.scroller.scrollTop;n=Math.floor(n-Di(e));var i=r&&r.bottom!=null?r.bottom:n+e.wrapper.clientHeight,o=X(t,n),s=X(t,i);if(r&&r.ensure){var l=r.ensure.from.line,f=r.ensure.to.line;l<o?(o=l,s=X(t,Cr(lt(t,l))+e.wrapper.clientHeight)):Math.min(f,t.lastLine())>=s&&(o=X(t,Cr(lt(t,f))-e.wrapper.clientHeight),s=f)}return{from:o,to:Math.max(s,o+1)}}function yl(e,t){if(!Yt(e,"scrollCursorIntoView")){var r=e.display,n=r.sizer.getBoundingClientRect(),i=null,o=r.wrapper.ownerDocument;if(t.top+n.top<0?i=!0:t.bottom+n.top>(o.defaultView.innerHeight||o.documentElement.clientHeight)&&(i=!1),i!=null&&!q){var s=p("div","​",null,`position: absolute;
                         top: `+(t.top-r.viewOffset-Di(e.display))+`px;
                         height: `+(t.bottom-t.top+Mr(e)+r.barHeight)+`px;
                         left: `+t.left+"px; width: "+Math.max(2,t.right-t.left)+"px;");e.display.lineSpace.appendChild(s),s.scrollIntoView(i),e.display.lineSpace.removeChild(s)}}}function xf(e,t,r,n){n==null&&(n=0);var i;!e.options.lineWrapping&&t==r&&(r=t.sticky=="before"?be(t.line,t.ch+1,"before"):t,t=t.ch?be(t.line,t.sticky=="before"?t.ch-1:t.ch,"after"):t);for(var o=0;o<5;o++){var s=!1,l=kr(e,t),f=!r||r==t?l:kr(e,r);i={left:Math.min(l.left,f.left),top:Math.min(l.top,f.top)-n,right:Math.max(l.left,f.left),bottom:Math.max(l.bottom,f.bottom)+n};var c=So(e,i),w=e.doc.scrollTop,O=e.doc.scrollLeft;if(c.scrollTop!=null&&(Ui(e,c.scrollTop),Math.abs(e.doc.scrollTop-w)>1&&(s=!0)),c.scrollLeft!=null&&(qn(e,c.scrollLeft),Math.abs(e.doc.scrollLeft-O)>1&&(s=!0)),!s)break}return i}function bl(e,t){var r=So(e,t);r.scrollTop!=null&&Ui(e,r.scrollTop),r.scrollLeft!=null&&qn(e,r.scrollLeft)}function So(e,t){var r=e.display,n=Gi(e.display);t.top<0&&(t.top=0);var i=e.curOp&&e.curOp.scrollTop!=null?e.curOp.scrollTop:r.scroller.scrollTop,o=Ta(e),s={};t.bottom-t.top>o&&(t.bottom=t.top+o);var l=e.doc.height+zn(r),f=t.top<n,c=t.bottom>l-n;if(t.top<i)s.scrollTop=f?0:t.top;else if(t.bottom>i+o){var w=Math.min(t.top,(c?l:t.bottom)-o);w!=i&&(s.scrollTop=w)}var O=e.options.fixedGutter?0:r.gutters.offsetWidth,B=e.curOp&&e.curOp.scrollLeft!=null?e.curOp.scrollLeft:r.scroller.scrollLeft-O,R=dn(e)-r.gutters.offsetWidth,H=t.right-t.left>R;return H&&(t.right=t.left+R),t.left<10?s.scrollLeft=0:t.left<B?s.scrollLeft=Math.max(0,t.left+O-(H?0:10)):t.right>R+B-3&&(s.scrollLeft=t.right+(H?0:10)-R),s}function bs(e,t){t!=null&&(hi(e),e.curOp.scrollTop=(e.curOp.scrollTop==null?e.doc.scrollTop:e.curOp.scrollTop)+t)}function mn(e){hi(e);var t=e.getCursor();e.curOp.scrollToPos={from:t,to:t,margin:e.options.cursorScrollMargin}}function Ra(e,t,r){(t!=null||r!=null)&&hi(e),t!=null&&(e.curOp.scrollLeft=t),r!=null&&(e.curOp.scrollTop=r)}function Wn(e,t){hi(e),e.curOp.scrollToPos=t}function hi(e){var t=e.curOp.scrollToPos;if(t){e.curOp.scrollToPos=null;var r=ps(e,t.from),n=ps(e,t.to);xs(e,r,n,t.margin)}}function xs(e,t,r,n){var i=So(e,{left:Math.min(t.left,r.left),top:Math.min(t.top,r.top)-n,right:Math.max(t.right,r.right),bottom:Math.max(t.bottom,r.bottom)+n});Ra(e,i.scrollLeft,i.scrollTop)}function Ui(e,t){Math.abs(e.doc.scrollTop-t)<2||(S||Fa(e,{top:t}),Ss(e,t,!0),S&&Fa(e),Ma(e,100))}function Ss(e,t,r){t=Math.max(0,Math.min(e.display.scroller.scrollHeight-e.display.scroller.clientHeight,t)),!(e.display.scroller.scrollTop==t&&!r)&&(e.doc.scrollTop=t,e.display.scrollbars.setScrollTop(t),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t))}function qn(e,t,r,n){t=Math.max(0,Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth)),!((r?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)&&!n)&&(e.doc.scrollLeft=t,Ll(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbars.setScrollLeft(t))}function Xi(e){var t=e.display,r=t.gutters.offsetWidth,n=Math.round(e.doc.height+zn(e.display));return{clientHeight:t.scroller.clientHeight,viewHeight:t.wrapper.clientHeight,scrollWidth:t.scroller.scrollWidth,clientWidth:t.scroller.clientWidth,viewWidth:t.wrapper.clientWidth,barLeft:e.options.fixedGutter?r:0,docHeight:n,scrollHeight:n+Mr(e)+t.barHeight,nativeBarWidth:t.nativeBarWidth,gutterWidth:r}}var Un=function(e,t,r){this.cm=r;var n=this.vert=p("div",[p("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),i=this.horiz=p("div",[p("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");n.tabIndex=i.tabIndex=-1,e(n),e(i),ht(n,"scroll",function(){n.clientHeight&&t(n.scrollTop,"vertical")}),ht(i,"scroll",function(){i.clientWidth&&t(i.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,he&&te<8&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};Un.prototype.update=function(e){var t=e.scrollWidth>e.clientWidth+1,r=e.scrollHeight>e.clientHeight+1,n=e.nativeBarWidth;if(r){this.vert.style.display="block",this.vert.style.bottom=t?n+"px":"0";var i=e.viewHeight-(t?n:0);this.vert.firstChild.style.height=Math.max(0,e.scrollHeight-e.clientHeight+i)+"px"}else this.vert.scrollTop=0,this.vert.style.display="",this.vert.firstChild.style.height="0";if(t){this.horiz.style.display="block",this.horiz.style.right=r?n+"px":"0",this.horiz.style.left=e.barLeft+"px";var o=e.viewWidth-e.barLeft-(r?n:0);this.horiz.firstChild.style.width=Math.max(0,e.scrollWidth-e.clientWidth+o)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&e.clientHeight>0&&(n==0&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:r?n:0,bottom:t?n:0}},Un.prototype.setScrollLeft=function(e){this.horiz.scrollLeft!=e&&(this.horiz.scrollLeft=e),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},Un.prototype.setScrollTop=function(e){this.vert.scrollTop!=e&&(this.vert.scrollTop=e),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},Un.prototype.zeroWidthHack=function(){var e=_&&!qe?"12px":"18px";this.horiz.style.height=this.vert.style.width=e,this.horiz.style.visibility=this.vert.style.visibility="hidden",this.disableHoriz=new Ht,this.disableVert=new Ht},Un.prototype.enableZeroWidthBar=function(e,t,r){e.style.visibility="";function n(){var i=e.getBoundingClientRect(),o=r=="vert"?document.elementFromPoint(i.right-1,(i.top+i.bottom)/2):document.elementFromPoint((i.right+i.left)/2,i.bottom-1);o!=e?e.style.visibility="hidden":t.set(1e3,n)}t.set(1e3,n)},Un.prototype.clear=function(){var e=this.horiz.parentNode;e.removeChild(this.horiz),e.removeChild(this.vert)};var ji=function(){};ji.prototype.update=function(){return{bottom:0,right:0}},ji.prototype.setScrollLeft=function(){},ji.prototype.setScrollTop=function(){},ji.prototype.clear=function(){};function pi(e,t){t||(t=Xi(e));var r=e.display.barWidth,n=e.display.barHeight;ws(e,t);for(var i=0;i<4&&r!=e.display.barWidth||n!=e.display.barHeight;i++)r!=e.display.barWidth&&e.options.lineWrapping&&xo(e),ws(e,Xi(e)),r=e.display.barWidth,n=e.display.barHeight}function ws(e,t){var r=e.display,n=r.scrollbars.update(t);r.sizer.style.paddingRight=(r.barWidth=n.right)+"px",r.sizer.style.paddingBottom=(r.barHeight=n.bottom)+"px",r.heightForcer.style.borderBottom=n.bottom+"px solid transparent",n.right&&n.bottom?(r.scrollbarFiller.style.display="block",r.scrollbarFiller.style.height=n.bottom+"px",r.scrollbarFiller.style.width=n.right+"px"):r.scrollbarFiller.style.display="",n.bottom&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(r.gutterFiller.style.display="block",r.gutterFiller.style.height=n.bottom+"px",r.gutterFiller.style.width=t.gutterWidth+"px"):r.gutterFiller.style.display=""}var Ir={native:Un,null:ji};function Ts(e){e.display.scrollbars&&(e.display.scrollbars.clear(),e.display.scrollbars.addClass&&We(e.display.wrapper,e.display.scrollbars.addClass)),e.display.scrollbars=new Ir[e.options.scrollbarStyle](function(t){e.display.wrapper.insertBefore(t,e.display.scrollbarFiller),ht(t,"mousedown",function(){e.state.focused&&setTimeout(function(){return e.display.input.focus()},0)}),t.setAttribute("cm-not-content","true")},function(t,r){r=="horizontal"?qn(e,t):Ui(e,t)},e),e.display.scrollbars.addClass&&$e(e.display.wrapper,e.display.scrollbars.addClass)}var Sf=0;function yr(e){e.curOp={cm:e,viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++Sf,markArrays:null},il(e.curOp)}function gn(e){var t=e.curOp;t&&Jr(t,function(r){for(var n=0;n<r.ops.length;n++)r.ops[n].cm.curOp=null;vi(r)})}function vi(e){for(var t=e.ops,r=0;r<t.length;r++)wo(t[r]);for(var n=0;n<t.length;n++)xl(t[n]);for(var i=0;i<t.length;i++)Sl(t[i]);for(var o=0;o<t.length;o++)wl(t[o]);for(var s=0;s<t.length;s++)Tl(t[s])}function wo(e){var t=e.cm,r=t.display;Tf(t),e.updateMaxLine&&rs(t),e.mustUpdate=e.viewChanged||e.forceUpdate||e.scrollTop!=null||e.scrollToPos&&(e.scrollToPos.from.line<r.viewFrom||e.scrollToPos.to.line>=r.viewTo)||r.maxLineChanged&&t.options.lineWrapping,e.update=e.mustUpdate&&new To(t,e.mustUpdate&&{top:e.scrollTop,ensure:e.scrollToPos},e.forceUpdate)}function xl(e){e.updatedDisplay=e.mustUpdate&&Cs(e.cm,e.update)}function Sl(e){var t=e.cm,r=t.display;e.updatedDisplay&&xo(t),e.barMeasure=Xi(t),r.maxLineChanged&&!t.options.lineWrapping&&(e.adjustWidthTo=fs(t,r.maxLine,r.maxLine.text.length).left+3,t.display.sizerWidth=e.adjustWidthTo,e.barMeasure.scrollWidth=Math.max(r.scroller.clientWidth,r.sizer.offsetLeft+e.adjustWidthTo+Mr(t)+t.display.barWidth),e.maxScrollLeft=Math.max(0,r.sizer.offsetLeft+e.adjustWidthTo-dn(t))),(e.updatedDisplay||e.selectionChanged)&&(e.preparedSelection=r.input.prepareSelection())}function wl(e){var t=e.cm;e.adjustWidthTo!=null&&(t.display.sizer.style.minWidth=e.adjustWidthTo+"px",e.maxScrollLeft<t.doc.scrollLeft&&qn(t,Math.min(t.display.scroller.scrollLeft,e.maxScrollLeft),!0),t.display.maxLineChanged=!1);var r=e.focus&&e.focus==Ve(Ot(t));e.preparedSelection&&t.display.input.showSelection(e.preparedSelection,r),(e.updatedDisplay||e.startHeight!=t.doc.height)&&pi(t,e.barMeasure),e.updatedDisplay&&Es(t,e.barMeasure),e.selectionChanged&&vn(t),t.state.focused&&e.updateInput&&t.display.input.reset(e.typing),r&&gs(e.cm)}function Tl(e){var t=e.cm,r=t.display,n=t.doc;if(e.updatedDisplay&&El(t,e.update),r.wheelStartX!=null&&(e.scrollTop!=null||e.scrollLeft!=null||e.scrollToPos)&&(r.wheelStartX=r.wheelStartY=null),e.scrollTop!=null&&Ss(t,e.scrollTop,e.forceScroll),e.scrollLeft!=null&&qn(t,e.scrollLeft,!0,!0),e.scrollToPos){var i=xf(t,gt(n,e.scrollToPos.from),gt(n,e.scrollToPos.to),e.scrollToPos.margin);yl(t,i)}var o=e.maybeHiddenMarkers,s=e.maybeUnhiddenMarkers;if(o)for(var l=0;l<o.length;++l)o[l].lines.length||Qt(o[l],"hide");if(s)for(var f=0;f<s.length;++f)s[f].lines.length&&Qt(s[f],"unhide");r.wrapper.offsetHeight&&(n.scrollTop=t.display.scroller.scrollTop),e.changeObjs&&Qt(t,"changes",t,e.changeObjs),e.update&&e.update.finish()}function br(e,t){if(e.curOp)return t();yr(e);try{return t()}finally{gn(e)}}function or(e,t){return function(){if(e.curOp)return t.apply(e,arguments);yr(e);try{return t.apply(e,arguments)}finally{gn(e)}}}function vr(e){return function(){if(this.curOp)return e.apply(this,arguments);yr(this);try{return e.apply(this,arguments)}finally{gn(this)}}}function sr(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);yr(t);try{return e.apply(this,arguments)}finally{gn(t)}}}function Ma(e,t){e.doc.highlightFrontier<e.display.viewTo&&e.state.highlight.set(t,tt(wf,e))}function wf(e){var t=e.doc;if(!(t.highlightFrontier>=e.display.viewTo)){var r=+new Date+e.options.workTime,n=va(e,t.highlightFrontier),i=[];t.iter(n.line,Math.min(t.first+t.size,e.display.viewTo+500),function(o){if(n.line>=e.display.viewFrom){var s=o.styles,l=o.text.length>e.options.maxHighlightLength?Vr(t.mode,n.state):null,f=$s(e,o,n,!0);l&&(n.state=l),o.styles=f.styles;var c=o.styleClasses,w=f.classes;w?o.styleClasses=w:c&&(o.styleClasses=null);for(var O=!s||s.length!=o.styles.length||c!=w&&(!c||!w||c.bgClass!=w.bgClass||c.textClass!=w.textClass),B=0;!O&&B<s.length;++B)O=s[B]!=o.styles[B];O&&i.push(n.line),o.stateAfter=n.save(),n.nextLine()}else o.text.length<=e.options.maxHighlightLength&&Lr(e,o.text,n),o.stateAfter=n.line%5==0?n.save():null,n.nextLine();if(+new Date>r)return Ma(e,e.options.workDelay),!0}),t.highlightFrontier=n.line,t.modeFrontier=Math.max(t.modeFrontier,n.line),i.length&&br(e,function(){for(var o=0;o<i.length;o++)hn(e,i[o],"text")})}}var To=function(e,t,r){var n=e.display;this.viewport=t,this.visible=qi(n,e.doc,t),this.editorIsHidden=!n.wrapper.offsetWidth,this.wrapperHeight=n.wrapper.clientHeight,this.wrapperWidth=n.wrapper.clientWidth,this.oldDisplayWidth=dn(e),this.force=r,this.dims=yo(e),this.events=[]};To.prototype.signal=function(e,t){wr(e,t)&&this.events.push(arguments)},To.prototype.finish=function(){for(var e=0;e<this.events.length;e++)Qt.apply(null,this.events[e])};function Tf(e){var t=e.display;!t.scrollbarsClipped&&t.scroller.offsetWidth&&(t.nativeBarWidth=t.scroller.offsetWidth-t.scroller.clientWidth,t.heightForcer.style.height=Mr(e)+"px",t.sizer.style.marginBottom=-t.nativeBarWidth+"px",t.sizer.style.borderRightWidth=Mr(e)+"px",t.scrollbarsClipped=!0)}function Cl(e){if(e.hasFocus())return null;var t=Ve(Ot(e));if(!t||!Pe(e.display.lineDiv,t))return null;var r={activeElt:t};if(window.getSelection){var n=ut(e).getSelection();n.anchorNode&&n.extend&&Pe(e.display.lineDiv,n.anchorNode)&&(r.anchorNode=n.anchorNode,r.anchorOffset=n.anchorOffset,r.focusNode=n.focusNode,r.focusOffset=n.focusOffset)}return r}function _l(e){if(!(!e||!e.activeElt||e.activeElt==Ve(st(e.activeElt)))&&(e.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(e.activeElt.nodeName)&&e.anchorNode&&Pe(document.body,e.anchorNode)&&Pe(document.body,e.focusNode))){var t=e.activeElt.ownerDocument,r=t.defaultView.getSelection(),n=t.createRange();n.setEnd(e.anchorNode,e.anchorOffset),n.collapse(!1),r.removeAllRanges(),r.addRange(n),r.extend(e.focusNode,e.focusOffset)}}function Cs(e,t){var r=e.display,n=e.doc;if(t.editorIsHidden)return pn(e),!1;if(!t.force&&t.visible.from>=r.viewFrom&&t.visible.to<=r.viewTo&&(r.updateLineNumbers==null||r.updateLineNumbers>=r.viewTo)&&r.renderedView==r.view&&ms(e)==0)return!1;kl(e)&&(pn(e),t.dims=yo(e));var i=n.first+n.size,o=Math.max(t.visible.from-e.options.viewportMargin,n.first),s=Math.min(i,t.visible.to+e.options.viewportMargin);r.viewFrom<o&&o-r.viewFrom<20&&(o=Math.max(n.first,r.viewFrom)),r.viewTo>s&&r.viewTo-s<20&&(s=Math.min(i,r.viewTo)),un&&(o=es(e.doc,o),s=tl(e.doc,s));var l=o!=r.viewFrom||s!=r.viewTo||r.lastWrapHeight!=t.wrapperHeight||r.lastWrapWidth!=t.wrapperWidth;vl(e,o,s),r.viewOffset=Cr(lt(e.doc,r.viewFrom)),e.display.mover.style.top=r.viewOffset+"px";var f=ms(e);if(!l&&f==0&&!t.force&&r.renderedView==r.view&&(r.updateLineNumbers==null||r.updateLineNumbers>=r.viewTo))return!1;var c=Cl(e);return f>4&&(r.lineDiv.style.display="none"),Co(e,r.updateLineNumbers,t.dims),f>4&&(r.lineDiv.style.display=""),r.renderedView=r.view,_l(c),C(r.cursorDiv),C(r.selectionDiv),r.gutters.style.height=r.sizer.style.minHeight=0,l&&(r.lastWrapHeight=t.wrapperHeight,r.lastWrapWidth=t.wrapperWidth,Ma(e,400)),r.updateLineNumbers=null,!0}function El(e,t){for(var r=t.viewport,n=!0;;n=!1){if(!n||!e.options.lineWrapping||t.oldDisplayWidth==dn(e)){if(r&&r.top!=null&&(r={top:Math.min(e.doc.height+zn(e.display)-Ta(e),r.top)}),t.visible=qi(e.display,e.doc,r),t.visible.from>=e.display.viewFrom&&t.visible.to<=e.display.viewTo)break}else n&&(t.visible=qi(e.display,e.doc,r));if(!Cs(e,t))break;xo(e);var i=Xi(e);Aa(e),pi(e,i),Es(e,i),t.force=!1}t.signal(e,"update",e),(e.display.viewFrom!=e.display.reportedViewFrom||e.display.viewTo!=e.display.reportedViewTo)&&(t.signal(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo),e.display.reportedViewFrom=e.display.viewFrom,e.display.reportedViewTo=e.display.viewTo)}function Fa(e,t){var r=new To(e,t);if(Cs(e,r)){xo(e),El(e,r);var n=Xi(e);Aa(e),pi(e,n),Es(e,n),r.finish()}}function Co(e,t,r){var n=e.display,i=e.options.lineNumbers,o=n.lineDiv,s=o.firstChild;function l(H){var ce=H.nextSibling;return z&&_&&e.display.currentWheelTarget==H?H.style.display="none":H.parentNode.removeChild(H),ce}for(var f=n.view,c=n.viewFrom,w=0;w<f.length;w++){var O=f[w];if(!O.hidden)if(!O.node||O.node.parentNode!=o){var B=mf(e,O,c,r);o.insertBefore(B,s)}else{for(;s!=O.node;)s=l(s);var R=i&&t!=null&&t<=c&&O.lineNumber;O.changes&&(ft(O.changes,"gutter")>-1&&(R=!1),fo(e,O,c,r)),R&&(C(O.lineNumber),O.lineNumber.appendChild(document.createTextNode(Ue(e.options,c)))),s=O.node.nextSibling}c+=O.size}for(;s;)s=l(s)}function _s(e){var t=e.gutters.offsetWidth;e.sizer.style.marginLeft=t+"px",er(e,"gutterChanged",e)}function Es(e,t){e.display.sizer.style.minHeight=t.docHeight+"px",e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=t.docHeight+e.display.barHeight+Mr(e)+"px"}function Ll(e){var t=e.display,r=t.view;if(!(!t.alignWidgets&&(!t.gutters.firstChild||!e.options.fixedGutter))){for(var n=ci(t)-t.scroller.scrollLeft+e.doc.scrollLeft,i=t.gutters.offsetWidth,o=n+"px",s=0;s<r.length;s++)if(!r[s].hidden){e.options.fixedGutter&&(r[s].gutter&&(r[s].gutter.style.left=o),r[s].gutterBackground&&(r[s].gutterBackground.style.left=o));var l=r[s].alignable;if(l)for(var f=0;f<l.length;f++)l[f].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=n+i+"px")}}function kl(e){if(!e.options.lineNumbers)return!1;var t=e.doc,r=Ue(e.options,t.first+t.size-1),n=e.display;if(r.length!=n.lineNumChars){var i=n.measure.appendChild(p("div",[p("div",r)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=i.firstChild.offsetWidth,s=i.offsetWidth-o;return n.lineGutter.style.width="",n.lineNumInnerWidth=Math.max(o,n.lineGutter.offsetWidth-s)+1,n.lineNumWidth=n.lineNumInnerWidth+s,n.lineNumChars=n.lineNumInnerWidth?r.length:-1,n.lineGutter.style.width=n.lineNumWidth+"px",_s(e.display),!0}return!1}function Ls(e,t){for(var r=[],n=!1,i=0;i<e.length;i++){var o=e[i],s=null;if(typeof o!="string"&&(s=o.style,o=o.className),o=="CodeMirror-linenumbers")if(t)n=!0;else continue;r.push({className:o,style:s})}return t&&!n&&r.push({className:"CodeMirror-linenumbers",style:null}),r}function ks(e){var t=e.gutters,r=e.gutterSpecs;C(t),e.lineGutter=null;for(var n=0;n<r.length;++n){var i=r[n],o=i.className,s=i.style,l=t.appendChild(p("div",null,"CodeMirror-gutter "+o));s&&(l.style.cssText=s),o=="CodeMirror-linenumbers"&&(e.lineGutter=l,l.style.width=(e.lineNumWidth||1)+"px")}t.style.display=r.length?"":"none",_s(e)}function Ia(e){ks(e.display),pr(e),Ll(e)}function Cf(e,t,r,n){var i=this;this.input=r,i.scrollbarFiller=p("div",null,"CodeMirror-scrollbar-filler"),i.scrollbarFiller.setAttribute("cm-not-content","true"),i.gutterFiller=p("div",null,"CodeMirror-gutter-filler"),i.gutterFiller.setAttribute("cm-not-content","true"),i.lineDiv=Z("div",null,"CodeMirror-code"),i.selectionDiv=p("div",null,null,"position: relative; z-index: 1"),i.cursorDiv=p("div",null,"CodeMirror-cursors"),i.measure=p("div",null,"CodeMirror-measure"),i.lineMeasure=p("div",null,"CodeMirror-measure"),i.lineSpace=Z("div",[i.measure,i.lineMeasure,i.selectionDiv,i.cursorDiv,i.lineDiv],null,"position: relative; outline: none");var o=Z("div",[i.lineSpace],"CodeMirror-lines");i.mover=p("div",[o],null,"position: relative"),i.sizer=p("div",[i.mover],"CodeMirror-sizer"),i.sizerWidth=null,i.heightForcer=p("div",null,null,"position: absolute; height: "+Mt+"px; width: 1px;"),i.gutters=p("div",null,"CodeMirror-gutters"),i.lineGutter=null,i.scroller=p("div",[i.sizer,i.heightForcer,i.gutters],"CodeMirror-scroll"),i.scroller.setAttribute("tabIndex","-1"),i.wrapper=p("div",[i.scrollbarFiller,i.gutterFiller,i.scroller],"CodeMirror"),D&&se>=105&&(i.wrapper.style.clipPath="inset(0px)"),i.wrapper.setAttribute("translate","no"),he&&te<8&&(i.gutters.style.zIndex=-1,i.scroller.style.paddingRight=0),!z&&!(S&&h)&&(i.scroller.draggable=!0),e&&(e.appendChild?e.appendChild(i.wrapper):e(i.wrapper)),i.viewFrom=i.viewTo=t.first,i.reportedViewFrom=i.reportedViewTo=t.first,i.view=[],i.renderedView=null,i.externalMeasured=null,i.viewOffset=0,i.lastWrapHeight=i.lastWrapWidth=0,i.updateLineNumbers=null,i.nativeBarWidth=i.barHeight=i.barWidth=0,i.scrollbarsClipped=!1,i.lineNumWidth=i.lineNumInnerWidth=i.lineNumChars=null,i.alignWidgets=!1,i.cachedCharWidth=i.cachedTextHeight=i.cachedPaddingH=null,i.maxLine=null,i.maxLineLength=0,i.maxLineChanged=!1,i.wheelDX=i.wheelDY=i.wheelStartX=i.wheelStartY=null,i.shift=!1,i.selForContextMenu=null,i.activeTouch=null,i.gutterSpecs=Ls(n.gutters,n.lineNumbers),ks(i),r.init(i)}var _o=0,yn=null;he?yn=-.53:S?yn=15:D?yn=-.7:Ge&&(yn=-1/3);function Al(e){var t=e.wheelDeltaX,r=e.wheelDeltaY;return t==null&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(t=e.detail),r==null&&e.detail&&e.axis==e.VERTICAL_AXIS?r=e.detail:r==null&&(r=e.wheelDelta),{x:t,y:r}}function Ki(e){var t=Al(e);return t.x*=yn,t.y*=yn,t}function Ol(e,t){D&&se==102&&(e.display.chromeScrollHack==null?e.display.sizer.style.pointerEvents="none":clearTimeout(e.display.chromeScrollHack),e.display.chromeScrollHack=setTimeout(function(){e.display.chromeScrollHack=null,e.display.sizer.style.pointerEvents=""},100));var r=Al(t),n=r.x,i=r.y,o=yn;t.deltaMode===0&&(n=t.deltaX,i=t.deltaY,o=1);var s=e.display,l=s.scroller,f=l.scrollWidth>l.clientWidth,c=l.scrollHeight>l.clientHeight;if(n&&f||i&&c){if(i&&_&&z){e:for(var w=t.target,O=s.view;w!=l;w=w.parentNode)for(var B=0;B<O.length;B++)if(O[B].node==w){e.display.currentWheelTarget=w;break e}}if(n&&!S&&!ve&&o!=null){i&&c&&Ui(e,Math.max(0,l.scrollTop+i*o)),qn(e,Math.max(0,l.scrollLeft+n*o)),(!i||i&&c)&&qt(t),s.wheelStartX=null;return}if(i&&o!=null){var R=i*o,H=e.doc.scrollTop,ce=H+s.wrapper.clientHeight;R<0?H=Math.max(0,H+R-50):ce=Math.min(e.doc.height,ce+R+50),Fa(e,{top:H,bottom:ce})}_o<20&&t.deltaMode!==0&&(s.wheelStartX==null?(s.wheelStartX=l.scrollLeft,s.wheelStartY=l.scrollTop,s.wheelDX=n,s.wheelDY=i,setTimeout(function(){if(s.wheelStartX!=null){var Se=l.scrollLeft-s.wheelStartX,me=l.scrollTop-s.wheelStartY,Oe=me&&s.wheelDY&&me/s.wheelDY||Se&&s.wheelDX&&Se/s.wheelDX;s.wheelStartX=s.wheelStartY=null,Oe&&(yn=(yn*_o+Oe)/(_o+1),++_o)}},200)):(s.wheelDX+=n,s.wheelDY+=i))}}var Ar=function(e,t){this.ranges=e,this.primIndex=t};Ar.prototype.primary=function(){return this.ranges[this.primIndex]},Ar.prototype.equals=function(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var t=0;t<this.ranges.length;t++){var r=this.ranges[t],n=e.ranges[t];if(!zt(r.anchor,n.anchor)||!zt(r.head,n.head))return!1}return!0},Ar.prototype.deepCopy=function(){for(var e=[],t=0;t<this.ranges.length;t++)e[t]=new Dt(Jt(this.ranges[t].anchor),Jt(this.ranges[t].head));return new Ar(e,this.primIndex)},Ar.prototype.somethingSelected=function(){for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1},Ar.prototype.contains=function(e,t){t||(t=e);for(var r=0;r<this.ranges.length;r++){var n=this.ranges[r];if(Qe(t,n.from())>=0&&Qe(e,n.to())<=0)return r}return-1};var Dt=function(e,t){this.anchor=e,this.head=t};Dt.prototype.from=function(){return Fi(this.anchor,this.head)},Dt.prototype.to=function(){return hr(this.anchor,this.head)},Dt.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};function Or(e,t,r){var n=e&&e.options.selectionsMayTouch,i=t[r];t.sort(function(B,R){return Qe(B.from(),R.from())}),r=ft(t,i);for(var o=1;o<t.length;o++){var s=t[o],l=t[o-1],f=Qe(l.to(),s.from());if(n&&!s.empty()?f>0:f>=0){var c=Fi(l.from(),s.from()),w=hr(l.to(),s.to()),O=l.empty()?s.from()==s.head:l.from()==l.head;o<=r&&--r,t.splice(--o,2,new Dt(O?w:c,O?c:w))}}return new Ar(t,r)}function Xn(e,t){return new Ar([new Dt(e,t||e)],0)}function bn(e){return e.text?be(e.from.line+e.text.length-1,_t(e.text).length+(e.text.length==1?e.from.ch:0)):e.to}function Rl(e,t){if(Qe(e,t.from)<0)return e;if(Qe(e,t.to)<=0)return bn(t);var r=e.line+t.text.length-(t.to.line-t.from.line)-1,n=e.ch;return e.line==t.to.line&&(n+=bn(t).ch-t.to.ch),be(r,n)}function As(e,t){for(var r=[],n=0;n<e.sel.ranges.length;n++){var i=e.sel.ranges[n];r.push(new Dt(Rl(i.anchor,t),Rl(i.head,t)))}return Or(e.cm,r,e.sel.primIndex)}function Ml(e,t,r){return e.line==t.line?be(r.line,e.ch-t.ch+r.ch):be(r.line+(e.line-t.line),e.ch)}function _f(e,t,r){for(var n=[],i=be(e.first,0),o=i,s=0;s<t.length;s++){var l=t[s],f=Ml(l.from,i,o),c=Ml(bn(l),i,o);if(i=l.to,o=c,r=="around"){var w=e.sel.ranges[s],O=Qe(w.head,w.anchor)<0;n[s]=new Dt(O?c:f,O?f:c)}else n[s]=new Dt(f,f)}return new Ar(n,e.sel.primIndex)}function Os(e){e.doc.mode=Oi(e.options,e.doc.modeOption),xn(e)}function xn(e){e.doc.iter(function(t){t.stateAfter&&(t.stateAfter=null),t.styles&&(t.styles=null)}),e.doc.modeFrontier=e.doc.highlightFrontier=e.doc.first,Ma(e,100),e.state.modeGen++,e.curOp&&pr(e)}function Fl(e,t){return t.from.ch==0&&t.to.ch==0&&_t(t.text)==""&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function Yi(e,t,r,n){function i(Oe){return r?r[Oe]:null}function o(Oe,_e,Re){ff(Oe,_e,Re,n),er(Oe,"change",Oe,t)}function s(Oe,_e){for(var Re=[],Ke=Oe;Ke<_e;++Ke)Re.push(new Zr(c[Ke],i(Ke),n));return Re}var l=t.from,f=t.to,c=t.text,w=lt(e,l.line),O=lt(e,f.line),B=_t(c),R=i(c.length-1),H=f.line-l.line;if(t.full)e.insert(0,s(0,c.length)),e.remove(c.length,e.size-c.length);else if(Fl(e,t)){var ce=s(0,c.length-1);o(O,O.text,R),H&&e.remove(l.line,H),ce.length&&e.insert(l.line,ce)}else if(w==O)if(c.length==1)o(w,w.text.slice(0,l.ch)+B+w.text.slice(f.ch),R);else{var Se=s(1,c.length-1);Se.push(new Zr(B+w.text.slice(f.ch),R,n)),o(w,w.text.slice(0,l.ch)+c[0],i(0)),e.insert(l.line+1,Se)}else if(c.length==1)o(w,w.text.slice(0,l.ch)+c[0]+O.text.slice(f.ch),i(0)),e.remove(l.line+1,H);else{o(w,w.text.slice(0,l.ch)+c[0],i(0)),o(O,B+O.text.slice(f.ch),R);var me=s(1,c.length-1);H>1&&e.remove(l.line+1,H-1),e.insert(l.line+1,me)}er(e,"change",e,t)}function jn(e,t,r){function n(i,o,s){if(i.linked)for(var l=0;l<i.linked.length;++l){var f=i.linked[l];if(f.doc!=o){var c=s&&f.sharedHist;r&&!c||(t(f.doc,c),n(f.doc,i,c))}}}n(e,null,!0)}function mi(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,zi(e),Os(e),gi(e),e.options.direction=t.direction,e.options.lineWrapping||rs(e),e.options.mode=t.modeOption,pr(e)}function gi(e){(e.doc.direction=="rtl"?$e:We)(e.display.lineDiv,"CodeMirror-rtl")}function Ef(e){br(e,function(){gi(e),pr(e)})}function Sn(e){this.done=[],this.undone=[],this.undoDepth=e?e.undoDepth:1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e?e.maxGeneration:1}function Eo(e,t){var r={from:Jt(t.from),to:bn(t),text:fn(e,t.from,t.to)};return Pa(e,r,t.from.line,t.to.line+1),jn(e,function(n){return Pa(n,r,t.from.line,t.to.line+1)},!0),r}function yi(e){for(;e.length;){var t=_t(e);if(t.ranges)e.pop();else break}}function Rs(e,t){if(t)return yi(e.done),_t(e.done);if(e.done.length&&!_t(e.done).ranges)return _t(e.done);if(e.done.length>1&&!e.done[e.done.length-2].ranges)return e.done.pop(),_t(e.done)}function Lo(e,t,r,n){var i=e.history;i.undone.length=0;var o=+new Date,s,l;if((i.lastOp==n||i.lastOrigin==t.origin&&t.origin&&(t.origin.charAt(0)=="+"&&i.lastModTime>o-(e.cm?e.cm.options.historyEventDelay:500)||t.origin.charAt(0)=="*"))&&(s=Rs(i,i.lastOp==n)))l=_t(s.changes),Qe(t.from,t.to)==0&&Qe(t.from,l.to)==0?l.to=bn(t):s.changes.push(Eo(e,t));else{var f=_t(i.done);for((!f||!f.ranges)&&$i(e.sel,i.done),s={changes:[Eo(e,t)],generation:i.generation},i.done.push(s);i.done.length>i.undoDepth;)i.done.shift(),i.done[0].ranges||i.done.shift()}i.done.push(r),i.generation=++i.maxGeneration,i.lastModTime=i.lastSelTime=o,i.lastOp=i.lastSelOp=n,i.lastOrigin=i.lastSelOrigin=t.origin,l||Qt(e,"historyAdded")}function Ms(e,t,r,n){var i=t.charAt(0);return i=="*"||i=="+"&&r.ranges.length==n.ranges.length&&r.somethingSelected()==n.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function Fs(e,t,r,n){var i=e.history,o=n&&n.origin;r==i.lastSelOp||o&&i.lastSelOrigin==o&&(i.lastModTime==i.lastSelTime&&i.lastOrigin==o||Ms(e,o,_t(i.done),t))?i.done[i.done.length-1]=t:$i(t,i.done),i.lastSelTime=+new Date,i.lastSelOrigin=o,i.lastSelOp=r,n&&n.clearRedo!==!1&&yi(i.undone)}function $i(e,t){var r=_t(t);r&&r.ranges&&r.equals(e)||t.push(e)}function Pa(e,t,r,n){var i=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,r),Math.min(e.first+e.size,n),function(s){s.markedSpans&&((i||(i=t["spans_"+e.id]={}))[o]=s.markedSpans),++o})}function Il(e){if(!e)return null;for(var t,r=0;r<e.length;++r)e[r].marker.explicitlyCleared?t||(t=e.slice(0,r)):t&&t.push(e[r]);return t?t.length?t:null:e}function Pl(e,t){var r=t["spans_"+e.id];if(!r)return null;for(var n=[],i=0;i<t.text.length;++i)n.push(Il(r[i]));return n}function Is(e,t){var r=Pl(e,t),n=Qo(e,t);if(!r)return n;if(!n)return r;for(var i=0;i<r.length;++i){var o=r[i],s=n[i];if(o&&s)e:for(var l=0;l<s.length;++l){for(var f=s[l],c=0;c<o.length;++c)if(o[c].marker==f.marker)continue e;o.push(f)}else s&&(r[i]=s)}return r}function bi(e,t,r){for(var n=[],i=0;i<e.length;++i){var o=e[i];if(o.ranges){n.push(r?Ar.prototype.deepCopy.call(o):o);continue}var s=o.changes,l=[];n.push({changes:l});for(var f=0;f<s.length;++f){var c=s[f],w=void 0;if(l.push({from:c.from,to:c.to,text:c.text}),t)for(var O in c)(w=O.match(/^spans_(\d+)$/))&&ft(t,Number(w[1]))>-1&&(_t(l)[O]=c[O],delete c[O])}}return n}function ko(e,t,r,n){if(n){var i=e.anchor;if(r){var o=Qe(t,i)<0;o!=Qe(r,i)<0?(i=t,t=r):o!=Qe(t,r)<0&&(t=r)}return new Dt(i,t)}else return new Dt(r||t,t)}function Vi(e,t,r,n,i){i==null&&(i=e.cm&&(e.cm.display.shift||e.extend)),lr(e,new Ar([ko(e.sel.primary(),t,r,i)],0),n)}function Ao(e,t,r){for(var n=[],i=e.cm&&(e.cm.display.shift||e.extend),o=0;o<e.sel.ranges.length;o++)n[o]=ko(e.sel.ranges[o],t[o],null,i);var s=Or(e.cm,n,e.sel.primIndex);lr(e,s,r)}function Oo(e,t,r,n){var i=e.sel.ranges.slice(0);i[t]=r,lr(e,Or(e.cm,i,e.sel.primIndex),n)}function Ps(e,t,r,n){lr(e,Xn(t,r),n)}function Nl(e,t,r){var n={ranges:t.ranges,update:function(i){this.ranges=[];for(var o=0;o<i.length;o++)this.ranges[o]=new Dt(gt(e,i[o].anchor),gt(e,i[o].head))},origin:r&&r.origin};return Qt(e,"beforeSelectionChange",e,n),e.cm&&Qt(e.cm,"beforeSelectionChange",e.cm,n),n.ranges!=t.ranges?Or(e.cm,n.ranges,n.ranges.length-1):t}function Ns(e,t,r){var n=e.history.done,i=_t(n);i&&i.ranges?(n[n.length-1]=t,Na(e,t,r)):lr(e,t,r)}function lr(e,t,r){Na(e,t,r),Fs(e,e.sel,e.cm?e.cm.curOp.id:NaN,r)}function Na(e,t,r){(wr(e,"beforeSelectionChange")||e.cm&&wr(e.cm,"beforeSelectionChange"))&&(t=Nl(e,t,r));var n=r&&r.bias||(Qe(t.primary().head,e.sel.primary().head)<0?-1:1);Bs(e,Mo(e,t,n,!0)),!(r&&r.scroll===!1)&&e.cm&&e.cm.getOption("readOnly")!="nocursor"&&mn(e.cm)}function Bs(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=1,e.cm.curOp.selectionChanged=!0,_r(e.cm)),er(e,"cursorActivity",e))}function Ro(e){Bs(e,Mo(e,e.sel,null,!1))}function Mo(e,t,r,n){for(var i,o=0;o<t.ranges.length;o++){var s=t.ranges[o],l=t.ranges.length==e.sel.ranges.length&&e.sel.ranges[o],f=Qi(e,s.anchor,l&&l.anchor,r,n),c=s.head==s.anchor?f:Qi(e,s.head,l&&l.head,r,n);(i||f!=s.anchor||c!=s.head)&&(i||(i=t.ranges.slice(0,o)),i[o]=new Dt(f,c))}return i?Or(e.cm,i,t.primIndex):t}function xi(e,t,r,n,i){var o=lt(e,t.line);if(o.markedSpans)for(var s=0;s<o.markedSpans.length;++s){var l=o.markedSpans[s],f=l.marker,c="selectLeft"in f?!f.selectLeft:f.inclusiveLeft,w="selectRight"in f?!f.selectRight:f.inclusiveRight;if((l.from==null||(c?l.from<=t.ch:l.from<t.ch))&&(l.to==null||(w?l.to>=t.ch:l.to>t.ch))){if(i&&(Qt(f,"beforeCursorEnter"),f.explicitlyCleared))if(o.markedSpans){--s;continue}else break;if(!f.atomic)continue;if(r){var O=f.find(n<0?1:-1),B=void 0;if((n<0?w:c)&&(O=Ds(e,O,-n,O&&O.line==t.line?o:null)),O&&O.line==t.line&&(B=Qe(O,r))&&(n<0?B<0:B>0))return xi(e,O,t,n,i)}var R=f.find(n<0?-1:1);return(n<0?c:w)&&(R=Ds(e,R,n,R.line==t.line?o:null)),R?xi(e,R,t,n,i):null}}return t}function Qi(e,t,r,n,i){var o=n||1,s=xi(e,t,r,o,i)||!i&&xi(e,t,r,o,!0)||xi(e,t,r,-o,i)||!i&&xi(e,t,r,-o,!0);return s||(e.cantEdit=!0,be(e.first,0))}function Ds(e,t,r,n){return r<0&&t.ch==0?t.line>e.first?gt(e,be(t.line-1)):null:r>0&&t.ch==(n||lt(e,t.line)).text.length?t.line<e.first+e.size-1?be(t.line+1,0):null:new be(t.line,t.ch+r)}function Gs(e){e.setSelection(be(e.firstLine(),0),be(e.lastLine()),ar)}function Fo(e,t,r){var n={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){return n.canceled=!0}};return r&&(n.update=function(i,o,s,l){i&&(n.from=gt(e,i)),o&&(n.to=gt(e,o)),s&&(n.text=s),l!==void 0&&(n.origin=l)}),Qt(e,"beforeChange",e,n),e.cm&&Qt(e.cm,"beforeChange",e.cm,n),n.canceled?(e.cm&&(e.cm.curOp.updateInput=2),null):{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Si(e,t,r){if(e.cm){if(!e.cm.curOp)return or(e.cm,Si)(e,t,r);if(e.cm.state.suppressEdits)return}if(!((wr(e,"beforeChange")||e.cm&&wr(e.cm,"beforeChange"))&&(t=Fo(e,t,!0),!t))){var n=ro&&!r&&io(e,t.from,t.to);if(n)for(var i=n.length-1;i>=0;--i)Hs(e,{from:n[i].from,to:n[i].to,text:i?[""]:t.text,origin:t.origin});else Hs(e,t)}}function Hs(e,t){if(!(t.text.length==1&&t.text[0]==""&&Qe(t.from,t.to)==0)){var r=As(e,t);Lo(e,t,r,e.cm?e.cm.curOp.id:NaN),wn(e,t,r,Qo(e,t));var n=[];jn(e,function(i,o){!o&&ft(n,i.history)==-1&&(Kn(i.history,t),n.push(i.history)),wn(i,t,null,Qo(i,t))})}}function Zi(e,t,r){var n=e.cm&&e.cm.state.suppressEdits;if(!(n&&!r)){for(var i=e.history,o,s=e.sel,l=t=="undo"?i.done:i.undone,f=t=="undo"?i.undone:i.done,c=0;c<l.length&&(o=l[c],!(r?o.ranges&&!o.equals(e.sel):!o.ranges));c++);if(c!=l.length){for(i.lastOrigin=i.lastSelOrigin=null;;)if(o=l.pop(),o.ranges){if($i(o,f),r&&!o.equals(e.sel)){lr(e,o,{clearRedo:!1});return}s=o}else if(n){l.push(o);return}else break;var w=[];$i(s,f),f.push({changes:w,generation:i.generation}),i.generation=o.generation||++i.maxGeneration;for(var O=wr(e,"beforeChange")||e.cm&&wr(e.cm,"beforeChange"),B=function(ce){var Se=o.changes[ce];if(Se.origin=t,O&&!Fo(e,Se,!1))return l.length=0,{};w.push(Eo(e,Se));var me=ce?As(e,Se):_t(l);wn(e,Se,me,Is(e,Se)),!ce&&e.cm&&e.cm.scrollIntoView({from:Se.from,to:bn(Se)});var Oe=[];jn(e,function(_e,Re){!Re&&ft(Oe,_e.history)==-1&&(Kn(_e.history,Se),Oe.push(_e.history)),wn(_e,Se,null,Is(_e,Se))})},R=o.changes.length-1;R>=0;--R){var H=B(R);if(H)return H.v}}}}function Io(e,t){if(t!=0&&(e.first+=t,e.sel=new Ar(ri(e.sel.ranges,function(i){return new Dt(be(i.anchor.line+t,i.anchor.ch),be(i.head.line+t,i.head.ch))}),e.sel.primIndex),e.cm)){pr(e.cm,e.first,e.first-t,t);for(var r=e.cm.display,n=r.viewFrom;n<r.viewTo;n++)hn(e.cm,n,"gutter")}}function wn(e,t,r,n){if(e.cm&&!e.cm.curOp)return or(e.cm,wn)(e,t,r,n);if(t.to.line<e.first){Io(e,t.text.length-1-(t.to.line-t.from.line));return}if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var i=t.text.length-1-(e.first-t.from.line);Io(e,i),t={from:be(e.first,0),to:be(t.to.line+i,t.to.ch),text:[_t(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:be(o,lt(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=fn(e,t.from,t.to),r||(r=As(e,t)),e.cm?Bl(e.cm,t,n):Yi(e,t,n),Na(e,r,ar),e.cantEdit&&Qi(e,be(e.firstLine(),0))&&(e.cantEdit=!1)}}function Bl(e,t,r){var n=e.doc,i=e.display,o=t.from,s=t.to,l=!1,f=o.line;e.options.lineWrapping||(f=v(zr(lt(n,o.line))),n.iter(f,s.line+1,function(R){if(R==i.maxLine)return l=!0,!0})),n.sel.contains(t.from,t.to)>-1&&_r(e),Yi(n,t,r,pl(e)),e.options.lineWrapping||(n.iter(f,o.line+t.text.length,function(R){var H=lo(R);H>i.maxLineLength&&(i.maxLine=R,i.maxLineLength=H,i.maxLineChanged=!0,l=!1)}),l&&(e.curOp.updateMaxLine=!0)),ef(n,o.line),Ma(e,400);var c=t.text.length-(s.line-o.line)-1;t.full?pr(e):o.line==s.line&&t.text.length==1&&!Fl(e.doc,t)?hn(e,o.line,"text"):pr(e,o.line,s.line+1,c);var w=wr(e,"changes"),O=wr(e,"change");if(O||w){var B={from:o,to:s,text:t.text,removed:t.removed,origin:t.origin};O&&er(e,"change",e,B),w&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(B)}e.display.selForContextMenu=null}function Tn(e,t,r,n,i){var o;n||(n=r),Qe(n,r)<0&&(o=[n,r],r=o[0],n=o[1]),typeof t=="string"&&(t=e.splitLines(t)),Si(e,{from:r,to:n,text:t,origin:i})}function en(e,t,r,n){r<e.line?e.line+=n:t<e.line&&(e.line=t,e.ch=0)}function Ji(e,t,r,n){for(var i=0;i<e.length;++i){var o=e[i],s=!0;if(o.ranges){o.copied||(o=e[i]=o.deepCopy(),o.copied=!0);for(var l=0;l<o.ranges.length;l++)en(o.ranges[l].anchor,t,r,n),en(o.ranges[l].head,t,r,n);continue}for(var f=0;f<o.changes.length;++f){var c=o.changes[f];if(r<c.from.line)c.from=be(c.from.line+n,c.from.ch),c.to=be(c.to.line+n,c.to.ch);else if(t<=c.to.line){s=!1;break}}s||(e.splice(0,i+1),i=0)}}function Kn(e,t){var r=t.from.line,n=t.to.line,i=t.text.length-(n-r)-1;Ji(e.done,r,n,i),Ji(e.undone,r,n,i)}function Cn(e,t,r,n){var i=t,o=t;return typeof t=="number"?o=lt(e,Ys(e,t)):i=v(t),i==null?null:(n(o,i)&&e.cm&&hn(e.cm,i,r),o)}function _n(e){this.lines=e,this.parent=null;for(var t=0,r=0;r<e.length;++r)e[r].parent=this,t+=e[r].height;this.height=t}_n.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var r=e,n=e+t;r<n;++r){var i=this.lines[r];this.height-=i.height,Ni(i),er(i,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,r){this.height+=r,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var n=0;n<t.length;++n)t[n].parent=this},iterN:function(e,t,r){for(var n=e+t;e<n;++e)if(r(this.lines[e]))return!0}};function Ur(e){this.children=e;for(var t=0,r=0,n=0;n<e.length;++n){var i=e[n];t+=i.chunkSize(),r+=i.height,i.parent=this}this.size=t,this.height=r,this.parent=null}Ur.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var r=0;r<this.children.length;++r){var n=this.children[r],i=n.chunkSize();if(e<i){var o=Math.min(t,i-e),s=n.height;if(n.removeInner(e,o),this.height-=s-n.height,i==o&&(this.children.splice(r--,1),n.parent=null),(t-=o)==0)break;e=0}else e-=i}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof _n))){var l=[];this.collapse(l),this.children=[new _n(l)],this.children[0].parent=this}},collapse:function(e){for(var t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner:function(e,t,r){this.size+=t.length,this.height+=r;for(var n=0;n<this.children.length;++n){var i=this.children[n],o=i.chunkSize();if(e<=o){if(i.insertInner(e,t,r),i.lines&&i.lines.length>50){for(var s=i.lines.length%25+25,l=s;l<i.lines.length;){var f=new _n(i.lines.slice(l,l+=25));i.height-=f.height,this.children.splice(++n,0,f),f.parent=this}i.lines=i.lines.slice(0,s),this.maybeSpill()}break}e-=o}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=e.children.splice(e.children.length-5,5),r=new Ur(t);if(e.parent){e.size-=r.size,e.height-=r.height;var i=ft(e.parent.children,e);e.parent.children.splice(i+1,0,r)}else{var n=new Ur(e.children);n.parent=e,e.children=[n,r],e=n}r.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,r){for(var n=0;n<this.children.length;++n){var i=this.children[n],o=i.chunkSize();if(e<o){var s=Math.min(t,o-e);if(i.iterN(e,s,r))return!0;if((t-=s)==0)break;e=0}else e-=o}}};var Xr=function(e,t,r){if(r)for(var n in r)r.hasOwnProperty(n)&&(this[n]=r[n]);this.doc=e,this.node=t};Xr.prototype.clear=function(){var e=this.doc.cm,t=this.line.widgets,r=this.line,n=v(r);if(!(n==null||!t)){for(var i=0;i<t.length;++i)t[i]==this&&t.splice(i--,1);t.length||(r.widgets=null);var o=Hn(this);Er(r,Math.max(0,r.height-o)),e&&(br(e,function(){Yn(e,r,-o),hn(e,n,"widget")}),er(e,"lineWidgetCleared",e,this,n))}},Xr.prototype.changed=function(){var e=this,t=this.height,r=this.doc.cm,n=this.line;this.height=null;var i=Hn(this)-t;i&&(Bn(this.doc,n)||Er(n,n.height+i),r&&br(r,function(){r.curOp.forceUpdate=!0,Yn(r,n,i),er(r,"lineWidgetChanged",r,e,v(n))}))},Nr(Xr);function Yn(e,t,r){Cr(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&bs(e,r)}function Po(e,t,r,n){var i=new Xr(e,r,n),o=e.cm;return o&&i.noHScroll&&(o.display.alignWidgets=!0),Cn(e,t,"widget",function(s){var l=s.widgets||(s.widgets=[]);if(i.insertAt==null?l.push(i):l.splice(Math.min(l.length,Math.max(0,i.insertAt)),0,i),i.line=s,o&&!Bn(e,s)){var f=Cr(s)<e.scrollTop;Er(s,s.height+Hn(i)),f&&bs(o,i.height),o.curOp.forceUpdate=!0}return!0}),o&&er(o,"lineWidgetAdded",o,i,typeof t=="number"?t:v(t)),i}var Ba=0,Pr=function(e,t){this.lines=[],this.type=t,this.doc=e,this.id=++Ba};Pr.prototype.clear=function(){if(!this.explicitlyCleared){var e=this.doc.cm,t=e&&!e.curOp;if(t&&yr(e),wr(this,"clear")){var r=this.find();r&&er(this,"clear",r.from,r.to)}for(var n=null,i=null,o=0;o<this.lines.length;++o){var s=this.lines[o],l=ma(s.markedSpans,this);e&&!this.collapsed?hn(e,v(s),"text"):e&&(l.to!=null&&(i=v(s)),l.from!=null&&(n=v(s))),s.markedSpans=nf(s.markedSpans,l),l.from==null&&this.collapsed&&!Bn(this.doc,s)&&e&&Er(s,Gi(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var f=0;f<this.lines.length;++f){var c=zr(this.lines[f]),w=lo(c);w>e.display.maxLineLength&&(e.display.maxLine=c,e.display.maxLineLength=w,e.display.maxLineChanged=!0)}n!=null&&e&&this.collapsed&&pr(e,n,i+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&Ro(e.doc)),e&&er(e,"markerCleared",e,this,n,i),t&&gn(e),this.parent&&this.parent.clear()}},Pr.prototype.find=function(e,t){e==null&&this.type=="bookmark"&&(e=1);for(var r,n,i=0;i<this.lines.length;++i){var o=this.lines[i],s=ma(o.markedSpans,this);if(s.from!=null&&(r=be(t?o:v(o),s.from),e==-1))return r;if(s.to!=null&&(n=be(t?o:v(o),s.to),e==1))return n}return r&&{from:r,to:n}},Pr.prototype.changed=function(){var e=this,t=this.find(-1,!0),r=this,n=this.doc.cm;!t||!n||br(n,function(){var i=t.line,o=v(t.line),s=co(n,o);if(s&&(ul(s),n.curOp.selectionChanged=n.curOp.forceUpdate=!0),n.curOp.updateMaxLine=!0,!Bn(r.doc,i)&&r.height!=null){var l=r.height;r.height=null;var f=Hn(r)-l;f&&Er(i,i.height+f)}er(n,"markerChanged",n,e)})},Pr.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(!t.maybeHiddenMarkers||ft(t.maybeHiddenMarkers,this)==-1)&&(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},Pr.prototype.detachLine=function(e){if(this.lines.splice(ft(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}},Nr(Pr);function $n(e,t,r,n,i){if(n&&n.shared)return ea(e,t,r,n,i);if(e.cm&&!e.cm.curOp)return or(e.cm,$n)(e,t,r,n,i);var o=new Pr(e,i),s=Qe(t,r);if(n&&pt(n,o,!1),s>0||s==0&&o.clearWhenEmpty!==!1)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=Z("span",[o.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||o.widgetNode.setAttribute("cm-ignore-events","true"),n.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(Jo(e,t.line,t,r,o)||t.line!=r.line&&Jo(e,r.line,t,r,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");rf()}o.addToHistory&&Lo(e,{from:t,to:r,origin:"markText"},e.sel,NaN);var l=t.line,f=e.cm,c;if(e.iter(l,r.line+1,function(O){f&&o.collapsed&&!f.options.lineWrapping&&zr(O)==f.display.maxLine&&(c=!0),o.collapsed&&l!=t.line&&Er(O,0),af(O,new no(o,l==t.line?t.ch:null,l==r.line?r.ch:null),e.cm&&e.cm.curOp),++l}),o.collapsed&&e.iter(t.line,r.line+1,function(O){Bn(e,O)&&Er(O,0)}),o.clearOnEnter&&ht(o,"beforeCursorEnter",function(){return o.clear()}),o.readOnly&&(tf(),(e.history.done.length||e.history.undone.length)&&e.clearHistory()),o.collapsed&&(o.id=++Ba,o.atomic=!0),f){if(c&&(f.curOp.updateMaxLine=!0),o.collapsed)pr(f,t.line,r.line+1);else if(o.className||o.startStyle||o.endStyle||o.css||o.attributes||o.title)for(var w=t.line;w<=r.line;w++)hn(f,w,"text");o.atomic&&Ro(f.doc),er(f,"markerAdded",f,o)}return o}var wi=function(e,t){this.markers=e,this.primary=t;for(var r=0;r<e.length;++r)e[r].parent=this};wi.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();er(this,"clear")}},wi.prototype.find=function(e,t){return this.primary.find(e,t)},Nr(wi);function ea(e,t,r,n,i){n=pt(n),n.shared=!1;var o=[$n(e,t,r,n,i)],s=o[0],l=n.widgetNode;return jn(e,function(f){l&&(n.widgetNode=l.cloneNode(!0)),o.push($n(f,gt(f,t),gt(f,r),n,i));for(var c=0;c<f.linked.length;++c)if(f.linked[c].isParent)return;s=_t(o)}),new wi(o,s)}function Ti(e){return e.findMarks(be(e.first,0),e.clipPos(be(e.lastLine())),function(t){return t.parent})}function Lf(e,t){for(var r=0;r<t.length;r++){var n=t[r],i=n.find(),o=e.clipPos(i.from),s=e.clipPos(i.to);if(Qe(o,s)){var l=$n(e,o,s,n.primary,n.primary.type);n.markers.push(l),l.parent=n}}}function kf(e){for(var t=function(n){var i=e[n],o=[i.primary.doc];jn(i.primary.doc,function(f){return o.push(f)});for(var s=0;s<i.markers.length;s++){var l=i.markers[s];ft(o,l.doc)==-1&&(l.parent=null,i.markers.splice(s--,1))}},r=0;r<e.length;r++)t(r)}var Dl=0,mr=function(e,t,r,n,i){if(!(this instanceof mr))return new mr(e,t,r,n,i);r==null&&(r=0),Ur.call(this,[new _n([new Zr("",null)])]),this.first=r,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=r;var o=be(r,0);this.sel=Xn(o),this.history=new Sn(null),this.id=++Dl,this.modeOption=t,this.lineSep=n,this.direction=i=="rtl"?"rtl":"ltr",this.extend=!1,typeof e=="string"&&(e=this.splitLines(e)),Yi(this,{from:o,to:o,text:e}),lr(this,Xn(o),ar)};mr.prototype=Za(Ur.prototype,{constructor:mr,iter:function(e,t,r){r?this.iterN(e-this.first,t-e,r):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var r=0,n=0;n<t.length;++n)r+=t[n].height;this.insertInner(e-this.first,t,r)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=pa(this,this.first,this.first+this.size);return e===!1?t:t.join(e||this.lineSeparator())},setValue:sr(function(e){var t=be(this.first,0),r=this.first+this.size-1;Si(this,{from:t,to:be(r,lt(this,r).text.length),text:this.splitLines(e),origin:"setValue",full:!0},!0),this.cm&&Ra(this.cm,0,0),lr(this,Xn(t),ar)}),replaceRange:function(e,t,r,n){t=gt(this,t),r=r?gt(this,r):t,Tn(this,e,t,r,n)},getRange:function(e,t,r){var n=fn(this,gt(this,e),gt(this,t));return r===!1?n:r===""?n.join(""):n.join(r||this.lineSeparator())},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){if(Ae(this,e))return lt(this,e)},getLineNumber:function(e){return v(e)},getLineHandleVisualStart:function(e){return typeof e=="number"&&(e=lt(this,e)),zr(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return gt(this,e)},getCursor:function(e){var t=this.sel.primary(),r;return e==null||e=="head"?r=t.head:e=="anchor"?r=t.anchor:e=="end"||e=="to"||e===!1?r=t.to():r=t.from(),r},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:sr(function(e,t,r){Ps(this,gt(this,typeof e=="number"?be(e,t||0):e),null,r)}),setSelection:sr(function(e,t,r){Ps(this,gt(this,e),gt(this,t||e),r)}),extendSelection:sr(function(e,t,r){Vi(this,gt(this,e),t&&gt(this,t),r)}),extendSelections:sr(function(e,t){Ao(this,Yo(this,e),t)}),extendSelectionsBy:sr(function(e,t){var r=ri(this.sel.ranges,e);Ao(this,Yo(this,r),t)}),setSelections:sr(function(e,t,r){if(e.length){for(var n=[],i=0;i<e.length;i++)n[i]=new Dt(gt(this,e[i].anchor),gt(this,e[i].head||e[i].anchor));t==null&&(t=Math.min(e.length-1,this.sel.primIndex)),lr(this,Or(this.cm,n,t),r)}}),addSelection:sr(function(e,t,r){var n=this.sel.ranges.slice(0);n.push(new Dt(gt(this,e),gt(this,t||e))),lr(this,Or(this.cm,n,n.length-1),r)}),getSelection:function(e){for(var t=this.sel.ranges,r,n=0;n<t.length;n++){var i=fn(this,t[n].from(),t[n].to());r=r?r.concat(i):i}return e===!1?r:r.join(e||this.lineSeparator())},getSelections:function(e){for(var t=[],r=this.sel.ranges,n=0;n<r.length;n++){var i=fn(this,r[n].from(),r[n].to());e!==!1&&(i=i.join(e||this.lineSeparator())),t[n]=i}return t},replaceSelection:function(e,t,r){for(var n=[],i=0;i<this.sel.ranges.length;i++)n[i]=e;this.replaceSelections(n,t,r||"+input")},replaceSelections:sr(function(e,t,r){for(var n=[],i=this.sel,o=0;o<i.ranges.length;o++){var s=i.ranges[o];n[o]={from:s.from(),to:s.to(),text:this.splitLines(e[o]),origin:r}}for(var l=t&&t!="end"&&_f(this,n,t),f=n.length-1;f>=0;f--)Si(this,n[f]);l?Ns(this,l):this.cm&&mn(this.cm)}),undo:sr(function(){Zi(this,"undo")}),redo:sr(function(){Zi(this,"redo")}),undoSelection:sr(function(){Zi(this,"undo",!0)}),redoSelection:sr(function(){Zi(this,"redo",!0)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,r=0,n=0;n<e.done.length;n++)e.done[n].ranges||++t;for(var i=0;i<e.undone.length;i++)e.undone[i].ranges||++r;return{undo:t,redo:r}},clearHistory:function(){var e=this;this.history=new Sn(this.history),jn(this,function(t){return t.history=e.history},!0)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:bi(this.history.done),undone:bi(this.history.undone)}},setHistory:function(e){var t=this.history=new Sn(this.history);t.done=bi(e.done.slice(0),null,!0),t.undone=bi(e.undone.slice(0),null,!0)},setGutterMarker:sr(function(e,t,r){return Cn(this,e,"gutter",function(n){var i=n.gutterMarkers||(n.gutterMarkers={});return i[t]=r,!r&&Kr(i)&&(n.gutterMarkers=null),!0})}),clearGutter:sr(function(e){var t=this;this.iter(function(r){r.gutterMarkers&&r.gutterMarkers[e]&&Cn(t,r,"gutter",function(){return r.gutterMarkers[e]=null,Kr(r.gutterMarkers)&&(r.gutterMarkers=null),!0})})}),lineInfo:function(e){var t;if(typeof e=="number"){if(!Ae(this,e)||(t=e,e=lt(this,e),!e))return null}else if(t=v(e),t==null)return null;return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},addLineClass:sr(function(e,t,r){return Cn(this,e,t=="gutter"?"gutter":"class",function(n){var i=t=="text"?"textClass":t=="background"?"bgClass":t=="gutter"?"gutterClass":"wrapClass";if(!n[i])n[i]=r;else{if(ke(r).test(n[i]))return!1;n[i]+=" "+r}return!0})}),removeLineClass:sr(function(e,t,r){return Cn(this,e,t=="gutter"?"gutter":"class",function(n){var i=t=="text"?"textClass":t=="background"?"bgClass":t=="gutter"?"gutterClass":"wrapClass",o=n[i];if(o)if(r==null)n[i]=null;else{var s=o.match(ke(r));if(!s)return!1;var l=s.index+s[0].length;n[i]=o.slice(0,s.index)+(!s.index||l==o.length?"":" ")+o.slice(l)||null}else return!1;return!0})}),addLineWidget:sr(function(e,t,r){return Po(this,e,t,r)}),removeLineWidget:function(e){e.clear()},markText:function(e,t,r){return $n(this,gt(this,e),gt(this,t),r,r&&r.type||"range")},setBookmark:function(e,t){var r={replacedWith:t&&(t.nodeType==null?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared,handleMouseEvents:t&&t.handleMouseEvents};return e=gt(this,e),$n(this,e,e,r,"bookmark")},findMarksAt:function(e){e=gt(this,e);var t=[],r=lt(this,e.line).markedSpans;if(r)for(var n=0;n<r.length;++n){var i=r[n];(i.from==null||i.from<=e.ch)&&(i.to==null||i.to>=e.ch)&&t.push(i.marker.parent||i.marker)}return t},findMarks:function(e,t,r){e=gt(this,e),t=gt(this,t);var n=[],i=e.line;return this.iter(e.line,t.line+1,function(o){var s=o.markedSpans;if(s)for(var l=0;l<s.length;l++){var f=s[l];!(f.to!=null&&i==e.line&&e.ch>=f.to||f.from==null&&i!=e.line||f.from!=null&&i==t.line&&f.from>=t.ch)&&(!r||r(f.marker))&&n.push(f.marker.parent||f.marker)}++i}),n},getAllMarks:function(){var e=[];return this.iter(function(t){var r=t.markedSpans;if(r)for(var n=0;n<r.length;++n)r[n].from!=null&&e.push(r[n].marker)}),e},posFromIndex:function(e){var t,r=this.first,n=this.lineSeparator().length;return this.iter(function(i){var o=i.text.length+n;if(o>e)return t=e,!0;e-=o,++r}),gt(this,be(r,t))},indexFromPos:function(e){e=gt(this,e);var t=e.ch;if(e.line<this.first||e.ch<0)return 0;var r=this.lineSeparator().length;return this.iter(this.first,e.line,function(n){t+=n.text.length+r}),t},copy:function(e){var t=new mr(pa(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,r=this.first+this.size;e.from!=null&&e.from>t&&(t=e.from),e.to!=null&&e.to<r&&(r=e.to);var n=new mr(pa(this,t,r),e.mode||this.modeOption,t,this.lineSep,this.direction);return e.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],Lf(n,Ti(this)),n},unlinkDoc:function(e){if(e instanceof Kt&&(e=e.doc),this.linked)for(var t=0;t<this.linked.length;++t){var r=this.linked[t];if(r.doc==e){this.linked.splice(t,1),e.unlinkDoc(this),kf(Ti(this));break}}if(e.history==this.history){var n=[e.id];jn(e,function(i){return n.push(i.id)},!0),e.history=new Sn(null),e.history.done=bi(this.history.done,n),e.history.undone=bi(this.history.undone,n)}},iterLinkedDocs:function(e){jn(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(e){return this.lineSep?e.split(this.lineSep):Bt(e)},lineSeparator:function(){return this.lineSep||`
`},setDirection:sr(function(e){e!="rtl"&&(e="ltr"),e!=this.direction&&(this.direction=e,this.iter(function(t){return t.order=null}),this.cm&&Ef(this.cm))})}),mr.prototype.eachLine=mr.prototype.iter;var zs=0;function Af(e){var t=this;if(Gl(t),!(Yt(t,e)||Wr(t.display,e))){qt(e),he&&(zs=+new Date);var r=fr(t,e,!0),n=e.dataTransfer.files;if(!(!r||t.isReadOnly()))if(n&&n.length&&window.FileReader&&window.File)for(var i=n.length,o=Array(i),s=0,l=function(){++s==i&&or(t,function(){r=gt(t.doc,r);var R={from:r,to:r,text:t.doc.splitLines(o.filter(function(H){return H!=null}).join(t.doc.lineSeparator())),origin:"paste"};Si(t.doc,R),Ns(t.doc,Xn(gt(t.doc,r),gt(t.doc,bn(R))))})()},f=function(R,H){if(t.options.allowDropFileTypes&&ft(t.options.allowDropFileTypes,R.type)==-1){l();return}var ce=new FileReader;ce.onerror=function(){return l()},ce.onload=function(){var Se=ce.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(Se)){l();return}o[H]=Se,l()},ce.readAsText(R)},c=0;c<n.length;c++)f(n[c],c);else{if(t.state.draggingText&&t.doc.sel.contains(r)>-1){t.state.draggingText(e),setTimeout(function(){return t.display.input.focus()},20);return}try{var w=e.dataTransfer.getData("Text");if(w){var O;if(t.state.draggingText&&!t.state.draggingText.copy&&(O=t.listSelections()),Na(t.doc,Xn(r,r)),O)for(var B=0;B<O.length;++B)Tn(t.doc,"",O[B].anchor,O[B].head,"drag");t.replaceSelection(w,"around","paste"),t.display.input.focus()}}catch{}}}}function ta(e,t){if(he&&(!e.state.draggingText||+new Date-zs<100)){In(t);return}if(!(Yt(e,t)||Wr(e.display,t))&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setDragImage&&!Ge)){var r=p("img",null,null,"position: fixed; left: 0; top: 0;");r.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",ve&&(r.width=r.height=1,e.display.wrapper.appendChild(r),r._top=r.offsetTop),t.dataTransfer.setDragImage(r,0,0),ve&&r.parentNode.removeChild(r)}}function Of(e,t){var r=fr(e,t);if(r){var n=document.createDocumentFragment();ir(e,r,n),e.display.dragCursor||(e.display.dragCursor=p("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),e.display.lineSpace.insertBefore(e.display.dragCursor,e.display.cursorDiv)),E(e.display.dragCursor,n)}}function Gl(e){e.display.dragCursor&&(e.display.lineSpace.removeChild(e.display.dragCursor),e.display.dragCursor=null)}function Hl(e){if(document.getElementsByClassName){for(var t=document.getElementsByClassName("CodeMirror"),r=[],n=0;n<t.length;n++){var i=t[n].CodeMirror;i&&r.push(i)}r.length&&r[0].operation(function(){for(var o=0;o<r.length;o++)e(r[o])})}}var Ws=!1;function Rf(){Ws||(Mf(),Ws=!0)}function Mf(){var e;ht(window,"resize",function(){e==null&&(e=setTimeout(function(){e=null,Hl(Ff)},100))}),ht(window,"blur",function(){return Hl(Wi)})}function Ff(e){var t=e.display;t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,t.scrollbarsClipped=!1,e.setSize()}for(var Vn={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",224:"Mod",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},Da=0;Da<10;Da++)Vn[Da+48]=Vn[Da+96]=String(Da);for(var No=65;No<=90;No++)Vn[No]=String.fromCharCode(No);for(var Ga=1;Ga<=12;Ga++)Vn[Ga+111]=Vn[Ga+63235]="F"+Ga;var En={};En.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},En.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},En.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},En.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},En.default=_?En.macDefault:En.pcDefault;function If(e){var t=e.split(/-(?!$)/);e=t[t.length-1];for(var r,n,i,o,s=0;s<t.length-1;s++){var l=t[s];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))n=!0;else if(/^s(hift)?$/i.test(l))i=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(e="Alt-"+e),n&&(e="Ctrl-"+e),o&&(e="Cmd-"+e),i&&(e="Shift-"+e),e}function Pf(e){var t={};for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];if(/^(name|fallthrough|(de|at)tach)$/.test(r))continue;if(n=="..."){delete e[r];continue}for(var i=ri(r.split(" "),If),o=0;o<i.length;o++){var s=void 0,l=void 0;o==i.length-1?(l=i.join(" "),s=n):(l=i.slice(0,o+1).join(" "),s="...");var f=t[l];if(!f)t[l]=s;else if(f!=s)throw new Error("Inconsistent bindings for "+l)}delete e[r]}for(var c in t)e[c]=t[c];return e}function Qn(e,t,r,n){t=ra(t);var i=t.call?t.call(e,n):t[e];if(i===!1)return"nothing";if(i==="...")return"multi";if(i!=null&&r(i))return"handled";if(t.fallthrough){if(Object.prototype.toString.call(t.fallthrough)!="[object Array]")return Qn(e,t.fallthrough,r,n);for(var o=0;o<t.fallthrough.length;o++){var s=Qn(e,t.fallthrough[o],r,n);if(s)return s}}}function Ha(e){var t=typeof e=="string"?e:Vn[e.keyCode];return t=="Ctrl"||t=="Alt"||t=="Shift"||t=="Mod"}function za(e,t,r){var n=e;return t.altKey&&n!="Alt"&&(e="Alt-"+e),(we?t.metaKey:t.ctrlKey)&&n!="Ctrl"&&(e="Ctrl-"+e),(we?t.ctrlKey:t.metaKey)&&n!="Mod"&&(e="Cmd-"+e),!r&&t.shiftKey&&n!="Shift"&&(e="Shift-"+e),e}function Wa(e,t){if(ve&&e.keyCode==34&&e.char)return!1;var r=Vn[e.keyCode];return r==null||e.altGraphKey?!1:(e.keyCode==3&&e.code&&(r=e.code),za(r,e,t))}function ra(e){return typeof e=="string"?En[e]:e}function Ln(e,t){for(var r=e.doc.sel.ranges,n=[],i=0;i<r.length;i++){for(var o=t(r[i]);n.length&&Qe(o.from,_t(n).to)<=0;){var s=n.pop();if(Qe(s.from,o.from)<0){o.from=s.from;break}}n.push(o)}br(e,function(){for(var l=n.length-1;l>=0;l--)Tn(e.doc,"",n[l].from,n[l].to,"+delete");mn(e)})}function na(e,t,r){var n=on(e.text,t+r,r);return n<0||n>e.text.length?null:n}function ia(e,t,r){var n=na(e,t.ch,r);return n==null?null:new be(t.line,n,r<0?"after":"before")}function qa(e,t,r,n,i){if(e){t.doc.direction=="rtl"&&(i=-i);var o=kt(r,t.doc.direction);if(o){var s=i<0?_t(o):o[0],l=i<0==(s.level==1),f=l?"after":"before",c;if(s.level>0||t.doc.direction=="rtl"){var w=li(t,r);c=i<0?r.text.length-1:0;var O=qr(t,w,c).top;c=$r(function(B){return qr(t,w,B).top==O},i<0==(s.level==1)?s.from:s.to-1,c),f=="before"&&(c=na(r,c,1))}else c=i<0?s.to:s.from;return new be(n,c,f)}}return new be(n,i<0?r.text.length:0,i<0?"before":"after")}function Bo(e,t,r,n){var i=kt(t,e.doc.direction);if(!i)return ia(t,r,n);r.ch>=t.text.length?(r.ch=t.text.length,r.sticky="before"):r.ch<=0&&(r.ch=0,r.sticky="after");var o=nr(i,r.ch,r.sticky),s=i[o];if(e.doc.direction=="ltr"&&s.level%2==0&&(n>0?s.to>r.ch:s.from<r.ch))return ia(t,r,n);var l=function(me,Oe){return na(t,me instanceof be?me.ch:me,Oe)},f,c=function(me){return e.options.lineWrapping?(f=f||li(e,t),La(e,t,f,me)):{begin:0,end:t.text.length}},w=c(r.sticky=="before"?l(r,-1):r.ch);if(e.doc.direction=="rtl"||s.level==1){var O=s.level==1==n<0,B=l(r,O?1:-1);if(B!=null&&(O?B<=s.to&&B<=w.end:B>=s.from&&B>=w.begin)){var R=O?"before":"after";return new be(r.line,B,R)}}var H=function(me,Oe,_e){for(var Re=function(rt,At){return At?new be(r.line,l(rt,1),"before"):new be(r.line,rt,"after")};me>=0&&me<i.length;me+=Oe){var Ke=i[me],Ze=Oe>0==(Ke.level!=1),ct=Ze?_e.begin:l(_e.end,-1);if(Ke.from<=ct&&ct<Ke.to||(ct=Ze?Ke.from:l(Ke.to,-1),_e.begin<=ct&&ct<_e.end))return Re(ct,Ze)}},ce=H(o+n,n,w);if(ce)return ce;var Se=n>0?w.end:l(w.begin,-1);return Se!=null&&!(n>0&&Se==t.text.length)&&(ce=H(n>0?0:i.length-1,n,c(Se)),ce)?ce:null}var Zn={selectAll:Gs,singleSelection:function(e){return e.setSelection(e.getCursor("anchor"),e.getCursor("head"),ar)},killLine:function(e){return Ln(e,function(t){if(t.empty()){var r=lt(e.doc,t.head.line).text.length;return t.head.ch==r&&t.head.line<e.lastLine()?{from:t.head,to:be(t.head.line+1,0)}:{from:t.head,to:be(t.head.line,r)}}else return{from:t.from(),to:t.to()}})},deleteLine:function(e){return Ln(e,function(t){return{from:be(t.from().line,0),to:gt(e.doc,be(t.to().line+1,0))}})},delLineLeft:function(e){return Ln(e,function(t){return{from:be(t.from().line,0),to:t.from()}})},delWrappedLineLeft:function(e){return Ln(e,function(t){var r=e.charCoords(t.head,"div").top+5,n=e.coordsChar({left:0,top:r},"div");return{from:n,to:t.from()}})},delWrappedLineRight:function(e){return Ln(e,function(t){var r=e.charCoords(t.head,"div").top+5,n=e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div");return{from:t.from(),to:n}})},undo:function(e){return e.undo()},redo:function(e){return e.redo()},undoSelection:function(e){return e.undoSelection()},redoSelection:function(e){return e.redoSelection()},goDocStart:function(e){return e.extendSelection(be(e.firstLine(),0))},goDocEnd:function(e){return e.extendSelection(be(e.lastLine()))},goLineStart:function(e){return e.extendSelectionsBy(function(t){return Ua(e,t.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(e){return e.extendSelectionsBy(function(t){return aa(e,t.head)},{origin:"+move",bias:1})},goLineEnd:function(e){return e.extendSelectionsBy(function(t){return Xa(e,t.head.line)},{origin:"+move",bias:-1})},goLineRight:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:r},"div")},ur)},goLineLeft:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:r},"div")},ur)},goLineLeftSmart:function(e){return e.extendSelectionsBy(function(t){var r=e.cursorCoords(t.head,"div").top+5,n=e.coordsChar({left:0,top:r},"div");return n.ch<e.getLine(n.line).search(/\S/)?aa(e,t.head):n},ur)},goLineUp:function(e){return e.moveV(-1,"line")},goLineDown:function(e){return e.moveV(1,"line")},goPageUp:function(e){return e.moveV(-1,"page")},goPageDown:function(e){return e.moveV(1,"page")},goCharLeft:function(e){return e.moveH(-1,"char")},goCharRight:function(e){return e.moveH(1,"char")},goColumnLeft:function(e){return e.moveH(-1,"column")},goColumnRight:function(e){return e.moveH(1,"column")},goWordLeft:function(e){return e.moveH(-1,"word")},goGroupRight:function(e){return e.moveH(1,"group")},goGroupLeft:function(e){return e.moveH(-1,"group")},goWordRight:function(e){return e.moveH(1,"word")},delCharBefore:function(e){return e.deleteH(-1,"codepoint")},delCharAfter:function(e){return e.deleteH(1,"char")},delWordBefore:function(e){return e.deleteH(-1,"word")},delWordAfter:function(e){return e.deleteH(1,"word")},delGroupBefore:function(e){return e.deleteH(-1,"group")},delGroupAfter:function(e){return e.deleteH(1,"group")},indentAuto:function(e){return e.indentSelection("smart")},indentMore:function(e){return e.indentSelection("add")},indentLess:function(e){return e.indentSelection("subtract")},insertTab:function(e){return e.replaceSelection("	")},insertSoftTab:function(e){for(var t=[],r=e.listSelections(),n=e.options.tabSize,i=0;i<r.length;i++){var o=r[i].from(),s=Ct(e.getLine(o.line),o.ch,n);t.push(nn(n-s%n))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){return br(e,function(){for(var t=e.listSelections(),r=[],n=0;n<t.length;n++)if(t[n].empty()){var i=t[n].head,o=lt(e.doc,i.line).text;if(o){if(i.ch==o.length&&(i=new be(i.line,i.ch-1)),i.ch>0)i=new be(i.line,i.ch+1),e.replaceRange(o.charAt(i.ch-1)+o.charAt(i.ch-2),be(i.line,i.ch-2),i,"+transpose");else if(i.line>e.doc.first){var s=lt(e.doc,i.line-1).text;s&&(i=new be(i.line,1),e.replaceRange(o.charAt(0)+e.doc.lineSeparator()+s.charAt(s.length-1),be(i.line-1,s.length-1),i,"+transpose"))}}r.push(new Dt(i,i))}e.setSelections(r)})},newlineAndIndent:function(e){return br(e,function(){for(var t=e.listSelections(),r=t.length-1;r>=0;r--)e.replaceRange(e.doc.lineSeparator(),t[r].anchor,t[r].head,"+input");t=e.listSelections();for(var n=0;n<t.length;n++)e.indentLine(t[n].from().line,null,!0);mn(e)})},openLine:function(e){return e.replaceSelection(`
`,"start")},toggleOverwrite:function(e){return e.toggleOverwrite()}};function Ua(e,t){var r=lt(e.doc,t),n=zr(r);return n!=r&&(t=v(n)),qa(!0,e,n,t,1)}function Xa(e,t){var r=lt(e.doc,t),n=sf(r);return n!=r&&(t=v(n)),qa(!0,e,r,t,-1)}function aa(e,t){var r=Ua(e,t.line),n=lt(e.doc,r.line),i=kt(n,e.doc.direction);if(!i||i[0].level==0){var o=Math.max(r.ch,n.text.search(/\S/)),s=t.line==r.line&&t.ch<=o&&t.ch;return be(r.line,s?0:o,r.sticky)}return r}function Jn(e,t,r){if(typeof t=="string"&&(t=Zn[t],!t))return!1;e.display.input.ensurePolled();var n=e.display.shift,i=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),r&&(e.display.shift=!1),i=t(e)!=$t}finally{e.display.shift=n,e.state.suppressEdits=!1}return i}function ja(e,t,r){for(var n=0;n<e.state.keyMaps.length;n++){var i=Qn(t,e.state.keyMaps[n],r,e);if(i)return i}return e.options.extraKeys&&Qn(t,e.options.extraKeys,r,e)||Qn(t,e.options.keyMap,r,e)}var Ka=new Ht;function oa(e,t,r,n){var i=e.state.keySeq;if(i){if(Ha(t))return"handled";if(/\'$/.test(t)?e.state.keySeq=null:Ka.set(50,function(){e.state.keySeq==i&&(e.state.keySeq=null,e.display.input.reset())}),sa(e,i+" "+t,r,n))return!0}return sa(e,t,r,n)}function sa(e,t,r,n){var i=ja(e,t,n);return i=="multi"&&(e.state.keySeq=t),i=="handled"&&er(e,"keyHandled",e,t,r),(i=="handled"||i=="multi")&&(qt(r),vn(e)),!!i}function ei(e,t){var r=Wa(t,!0);return r?t.shiftKey&&!e.state.keySeq?oa(e,"Shift-"+r,t,function(n){return Jn(e,n,!0)})||oa(e,r,t,function(n){if(typeof n=="string"?/^go[A-Z]/.test(n):n.motion)return Jn(e,n)}):oa(e,r,t,function(n){return Jn(e,n)}):!1}function zl(e,t,r){return oa(e,"'"+r+"'",t,function(n){return Jn(e,n,!0)})}var Ya=null;function Wl(e){var t=this;if(!(e.target&&e.target!=t.display.input.getField())&&(t.curOp.focus=Ve(Ot(t)),!Yt(t,e))){he&&te<11&&e.keyCode==27&&(e.returnValue=!1);var r=e.keyCode;t.display.shift=r==16||e.shiftKey;var n=ei(t,e);ve&&(Ya=n?r:null,!n&&r==88&&!to&&(_?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut")),S&&!_&&!n&&r==46&&e.shiftKey&&!e.ctrlKey&&document.execCommand&&document.execCommand("cut"),r==18&&!/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)&&Nf(t)}}function Nf(e){var t=e.display.lineDiv;$e(t,"CodeMirror-crosshair");function r(n){(n.keyCode==18||!n.altKey)&&(We(t,"CodeMirror-crosshair"),cr(document,"keyup",r),cr(document,"mouseover",r))}ht(document,"keyup",r),ht(document,"mouseover",r)}function ql(e){e.keyCode==16&&(this.doc.sel.shift=!1),Yt(this,e)}function kn(e){var t=this;if(!(e.target&&e.target!=t.display.input.getField())&&!(Wr(t.display,e)||Yt(t,e)||e.ctrlKey&&!e.altKey||_&&e.metaKey)){var r=e.keyCode,n=e.charCode;if(ve&&r==Ya){Ya=null,qt(e);return}if(!(ve&&(!e.which||e.which<10)&&ei(t,e))){var i=String.fromCharCode(n??r);i!="\b"&&(zl(t,e,i)||t.display.input.onKeyPress(e))}}}var Ul=400,Do=function(e,t,r){this.time=e,this.pos=t,this.button=r};Do.prototype.compare=function(e,t,r){return this.time+Ul>e&&Qe(t,this.pos)==0&&r==this.button};var la,$a;function Xl(e,t){var r=+new Date;return $a&&$a.compare(r,e,t)?(la=$a=null,"triple"):la&&la.compare(r,e,t)?($a=new Do(r,e,t),la=null,"double"):(la=new Do(r,e,t),$a=null,"single")}function jl(e){var t=this,r=t.display;if(!(Yt(t,e)||r.activeTouch&&r.input.supportsTouch())){if(r.input.ensurePolled(),r.shift=e.shiftKey,Wr(r,e)){z||(r.scroller.draggable=!1,setTimeout(function(){return r.scroller.draggable=!0},100));return}if(!dr(t,e)){var n=fr(t,e),i=Br(e),o=n?Xl(n,i):"single";ut(t).focus(),i==1&&t.state.selectingText&&t.state.selectingText(e),!(n&&tn(t,i,n,o,e))&&(i==1?n?fa(t,n,o,e):da(e)==r.scroller&&qt(e):i==2?(n&&Vi(t.doc,n),setTimeout(function(){return r.input.focus()},20)):i==3&&(Ne?t.display.input.onContextMenu(e):bo(t)))}}}function tn(e,t,r,n,i){var o="Click";return n=="double"?o="Double"+o:n=="triple"&&(o="Triple"+o),o=(t==1?"Left":t==2?"Middle":"Right")+o,oa(e,za(o,i),i,function(s){if(typeof s=="string"&&(s=Zn[s]),!s)return!1;var l=!1;try{e.isReadOnly()&&(e.state.suppressEdits=!0),l=s(e,r)!=$t}finally{e.state.suppressEdits=!1}return l})}function Kl(e,t,r){var n=e.getOption("configureMouse"),i=n?n(e,t,r):{};if(i.unit==null){var o=G?r.shiftKey&&r.metaKey:r.altKey;i.unit=o?"rectangle":t=="single"?"char":t=="double"?"word":"line"}return(i.extend==null||e.doc.extend)&&(i.extend=e.doc.extend||r.shiftKey),i.addNew==null&&(i.addNew=_?r.metaKey:r.ctrlKey),i.moveOnDrag==null&&(i.moveOnDrag=!(_?r.altKey:r.ctrlKey)),i}function fa(e,t,r,n){he?setTimeout(tt(gs,e),0):e.curOp.focus=Ve(Ot(e));var i=Kl(e,r,n),o=e.doc.sel,s;e.options.dragDrop&&Xo&&!e.isReadOnly()&&r=="single"&&(s=o.contains(t))>-1&&(Qe((s=o.ranges[s]).from(),t)<0||t.xRel>0)&&(Qe(s.to(),t)>0||t.xRel<0)?ti(e,n,t,i):Us(e,n,t,i)}function ti(e,t,r,n){var i=e.display,o=!1,s=or(e,function(c){z&&(i.scroller.draggable=!1),e.state.draggingText=!1,e.state.delayingBlurEvent&&(e.hasFocus()?e.state.delayingBlurEvent=!1:bo(e)),cr(i.wrapper.ownerDocument,"mouseup",s),cr(i.wrapper.ownerDocument,"mousemove",l),cr(i.scroller,"dragstart",f),cr(i.scroller,"drop",s),o||(qt(c),n.addNew||Vi(e.doc,r,null,null,n.extend),z&&!Ge||he&&te==9?setTimeout(function(){i.wrapper.ownerDocument.body.focus({preventScroll:!0}),i.input.focus()},20):i.input.focus())}),l=function(c){o=o||Math.abs(t.clientX-c.clientX)+Math.abs(t.clientY-c.clientY)>=10},f=function(){return o=!0};z&&(i.scroller.draggable=!0),e.state.draggingText=s,s.copy=!n.moveOnDrag,ht(i.wrapper.ownerDocument,"mouseup",s),ht(i.wrapper.ownerDocument,"mousemove",l),ht(i.scroller,"dragstart",f),ht(i.scroller,"drop",s),e.state.delayingBlurEvent=!0,setTimeout(function(){return i.input.focus()},20),i.scroller.dragDrop&&i.scroller.dragDrop()}function qs(e,t,r){if(r=="char")return new Dt(t,t);if(r=="word")return e.findWordAt(t);if(r=="line")return new Dt(be(t.line,0),gt(e.doc,be(t.line+1,0)));var n=r(e,t);return new Dt(n.from,n.to)}function Us(e,t,r,n){he&&bo(e);var i=e.display,o=e.doc;qt(t);var s,l,f=o.sel,c=f.ranges;if(n.addNew&&!n.extend?(l=o.sel.contains(r),l>-1?s=c[l]:s=new Dt(r,r)):(s=o.sel.primary(),l=o.sel.primIndex),n.unit=="rectangle")n.addNew||(s=new Dt(r,r)),r=fr(e,t,!0,!0),l=-1;else{var w=qs(e,r,n.unit);n.extend?s=ko(s,w.anchor,w.head,n.extend):s=w}n.addNew?l==-1?(l=c.length,lr(o,Or(e,c.concat([s]),l),{scroll:!1,origin:"*mouse"})):c.length>1&&c[l].empty()&&n.unit=="char"&&!n.extend?(lr(o,Or(e,c.slice(0,l).concat(c.slice(l+1)),0),{scroll:!1,origin:"*mouse"}),f=o.sel):Oo(o,l,s,Sr):(l=0,lr(o,new Ar([s],0),Sr),f=o.sel);var O=r;function B(_e){if(Qe(O,_e)!=0)if(O=_e,n.unit=="rectangle"){for(var Re=[],Ke=e.options.tabSize,Ze=Ct(lt(o,r.line).text,r.ch,Ke),ct=Ct(lt(o,_e.line).text,_e.ch,Ke),rt=Math.min(Ze,ct),At=Math.max(Ze,ct),yt=Math.min(r.line,_e.line),Ft=Math.min(e.lastLine(),Math.max(r.line,_e.line));yt<=Ft;yt++){var It=lt(o,yt).text,Et=Vt(It,rt,Ke);rt==At?Re.push(new Dt(be(yt,Et),be(yt,Et))):It.length>Et&&Re.push(new Dt(be(yt,Et),be(yt,Vt(It,At,Ke))))}Re.length||Re.push(new Dt(r,r)),lr(o,Or(e,f.ranges.slice(0,l).concat(Re),l),{origin:"*mouse",scroll:!1}),e.scrollIntoView(_e)}else{var Gt=s,Pt=qs(e,_e,n.unit),Tt=Gt.anchor,nt;Qe(Pt.anchor,Tt)>0?(nt=Pt.head,Tt=Fi(Gt.from(),Pt.anchor)):(nt=Pt.anchor,Tt=hr(Gt.to(),Pt.head));var Lt=f.ranges.slice(0);Lt[l]=Go(e,new Dt(gt(o,Tt),nt)),lr(o,Or(e,Lt,l),Sr)}}var R=i.wrapper.getBoundingClientRect(),H=0;function ce(_e){var Re=++H,Ke=fr(e,_e,!0,n.unit=="rectangle");if(Ke)if(Qe(Ke,O)!=0){e.curOp.focus=Ve(Ot(e)),B(Ke);var Ze=qi(i,o);(Ke.line>=Ze.to||Ke.line<Ze.from)&&setTimeout(or(e,function(){H==Re&&ce(_e)}),150)}else{var ct=_e.clientY<R.top?-20:_e.clientY>R.bottom?20:0;ct&&setTimeout(or(e,function(){H==Re&&(i.scroller.scrollTop+=ct,ce(_e))}),50)}}function Se(_e){e.state.selectingText=!1,H=1/0,_e&&(qt(_e),i.input.focus()),cr(i.wrapper.ownerDocument,"mousemove",me),cr(i.wrapper.ownerDocument,"mouseup",Oe),o.history.lastSelOrigin=null}var me=or(e,function(_e){_e.buttons===0||!Br(_e)?Se(_e):ce(_e)}),Oe=or(e,Se);e.state.selectingText=Oe,ht(i.wrapper.ownerDocument,"mousemove",me),ht(i.wrapper.ownerDocument,"mouseup",Oe)}function Go(e,t){var r=t.anchor,n=t.head,i=lt(e.doc,r.line);if(Qe(r,n)==0&&r.sticky==n.sticky)return t;var o=kt(i);if(!o)return t;var s=nr(o,r.ch,r.sticky),l=o[s];if(l.from!=r.ch&&l.to!=r.ch)return t;var f=s+(l.from==r.ch==(l.level!=1)?0:1);if(f==0||f==o.length)return t;var c;if(n.line!=r.line)c=(n.line-r.line)*(e.doc.direction=="ltr"?1:-1)>0;else{var w=nr(o,n.ch,n.sticky),O=w-s||(n.ch-r.ch)*(l.level==1?-1:1);w==f-1||w==f?c=O<0:c=O>0}var B=o[f+(c?-1:0)],R=c==(B.level==1),H=R?B.from:B.to,ce=R?"after":"before";return r.ch==H&&r.sticky==ce?t:new Dt(new be(r.line,H,ce),n)}function Xs(e,t,r,n){var i,o;if(t.touches)i=t.touches[0].clientX,o=t.touches[0].clientY;else try{i=t.clientX,o=t.clientY}catch{return!1}if(i>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;n&&qt(t);var s=e.display,l=s.lineDiv.getBoundingClientRect();if(o>l.bottom||!wr(e,r))return gr(t);o-=l.top-s.viewOffset;for(var f=0;f<e.display.gutterSpecs.length;++f){var c=s.gutters.childNodes[f];if(c&&c.getBoundingClientRect().right>=i){var w=X(e.doc,o),O=e.display.gutterSpecs[f];return Qt(e,r,e,w,O.className,t),gr(t)}}}function dr(e,t){return Xs(e,t,"gutterClick",!0)}function An(e,t){Wr(e.display,t)||tr(e,t)||Yt(e,t,"contextmenu")||Ne||e.display.input.onContextMenu(t)}function tr(e,t){return wr(e,"gutterContextMenu")?Xs(e,t,"gutterContextMenu",!1):!1}function xr(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),_a(e)}var Ci={toString:function(){return"CodeMirror.Init"}},Yl={},Ho={};function Bf(e){var t=e.optionHandlers;function r(n,i,o,s){e.defaults[n]=i,o&&(t[n]=s?function(l,f,c){c!=Ci&&o(l,f,c)}:o)}e.defineOption=r,e.Init=Ci,r("value","",function(n,i){return n.setValue(i)},!0),r("mode",null,function(n,i){n.doc.modeOption=i,Os(n)},!0),r("indentUnit",2,Os,!0),r("indentWithTabs",!1),r("smartIndent",!0),r("tabSize",4,function(n){xn(n),_a(n),pr(n)},!0),r("lineSeparator",null,function(n,i){if(n.doc.lineSep=i,!!i){var o=[],s=n.doc.first;n.doc.iter(function(f){for(var c=0;;){var w=f.text.indexOf(i,c);if(w==-1)break;c=w+i.length,o.push(be(s,w))}s++});for(var l=o.length-1;l>=0;l--)Tn(n.doc,i,o[l],be(o[l].line,o[l].ch+i.length))}}),r("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b\u200e\u200f\u2028\u2029\u202d\u202e\u2066\u2067\u2069\ufeff\ufff9-\ufffc]/g,function(n,i,o){n.state.specialChars=new RegExp(i.source+(i.test("	")?"":"|	"),"g"),o!=Ci&&n.refresh()}),r("specialCharPlaceholder",is,function(n){return n.refresh()},!0),r("electricChars",!0),r("inputStyle",h?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),r("spellcheck",!1,function(n,i){return n.getInputField().spellcheck=i},!0),r("autocorrect",!1,function(n,i){return n.getInputField().autocorrect=i},!0),r("autocapitalize",!1,function(n,i){return n.getInputField().autocapitalize=i},!0),r("rtlMoveVisually",!U),r("wholeLineUpdateBefore",!0),r("theme","default",function(n){xr(n),Ia(n)},!0),r("keyMap","default",function(n,i,o){var s=ra(i),l=o!=Ci&&ra(o);l&&l.detach&&l.detach(n,s),s.attach&&s.attach(n,l||null)}),r("extraKeys",null),r("configureMouse",null),r("lineWrapping",!1,$l,!0),r("gutters",[],function(n,i){n.display.gutterSpecs=Ls(i,n.options.lineNumbers),Ia(n)},!0),r("fixedGutter",!0,function(n,i){n.display.gutters.style.left=i?ci(n.display)+"px":"0",n.refresh()},!0),r("coverGutterNextToScrollbar",!1,function(n){return pi(n)},!0),r("scrollbarStyle","native",function(n){Ts(n),pi(n),n.display.scrollbars.setScrollTop(n.doc.scrollTop),n.display.scrollbars.setScrollLeft(n.doc.scrollLeft)},!0),r("lineNumbers",!1,function(n,i){n.display.gutterSpecs=Ls(n.options.gutters,i),Ia(n)},!0),r("firstLineNumber",1,Ia,!0),r("lineNumberFormatter",function(n){return n},Ia,!0),r("showCursorWhenSelecting",!1,Aa,!0),r("resetSelectionOnContextMenu",!0),r("lineWiseCopyCut",!0),r("pasteLinesPerSelection",!0),r("selectionsMayTouch",!1),r("readOnly",!1,function(n,i){i=="nocursor"&&(Wi(n),n.display.input.blur()),n.display.input.readOnlyChanged(i)}),r("screenReaderLabel",null,function(n,i){i=i===""?null:i,n.display.input.screenReaderLabelChanged(i)}),r("disableInput",!1,function(n,i){i||n.display.input.reset()},!0),r("dragDrop",!0,Df),r("allowDropFileTypes",null),r("cursorBlinkRate",530),r("cursorScrollMargin",0),r("cursorHeight",1,Aa,!0),r("singleCursorHeightPerLine",!0,Aa,!0),r("workTime",100),r("workDelay",100),r("flattenSpans",!0,xn,!0),r("addModeClass",!1,xn,!0),r("pollInterval",100),r("undoDepth",200,function(n,i){return n.doc.history.undoDepth=i}),r("historyEventDelay",1250),r("viewportMargin",10,function(n){return n.refresh()},!0),r("maxHighlightLength",1e4,xn,!0),r("moveInputWithCursor",!0,function(n,i){i||n.display.input.resetPosition()}),r("tabindex",null,function(n,i){return n.display.input.getField().tabIndex=i||""}),r("autofocus",null),r("direction","ltr",function(n,i){return n.doc.setDirection(i)},!0),r("phrases",null)}function Df(e,t,r){var n=r&&r!=Ci;if(!t!=!n){var i=e.display.dragFunctions,o=t?ht:cr;o(e.display.scroller,"dragstart",i.start),o(e.display.scroller,"dragenter",i.enter),o(e.display.scroller,"dragover",i.over),o(e.display.scroller,"dragleave",i.leave),o(e.display.scroller,"drop",i.drop)}}function $l(e){e.options.lineWrapping?($e(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth="",e.display.sizerWidth=null):(We(e.display.wrapper,"CodeMirror-wrap"),rs(e)),zi(e),pr(e),_a(e),setTimeout(function(){return pi(e)},100)}function Kt(e,t){var r=this;if(!(this instanceof Kt))return new Kt(e,t);this.options=t=t?pt(t):{},pt(Yl,t,!1);var n=t.value;typeof n=="string"?n=new mr(n,t.mode,null,t.lineSeparator,t.direction):t.mode&&(n.modeOption=t.mode),this.doc=n;var i=new Kt.inputStyles[t.inputStyle](this),o=this.display=new Cf(e,n,i,t);o.wrapper.CodeMirror=this,xr(this),t.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),Ts(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new Ht,keySeq:null,specialChars:null},t.autofocus&&!h&&o.input.focus(),he&&te<11&&setTimeout(function(){return r.display.input.reset(!0)},20),Gf(this),Rf(),yr(this),this.curOp.forceUpdate=!0,mi(this,n),t.autofocus&&!h||this.hasFocus()?setTimeout(function(){r.hasFocus()&&!r.state.focused&&ys(r)},20):Wi(this);for(var s in Ho)Ho.hasOwnProperty(s)&&Ho[s](this,t[s],Ci);kl(this),t.finishInit&&t.finishInit(this);for(var l=0;l<js.length;++l)js[l](this);gn(this),z&&t.lineWrapping&&getComputedStyle(o.lineDiv).textRendering=="optimizelegibility"&&(o.lineDiv.style.textRendering="auto")}Kt.defaults=Yl,Kt.optionHandlers=Ho;function Gf(e){var t=e.display;ht(t.scroller,"mousedown",or(e,jl)),he&&te<11?ht(t.scroller,"dblclick",or(e,function(f){if(!Yt(e,f)){var c=fr(e,f);if(!(!c||dr(e,f)||Wr(e.display,f))){qt(f);var w=e.findWordAt(c);Vi(e.doc,w.anchor,w.head)}}})):ht(t.scroller,"dblclick",function(f){return Yt(e,f)||qt(f)}),ht(t.scroller,"contextmenu",function(f){return An(e,f)}),ht(t.input.getField(),"contextmenu",function(f){t.scroller.contains(f.target)||An(e,f)});var r,n={end:0};function i(){t.activeTouch&&(r=setTimeout(function(){return t.activeTouch=null},1e3),n=t.activeTouch,n.end=+new Date)}function o(f){if(f.touches.length!=1)return!1;var c=f.touches[0];return c.radiusX<=1&&c.radiusY<=1}function s(f,c){if(c.left==null)return!0;var w=c.left-f.left,O=c.top-f.top;return w*w+O*O>20*20}ht(t.scroller,"touchstart",function(f){if(!Yt(e,f)&&!o(f)&&!dr(e,f)){t.input.ensurePolled(),clearTimeout(r);var c=+new Date;t.activeTouch={start:c,moved:!1,prev:c-n.end<=300?n:null},f.touches.length==1&&(t.activeTouch.left=f.touches[0].pageX,t.activeTouch.top=f.touches[0].pageY)}}),ht(t.scroller,"touchmove",function(){t.activeTouch&&(t.activeTouch.moved=!0)}),ht(t.scroller,"touchend",function(f){var c=t.activeTouch;if(c&&!Wr(t,f)&&c.left!=null&&!c.moved&&new Date-c.start<300){var w=e.coordsChar(t.activeTouch,"page"),O;!c.prev||s(c,c.prev)?O=new Dt(w,w):!c.prev.prev||s(c,c.prev.prev)?O=e.findWordAt(w):O=new Dt(be(w.line,0),gt(e.doc,be(w.line+1,0))),e.setSelection(O.anchor,O.head),e.focus(),qt(f)}i()}),ht(t.scroller,"touchcancel",i),ht(t.scroller,"scroll",function(){t.scroller.clientHeight&&(Ui(e,t.scroller.scrollTop),qn(e,t.scroller.scrollLeft,!0),Qt(e,"scroll",e))}),ht(t.scroller,"mousewheel",function(f){return Ol(e,f)}),ht(t.scroller,"DOMMouseScroll",function(f){return Ol(e,f)}),ht(t.wrapper,"scroll",function(){return t.wrapper.scrollTop=t.wrapper.scrollLeft=0}),t.dragFunctions={enter:function(f){Yt(e,f)||In(f)},over:function(f){Yt(e,f)||(Of(e,f),In(f))},start:function(f){return ta(e,f)},drop:or(e,Af),leave:function(f){Yt(e,f)||Gl(e)}};var l=t.input.getField();ht(l,"keyup",function(f){return ql.call(e,f)}),ht(l,"keydown",or(e,Wl)),ht(l,"keypress",or(e,kn)),ht(l,"focus",function(f){return ys(e,f)}),ht(l,"blur",function(f){return Wi(e,f)})}var js=[];Kt.defineInitHook=function(e){return js.push(e)};function Va(e,t,r,n){var i=e.doc,o;r==null&&(r="add"),r=="smart"&&(i.mode.indent?o=va(e,t).state:r="prev");var s=e.options.tabSize,l=lt(i,t),f=Ct(l.text,null,s);l.stateAfter&&(l.stateAfter=null);var c=l.text.match(/^\s*/)[0],w;if(!n&&!/\S/.test(l.text))w=0,r="not";else if(r=="smart"&&(w=i.mode.indent(o,l.text.slice(c.length),l.text),w==$t||w>150)){if(!n)return;r="prev"}r=="prev"?t>i.first?w=Ct(lt(i,t-1).text,null,s):w=0:r=="add"?w=f+e.options.indentUnit:r=="subtract"?w=f-e.options.indentUnit:typeof r=="number"&&(w=f+r),w=Math.max(0,w);var O="",B=0;if(e.options.indentWithTabs)for(var R=Math.floor(w/s);R;--R)B+=s,O+="	";if(B<w&&(O+=nn(w-B)),O!=c)return Tn(i,O,be(t,0),be(t,c.length),"+input"),l.stateAfter=null,!0;for(var H=0;H<i.sel.ranges.length;H++){var ce=i.sel.ranges[H];if(ce.head.line==t&&ce.head.ch<c.length){var Se=be(t,c.length);Oo(i,H,new Dt(Se,Se));break}}}var jr=null;function Qa(e){jr=e}function zo(e,t,r,n,i){var o=e.doc;e.display.shift=!1,n||(n=o.sel);var s=+new Date-200,l=i=="paste"||e.state.pasteIncoming>s,f=Bt(t),c=null;if(l&&n.ranges.length>1)if(jr&&jr.text.join(`
`)==t){if(n.ranges.length%jr.text.length==0){c=[];for(var w=0;w<jr.text.length;w++)c.push(o.splitLines(jr.text[w]))}}else f.length==n.ranges.length&&e.options.pasteLinesPerSelection&&(c=ri(f,function(me){return[me]}));for(var O=e.curOp.updateInput,B=n.ranges.length-1;B>=0;B--){var R=n.ranges[B],H=R.from(),ce=R.to();R.empty()&&(r&&r>0?H=be(H.line,H.ch-r):e.state.overwrite&&!l?ce=be(ce.line,Math.min(lt(o,ce.line).text.length,ce.ch+_t(f).length)):l&&jr&&jr.lineWise&&jr.text.join(`
`)==f.join(`
`)&&(H=ce=be(H.line,0)));var Se={from:H,to:ce,text:c?c[B%c.length]:f,origin:i||(l?"paste":e.state.cutIncoming>s?"cut":"+input")};Si(e.doc,Se),er(e,"inputRead",e,Se)}t&&!l&&Vl(e,t),mn(e),e.curOp.updateInput<2&&(e.curOp.updateInput=O),e.curOp.typing=!0,e.state.pasteIncoming=e.state.cutIncoming=-1}function Ks(e,t){var r=e.clipboardData&&e.clipboardData.getData("Text");if(r)return e.preventDefault(),!t.isReadOnly()&&!t.options.disableInput&&t.hasFocus()&&br(t,function(){return zo(t,r,0,null,"paste")}),!0}function Vl(e,t){if(!(!e.options.electricChars||!e.options.smartIndent))for(var r=e.doc.sel,n=r.ranges.length-1;n>=0;n--){var i=r.ranges[n];if(!(i.head.ch>100||n&&r.ranges[n-1].head.line==i.head.line)){var o=e.getModeAt(i.head),s=!1;if(o.electricChars){for(var l=0;l<o.electricChars.length;l++)if(t.indexOf(o.electricChars.charAt(l))>-1){s=Va(e,i.head.line,"smart");break}}else o.electricInput&&o.electricInput.test(lt(e.doc,i.head.line).text.slice(0,i.head.ch))&&(s=Va(e,i.head.line,"smart"));s&&er(e,"electricInput",e,i.head.line)}}}function Ql(e){for(var t=[],r=[],n=0;n<e.doc.sel.ranges.length;n++){var i=e.doc.sel.ranges[n].head.line,o={anchor:be(i,0),head:be(i+1,0)};r.push(o),t.push(e.getRange(o.anchor,o.head))}return{text:t,ranges:r}}function Wo(e,t,r,n){e.setAttribute("autocorrect",r?"on":"off"),e.setAttribute("autocapitalize",n?"on":"off"),e.setAttribute("spellcheck",!!t)}function Zl(){var e=p("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; min-height: 1em; outline: none"),t=p("div",[e],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return z?e.style.width="1000px":e.setAttribute("wrap","off"),A&&(e.style.border="1px solid black"),t}function u(e){var t=e.optionHandlers,r=e.helpers={};e.prototype={constructor:e,focus:function(){ut(this).focus(),this.display.input.focus()},setOption:function(n,i){var o=this.options,s=o[n];o[n]==i&&n!="mode"||(o[n]=i,t.hasOwnProperty(n)&&or(this,t[n])(this,i,s),Qt(this,"optionChange",this,n))},getOption:function(n){return this.options[n]},getDoc:function(){return this.doc},addKeyMap:function(n,i){this.state.keyMaps[i?"push":"unshift"](ra(n))},removeKeyMap:function(n){for(var i=this.state.keyMaps,o=0;o<i.length;++o)if(i[o]==n||i[o].name==n)return i.splice(o,1),!0},addOverlay:vr(function(n,i){var o=n.token?n:e.getMode(this.options,n);if(o.startState)throw new Error("Overlays may not be stateful.");qo(this.state.overlays,{mode:o,modeSpec:n,opaque:i&&i.opaque,priority:i&&i.priority||0},function(s){return s.priority}),this.state.modeGen++,pr(this)}),removeOverlay:vr(function(n){for(var i=this.state.overlays,o=0;o<i.length;++o){var s=i[o].modeSpec;if(s==n||typeof n=="string"&&s.name==n){i.splice(o,1),this.state.modeGen++,pr(this);return}}}),indentLine:vr(function(n,i,o){typeof i!="string"&&typeof i!="number"&&(i==null?i=this.options.smartIndent?"smart":"prev":i=i?"add":"subtract"),Ae(this.doc,n)&&Va(this,n,i,o)}),indentSelection:vr(function(n){for(var i=this.doc.sel.ranges,o=-1,s=0;s<i.length;s++){var l=i[s];if(l.empty())l.head.line>o&&(Va(this,l.head.line,n,!0),o=l.head.line,s==this.doc.sel.primIndex&&mn(this));else{var f=l.from(),c=l.to(),w=Math.max(o,f.line);o=Math.min(this.lastLine(),c.line-(c.ch?0:1))+1;for(var O=w;O<o;++O)Va(this,O,n);var B=this.doc.sel.ranges;f.ch==0&&i.length==B.length&&B[s].from().ch>0&&Oo(this.doc,s,new Dt(f,B[s].to()),ar)}}}),getTokenAt:function(n,i){return Zs(this,n,i)},getLineTokens:function(n,i){return Zs(this,be(n),i,!0)},getTokenTypeAt:function(n){n=gt(this.doc,n);var i=Vs(this,lt(this.doc,n.line)),o=0,s=(i.length-1)/2,l=n.ch,f;if(l==0)f=i[2];else for(;;){var c=o+s>>1;if((c?i[c*2-1]:0)>=l)s=c;else if(i[c*2+1]<l)o=c+1;else{f=i[c*2+2];break}}var w=f?f.indexOf("overlay "):-1;return w<0?f:w==0?null:f.slice(0,w-1)},getModeAt:function(n){var i=this.doc.mode;return i.innerMode?e.innerMode(i,this.getTokenAt(n).state).mode:i},getHelper:function(n,i){return this.getHelpers(n,i)[0]},getHelpers:function(n,i){var o=[];if(!r.hasOwnProperty(i))return o;var s=r[i],l=this.getModeAt(n);if(typeof l[i]=="string")s[l[i]]&&o.push(s[l[i]]);else if(l[i])for(var f=0;f<l[i].length;f++){var c=s[l[i][f]];c&&o.push(c)}else l.helperType&&s[l.helperType]?o.push(s[l.helperType]):s[l.name]&&o.push(s[l.name]);for(var w=0;w<s._global.length;w++){var O=s._global[w];O.pred(l,this)&&ft(o,O.val)==-1&&o.push(O.val)}return o},getStateAfter:function(n,i){var o=this.doc;return n=Ys(o,n??o.first+o.size-1),va(this,n+1,i).state},cursorCoords:function(n,i){var o,s=this.doc.sel.primary();return n==null?o=s.head:typeof n=="object"?o=gt(this.doc,n):o=n?s.from():s.to(),kr(this,o,i||"page")},charCoords:function(n,i){return mo(this,gt(this.doc,n),i||"page")},coordsChar:function(n,i){return n=vo(this,n,i||"page"),Ea(this,n.left,n.top)},lineAtHeight:function(n,i){return n=vo(this,{top:n,left:0},i||"page").top,X(this.doc,n+this.display.viewOffset)},heightAtLine:function(n,i,o){var s=!1,l;if(typeof n=="number"){var f=this.doc.first+this.doc.size-1;n<this.doc.first?n=this.doc.first:n>f&&(n=f,s=!0),l=lt(this.doc,n)}else l=n;return po(this,l,{top:0,left:0},i||"page",o||s).top+(s?this.doc.height-Cr(l):0)},defaultTextHeight:function(){return Gi(this.display)},defaultCharWidth:function(){return Hi(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(n,i,o,s,l){var f=this.display;n=kr(this,gt(this.doc,n));var c=n.bottom,w=n.left;if(i.style.position="absolute",i.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(i),f.sizer.appendChild(i),s=="over")c=n.top;else if(s=="above"||s=="near"){var O=Math.max(f.wrapper.clientHeight,this.doc.height),B=Math.max(f.sizer.clientWidth,f.lineSpace.clientWidth);(s=="above"||n.bottom+i.offsetHeight>O)&&n.top>i.offsetHeight?c=n.top-i.offsetHeight:n.bottom+i.offsetHeight<=O&&(c=n.bottom),w+i.offsetWidth>B&&(w=B-i.offsetWidth)}i.style.top=c+"px",i.style.left=i.style.right="",l=="right"?(w=f.sizer.clientWidth-i.offsetWidth,i.style.right="0px"):(l=="left"?w=0:l=="middle"&&(w=(f.sizer.clientWidth-i.offsetWidth)/2),i.style.left=w+"px"),o&&bl(this,{left:w,top:c,right:w+i.offsetWidth,bottom:c+i.offsetHeight})},triggerOnKeyDown:vr(Wl),triggerOnKeyPress:vr(kn),triggerOnKeyUp:ql,triggerOnMouseDown:vr(jl),execCommand:function(n){if(Zn.hasOwnProperty(n))return Zn[n].call(null,this)},triggerElectric:vr(function(n){Vl(this,n)}),findPosH:function(n,i,o,s){var l=1;i<0&&(l=-1,i=-i);for(var f=gt(this.doc,n),c=0;c<i&&(f=L(this.doc,f,l,o,s),!f.hitSide);++c);return f},moveH:vr(function(n,i){var o=this;this.extendSelectionsBy(function(s){return o.display.shift||o.doc.extend||s.empty()?L(o.doc,s.head,n,i,o.options.rtlMoveVisually):n<0?s.from():s.to()},ur)}),deleteH:vr(function(n,i){var o=this.doc.sel,s=this.doc;o.somethingSelected()?s.replaceSelection("",null,"+delete"):Ln(this,function(l){var f=L(s,l.head,n,i,!1);return n<0?{from:f,to:l.head}:{from:l.head,to:f}})}),findPosV:function(n,i,o,s){var l=1,f=s;i<0&&(l=-1,i=-i);for(var c=gt(this.doc,n),w=0;w<i;++w){var O=kr(this,c,"div");if(f==null?f=O.left:O.left=f,c=W(this,O,l,o),c.hitSide)break}return c},moveV:vr(function(n,i){var o=this,s=this.doc,l=[],f=!this.display.shift&&!s.extend&&s.sel.somethingSelected();if(s.extendSelectionsBy(function(w){if(f)return n<0?w.from():w.to();var O=kr(o,w.head,"div");w.goalColumn!=null&&(O.left=w.goalColumn),l.push(O.left);var B=W(o,O,n,i);return i=="page"&&w==s.sel.primary()&&bs(o,mo(o,B,"div").top-O.top),B},ur),l.length)for(var c=0;c<s.sel.ranges.length;c++)s.sel.ranges[c].goalColumn=l[c]}),findWordAt:function(n){var i=this.doc,o=lt(i,n.line).text,s=n.ch,l=n.ch;if(o){var f=this.getHelper(n,"wordChars");(n.sticky=="before"||l==o.length)&&s?--s:++l;for(var c=o.charAt(s),w=an(c,f)?function(O){return an(O,f)}:/\s/.test(c)?function(O){return/\s/.test(O)}:function(O){return!/\s/.test(O)&&!an(O)};s>0&&w(o.charAt(s-1));)--s;for(;l<o.length&&w(o.charAt(l));)++l}return new Dt(be(n.line,s),be(n.line,l))},toggleOverwrite:function(n){n!=null&&n==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?$e(this.display.cursorDiv,"CodeMirror-overwrite"):We(this.display.cursorDiv,"CodeMirror-overwrite"),Qt(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return this.display.input.getField()==Ve(Ot(this))},isReadOnly:function(){return!!(this.options.readOnly||this.doc.cantEdit)},scrollTo:vr(function(n,i){Ra(this,n,i)}),getScrollInfo:function(){var n=this.display.scroller;return{left:n.scrollLeft,top:n.scrollTop,height:n.scrollHeight-Mr(this)-this.display.barHeight,width:n.scrollWidth-Mr(this)-this.display.barWidth,clientHeight:Ta(this),clientWidth:dn(this)}},scrollIntoView:vr(function(n,i){n==null?(n={from:this.doc.sel.primary().head,to:null},i==null&&(i=this.options.cursorScrollMargin)):typeof n=="number"?n={from:be(n,0),to:null}:n.from==null&&(n={from:n,to:null}),n.to||(n.to=n.from),n.margin=i||0,n.from.line!=null?Wn(this,n):xs(this,n.from,n.to,n.margin)}),setSize:vr(function(n,i){var o=this,s=function(f){return typeof f=="number"||/^\d+$/.test(String(f))?f+"px":f};n!=null&&(this.display.wrapper.style.width=s(n)),i!=null&&(this.display.wrapper.style.height=s(i)),this.options.lineWrapping&&cl(this);var l=this.display.viewFrom;this.doc.iter(l,this.display.viewTo,function(f){if(f.widgets){for(var c=0;c<f.widgets.length;c++)if(f.widgets[c].noHScroll){hn(o,l,"widget");break}}++l}),this.curOp.forceUpdate=!0,Qt(this,"refresh",this)}),operation:function(n){return br(this,n)},startOperation:function(){return yr(this)},endOperation:function(){return gn(this)},refresh:vr(function(){var n=this.display.cachedTextHeight;pr(this),this.curOp.forceUpdate=!0,_a(this),Ra(this,this.doc.scrollLeft,this.doc.scrollTop),_s(this.display),(n==null||Math.abs(n-Gi(this.display))>.5||this.options.lineWrapping)&&zi(this),Qt(this,"refresh",this)}),swapDoc:vr(function(n){var i=this.doc;return i.cm=null,this.state.selectingText&&this.state.selectingText(),mi(this,n),_a(this),this.display.input.reset(),Ra(this,n.scrollLeft,n.scrollTop),this.curOp.forceScroll=!0,er(this,"swapDoc",this,i),i}),phrase:function(n){var i=this.options.phrases;return i&&Object.prototype.hasOwnProperty.call(i,n)?i[n]:n},getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Nr(e),e.registerHelper=function(n,i,o){r.hasOwnProperty(n)||(r[n]=e[n]={_global:[]}),r[n][i]=o},e.registerGlobalHelper=function(n,i,o,s){e.registerHelper(n,i,s),r[n]._global.push({pred:o,val:s})}}function L(e,t,r,n,i){var o=t,s=r,l=lt(e,t.line),f=i&&e.direction=="rtl"?-r:r;function c(){var Oe=t.line+f;return Oe<e.first||Oe>=e.first+e.size?!1:(t=new be(Oe,t.ch,t.sticky),l=lt(e,Oe))}function w(Oe){var _e;if(n=="codepoint"){var Re=l.text.charCodeAt(t.ch+(r>0?0:-1));if(isNaN(Re))_e=null;else{var Ke=r>0?Re>=55296&&Re<56320:Re>=56320&&Re<57343;_e=new be(t.line,Math.max(0,Math.min(l.text.length,t.ch+r*(Ke?2:1))),-r)}}else i?_e=Bo(e.cm,l,t,r):_e=ia(l,t,r);if(_e==null)if(!Oe&&c())t=qa(i,e.cm,l,t.line,f);else return!1;else t=_e;return!0}if(n=="char"||n=="codepoint")w();else if(n=="column")w(!0);else if(n=="word"||n=="group")for(var O=null,B=n=="group",R=e.cm&&e.cm.getHelper(t,"wordChars"),H=!0;!(r<0&&!w(!H));H=!1){var ce=l.text.charAt(t.ch)||`
`,Se=an(ce,R)?"w":B&&ce==`
`?"n":!B||/\s/.test(ce)?null:"p";if(B&&!H&&!Se&&(Se="s"),O&&O!=Se){r<0&&(r=1,w(),t.sticky="after");break}if(Se&&(O=Se),r>0&&!w(!H))break}var me=Qi(e,t,o,s,!0);return zt(o,me)&&(me.hitSide=!0),me}function W(e,t,r,n){var i=e.doc,o=t.left,s;if(n=="page"){var l=Math.min(e.display.wrapper.clientHeight,ut(e).innerHeight||i(e).documentElement.clientHeight),f=Math.max(l-.5*Gi(e.display),3);s=(r>0?t.bottom:t.top)+r*f}else n=="line"&&(s=r>0?t.bottom+3:t.top-3);for(var c;c=Ea(e,o,s),!!c.outside;){if(r<0?s<=0:s>=i.height){c.hitSide=!0;break}s+=r*5}return c}var re=function(e){this.cm=e,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Ht,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};re.prototype.init=function(e){var t=this,r=this,n=r.cm,i=r.div=e.lineDiv;i.contentEditable=!0,Wo(i,n.options.spellcheck,n.options.autocorrect,n.options.autocapitalize);function o(l){for(var f=l.target;f;f=f.parentNode){if(f==i)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(f.className))break}return!1}ht(i,"paste",function(l){!o(l)||Yt(n,l)||Ks(l,n)||te<=11&&setTimeout(or(n,function(){return t.updateFromDOM()}),20)}),ht(i,"compositionstart",function(l){t.composing={data:l.data,done:!1}}),ht(i,"compositionupdate",function(l){t.composing||(t.composing={data:l.data,done:!1})}),ht(i,"compositionend",function(l){t.composing&&(l.data!=t.composing.data&&t.readFromDOMSoon(),t.composing.done=!0)}),ht(i,"touchstart",function(){return r.forceCompositionEnd()}),ht(i,"input",function(){t.composing||t.readFromDOMSoon()});function s(l){if(!(!o(l)||Yt(n,l))){if(n.somethingSelected())Qa({lineWise:!1,text:n.getSelections()}),l.type=="cut"&&n.replaceSelection("",null,"cut");else if(n.options.lineWiseCopyCut){var f=Ql(n);Qa({lineWise:!0,text:f.text}),l.type=="cut"&&n.operation(function(){n.setSelections(f.ranges,0,ar),n.replaceSelection("",null,"cut")})}else return;if(l.clipboardData){l.clipboardData.clearData();var c=jr.text.join(`
`);if(l.clipboardData.setData("Text",c),l.clipboardData.getData("Text")==c){l.preventDefault();return}}var w=Zl(),O=w.firstChild;Wo(O),n.display.lineSpace.insertBefore(w,n.display.lineSpace.firstChild),O.value=jr.text.join(`
`);var B=Ve(st(i));Je(O),setTimeout(function(){n.display.lineSpace.removeChild(w),B.focus(),B==i&&r.showPrimarySelection()},50)}}ht(i,"copy",s),ht(i,"cut",s)},re.prototype.screenReaderLabelChanged=function(e){e?this.div.setAttribute("aria-label",e):this.div.removeAttribute("aria-label")},re.prototype.prepareSelection=function(){var e=di(this.cm,!1);return e.focus=Ve(st(this.div))==this.div,e},re.prototype.showSelection=function(e,t){!e||!this.cm.display.view.length||((e.focus||t)&&this.showPrimarySelection(),this.showMultipleSelections(e))},re.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},re.prototype.showPrimarySelection=function(){var e=this.getSelection(),t=this.cm,r=t.doc.sel.primary(),n=r.from(),i=r.to();if(t.display.viewTo==t.display.viewFrom||n.line>=t.display.viewTo||i.line<t.display.viewFrom){e.removeAllRanges();return}var o=Fe(t,e.anchorNode,e.anchorOffset),s=Fe(t,e.focusNode,e.focusOffset);if(!(o&&!o.bad&&s&&!s.bad&&Qe(Fi(o,s),n)==0&&Qe(hr(o,s),i)==0)){var l=t.display.view,f=n.line>=t.display.viewFrom&&Ce(t,n)||{node:l[0].measure.map[2],offset:0},c=i.line<t.display.viewTo&&Ce(t,i);if(!c){var w=l[l.length-1].measure,O=w.maps?w.maps[w.maps.length-1]:w.map;c={node:O[O.length-1],offset:O[O.length-2]-O[O.length-3]}}if(!f||!c){e.removeAllRanges();return}var B=e.rangeCount&&e.getRangeAt(0),R;try{R=ye(f.node,f.offset,c.offset,c.node)}catch{}R&&(!S&&t.state.focused?(e.collapse(f.node,f.offset),R.collapsed||(e.removeAllRanges(),e.addRange(R))):(e.removeAllRanges(),e.addRange(R)),B&&e.anchorNode==null?e.addRange(B):S&&this.startGracePeriod()),this.rememberSelection()}},re.prototype.startGracePeriod=function(){var e=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){e.gracePeriod=!1,e.selectionChanged()&&e.cm.operation(function(){return e.cm.curOp.selectionChanged=!0})},20)},re.prototype.showMultipleSelections=function(e){E(this.cm.display.cursorDiv,e.cursors),E(this.cm.display.selectionDiv,e.selection)},re.prototype.rememberSelection=function(){var e=this.getSelection();this.lastAnchorNode=e.anchorNode,this.lastAnchorOffset=e.anchorOffset,this.lastFocusNode=e.focusNode,this.lastFocusOffset=e.focusOffset},re.prototype.selectionInEditor=function(){var e=this.getSelection();if(!e.rangeCount)return!1;var t=e.getRangeAt(0).commonAncestorContainer;return Pe(this.div,t)},re.prototype.focus=function(){this.cm.options.readOnly!="nocursor"&&((!this.selectionInEditor()||Ve(st(this.div))!=this.div)&&this.showSelection(this.prepareSelection(),!0),this.div.focus())},re.prototype.blur=function(){this.div.blur()},re.prototype.getField=function(){return this.div},re.prototype.supportsTouch=function(){return!0},re.prototype.receivedFocus=function(){var e=this,t=this;this.selectionInEditor()?setTimeout(function(){return e.pollSelection()},20):br(this.cm,function(){return t.cm.curOp.selectionChanged=!0});function r(){t.cm.state.focused&&(t.pollSelection(),t.polling.set(t.cm.options.pollInterval,r))}this.polling.set(this.cm.options.pollInterval,r)},re.prototype.selectionChanged=function(){var e=this.getSelection();return e.anchorNode!=this.lastAnchorNode||e.anchorOffset!=this.lastAnchorOffset||e.focusNode!=this.lastFocusNode||e.focusOffset!=this.lastFocusOffset},re.prototype.pollSelection=function(){if(!(this.readDOMTimeout!=null||this.gracePeriod||!this.selectionChanged())){var e=this.getSelection(),t=this.cm;if(j&&D&&this.cm.display.gutterSpecs.length&&pe(e.anchorNode)){this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),this.focus();return}if(!this.composing){this.rememberSelection();var r=Fe(t,e.anchorNode,e.anchorOffset),n=Fe(t,e.focusNode,e.focusOffset);r&&n&&br(t,function(){lr(t.doc,Xn(r,n),ar),(r.bad||n.bad)&&(t.curOp.selectionChanged=!0)})}}},re.prototype.pollContent=function(){this.readDOMTimeout!=null&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var e=this.cm,t=e.display,r=e.doc.sel.primary(),n=r.from(),i=r.to();if(n.ch==0&&n.line>e.firstLine()&&(n=be(n.line-1,lt(e.doc,n.line-1).length)),i.ch==lt(e.doc,i.line).text.length&&i.line<e.lastLine()&&(i=be(i.line+1,0)),n.line<t.viewFrom||i.line>t.viewTo-1)return!1;var o,s,l;n.line==t.viewFrom||(o=Fr(e,n.line))==0?(s=v(t.view[0].line),l=t.view[0].node):(s=v(t.view[o].line),l=t.view[o-1].node.nextSibling);var f=Fr(e,i.line),c,w;if(f==t.view.length-1?(c=t.viewTo-1,w=t.lineDiv.lastChild):(c=v(t.view[f+1].line)-1,w=t.view[f+1].node.previousSibling),!l)return!1;for(var O=e.doc.splitLines(Me(e,l,w,s,c)),B=fn(e.doc,be(s,0),be(c,lt(e.doc,c).text.length));O.length>1&&B.length>1;)if(_t(O)==_t(B))O.pop(),B.pop(),c--;else if(O[0]==B[0])O.shift(),B.shift(),s++;else break;for(var R=0,H=0,ce=O[0],Se=B[0],me=Math.min(ce.length,Se.length);R<me&&ce.charCodeAt(R)==Se.charCodeAt(R);)++R;for(var Oe=_t(O),_e=_t(B),Re=Math.min(Oe.length-(O.length==1?R:0),_e.length-(B.length==1?R:0));H<Re&&Oe.charCodeAt(Oe.length-H-1)==_e.charCodeAt(_e.length-H-1);)++H;if(O.length==1&&B.length==1&&s==n.line)for(;R&&R>n.ch&&Oe.charCodeAt(Oe.length-H-1)==_e.charCodeAt(_e.length-H-1);)R--,H++;O[O.length-1]=Oe.slice(0,Oe.length-H).replace(/^\u200b+/,""),O[0]=O[0].slice(R).replace(/\u200b+$/,"");var Ke=be(s,R),Ze=be(c,B.length?_t(B).length-H:0);if(O.length>1||O[0]||Qe(Ke,Ze))return Tn(e.doc,O,Ke,Ze,"+input"),!0},re.prototype.ensurePolled=function(){this.forceCompositionEnd()},re.prototype.reset=function(){this.forceCompositionEnd()},re.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},re.prototype.readFromDOMSoon=function(){var e=this;this.readDOMTimeout==null&&(this.readDOMTimeout=setTimeout(function(){if(e.readDOMTimeout=null,e.composing)if(e.composing.done)e.composing=null;else return;e.updateFromDOM()},80))},re.prototype.updateFromDOM=function(){var e=this;(this.cm.isReadOnly()||!this.pollContent())&&br(this.cm,function(){return pr(e.cm)})},re.prototype.setUneditable=function(e){e.contentEditable="false"},re.prototype.onKeyPress=function(e){e.charCode==0||this.composing||(e.preventDefault(),this.cm.isReadOnly()||or(this.cm,zo)(this.cm,String.fromCharCode(e.charCode==null?e.keyCode:e.charCode),0))},re.prototype.readOnlyChanged=function(e){this.div.contentEditable=String(e!="nocursor")},re.prototype.onContextMenu=function(){},re.prototype.resetPosition=function(){},re.prototype.needsContentAttribute=!0;function Ce(e,t){var r=co(e,t.line);if(!r||r.hidden)return null;var n=lt(e.doc,t.line),i=ls(r,n,t.line),o=kt(n,e.doc.direction),s="left";if(o){var l=nr(o,t.ch);s=l%2?"right":"left"}var f=fi(i.map,t.ch,s);return f.offset=f.collapse=="right"?f.end:f.start,f}function pe(e){for(var t=e;t;t=t.parentNode)if(/CodeMirror-gutter-wrapper/.test(t.className))return!0;return!1}function ge(e,t){return t&&(e.bad=!0),e}function Me(e,t,r,n,i){var o="",s=!1,l=e.doc.lineSeparator(),f=!1;function c(R){return function(H){return H.id==R}}function w(){s&&(o+=l,f&&(o+=l),s=f=!1)}function O(R){R&&(w(),o+=R)}function B(R){if(R.nodeType==1){var H=R.getAttribute("cm-text");if(H){O(H);return}var ce=R.getAttribute("cm-marker"),Se;if(ce){var me=e.findMarks(be(n,0),be(i+1,0),c(+ce));me.length&&(Se=me[0].find(0))&&O(fn(e.doc,Se.from,Se.to).join(l));return}if(R.getAttribute("contenteditable")=="false")return;var Oe=/^(pre|div|p|li|table|br)$/i.test(R.nodeName);if(!/^br$/i.test(R.nodeName)&&R.textContent.length==0)return;Oe&&w();for(var _e=0;_e<R.childNodes.length;_e++)B(R.childNodes[_e]);/^(pre|p)$/i.test(R.nodeName)&&(f=!0),Oe&&(s=!0)}else R.nodeType==3&&O(R.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(;B(t),t!=r;)t=t.nextSibling,f=!1;return o}function Fe(e,t,r){var n;if(t==e.display.lineDiv){if(n=e.display.lineDiv.childNodes[r],!n)return ge(e.clipPos(be(e.display.viewTo-1)),!0);t=null,r=0}else for(n=t;;n=n.parentNode){if(!n||n==e.display.lineDiv)return null;if(n.parentNode&&n.parentNode==e.display.lineDiv)break}for(var i=0;i<e.display.view.length;i++){var o=e.display.view[i];if(o.node==n)return Be(o,t,r)}}function Be(e,t,r){var n=e.text.firstChild,i=!1;if(!t||!Pe(n,t))return ge(be(v(e.line),0),!0);if(t==n&&(i=!0,t=n.childNodes[r],r=0,!t)){var o=e.rest?_t(e.rest):e.line;return ge(be(v(o),o.text.length),i)}var s=t.nodeType==3?t:null,l=t;for(!s&&t.childNodes.length==1&&t.firstChild.nodeType==3&&(s=t.firstChild,r&&(r=s.nodeValue.length));l.parentNode!=n;)l=l.parentNode;var f=e.measure,c=f.maps;function w(Se,me,Oe){for(var _e=-1;_e<(c?c.length:0);_e++)for(var Re=_e<0?f.map:c[_e],Ke=0;Ke<Re.length;Ke+=3){var Ze=Re[Ke+2];if(Ze==Se||Ze==me){var ct=v(_e<0?e.line:e.rest[_e]),rt=Re[Ke]+Oe;return(Oe<0||Ze!=Se)&&(rt=Re[Ke+(Oe?1:0)]),be(ct,rt)}}}var O=w(s,l,r);if(O)return ge(O,i);for(var B=l.nextSibling,R=s?s.nodeValue.length-r:0;B;B=B.nextSibling){if(O=w(B,B.firstChild,0),O)return ge(be(O.line,O.ch-R),i);R+=B.textContent.length}for(var H=l.previousSibling,ce=r;H;H=H.previousSibling){if(O=w(H,H.firstChild,-1),O)return ge(be(O.line,O.ch+ce),i);ce+=H.textContent.length}}var Ee=function(e){this.cm=e,this.prevInput="",this.pollingFast=!1,this.polling=new Ht,this.hasSelection=!1,this.composing=null,this.resetting=!1};Ee.prototype.init=function(e){var t=this,r=this,n=this.cm;this.createField(e);var i=this.textarea;e.wrapper.insertBefore(this.wrapper,e.wrapper.firstChild),A&&(i.style.width="0px"),ht(i,"input",function(){he&&te>=9&&t.hasSelection&&(t.hasSelection=null),r.poll()}),ht(i,"paste",function(s){Yt(n,s)||Ks(s,n)||(n.state.pasteIncoming=+new Date,r.fastPoll())});function o(s){if(!Yt(n,s)){if(n.somethingSelected())Qa({lineWise:!1,text:n.getSelections()});else if(n.options.lineWiseCopyCut){var l=Ql(n);Qa({lineWise:!0,text:l.text}),s.type=="cut"?n.setSelections(l.ranges,null,ar):(r.prevInput="",i.value=l.text.join(`
`),Je(i))}else return;s.type=="cut"&&(n.state.cutIncoming=+new Date)}}ht(i,"cut",o),ht(i,"copy",o),ht(e.scroller,"paste",function(s){if(!(Wr(e,s)||Yt(n,s))){if(!i.dispatchEvent){n.state.pasteIncoming=+new Date,r.focus();return}var l=new Event("paste");l.clipboardData=s.clipboardData,i.dispatchEvent(l)}}),ht(e.lineSpace,"selectstart",function(s){Wr(e,s)||qt(s)}),ht(i,"compositionstart",function(){var s=n.getCursor("from");r.composing&&r.composing.range.clear(),r.composing={start:s,range:n.markText(s,n.getCursor("to"),{className:"CodeMirror-composing"})}}),ht(i,"compositionend",function(){r.composing&&(r.poll(),r.composing.range.clear(),r.composing=null)})},Ee.prototype.createField=function(e){this.wrapper=Zl(),this.textarea=this.wrapper.firstChild;var t=this.cm.options;Wo(this.textarea,t.spellcheck,t.autocorrect,t.autocapitalize)},Ee.prototype.screenReaderLabelChanged=function(e){e?this.textarea.setAttribute("aria-label",e):this.textarea.removeAttribute("aria-label")},Ee.prototype.prepareSelection=function(){var e=this.cm,t=e.display,r=e.doc,n=di(e);if(e.options.moveInputWithCursor){var i=kr(e,r.sel.primary().head,"div"),o=t.wrapper.getBoundingClientRect(),s=t.lineDiv.getBoundingClientRect();n.teTop=Math.max(0,Math.min(t.wrapper.clientHeight-10,i.top+s.top-o.top)),n.teLeft=Math.max(0,Math.min(t.wrapper.clientWidth-10,i.left+s.left-o.left))}return n},Ee.prototype.showSelection=function(e){var t=this.cm,r=t.display;E(r.cursorDiv,e.cursors),E(r.selectionDiv,e.selection),e.teTop!=null&&(this.wrapper.style.top=e.teTop+"px",this.wrapper.style.left=e.teLeft+"px")},Ee.prototype.reset=function(e){if(!(this.contextMenuPending||this.composing&&e)){var t=this.cm;if(this.resetting=!0,t.somethingSelected()){this.prevInput="";var r=t.getSelection();this.textarea.value=r,t.state.focused&&Je(this.textarea),he&&te>=9&&(this.hasSelection=r)}else e||(this.prevInput=this.textarea.value="",he&&te>=9&&(this.hasSelection=null));this.resetting=!1}},Ee.prototype.getField=function(){return this.textarea},Ee.prototype.supportsTouch=function(){return!1},Ee.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"&&(!h||Ve(st(this.textarea))!=this.textarea))try{this.textarea.focus()}catch{}},Ee.prototype.blur=function(){this.textarea.blur()},Ee.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},Ee.prototype.receivedFocus=function(){this.slowPoll()},Ee.prototype.slowPoll=function(){var e=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){e.poll(),e.cm.state.focused&&e.slowPoll()})},Ee.prototype.fastPoll=function(){var e=!1,t=this;t.pollingFast=!0;function r(){var n=t.poll();!n&&!e?(e=!0,t.polling.set(60,r)):(t.pollingFast=!1,t.slowPoll())}t.polling.set(20,r)},Ee.prototype.poll=function(){var e=this,t=this.cm,r=this.textarea,n=this.prevInput;if(this.contextMenuPending||this.resetting||!t.state.focused||Pn(r)&&!n&&!this.composing||t.isReadOnly()||t.options.disableInput||t.state.keySeq)return!1;var i=r.value;if(i==n&&!t.somethingSelected())return!1;if(he&&te>=9&&this.hasSelection===i||_&&/[\uf700-\uf7ff]/.test(i))return t.display.input.reset(),!1;if(t.doc.sel==t.display.selForContextMenu){var o=i.charCodeAt(0);if(o==8203&&!n&&(n="​"),o==8666)return this.reset(),this.cm.execCommand("undo")}for(var s=0,l=Math.min(n.length,i.length);s<l&&n.charCodeAt(s)==i.charCodeAt(s);)++s;return br(t,function(){zo(t,i.slice(s),n.length-s,null,e.composing?"*compose":null),i.length>1e3||i.indexOf(`
`)>-1?r.value=e.prevInput="":e.prevInput=i,e.composing&&(e.composing.range.clear(),e.composing.range=t.markText(e.composing.start,t.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},Ee.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},Ee.prototype.onKeyPress=function(){he&&te>=9&&(this.hasSelection=null),this.fastPoll()},Ee.prototype.onContextMenu=function(e){var t=this,r=t.cm,n=r.display,i=t.textarea;t.contextMenuPending&&t.contextMenuPending();var o=fr(r,e),s=n.scroller.scrollTop;if(!o||ve)return;var l=r.options.resetSelectionOnContextMenu;l&&r.doc.sel.contains(o)==-1&&or(r,lr)(r.doc,Xn(o),ar);var f=i.style.cssText,c=t.wrapper.style.cssText,w=t.wrapper.offsetParent.getBoundingClientRect();t.wrapper.style.cssText="position: static",i.style.cssText=`position: absolute; width: 30px; height: 30px;
      top: `+(e.clientY-w.top-5)+"px; left: "+(e.clientX-w.left-5)+`px;
      z-index: 1000; background: `+(he?"rgba(255, 255, 255, .05)":"transparent")+`;
      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);`;var O;z&&(O=i.ownerDocument.defaultView.scrollY),n.input.focus(),z&&i.ownerDocument.defaultView.scrollTo(null,O),n.input.reset(),r.somethingSelected()||(i.value=t.prevInput=" "),t.contextMenuPending=R,n.selForContextMenu=r.doc.sel,clearTimeout(n.detectingSelectAll);function B(){if(i.selectionStart!=null){var ce=r.somethingSelected(),Se="​"+(ce?i.value:"");i.value="⇚",i.value=Se,t.prevInput=ce?"":"​",i.selectionStart=1,i.selectionEnd=Se.length,n.selForContextMenu=r.doc.sel}}function R(){if(t.contextMenuPending==R&&(t.contextMenuPending=!1,t.wrapper.style.cssText=c,i.style.cssText=f,he&&te<9&&n.scrollbars.setScrollTop(n.scroller.scrollTop=s),i.selectionStart!=null)){(!he||he&&te<9)&&B();var ce=0,Se=function(){n.selForContextMenu==r.doc.sel&&i.selectionStart==0&&i.selectionEnd>0&&t.prevInput=="​"?or(r,Gs)(r):ce++<10?n.detectingSelectAll=setTimeout(Se,500):(n.selForContextMenu=null,n.input.reset())};n.detectingSelectAll=setTimeout(Se,200)}}if(he&&te>=9&&B(),Ne){In(e);var H=function(){cr(window,"mouseup",H),setTimeout(R,20)};ht(window,"mouseup",H)}else setTimeout(R,50)},Ee.prototype.readOnlyChanged=function(e){e||this.reset(),this.textarea.disabled=e=="nocursor",this.textarea.readOnly=!!e},Ee.prototype.setUneditable=function(){},Ee.prototype.needsContentAttribute=!1;function ze(e,t){if(t=t?pt(t):{},t.value=e.value,!t.tabindex&&e.tabIndex&&(t.tabindex=e.tabIndex),!t.placeholder&&e.placeholder&&(t.placeholder=e.placeholder),t.autofocus==null){var r=Ve(st(e));t.autofocus=r==e||e.getAttribute("autofocus")!=null&&r==document.body}function n(){e.value=l.getValue()}var i;if(e.form&&(ht(e.form,"submit",n),!t.leaveSubmitMethodAlone)){var o=e.form;i=o.submit;try{var s=o.submit=function(){n(),o.submit=i,o.submit(),o.submit=s}}catch{}}t.finishInit=function(f){f.save=n,f.getTextArea=function(){return e},f.toTextArea=function(){f.toTextArea=isNaN,n(),e.parentNode.removeChild(f.getWrapperElement()),e.style.display="",e.form&&(cr(e.form,"submit",n),!t.leaveSubmitMethodAlone&&typeof e.form.submit=="function"&&(e.form.submit=i))}},e.style.display="none";var l=Kt(function(f){return e.parentNode.insertBefore(f,e.nextSibling)},t);return l}function Xe(e){e.off=cr,e.on=ht,e.wheelEventPixels=Ki,e.Doc=mr,e.splitLines=Bt,e.countColumn=Ct,e.findColumn=Vt,e.isWordChar=ua,e.Pass=$t,e.signal=Qt,e.Line=Zr,e.changeEnd=bn,e.scrollbarModel=Ir,e.Pos=be,e.cmpPos=Qe,e.modes=ki,e.mimeModes=Gr,e.resolveMode=Ai,e.getMode=Oi,e.modeExtensions=Nn,e.extendMode=Ri,e.copyState=Vr,e.startState=Mi,e.innerMode=ha,e.commands=Zn,e.keyMap=En,e.keyName=Wa,e.isModifierKey=Ha,e.lookupKey=Qn,e.normalizeKeyMap=Pf,e.StringStream=Zt,e.SharedTextMarker=wi,e.TextMarker=Pr,e.LineWidget=Xr,e.e_preventDefault=qt,e.e_stopPropagation=_i,e.e_stop=In,e.addClass=$e,e.contains=Pe,e.rmClass=We,e.keyNames=Vn}Bf(Kt),u(Kt);var Ie="iter insert remove copy getEditor constructor".split(" ");for(var He in mr.prototype)mr.prototype.hasOwnProperty(He)&&ft(Ie,He)<0&&(Kt.prototype[He]=function(e){return function(){return e.apply(this.doc,arguments)}}(mr.prototype[He]));return Nr(mr),Kt.inputStyles={textarea:Ee,contenteditable:re},Kt.defineMode=function(e){!Kt.defaults.mode&&e!="null"&&(Kt.defaults.mode=e),Hr.apply(this,arguments)},Kt.defineMIME=ni,Kt.defineMode("null",function(){return{token:function(e){return e.skipToEnd()}}}),Kt.defineMIME("text/plain","null"),Kt.defineExtension=function(e,t){Kt.prototype[e]=t},Kt.defineDocExtension=function(e,t){mr.prototype[e]=t},Kt.fromTextArea=ze,Xe(Kt),Kt.version="5.65.19",Kt})}(codemirror$1)),codemirror$1.exports}var codemirrorExports=requireCodemirror();const CodeMirror=getDefaultExportFromCjs(codemirrorExports);var javascript={exports:{}},hasRequiredJavascript;function requireJavascript(){return hasRequiredJavascript||(hasRequiredJavascript=1,function(b,y){(function(d){d(requireCodemirror())})(function(d){d.defineMode("javascript",function(m,S){var P=m.indentUnit,ie=S.statementIndent,Q=S.jsonld,he=S.json||Q,te=S.trackScope!==!1,z=S.typescript,ue=S.wordCharacters||/[\w$\xa1-\uffff]/,D=function(){function v(Jt){return{type:Jt,style:"keyword"}}var X=v("keyword a"),Ae=v("keyword b"),Ue=v("keyword c"),be=v("keyword d"),Qe=v("operator"),zt={type:"atom",style:"atom"};return{if:v("if"),while:X,with:X,else:Ae,do:Ae,try:Ae,finally:Ae,return:be,break:be,continue:be,new:v("new"),delete:Ue,void:Ue,throw:Ue,debugger:v("debugger"),var:v("var"),const:v("var"),let:v("var"),function:v("function"),catch:v("catch"),for:v("for"),switch:v("switch"),case:v("case"),default:v("default"),in:Qe,typeof:Qe,instanceof:Qe,true:zt,false:zt,null:zt,undefined:zt,NaN:zt,Infinity:zt,this:v("this"),class:v("class"),super:v("atom"),yield:Ue,export:v("export"),import:v("import"),extends:Ue,await:Ue}}(),se=/[+\-*&%=<>!?|~^@]/,ve=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function Ge(v){for(var X=!1,Ae,Ue=!1;(Ae=v.next())!=null;){if(!X){if(Ae=="/"&&!Ue)return;Ae=="["?Ue=!0:Ue&&Ae=="]"&&(Ue=!1)}X=!X&&Ae=="\\"}}var qe,q;function A(v,X,Ae){return qe=v,q=Ae,X}function j(v,X){var Ae=v.next();if(Ae=='"'||Ae=="'")return X.tokenize=h(Ae),X.tokenize(v,X);if(Ae=="."&&v.match(/^\d[\d_]*(?:[eE][+\-]?[\d_]+)?/))return A("number","number");if(Ae=="."&&v.match(".."))return A("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(Ae))return A(Ae);if(Ae=="="&&v.eat(">"))return A("=>","operator");if(Ae=="0"&&v.match(/^(?:x[\dA-Fa-f_]+|o[0-7_]+|b[01_]+)n?/))return A("number","number");if(/\d/.test(Ae))return v.match(/^[\d_]*(?:n|(?:\.[\d_]*)?(?:[eE][+\-]?[\d_]+)?)?/),A("number","number");if(Ae=="/")return v.eat("*")?(X.tokenize=_,_(v,X)):v.eat("/")?(v.skipToEnd(),A("comment","comment")):Er(v,X,1)?(Ge(v),v.match(/^\b(([gimyus])(?![gimyus]*\2))+\b/),A("regexp","string-2")):(v.eat("="),A("operator","operator",v.current()));if(Ae=="`")return X.tokenize=G,G(v,X);if(Ae=="#"&&v.peek()=="!")return v.skipToEnd(),A("meta","meta");if(Ae=="#"&&v.eatWhile(ue))return A("variable","property");if(Ae=="<"&&v.match("!--")||Ae=="-"&&v.match("->")&&!/\S/.test(v.string.slice(0,v.start)))return v.skipToEnd(),A("comment","comment");if(se.test(Ae))return(Ae!=">"||!X.lexical||X.lexical.type!=">")&&(v.eat("=")?(Ae=="!"||Ae=="=")&&v.eat("="):/[<>*+\-|&?]/.test(Ae)&&(v.eat(Ae),Ae==">"&&v.eat(Ae))),Ae=="?"&&v.eat(".")?A("."):A("operator","operator",v.current());if(ue.test(Ae)){v.eatWhile(ue);var Ue=v.current();if(X.lastType!="."){if(D.propertyIsEnumerable(Ue)){var be=D[Ue];return A(be.type,be.style,Ue)}if(Ue=="async"&&v.match(/^(\s|\/\*([^*]|\*(?!\/))*?\*\/)*[\[\(\w]/,!1))return A("async","keyword",Ue)}return A("variable","variable",Ue)}}function h(v){return function(X,Ae){var Ue=!1,be;if(Q&&X.peek()=="@"&&X.match(ve))return Ae.tokenize=j,A("jsonld-keyword","meta");for(;(be=X.next())!=null&&!(be==v&&!Ue);)Ue=!Ue&&be=="\\";return Ue||(Ae.tokenize=j),A("string","string")}}function _(v,X){for(var Ae=!1,Ue;Ue=v.next();){if(Ue=="/"&&Ae){X.tokenize=j;break}Ae=Ue=="*"}return A("comment","comment")}function G(v,X){for(var Ae=!1,Ue;(Ue=v.next())!=null;){if(!Ae&&(Ue=="`"||Ue=="$"&&v.eat("{"))){X.tokenize=j;break}Ae=!Ae&&Ue=="\\"}return A("quasi","string-2",v.current())}var U="([{}])";function ae(v,X){X.fatArrowAt&&(X.fatArrowAt=null);var Ae=v.string.indexOf("=>",v.start);if(!(Ae<0)){if(z){var Ue=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(v.string.slice(v.start,Ae));Ue&&(Ae=Ue.index)}for(var be=0,Qe=!1,zt=Ae-1;zt>=0;--zt){var Jt=v.string.charAt(zt),hr=U.indexOf(Jt);if(hr>=0&&hr<3){if(!be){++zt;break}if(--be==0){Jt=="("&&(Qe=!0);break}}else if(hr>=3&&hr<6)++be;else if(ue.test(Jt))Qe=!0;else if(/["'\/`]/.test(Jt))for(;;--zt){if(zt==0)return;var Fi=v.string.charAt(zt-1);if(Fi==Jt&&v.string.charAt(zt-2)!="\\"){zt--;break}}else if(Qe&&!be){++zt;break}}Qe&&!be&&(X.fatArrowAt=zt)}}var we={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,this:!0,import:!0,"jsonld-keyword":!0};function Ne(v,X,Ae,Ue,be,Qe){this.indented=v,this.column=X,this.type=Ae,this.prev=be,this.info=Qe,Ue!=null&&(this.align=Ue)}function ke(v,X){if(!te)return!1;for(var Ae=v.localVars;Ae;Ae=Ae.next)if(Ae.name==X)return!0;for(var Ue=v.context;Ue;Ue=Ue.prev)for(var Ae=Ue.vars;Ae;Ae=Ae.next)if(Ae.name==X)return!0}function We(v,X,Ae,Ue,be){var Qe=v.cc;for(C.state=v,C.stream=be,C.marked=null,C.cc=Qe,C.style=X,v.lexical.hasOwnProperty("align")||(v.lexical.align=!0);;){var zt=Qe.length?Qe.pop():he?ft:Ct;if(zt(Ae,Ue)){for(;Qe.length&&Qe[Qe.length-1].lex;)Qe.pop()();return C.marked?C.marked:Ae=="variable"&&ke(v,Ue)?"variable-2":X}}}var C={state:null,marked:null,cc:null};function E(){for(var v=arguments.length-1;v>=0;v--)C.cc.push(arguments[v])}function p(){return E.apply(null,arguments),!0}function Z(v,X){for(var Ae=X;Ae;Ae=Ae.next)if(Ae.name==v)return!0;return!1}function ye(v){var X=C.state;if(C.marked="def",!!te){if(X.context){if(X.lexical.info=="var"&&X.context&&X.context.block){var Ae=Pe(v,X.context);if(Ae!=null){X.context=Ae;return}}else if(!Z(v,X.localVars)){X.localVars=new Ye(v,X.localVars);return}}S.globalVars&&!Z(v,X.globalVars)&&(X.globalVars=new Ye(v,X.globalVars))}}function Pe(v,X){if(X)if(X.block){var Ae=Pe(v,X.prev);return Ae?Ae==X.prev?X:new $e(Ae,X.vars,!0):null}else return Z(v,X.vars)?X:new $e(X.prev,new Ye(v,X.vars),!1);else return null}function Ve(v){return v=="public"||v=="private"||v=="protected"||v=="abstract"||v=="readonly"}function $e(v,X,Ae){this.prev=v,this.vars=X,this.block=Ae}function Ye(v,X){this.name=v,this.next=X}var Je=new Ye("this",new Ye("arguments",null));function at(){C.state.context=new $e(C.state.context,C.state.localVars,!1),C.state.localVars=Je}function Ot(){C.state.context=new $e(C.state.context,C.state.localVars,!0),C.state.localVars=null}at.lex=Ot.lex=!0;function st(){C.state.localVars=C.state.context.vars,C.state.context=C.state.context.prev}st.lex=!0;function ut(v,X){var Ae=function(){var Ue=C.state,be=Ue.indented;if(Ue.lexical.type=="stat")be=Ue.lexical.indented;else for(var Qe=Ue.lexical;Qe&&Qe.type==")"&&Qe.align;Qe=Qe.prev)be=Qe.indented;Ue.lexical=new Ne(be,C.stream.column(),v,null,Ue.lexical,X)};return Ae.lex=!0,Ae}function tt(){var v=C.state;v.lexical.prev&&(v.lexical.type==")"&&(v.indented=v.lexical.indented),v.lexical=v.lexical.prev)}tt.lex=!0;function pt(v){function X(Ae){return Ae==v?p():v==";"||Ae=="}"||Ae==")"||Ae=="]"?E():p(X)}return X}function Ct(v,X){return v=="var"?p(ut("vardef",X),_i,pt(";"),tt):v=="keyword a"?p(ut("form"),$t,Ct,tt):v=="keyword b"?p(ut("form"),Ct,tt):v=="keyword d"?C.stream.match(/^\s*$/,!1)?p():p(ut("stat"),Sr,pt(";"),tt):v=="debugger"?p(pt(";")):v=="{"?p(ut("}"),Ot,$r,tt,st):v==";"?p():v=="if"?(C.state.lexical.info=="else"&&C.state.cc[C.state.cc.length-1]==tt&&C.state.cc.pop()(),p(ut("form"),$t,Ct,tt,Ei)):v=="function"?p(Bt):v=="for"?p(ut("form"),Ot,eo,Ct,st,tt):v=="class"||z&&X=="interface"?(C.marked="keyword",p(ut("form",v=="class"?v:X),ki,tt)):v=="variable"?z&&X=="declare"?(C.marked="keyword",p(Ct)):z&&(X=="module"||X=="enum"||X=="type")&&C.stream.match(/^\s*\w/,!1)?(C.marked="keyword",X=="enum"?p(lt):X=="type"?p(to,pt("operator"),kt,pt(";")):p(ut("form"),gr,pt("{"),ut("}"),$r,tt,tt)):z&&X=="namespace"?(C.marked="keyword",p(ut("form"),ft,Ct,tt)):z&&X=="abstract"?(C.marked="keyword",p(Ct)):p(ut("stat"),Uo):v=="switch"?p(ut("form"),$t,pt("{"),ut("}","switch"),Ot,$r,tt,tt,st):v=="case"?p(ft,pt(":")):v=="default"?p(pt(":")):v=="catch"?p(ut("form"),at,Ht,Ct,tt,st):v=="export"?p(ut("stat"),Ai,tt):v=="import"?p(ut("stat"),Nn,tt):v=="async"?p(Ct):X=="@"?p(ft,Ct):E(ut("stat"),ft,pt(";"),tt)}function Ht(v){if(v=="(")return p(Dr,pt(")"))}function ft(v,X){return ar(v,X,!1)}function Mt(v,X){return ar(v,X,!0)}function $t(v){return v!="("?E():p(ut(")"),Sr,pt(")"),tt)}function ar(v,X,Ae){if(C.state.fatArrowAt==C.stream.start){var Ue=Ae?ri:_t;if(v=="(")return p(at,ut(")"),jt(Dr,")"),tt,pt("=>"),Ue,st);if(v=="variable")return E(at,gr,pt("=>"),Ue,st)}var be=Ae?Vt:ur;return we.hasOwnProperty(v)?p(be):v=="function"?p(Bt,be):v=="class"||z&&X=="interface"?(C.marked="keyword",p(ut("form"),jo,tt)):v=="keyword c"||v=="async"?p(Ae?Mt:ft):v=="("?p(ut(")"),Sr,pt(")"),tt,be):v=="operator"||v=="spread"?p(Ae?Mt:ft):v=="["?p(ut("]"),Zt,tt,be):v=="{"?on(an,"}",null,be):v=="quasi"?E(Nt,be):v=="new"?p(qo(Ae)):p()}function Sr(v){return v.match(/[;\}\)\],]/)?E():E(ft)}function ur(v,X){return v==","?p(Sr):Vt(v,X,!1)}function Vt(v,X,Ae){var Ue=Ae==!1?ur:Vt,be=Ae==!1?ft:Mt;if(v=="=>")return p(at,Ae?ri:_t,st);if(v=="operator")return/\+\+|--/.test(X)||z&&X=="!"?p(Ue):z&&X=="<"&&C.stream.match(/^([^<>]|<[^<>]*>)*>\s*\(/,!1)?p(ut(">"),jt(kt,">"),tt,Ue):X=="?"?p(ft,pt(":"),be):p(be);if(v=="quasi")return E(Nt,Ue);if(v!=";"){if(v=="(")return on(Mt,")","call",Ue);if(v==".")return p(ua,Ue);if(v=="[")return p(ut("]"),Sr,pt("]"),tt,Ue);if(z&&X=="as")return C.marked="keyword",p(kt,Ue);if(v=="regexp")return C.state.lastType=C.marked="operator",C.stream.backUp(C.stream.pos-C.stream.start-1),p(be)}}function Nt(v,X){return v!="quasi"?E():X.slice(X.length-2)!="${"?p(Nt):p(Sr,nn)}function nn(v){if(v=="}")return C.marked="string-2",C.state.tokenize=G,p(Nt)}function _t(v){return ae(C.stream,C.state),E(v=="{"?Ct:ft)}function ri(v){return ae(C.stream,C.state),E(v=="{"?Ct:Mt)}function qo(v){return function(X){return X=="."?p(v?Za:M):X=="variable"&&z?p(wr,v?Vt:ur):E(v?Mt:ft)}}function M(v,X){if(X=="target")return C.marked="keyword",p(ur)}function Za(v,X){if(X=="target")return C.marked="keyword",p(Vt)}function Uo(v){return v==":"?p(tt,Ct):E(ur,pt(";"),tt)}function ua(v){if(v=="variable")return C.marked="property",p()}function an(v,X){if(v=="async")return C.marked="property",p(an);if(v=="variable"||C.style=="keyword"){if(C.marked="property",X=="get"||X=="set")return p(Kr);var Ae;return z&&C.state.fatArrowAt==C.stream.start&&(Ae=C.stream.match(/^\s*:\s*/,!1))&&(C.state.fatArrowAt=C.stream.pos+Ae[0].length),p(Yr)}else{if(v=="number"||v=="string")return C.marked=Q?"property":C.style+" property",p(Yr);if(v=="jsonld-keyword")return p(Yr);if(z&&Ve(X))return C.marked="keyword",p(an);if(v=="[")return p(ft,Mn,pt("]"),Yr);if(v=="spread")return p(Mt,Yr);if(X=="*")return C.marked="keyword",p(an);if(v==":")return E(Yr)}}function Kr(v){return v!="variable"?E(Yr):(C.marked="property",p(Bt))}function Yr(v){if(v==":")return p(Mt);if(v=="(")return E(Bt)}function jt(v,X,Ae){function Ue(be,Qe){if(Ae?Ae.indexOf(be)>-1:be==","){var zt=C.state.lexical;return zt.info=="call"&&(zt.pos=(zt.pos||0)+1),p(function(Jt,hr){return Jt==X||hr==X?E():E(v)},Ue)}return be==X||Qe==X?p():Ae&&Ae.indexOf(";")>-1?E(v):p(pt(X))}return function(be,Qe){return be==X||Qe==X?p():E(v,Ue)}}function on(v,X,Ae){for(var Ue=3;Ue<arguments.length;Ue++)C.cc.push(arguments[Ue]);return p(ut(X,Ae),jt(v,X),tt)}function $r(v){return v=="}"?p():E(Ct,$r)}function Mn(v,X){if(z){if(v==":")return p(kt);if(X=="?")return p(Mn)}}function Fn(v,X){if(z&&(v==":"||X=="in"))return p(kt)}function nr(v){if(z&&v==":")return C.stream.match(/^\s*\w+\s+is\b/,!1)?p(ft,ca,kt):p(kt)}function ca(v,X){if(X=="is")return C.marked="keyword",p()}function kt(v,X){if(X=="keyof"||X=="typeof"||X=="infer"||X=="readonly")return C.marked="keyword",p(X=="typeof"?Mt:kt);if(v=="variable"||X=="void")return C.marked="type",p(_r);if(X=="|"||X=="&")return p(kt);if(v=="string"||v=="number"||v=="atom")return p(_r);if(v=="[")return p(ut("]"),jt(kt,"]",","),tt,_r);if(v=="{")return p(ut("}"),ht,tt,_r);if(v=="(")return p(jt(Yt,")"),Ja,_r);if(v=="<")return p(jt(kt,">"),kt);if(v=="quasi")return E(cr,_r)}function Ja(v){if(v=="=>")return p(kt)}function ht(v){return v.match(/[\}\)\]]/)?p():v==","||v==";"?p(ht):E(sn,ht)}function sn(v,X){if(v=="variable"||C.style=="keyword")return C.marked="property",p(sn);if(X=="?"||v=="number"||v=="string")return p(sn);if(v==":")return p(kt);if(v=="[")return p(pt("variable"),Fn,pt("]"),sn);if(v=="(")return E(Pn,sn);if(!v.match(/[;\}\)\],]/))return p()}function cr(v,X){return v!="quasi"?E():X.slice(X.length-2)!="${"?p(cr):p(kt,Qt)}function Qt(v){if(v=="}")return C.marked="string-2",C.state.tokenize=G,p(cr)}function Yt(v,X){return v=="variable"&&C.stream.match(/^\s*[?:]/,!1)||X=="?"?p(Yt):v==":"?p(kt):v=="spread"?p(Yt):E(kt)}function _r(v,X){if(X=="<")return p(ut(">"),jt(kt,">"),tt,_r);if(X=="|"||v=="."||X=="&")return p(kt);if(v=="[")return p(kt,pt("]"),_r);if(X=="extends"||X=="implements")return C.marked="keyword",p(kt);if(X=="?")return p(kt,pt(":"),kt)}function wr(v,X){if(X=="<")return p(ut(">"),jt(kt,">"),tt,_r)}function Nr(){return E(kt,qt)}function qt(v,X){if(X=="=")return p(kt)}function _i(v,X){return X=="enum"?(C.marked="keyword",p(lt)):E(gr,Mn,Br,Xo)}function gr(v,X){if(z&&Ve(X))return C.marked="keyword",p(gr);if(v=="variable")return ye(X),p();if(v=="spread")return p(gr);if(v=="[")return on(da,"]");if(v=="{")return on(In,"}")}function In(v,X){return v=="variable"&&!C.stream.match(/^\s*:/,!1)?(ye(X),p(Br)):(v=="variable"&&(C.marked="property"),v=="spread"?p(gr):v=="}"?E():v=="["?p(ft,pt("]"),pt(":"),In):p(pt(":"),gr,Br))}function da(){return E(gr,Br)}function Br(v,X){if(X=="=")return p(Mt)}function Xo(v){if(v==",")return p(_i)}function Ei(v,X){if(v=="keyword b"&&X=="else")return p(ut("form","else"),Ct,tt)}function eo(v,X){if(X=="await")return p(eo);if(v=="(")return p(ut(")"),Li,tt)}function Li(v){return v=="var"?p(_i,ln):v=="variable"?p(ln):E(ln)}function ln(v,X){return v==")"?p():v==";"?p(ln):X=="in"||X=="of"?(C.marked="keyword",p(ft,ln)):E(ft,ln)}function Bt(v,X){if(X=="*")return C.marked="keyword",p(Bt);if(v=="variable")return ye(X),p(Bt);if(v=="(")return p(at,ut(")"),jt(Dr,")"),tt,nr,Ct,st);if(z&&X=="<")return p(ut(">"),jt(Nr,">"),tt,Bt)}function Pn(v,X){if(X=="*")return C.marked="keyword",p(Pn);if(v=="variable")return ye(X),p(Pn);if(v=="(")return p(at,ut(")"),jt(Dr,")"),tt,nr,st);if(z&&X=="<")return p(ut(">"),jt(Nr,">"),tt,Pn)}function to(v,X){if(v=="keyword"||v=="variable")return C.marked="type",p(to);if(X=="<")return p(ut(">"),jt(Nr,">"),tt)}function Dr(v,X){return X=="@"&&p(ft,Dr),v=="spread"?p(Dr):z&&Ve(X)?(C.marked="keyword",p(Dr)):z&&v=="this"?p(Mn,Br):E(gr,Mn,Br)}function jo(v,X){return v=="variable"?ki(v,X):Gr(v,X)}function ki(v,X){if(v=="variable")return ye(X),p(Gr)}function Gr(v,X){if(X=="<")return p(ut(">"),jt(Nr,">"),tt,Gr);if(X=="extends"||X=="implements"||z&&v==",")return X=="implements"&&(C.marked="keyword"),p(z?kt:ft,Gr);if(v=="{")return p(ut("}"),Hr,tt)}function Hr(v,X){if(v=="async"||v=="variable"&&(X=="static"||X=="get"||X=="set"||z&&Ve(X))&&C.stream.match(/^\s+#?[\w$\xa1-\uffff]/,!1))return C.marked="keyword",p(Hr);if(v=="variable"||C.style=="keyword")return C.marked="property",p(ni,Hr);if(v=="number"||v=="string")return p(ni,Hr);if(v=="[")return p(ft,Mn,pt("]"),ni,Hr);if(X=="*")return C.marked="keyword",p(Hr);if(z&&v=="(")return E(Pn,Hr);if(v==";"||v==",")return p(Hr);if(v=="}")return p();if(X=="@")return p(ft,Hr)}function ni(v,X){if(X=="!"||X=="?")return p(ni);if(v==":")return p(kt,Br);if(X=="=")return p(Mt);var Ae=C.state.lexical.prev,Ue=Ae&&Ae.info=="interface";return E(Ue?Pn:Bt)}function Ai(v,X){return X=="*"?(C.marked="keyword",p(Mi,pt(";"))):X=="default"?(C.marked="keyword",p(ft,pt(";"))):v=="{"?p(jt(Oi,"}"),Mi,pt(";")):E(Ct)}function Oi(v,X){if(X=="as")return C.marked="keyword",p(pt("variable"));if(v=="variable")return E(Mt,Oi)}function Nn(v){return v=="string"?p():v=="("?E(ft):v=="."?E(ur):E(Ri,Vr,Mi)}function Ri(v,X){return v=="{"?on(Ri,"}"):(v=="variable"&&ye(X),X=="*"&&(C.marked="keyword"),p(ha))}function Vr(v){if(v==",")return p(Ri,Vr)}function ha(v,X){if(X=="as")return C.marked="keyword",p(Ri)}function Mi(v,X){if(X=="from")return C.marked="keyword",p(ft)}function Zt(v){return v=="]"?p():E(jt(Mt,"]"))}function lt(){return E(ut("form"),gr,pt("{"),ut("}"),jt(fn,"}"),tt,tt)}function fn(){return E(gr,Br)}function pa(v,X){return v.lastType=="operator"||v.lastType==","||se.test(X.charAt(0))||/[,.]/.test(X.charAt(0))}function Er(v,X,Ae){return X.tokenize==j&&/^(?:operator|sof|keyword [bcd]|case|new|export|default|spread|[\[{}\(,;:]|=>)$/.test(X.lastType)||X.lastType=="quasi"&&/\{\s*$/.test(v.string.slice(0,v.pos-(Ae||0)))}return{startState:function(v){var X={tokenize:j,lastType:"sof",cc:[],lexical:new Ne((v||0)-P,0,"block",!1),localVars:S.localVars,context:S.localVars&&new $e(null,null,!1),indented:v||0};return S.globalVars&&typeof S.globalVars=="object"&&(X.globalVars=S.globalVars),X},token:function(v,X){if(v.sol()&&(X.lexical.hasOwnProperty("align")||(X.lexical.align=!1),X.indented=v.indentation(),ae(v,X)),X.tokenize!=_&&v.eatSpace())return null;var Ae=X.tokenize(v,X);return qe=="comment"?Ae:(X.lastType=qe=="operator"&&(q=="++"||q=="--")?"incdec":qe,We(X,Ae,qe,q,v))},indent:function(v,X){if(v.tokenize==_||v.tokenize==G)return d.Pass;if(v.tokenize!=j)return 0;var Ae=X&&X.charAt(0),Ue=v.lexical,be;if(!/^\s*else\b/.test(X))for(var Qe=v.cc.length-1;Qe>=0;--Qe){var zt=v.cc[Qe];if(zt==tt)Ue=Ue.prev;else if(zt!=Ei&&zt!=st)break}for(;(Ue.type=="stat"||Ue.type=="form")&&(Ae=="}"||(be=v.cc[v.cc.length-1])&&(be==ur||be==Vt)&&!/^[,\.=+\-*:?[\(]/.test(X));)Ue=Ue.prev;ie&&Ue.type==")"&&Ue.prev.type=="stat"&&(Ue=Ue.prev);var Jt=Ue.type,hr=Ae==Jt;return Jt=="vardef"?Ue.indented+(v.lastType=="operator"||v.lastType==","?Ue.info.length+1:0):Jt=="form"&&Ae=="{"?Ue.indented:Jt=="form"?Ue.indented+P:Jt=="stat"?Ue.indented+(pa(v,X)?ie||P:0):Ue.info=="switch"&&!hr&&S.doubleIndentSwitch!=!1?Ue.indented+(/^(?:case|default)\b/.test(X)?P:2*P):Ue.align?Ue.column+(hr?0:1):Ue.indented+(hr?0:P)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:he?null:"/*",blockCommentEnd:he?null:"*/",blockCommentContinue:he?null:" * ",lineComment:he?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:he?"json":"javascript",jsonldMode:Q,jsonMode:he,expressionAllowed:Er,skipExpression:function(v){We(v,"atom","atom","true",new d.StringStream("",2,null))}}}),d.registerHelper("wordChars","javascript",/[\w$]/),d.defineMIME("text/javascript","javascript"),d.defineMIME("text/ecmascript","javascript"),d.defineMIME("application/javascript","javascript"),d.defineMIME("application/x-javascript","javascript"),d.defineMIME("application/ecmascript","javascript"),d.defineMIME("application/json",{name:"javascript",json:!0}),d.defineMIME("application/x-json",{name:"javascript",json:!0}),d.defineMIME("application/manifest+json",{name:"javascript",json:!0}),d.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),d.defineMIME("text/typescript",{name:"javascript",typescript:!0}),d.defineMIME("application/typescript",{name:"javascript",typescript:!0})})}()),javascript.exports}requireJavascript();var dialog={exports:{}},hasRequiredDialog;function requireDialog(){return hasRequiredDialog||(hasRequiredDialog=1,function(b,y){(function(d){d(requireCodemirror())})(function(d){function m(P,ie,Q){var he=P.getWrapperElement(),te;return te=he.appendChild(document.createElement("div")),Q?te.className="CodeMirror-dialog CodeMirror-dialog-bottom":te.className="CodeMirror-dialog CodeMirror-dialog-top",typeof ie=="string"?te.innerHTML=ie:te.appendChild(ie),d.addClass(he,"dialog-opened"),te}function S(P,ie){P.state.currentNotificationClose&&P.state.currentNotificationClose(),P.state.currentNotificationClose=ie}d.defineExtension("openDialog",function(P,ie,Q){Q||(Q={}),S(this,null);var he=m(this,P,Q.bottom),te=!1,z=this;function ue(ve){if(typeof ve=="string")D.value=ve;else{if(te)return;te=!0,d.rmClass(he.parentNode,"dialog-opened"),he.parentNode.removeChild(he),z.focus(),Q.onClose&&Q.onClose(he)}}var D=he.getElementsByTagName("input")[0],se;return D?(D.focus(),Q.value&&(D.value=Q.value,Q.selectValueOnOpen!==!1&&D.select()),Q.onInput&&d.on(D,"input",function(ve){Q.onInput(ve,D.value,ue)}),Q.onKeyUp&&d.on(D,"keyup",function(ve){Q.onKeyUp(ve,D.value,ue)}),d.on(D,"keydown",function(ve){Q&&Q.onKeyDown&&Q.onKeyDown(ve,D.value,ue)||((ve.keyCode==27||Q.closeOnEnter!==!1&&ve.keyCode==13)&&(D.blur(),d.e_stop(ve),ue()),ve.keyCode==13&&ie(D.value,ve))}),Q.closeOnBlur!==!1&&d.on(he,"focusout",function(ve){ve.relatedTarget!==null&&ue()})):(se=he.getElementsByTagName("button")[0])&&(d.on(se,"click",function(){ue(),z.focus()}),Q.closeOnBlur!==!1&&d.on(se,"blur",ue),se.focus()),ue}),d.defineExtension("openConfirm",function(P,ie,Q){S(this,null);var he=m(this,P,Q&&Q.bottom),te=he.getElementsByTagName("button"),z=!1,ue=this,D=1;function se(){z||(z=!0,d.rmClass(he.parentNode,"dialog-opened"),he.parentNode.removeChild(he),ue.focus())}te[0].focus();for(var ve=0;ve<te.length;++ve){var Ge=te[ve];(function(qe){d.on(Ge,"click",function(q){d.e_preventDefault(q),se(),qe&&qe(ue)})})(ie[ve]),d.on(Ge,"blur",function(){--D,setTimeout(function(){D<=0&&se()},200)}),d.on(Ge,"focus",function(){++D})}}),d.defineExtension("openNotification",function(P,ie){S(this,ue);var Q=m(this,P,ie&&ie.bottom),he=!1,te,z=ie&&typeof ie.duration<"u"?ie.duration:5e3;function ue(){he||(he=!0,clearTimeout(te),d.rmClass(Q.parentNode,"dialog-opened"),Q.parentNode.removeChild(Q))}return d.on(Q,"click",function(D){d.e_preventDefault(D),ue()}),z&&(te=setTimeout(ue,z)),ue})})}()),dialog.exports}requireDialog();var sublime={exports:{}},searchcursor={exports:{}},hasRequiredSearchcursor;function requireSearchcursor(){return hasRequiredSearchcursor||(hasRequiredSearchcursor=1,function(b,y){(function(d){d(requireCodemirror())})(function(d){var m=d.Pos;function S(A){var j=A.flags;return j??(A.ignoreCase?"i":"")+(A.global?"g":"")+(A.multiline?"m":"")}function P(A,j){for(var h=S(A),_=h,G=0;G<j.length;G++)_.indexOf(j.charAt(G))==-1&&(_+=j.charAt(G));return h==_?A:new RegExp(A.source,_)}function ie(A){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(A.source)}function Q(A,j,h){j=P(j,"g");for(var _=h.line,G=h.ch,U=A.lastLine();_<=U;_++,G=0){j.lastIndex=G;var ae=A.getLine(_),we=j.exec(ae);if(we)return{from:m(_,we.index),to:m(_,we.index+we[0].length),match:we}}}function he(A,j,h){if(!ie(j))return Q(A,j,h);j=P(j,"gm");for(var _,G=1,U=h.line,ae=A.lastLine();U<=ae;){for(var we=0;we<G&&!(U>ae);we++){var Ne=A.getLine(U++);_=_==null?Ne:_+`
`+Ne}G=G*2,j.lastIndex=h.ch;var ke=j.exec(_);if(ke){var We=_.slice(0,ke.index).split(`
`),C=ke[0].split(`
`),E=h.line+We.length-1,p=We[We.length-1].length;return{from:m(E,p),to:m(E+C.length-1,C.length==1?p+C[0].length:C[C.length-1].length),match:ke}}}}function te(A,j,h){for(var _,G=0;G<=A.length;){j.lastIndex=G;var U=j.exec(A);if(!U)break;var ae=U.index+U[0].length;if(ae>A.length-h)break;(!_||ae>_.index+_[0].length)&&(_=U),G=U.index+1}return _}function z(A,j,h){j=P(j,"g");for(var _=h.line,G=h.ch,U=A.firstLine();_>=U;_--,G=-1){var ae=A.getLine(_),we=te(ae,j,G<0?0:ae.length-G);if(we)return{from:m(_,we.index),to:m(_,we.index+we[0].length),match:we}}}function ue(A,j,h){if(!ie(j))return z(A,j,h);j=P(j,"gm");for(var _,G=1,U=A.getLine(h.line).length-h.ch,ae=h.line,we=A.firstLine();ae>=we;){for(var Ne=0;Ne<G&&ae>=we;Ne++){var ke=A.getLine(ae--);_=_==null?ke:ke+`
`+_}G*=2;var We=te(_,j,U);if(We){var C=_.slice(0,We.index).split(`
`),E=We[0].split(`
`),p=ae+C.length,Z=C[C.length-1].length;return{from:m(p,Z),to:m(p+E.length-1,E.length==1?Z+E[0].length:E[E.length-1].length),match:We}}}}var D,se;String.prototype.normalize?(D=function(A){return A.normalize("NFD").toLowerCase()},se=function(A){return A.normalize("NFD")}):(D=function(A){return A.toLowerCase()},se=function(A){return A});function ve(A,j,h,_){if(A.length==j.length)return h;for(var G=0,U=h+Math.max(0,A.length-j.length);;){if(G==U)return G;var ae=G+U>>1,we=_(A.slice(0,ae)).length;if(we==h)return ae;we>h?U=ae:G=ae+1}}function Ge(A,j,h,_){if(!j.length)return null;var G=_?D:se,U=G(j).split(/\r|\n\r?/);e:for(var ae=h.line,we=h.ch,Ne=A.lastLine()+1-U.length;ae<=Ne;ae++,we=0){var ke=A.getLine(ae).slice(we),We=G(ke);if(U.length==1){var C=We.indexOf(U[0]);if(C==-1)continue e;var h=ve(ke,We,C,G)+we;return{from:m(ae,ve(ke,We,C,G)+we),to:m(ae,ve(ke,We,C+U[0].length,G)+we)}}else{var E=We.length-U[0].length;if(We.slice(E)!=U[0])continue e;for(var p=1;p<U.length-1;p++)if(G(A.getLine(ae+p))!=U[p])continue e;var Z=A.getLine(ae+U.length-1),ye=G(Z),Pe=U[U.length-1];if(ye.slice(0,Pe.length)!=Pe)continue e;return{from:m(ae,ve(ke,We,E,G)+we),to:m(ae+U.length-1,ve(Z,ye,Pe.length,G))}}}}function qe(A,j,h,_){if(!j.length)return null;var G=_?D:se,U=G(j).split(/\r|\n\r?/);e:for(var ae=h.line,we=h.ch,Ne=A.firstLine()-1+U.length;ae>=Ne;ae--,we=-1){var ke=A.getLine(ae);we>-1&&(ke=ke.slice(0,we));var We=G(ke);if(U.length==1){var C=We.lastIndexOf(U[0]);if(C==-1)continue e;return{from:m(ae,ve(ke,We,C,G)),to:m(ae,ve(ke,We,C+U[0].length,G))}}else{var E=U[U.length-1];if(We.slice(0,E.length)!=E)continue e;for(var p=1,h=ae-U.length+1;p<U.length-1;p++)if(G(A.getLine(h+p))!=U[p])continue e;var Z=A.getLine(ae+1-U.length),ye=G(Z);if(ye.slice(ye.length-U[0].length)!=U[0])continue e;return{from:m(ae+1-U.length,ve(Z,ye,Z.length-U[0].length,G)),to:m(ae,ve(ke,We,E.length,G))}}}}function q(A,j,h,_){this.atOccurrence=!1,this.afterEmptyMatch=!1,this.doc=A,h=h?A.clipPos(h):m(0,0),this.pos={from:h,to:h};var G;typeof _=="object"?G=_.caseFold:(G=_,_=null),typeof j=="string"?(G==null&&(G=!1),this.matches=function(U,ae){return(U?qe:Ge)(A,j,ae,G)}):(j=P(j,"gm"),!_||_.multiline!==!1?this.matches=function(U,ae){return(U?ue:he)(A,j,ae)}:this.matches=function(U,ae){return(U?z:Q)(A,j,ae)})}q.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(A){var j=this.doc.clipPos(A?this.pos.from:this.pos.to);if(this.afterEmptyMatch&&this.atOccurrence&&(j=m(j.line,j.ch),A?(j.ch--,j.ch<0&&(j.line--,j.ch=(this.doc.getLine(j.line)||"").length)):(j.ch++,j.ch>(this.doc.getLine(j.line)||"").length&&(j.ch=0,j.line++)),d.cmpPos(j,this.doc.clipPos(j))!=0))return this.atOccurrence=!1;var h=this.matches(A,j);if(this.afterEmptyMatch=h&&d.cmpPos(h.from,h.to)==0,h)return this.pos=h,this.atOccurrence=!0,this.pos.match||!0;var _=m(A?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:_,to:_},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(A,j){if(this.atOccurrence){var h=d.splitLines(A);this.doc.replaceRange(h,this.pos.from,this.pos.to,j),this.pos.to=m(this.pos.from.line+h.length-1,h[h.length-1].length+(h.length==1?this.pos.from.ch:0))}}},d.defineExtension("getSearchCursor",function(A,j,h){return new q(this.doc,A,j,h)}),d.defineDocExtension("getSearchCursor",function(A,j,h){return new q(this,A,j,h)}),d.defineExtension("selectMatches",function(A,j){for(var h=[],_=this.getSearchCursor(A,this.getCursor("from"),j);_.findNext()&&!(d.cmpPos(_.to(),this.getCursor("to"))>0);)h.push({anchor:_.from(),head:_.to()});h.length&&this.setSelections(h,0)})})}()),searchcursor.exports}var matchbrackets={exports:{}},hasRequiredMatchbrackets;function requireMatchbrackets(){return hasRequiredMatchbrackets||(hasRequiredMatchbrackets=1,function(b,y){(function(d){d(requireCodemirror())})(function(d){var m=/MSIE \d/.test(navigator.userAgent)&&(document.documentMode==null||document.documentMode<8),S=d.Pos,P={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};function ie(D){return D&&D.bracketRegex||/[(){}[\]]/}function Q(D,se,ve){var Ge=D.getLineHandle(se.line),qe=se.ch-1,q=ve&&ve.afterCursor;q==null&&(q=/(^| )cm-fat-cursor($| )/.test(D.getWrapperElement().className));var A=ie(ve),j=!q&&qe>=0&&A.test(Ge.text.charAt(qe))&&P[Ge.text.charAt(qe)]||A.test(Ge.text.charAt(qe+1))&&P[Ge.text.charAt(++qe)];if(!j)return null;var h=j.charAt(1)==">"?1:-1;if(ve&&ve.strict&&h>0!=(qe==se.ch))return null;var _=D.getTokenTypeAt(S(se.line,qe+1)),G=he(D,S(se.line,qe+(h>0?1:0)),h,_,ve);return G==null?null:{from:S(se.line,qe),to:G&&G.pos,match:G&&G.ch==j.charAt(0),forward:h>0}}function he(D,se,ve,Ge,qe){for(var q=qe&&qe.maxScanLineLength||1e4,A=qe&&qe.maxScanLines||1e3,j=[],h=ie(qe),_=ve>0?Math.min(se.line+A,D.lastLine()+1):Math.max(D.firstLine()-1,se.line-A),G=se.line;G!=_;G+=ve){var U=D.getLine(G);if(U){var ae=ve>0?0:U.length-1,we=ve>0?U.length:-1;if(!(U.length>q))for(G==se.line&&(ae=se.ch-(ve<0?1:0));ae!=we;ae+=ve){var Ne=U.charAt(ae);if(h.test(Ne)&&(Ge===void 0||(D.getTokenTypeAt(S(G,ae+1))||"")==(Ge||""))){var ke=P[Ne];if(ke&&ke.charAt(1)==">"==ve>0)j.push(Ne);else if(j.length)j.pop();else return{pos:S(G,ae),ch:Ne}}}}}return G-ve==(ve>0?D.lastLine():D.firstLine())?!1:null}function te(D,se,ve){for(var Ge=D.state.matchBrackets.maxHighlightLineLength||1e3,qe=ve&&ve.highlightNonMatching,q=[],A=D.listSelections(),j=0;j<A.length;j++){var h=A[j].empty()&&Q(D,A[j].head,ve);if(h&&(h.match||qe!==!1)&&D.getLine(h.from.line).length<=Ge){var _=h.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";q.push(D.markText(h.from,S(h.from.line,h.from.ch+1),{className:_})),h.to&&D.getLine(h.to.line).length<=Ge&&q.push(D.markText(h.to,S(h.to.line,h.to.ch+1),{className:_}))}}if(q.length){m&&D.state.focused&&D.focus();var G=function(){D.operation(function(){for(var U=0;U<q.length;U++)q[U].clear()})};if(se)setTimeout(G,800);else return G}}function z(D){D.operation(function(){D.state.matchBrackets.currentlyHighlighted&&(D.state.matchBrackets.currentlyHighlighted(),D.state.matchBrackets.currentlyHighlighted=null),D.state.matchBrackets.currentlyHighlighted=te(D,!1,D.state.matchBrackets)})}function ue(D){D.state.matchBrackets&&D.state.matchBrackets.currentlyHighlighted&&(D.state.matchBrackets.currentlyHighlighted(),D.state.matchBrackets.currentlyHighlighted=null)}d.defineOption("matchBrackets",!1,function(D,se,ve){ve&&ve!=d.Init&&(D.off("cursorActivity",z),D.off("focus",z),D.off("blur",ue),ue(D)),se&&(D.state.matchBrackets=typeof se=="object"?se:{},D.on("cursorActivity",z),D.on("focus",z),D.on("blur",ue))}),d.defineExtension("matchBrackets",function(){te(this,!0)}),d.defineExtension("findMatchingBracket",function(D,se,ve){return(ve||typeof se=="boolean")&&(ve?(ve.strict=se,se=ve):se=se?{strict:!0}:null),Q(this,D,se)}),d.defineExtension("scanForBracket",function(D,se,ve,Ge){return he(this,D,se,ve,Ge)})})}()),matchbrackets.exports}var hasRequiredSublime;function requireSublime(){return hasRequiredSublime||(hasRequiredSublime=1,function(b,y){(function(d){d(requireCodemirror(),requireSearchcursor(),requireMatchbrackets())})(function(d){var m=d.commands,S=d.Pos;function P(h,_,G){if(G<0&&_.ch==0)return h.clipPos(S(_.line-1));var U=h.getLine(_.line);if(G>0&&_.ch>=U.length)return h.clipPos(S(_.line+1,0));for(var ae="start",we,Ne=_.ch,ke=Ne,We=G<0?0:U.length,C=0;ke!=We;ke+=G,C++){var E=U.charAt(G<0?ke-1:ke),p=E!="_"&&d.isWordChar(E)?"w":"o";if(p=="w"&&E.toUpperCase()==E&&(p="W"),ae=="start")p!="o"?(ae="in",we=p):Ne=ke+G;else if(ae=="in"&&we!=p){if(we=="w"&&p=="W"&&G<0&&ke--,we=="W"&&p=="w"&&G>0)if(ke==Ne+1){we="w";continue}else ke--;break}}return S(_.line,ke)}function ie(h,_){h.extendSelectionsBy(function(G){return h.display.shift||h.doc.extend||G.empty()?P(h.doc,G.head,_):_<0?G.from():G.to()})}m.goSubwordLeft=function(h){ie(h,-1)},m.goSubwordRight=function(h){ie(h,1)},m.scrollLineUp=function(h){var _=h.getScrollInfo();if(!h.somethingSelected()){var G=h.lineAtHeight(_.top+_.clientHeight,"local");h.getCursor().line>=G&&h.execCommand("goLineUp")}h.scrollTo(null,_.top-h.defaultTextHeight())},m.scrollLineDown=function(h){var _=h.getScrollInfo();if(!h.somethingSelected()){var G=h.lineAtHeight(_.top,"local")+1;h.getCursor().line<=G&&h.execCommand("goLineDown")}h.scrollTo(null,_.top+h.defaultTextHeight())},m.splitSelectionByLine=function(h){for(var _=h.listSelections(),G=[],U=0;U<_.length;U++)for(var ae=_[U].from(),we=_[U].to(),Ne=ae.line;Ne<=we.line;++Ne)we.line>ae.line&&Ne==we.line&&we.ch==0||G.push({anchor:Ne==ae.line?ae:S(Ne,0),head:Ne==we.line?we:S(Ne)});h.setSelections(G,0)},m.singleSelectionTop=function(h){var _=h.listSelections()[0];h.setSelection(_.anchor,_.head,{scroll:!1})},m.selectLine=function(h){for(var _=h.listSelections(),G=[],U=0;U<_.length;U++){var ae=_[U];G.push({anchor:S(ae.from().line,0),head:S(ae.to().line+1,0)})}h.setSelections(G)};function Q(h,_){if(h.isReadOnly())return d.Pass;h.operation(function(){for(var G=h.listSelections().length,U=[],ae=-1,we=0;we<G;we++){var Ne=h.listSelections()[we].head;if(!(Ne.line<=ae)){var ke=S(Ne.line+(_?0:1),0);h.replaceRange(`
`,ke,null,"+insertLine"),h.indentLine(ke.line,null,!0),U.push({head:ke,anchor:ke}),ae=Ne.line+1}}h.setSelections(U)}),h.execCommand("indentAuto")}m.insertLineAfter=function(h){return Q(h,!1)},m.insertLineBefore=function(h){return Q(h,!0)};function he(h,_){for(var G=_.ch,U=G,ae=h.getLine(_.line);G&&d.isWordChar(ae.charAt(G-1));)--G;for(;U<ae.length&&d.isWordChar(ae.charAt(U));)++U;return{from:S(_.line,G),to:S(_.line,U),word:ae.slice(G,U)}}m.selectNextOccurrence=function(h){var _=h.getCursor("from"),G=h.getCursor("to"),U=h.state.sublimeFindFullWord==h.doc.sel;if(d.cmpPos(_,G)==0){var ae=he(h,_);if(!ae.word)return;h.setSelection(ae.from,ae.to),U=!0}else{var we=h.getRange(_,G),Ne=U?new RegExp("\\b"+we+"\\b"):we,ke=h.getSearchCursor(Ne,G),We=ke.findNext();if(We||(ke=h.getSearchCursor(Ne,S(h.firstLine(),0)),We=ke.findNext()),!We||z(h.listSelections(),ke.from(),ke.to()))return;h.addSelection(ke.from(),ke.to())}U&&(h.state.sublimeFindFullWord=h.doc.sel)},m.skipAndSelectNextOccurrence=function(h){var _=h.getCursor("anchor"),G=h.getCursor("head");m.selectNextOccurrence(h),d.cmpPos(_,G)!=0&&h.doc.setSelections(h.doc.listSelections().filter(function(U){return U.anchor!=_||U.head!=G}))};function te(h,_){for(var G=h.listSelections(),U=[],ae=0;ae<G.length;ae++){var we=G[ae],Ne=h.findPosV(we.anchor,_,"line",we.anchor.goalColumn),ke=h.findPosV(we.head,_,"line",we.head.goalColumn);Ne.goalColumn=we.anchor.goalColumn!=null?we.anchor.goalColumn:h.cursorCoords(we.anchor,"div").left,ke.goalColumn=we.head.goalColumn!=null?we.head.goalColumn:h.cursorCoords(we.head,"div").left;var We={anchor:Ne,head:ke};U.push(we),U.push(We)}h.setSelections(U)}m.addCursorToPrevLine=function(h){te(h,-1)},m.addCursorToNextLine=function(h){te(h,1)};function z(h,_,G){for(var U=0;U<h.length;U++)if(d.cmpPos(h[U].from(),_)==0&&d.cmpPos(h[U].to(),G)==0)return!0;return!1}var ue="(){}[]";function D(h){for(var _=h.listSelections(),G=[],U=0;U<_.length;U++){var ae=_[U],we=ae.head,Ne=h.scanForBracket(we,-1);if(!Ne)return!1;for(;;){var ke=h.scanForBracket(we,1);if(!ke)return!1;if(ke.ch==ue.charAt(ue.indexOf(Ne.ch)+1)){var We=S(Ne.pos.line,Ne.pos.ch+1);if(d.cmpPos(We,ae.from())==0&&d.cmpPos(ke.pos,ae.to())==0){if(Ne=h.scanForBracket(Ne.pos,-1),!Ne)return!1}else{G.push({anchor:We,head:ke.pos});break}}we=S(ke.pos.line,ke.pos.ch+1)}}return h.setSelections(G),!0}m.selectScope=function(h){D(h)||h.execCommand("selectAll")},m.selectBetweenBrackets=function(h){if(!D(h))return d.Pass};function se(h){return h?/\bpunctuation\b/.test(h)?h:void 0:null}m.goToBracket=function(h){h.extendSelectionsBy(function(_){var G=h.scanForBracket(_.head,1,se(h.getTokenTypeAt(_.head)));if(G&&d.cmpPos(G.pos,_.head)!=0)return G.pos;var U=h.scanForBracket(_.head,-1,se(h.getTokenTypeAt(S(_.head.line,_.head.ch+1))));return U&&S(U.pos.line,U.pos.ch+1)||_.head})},m.swapLineUp=function(h){if(h.isReadOnly())return d.Pass;for(var _=h.listSelections(),G=[],U=h.firstLine()-1,ae=[],we=0;we<_.length;we++){var Ne=_[we],ke=Ne.from().line-1,We=Ne.to().line;ae.push({anchor:S(Ne.anchor.line-1,Ne.anchor.ch),head:S(Ne.head.line-1,Ne.head.ch)}),Ne.to().ch==0&&!Ne.empty()&&--We,ke>U?G.push(ke,We):G.length&&(G[G.length-1]=We),U=We}h.operation(function(){for(var C=0;C<G.length;C+=2){var E=G[C],p=G[C+1],Z=h.getLine(E);h.replaceRange("",S(E,0),S(E+1,0),"+swapLine"),p>h.lastLine()?h.replaceRange(`
`+Z,S(h.lastLine()),null,"+swapLine"):h.replaceRange(Z+`
`,S(p,0),null,"+swapLine")}h.setSelections(ae),h.scrollIntoView()})},m.swapLineDown=function(h){if(h.isReadOnly())return d.Pass;for(var _=h.listSelections(),G=[],U=h.lastLine()+1,ae=_.length-1;ae>=0;ae--){var we=_[ae],Ne=we.to().line+1,ke=we.from().line;we.to().ch==0&&!we.empty()&&Ne--,Ne<U?G.push(Ne,ke):G.length&&(G[G.length-1]=ke),U=ke}h.operation(function(){for(var We=G.length-2;We>=0;We-=2){var C=G[We],E=G[We+1],p=h.getLine(C);C==h.lastLine()?h.replaceRange("",S(C-1),S(C),"+swapLine"):h.replaceRange("",S(C,0),S(C+1,0),"+swapLine"),h.replaceRange(p+`
`,S(E,0),null,"+swapLine")}h.scrollIntoView()})},m.toggleCommentIndented=function(h){h.toggleComment({indent:!0})},m.joinLines=function(h){for(var _=h.listSelections(),G=[],U=0;U<_.length;U++){for(var ae=_[U],we=ae.from(),Ne=we.line,ke=ae.to().line;U<_.length-1&&_[U+1].from().line==ke;)ke=_[++U].to().line;G.push({start:Ne,end:ke,anchor:!ae.empty()&&we})}h.operation(function(){for(var We=0,C=[],E=0;E<G.length;E++){for(var p=G[E],Z=p.anchor&&S(p.anchor.line-We,p.anchor.ch),ye,Pe=p.start;Pe<=p.end;Pe++){var Ve=Pe-We;Pe==p.end&&(ye=S(Ve,h.getLine(Ve).length+1)),Ve<h.lastLine()&&(h.replaceRange(" ",S(Ve),S(Ve+1,/^\s*/.exec(h.getLine(Ve+1))[0].length)),++We)}C.push({anchor:Z||ye,head:ye})}h.setSelections(C,0)})},m.duplicateLine=function(h){h.operation(function(){for(var _=h.listSelections().length,G=0;G<_;G++){var U=h.listSelections()[G];U.empty()?h.replaceRange(h.getLine(U.head.line)+`
`,S(U.head.line,0)):h.replaceRange(h.getRange(U.from(),U.to()),U.from())}h.scrollIntoView()})};function ve(h,_,G){if(h.isReadOnly())return d.Pass;for(var U=h.listSelections(),ae=[],we,Ne=0;Ne<U.length;Ne++){var ke=U[Ne];if(!ke.empty()){for(var We=ke.from().line,C=ke.to().line;Ne<U.length-1&&U[Ne+1].from().line==C;)C=U[++Ne].to().line;U[Ne].to().ch||C--,ae.push(We,C)}}ae.length?we=!0:ae.push(h.firstLine(),h.lastLine()),h.operation(function(){for(var E=[],p=0;p<ae.length;p+=2){var Z=ae[p],ye=ae[p+1],Pe=S(Z,0),Ve=S(ye),$e=h.getRange(Pe,Ve,!1);_?$e.sort(function(Ye,Je){return Ye<Je?-G:Ye==Je?0:G}):$e.sort(function(Ye,Je){var at=Ye.toUpperCase(),Ot=Je.toUpperCase();return at!=Ot&&(Ye=at,Je=Ot),Ye<Je?-G:Ye==Je?0:G}),h.replaceRange($e,Pe,Ve),we&&E.push({anchor:Pe,head:S(ye+1,0)})}we&&h.setSelections(E,0)})}m.sortLines=function(h){ve(h,!0,1)},m.reverseSortLines=function(h){ve(h,!0,-1)},m.sortLinesInsensitive=function(h){ve(h,!1,1)},m.reverseSortLinesInsensitive=function(h){ve(h,!1,-1)},m.nextBookmark=function(h){var _=h.state.sublimeBookmarks;if(_)for(;_.length;){var G=_.shift(),U=G.find();if(U)return _.push(G),h.setSelection(U.from,U.to)}},m.prevBookmark=function(h){var _=h.state.sublimeBookmarks;if(_)for(;_.length;){_.unshift(_.pop());var G=_[_.length-1].find();if(!G)_.pop();else return h.setSelection(G.from,G.to)}},m.toggleBookmark=function(h){for(var _=h.listSelections(),G=h.state.sublimeBookmarks||(h.state.sublimeBookmarks=[]),U=0;U<_.length;U++){for(var ae=_[U].from(),we=_[U].to(),Ne=_[U].empty()?h.findMarksAt(ae):h.findMarks(ae,we),ke=0;ke<Ne.length;ke++)if(Ne[ke].sublimeBookmark){Ne[ke].clear();for(var We=0;We<G.length;We++)G[We]==Ne[ke]&&G.splice(We--,1);break}ke==Ne.length&&G.push(h.markText(ae,we,{sublimeBookmark:!0,clearWhenEmpty:!1}))}},m.clearBookmarks=function(h){var _=h.state.sublimeBookmarks;if(_)for(var G=0;G<_.length;G++)_[G].clear();_.length=0},m.selectBookmarks=function(h){var _=h.state.sublimeBookmarks,G=[];if(_)for(var U=0;U<_.length;U++){var ae=_[U].find();ae?G.push({anchor:ae.from,head:ae.to}):_.splice(U--,0)}G.length&&h.setSelections(G,0)};function Ge(h,_){h.operation(function(){for(var G=h.listSelections(),U=[],ae=[],we=0;we<G.length;we++){var Ne=G[we];Ne.empty()?(U.push(we),ae.push("")):ae.push(_(h.getRange(Ne.from(),Ne.to())))}h.replaceSelections(ae,"around","case");for(var we=U.length-1,ke;we>=0;we--){var Ne=G[U[we]];if(!(ke&&d.cmpPos(Ne.head,ke)>0)){var We=he(h,Ne.head);ke=We.from,h.replaceRange(_(We.word),We.from,We.to)}}})}m.smartBackspace=function(h){if(h.somethingSelected())return d.Pass;h.operation(function(){for(var _=h.listSelections(),G=h.getOption("indentUnit"),U=_.length-1;U>=0;U--){var ae=_[U].head,we=h.getRange({line:ae.line,ch:0},ae),Ne=d.countColumn(we,null,h.getOption("tabSize")),ke=h.findPosH(ae,-1,"char",!1);if(we&&!/\S/.test(we)&&Ne%G==0){var We=new S(ae.line,d.findColumn(we,Ne-G,G));We.ch!=ae.ch&&(ke=We)}h.replaceRange("",ke,ae,"+delete")}})},m.delLineRight=function(h){h.operation(function(){for(var _=h.listSelections(),G=_.length-1;G>=0;G--)h.replaceRange("",_[G].anchor,S(_[G].to().line),"+delete");h.scrollIntoView()})},m.upcaseAtCursor=function(h){Ge(h,function(_){return _.toUpperCase()})},m.downcaseAtCursor=function(h){Ge(h,function(_){return _.toLowerCase()})},m.setSublimeMark=function(h){h.state.sublimeMark&&h.state.sublimeMark.clear(),h.state.sublimeMark=h.setBookmark(h.getCursor())},m.selectToSublimeMark=function(h){var _=h.state.sublimeMark&&h.state.sublimeMark.find();_&&h.setSelection(h.getCursor(),_)},m.deleteToSublimeMark=function(h){var _=h.state.sublimeMark&&h.state.sublimeMark.find();if(_){var G=h.getCursor(),U=_;if(d.cmpPos(G,U)>0){var ae=U;U=G,G=ae}h.state.sublimeKilled=h.getRange(G,U),h.replaceRange("",G,U)}},m.swapWithSublimeMark=function(h){var _=h.state.sublimeMark&&h.state.sublimeMark.find();_&&(h.state.sublimeMark.clear(),h.state.sublimeMark=h.setBookmark(h.getCursor()),h.setCursor(_))},m.sublimeYank=function(h){h.state.sublimeKilled!=null&&h.replaceSelection(h.state.sublimeKilled,null,"paste")},m.showInCenter=function(h){var _=h.cursorCoords(null,"local");h.scrollTo(null,(_.top+_.bottom)/2-h.getScrollInfo().clientHeight/2)};function qe(h){var _=h.getCursor("from"),G=h.getCursor("to");if(d.cmpPos(_,G)==0){var U=he(h,_);if(!U.word)return;_=U.from,G=U.to}return{from:_,to:G,query:h.getRange(_,G),word:U}}function q(h,_){var G=qe(h);if(G){var U=G.query,ae=h.getSearchCursor(U,_?G.to:G.from);(_?ae.findNext():ae.findPrevious())?h.setSelection(ae.from(),ae.to()):(ae=h.getSearchCursor(U,_?S(h.firstLine(),0):h.clipPos(S(h.lastLine()))),(_?ae.findNext():ae.findPrevious())?h.setSelection(ae.from(),ae.to()):G.word&&h.setSelection(G.from,G.to))}}m.findUnder=function(h){q(h,!0)},m.findUnderPrevious=function(h){q(h,!1)},m.findAllUnder=function(h){var _=qe(h);if(_){for(var G=h.getSearchCursor(_.query),U=[],ae=-1;G.findNext();)U.push({anchor:G.from(),head:G.to()}),G.from().line<=_.from.line&&G.from().ch<=_.from.ch&&ae++;h.setSelections(U,ae)}};var A=d.keyMap;A.macSublime={"Cmd-Left":"goLineStartSmart","Shift-Tab":"indentLess","Shift-Ctrl-K":"deleteLine","Alt-Q":"wrapLines","Ctrl-Left":"goSubwordLeft","Ctrl-Right":"goSubwordRight","Ctrl-Alt-Up":"scrollLineUp","Ctrl-Alt-Down":"scrollLineDown","Cmd-L":"selectLine","Shift-Cmd-L":"splitSelectionByLine",Esc:"singleSelectionTop","Cmd-Enter":"insertLineAfter","Shift-Cmd-Enter":"insertLineBefore","Cmd-D":"selectNextOccurrence","Shift-Cmd-Space":"selectScope","Shift-Cmd-M":"selectBetweenBrackets","Cmd-M":"goToBracket","Cmd-Ctrl-Up":"swapLineUp","Cmd-Ctrl-Down":"swapLineDown","Cmd-/":"toggleCommentIndented","Cmd-J":"joinLines","Shift-Cmd-D":"duplicateLine",F5:"sortLines","Shift-F5":"reverseSortLines","Cmd-F5":"sortLinesInsensitive","Shift-Cmd-F5":"reverseSortLinesInsensitive",F2:"nextBookmark","Shift-F2":"prevBookmark","Cmd-F2":"toggleBookmark","Shift-Cmd-F2":"clearBookmarks","Alt-F2":"selectBookmarks",Backspace:"smartBackspace","Cmd-K Cmd-D":"skipAndSelectNextOccurrence","Cmd-K Cmd-K":"delLineRight","Cmd-K Cmd-U":"upcaseAtCursor","Cmd-K Cmd-L":"downcaseAtCursor","Cmd-K Cmd-Space":"setSublimeMark","Cmd-K Cmd-A":"selectToSublimeMark","Cmd-K Cmd-W":"deleteToSublimeMark","Cmd-K Cmd-X":"swapWithSublimeMark","Cmd-K Cmd-Y":"sublimeYank","Cmd-K Cmd-C":"showInCenter","Cmd-K Cmd-G":"clearBookmarks","Cmd-K Cmd-Backspace":"delLineLeft","Cmd-K Cmd-1":"foldAll","Cmd-K Cmd-0":"unfoldAll","Cmd-K Cmd-J":"unfoldAll","Ctrl-Shift-Up":"addCursorToPrevLine","Ctrl-Shift-Down":"addCursorToNextLine","Cmd-F3":"findUnder","Shift-Cmd-F3":"findUnderPrevious","Alt-F3":"findAllUnder","Shift-Cmd-[":"fold","Shift-Cmd-]":"unfold","Cmd-I":"findIncremental","Shift-Cmd-I":"findIncrementalReverse","Cmd-H":"replace",F3:"findNext","Shift-F3":"findPrev",fallthrough:"macDefault"},d.normalizeKeyMap(A.macSublime),A.pcSublime={"Shift-Tab":"indentLess","Shift-Ctrl-K":"deleteLine","Alt-Q":"wrapLines","Ctrl-T":"transposeChars","Alt-Left":"goSubwordLeft","Alt-Right":"goSubwordRight","Ctrl-Up":"scrollLineUp","Ctrl-Down":"scrollLineDown","Ctrl-L":"selectLine","Shift-Ctrl-L":"splitSelectionByLine",Esc:"singleSelectionTop","Ctrl-Enter":"insertLineAfter","Shift-Ctrl-Enter":"insertLineBefore","Ctrl-D":"selectNextOccurrence","Shift-Ctrl-Space":"selectScope","Shift-Ctrl-M":"selectBetweenBrackets","Ctrl-M":"goToBracket","Shift-Ctrl-Up":"swapLineUp","Shift-Ctrl-Down":"swapLineDown","Ctrl-/":"toggleCommentIndented","Ctrl-J":"joinLines","Shift-Ctrl-D":"duplicateLine",F9:"sortLines","Shift-F9":"reverseSortLines","Ctrl-F9":"sortLinesInsensitive","Shift-Ctrl-F9":"reverseSortLinesInsensitive",F2:"nextBookmark","Shift-F2":"prevBookmark","Ctrl-F2":"toggleBookmark","Shift-Ctrl-F2":"clearBookmarks","Alt-F2":"selectBookmarks",Backspace:"smartBackspace","Ctrl-K Ctrl-D":"skipAndSelectNextOccurrence","Ctrl-K Ctrl-K":"delLineRight","Ctrl-K Ctrl-U":"upcaseAtCursor","Ctrl-K Ctrl-L":"downcaseAtCursor","Ctrl-K Ctrl-Space":"setSublimeMark","Ctrl-K Ctrl-A":"selectToSublimeMark","Ctrl-K Ctrl-W":"deleteToSublimeMark","Ctrl-K Ctrl-X":"swapWithSublimeMark","Ctrl-K Ctrl-Y":"sublimeYank","Ctrl-K Ctrl-C":"showInCenter","Ctrl-K Ctrl-G":"clearBookmarks","Ctrl-K Ctrl-Backspace":"delLineLeft","Ctrl-K Ctrl-1":"foldAll","Ctrl-K Ctrl-0":"unfoldAll","Ctrl-K Ctrl-J":"unfoldAll","Ctrl-Alt-Up":"addCursorToPrevLine","Ctrl-Alt-Down":"addCursorToNextLine","Ctrl-F3":"findUnder","Shift-Ctrl-F3":"findUnderPrevious","Alt-F3":"findAllUnder","Shift-Ctrl-[":"fold","Shift-Ctrl-]":"unfold","Ctrl-I":"findIncremental","Shift-Ctrl-I":"findIncrementalReverse","Ctrl-H":"replace",F3:"findNext","Shift-F3":"findPrev",fallthrough:"pcDefault"},d.normalizeKeyMap(A.pcSublime);var j=A.default==A.macDefault;A.sublime=j?A.macSublime:A.pcSublime})}()),sublime.exports}requireSublime();requireMatchbrackets();var closebrackets={exports:{}},hasRequiredClosebrackets;function requireClosebrackets(){return hasRequiredClosebrackets||(hasRequiredClosebrackets=1,function(b,y){(function(d){d(requireCodemirror())})(function(d){var m={pairs:`()[]{}''""`,closeBefore:`)]}'":;>`,triples:"",explode:"[]{}"},S=d.Pos;d.defineOption("autoCloseBrackets",!1,function(q,A,j){j&&j!=d.Init&&(q.removeKeyMap(ie),q.state.closeBrackets=null),A&&(Q(P(A,"pairs")),q.state.closeBrackets=A,q.addKeyMap(ie))});function P(q,A){return A=="pairs"&&typeof q=="string"?q:typeof q=="object"&&q[A]!=null?q[A]:m[A]}var ie={Backspace:z,Enter:ue};function Q(q){for(var A=0;A<q.length;A++){var j=q.charAt(A),h="'"+j+"'";ie[h]||(ie[h]=he(j))}}Q(m.pairs+"`");function he(q){return function(A){return ve(A,q)}}function te(q){var A=q.state.closeBrackets;if(!A||A.override)return A;var j=q.getModeAt(q.getCursor());return j.closeBrackets||A}function z(q){var A=te(q);if(!A||q.getOption("disableInput"))return d.Pass;for(var j=P(A,"pairs"),h=q.listSelections(),_=0;_<h.length;_++){if(!h[_].empty())return d.Pass;var G=Ge(q,h[_].head);if(!G||j.indexOf(G)%2!=0)return d.Pass}for(var _=h.length-1;_>=0;_--){var U=h[_].head;q.replaceRange("",S(U.line,U.ch-1),S(U.line,U.ch+1),"+delete")}}function ue(q){var A=te(q),j=A&&P(A,"explode");if(!j||q.getOption("disableInput"))return d.Pass;for(var h=q.listSelections(),_=0;_<h.length;_++){if(!h[_].empty())return d.Pass;var G=Ge(q,h[_].head);if(!G||j.indexOf(G)%2!=0)return d.Pass}q.operation(function(){var U=q.lineSeparator()||`
`;q.replaceSelection(U+U,null),D(q,-1),h=q.listSelections();for(var ae=0;ae<h.length;ae++){var we=h[ae].head.line;q.indentLine(we,null,!0),q.indentLine(we+1,null,!0)}})}function D(q,A){for(var j=[],h=q.listSelections(),_=0,G=0;G<h.length;G++){var U=h[G];U.head==q.getCursor()&&(_=G);var ae=U.head.ch||A>0?{line:U.head.line,ch:U.head.ch+A}:{line:U.head.line-1};j.push({anchor:ae,head:ae})}q.setSelections(j,_)}function se(q){var A=d.cmpPos(q.anchor,q.head)>0;return{anchor:new S(q.anchor.line,q.anchor.ch+(A?-1:1)),head:new S(q.head.line,q.head.ch+(A?1:-1))}}function ve(q,A){var j=te(q);if(!j||q.getOption("disableInput"))return d.Pass;var h=P(j,"pairs"),_=h.indexOf(A);if(_==-1)return d.Pass;for(var G=P(j,"closeBefore"),U=P(j,"triples"),ae=h.charAt(_+1)==A,we=q.listSelections(),Ne=_%2==0,ke,We=0;We<we.length;We++){var C=we[We],E=C.head,p,Z=q.getRange(E,S(E.line,E.ch+1));if(Ne&&!C.empty())p="surround";else if((ae||!Ne)&&Z==A)ae&&qe(q,E)?p="both":U.indexOf(A)>=0&&q.getRange(E,S(E.line,E.ch+3))==A+A+A?p="skipThree":p="skip";else if(ae&&E.ch>1&&U.indexOf(A)>=0&&q.getRange(S(E.line,E.ch-2),E)==A+A){if(E.ch>2&&/\bstring/.test(q.getTokenTypeAt(S(E.line,E.ch-2))))return d.Pass;p="addFour"}else if(ae){var ye=E.ch==0?" ":q.getRange(S(E.line,E.ch-1),E);if(!d.isWordChar(Z)&&ye!=A&&!d.isWordChar(ye))p="both";else return d.Pass}else if(Ne&&(Z.length===0||/\s/.test(Z)||G.indexOf(Z)>-1))p="both";else return d.Pass;if(!ke)ke=p;else if(ke!=p)return d.Pass}var Pe=_%2?h.charAt(_-1):A,Ve=_%2?A:h.charAt(_+1);q.operation(function(){if(ke=="skip")D(q,1);else if(ke=="skipThree")D(q,3);else if(ke=="surround"){for(var $e=q.getSelections(),Ye=0;Ye<$e.length;Ye++)$e[Ye]=Pe+$e[Ye]+Ve;q.replaceSelections($e,"around"),$e=q.listSelections().slice();for(var Ye=0;Ye<$e.length;Ye++)$e[Ye]=se($e[Ye]);q.setSelections($e)}else ke=="both"?(q.replaceSelection(Pe+Ve,null),q.triggerElectric(Pe+Ve),D(q,-1)):ke=="addFour"&&(q.replaceSelection(Pe+Pe+Pe+Pe,"before"),D(q,1))})}function Ge(q,A){var j=q.getRange(S(A.line,A.ch-1),S(A.line,A.ch+1));return j.length==2?j:null}function qe(q,A){var j=q.getTokenAt(S(A.line,A.ch+1));return/\bstring/.test(j.type)&&j.start==A.ch&&(A.ch==0||!/\bstring/.test(q.getTokenTypeAt(A)))}})}()),closebrackets.exports}requireClosebrackets();var comment={exports:{}},hasRequiredComment;function requireComment(){return hasRequiredComment||(hasRequiredComment=1,function(b,y){(function(d){d(requireCodemirror())})(function(d){var m={},S=/[^\s\u00a0]/,P=d.Pos,ie=d.cmpPos;function Q(z){var ue=z.search(S);return ue==-1?0:ue}d.commands.toggleComment=function(z){z.toggleComment()},d.defineExtension("toggleComment",function(z){z||(z=m);for(var ue=this,D=1/0,se=this.listSelections(),ve=null,Ge=se.length-1;Ge>=0;Ge--){var qe=se[Ge].from(),q=se[Ge].to();qe.line>=D||(q.line>=D&&(q=P(D,0)),D=qe.line,ve==null?ue.uncomment(qe,q,z)?ve="un":(ue.lineComment(qe,q,z),ve="line"):ve=="un"?ue.uncomment(qe,q,z):ue.lineComment(qe,q,z))}});function he(z,ue,D){return/\bstring\b/.test(z.getTokenTypeAt(P(ue.line,0)))&&!/^[\'\"\`]/.test(D)}function te(z,ue){var D=z.getMode();return D.useInnerComments===!1||!D.innerMode?D:z.getModeAt(ue)}d.defineExtension("lineComment",function(z,ue,D){D||(D=m);var se=this,ve=te(se,z),Ge=se.getLine(z.line);if(!(Ge==null||he(se,z,Ge))){var qe=D.lineComment||ve.lineComment;if(!qe){(D.blockCommentStart||ve.blockCommentStart)&&(D.fullLines=!0,se.blockComment(z,ue,D));return}var q=Math.min(ue.ch!=0||ue.line==z.line?ue.line+1:ue.line,se.lastLine()+1),A=D.padding==null?" ":D.padding,j=D.commentBlankLines||z.line==ue.line;se.operation(function(){if(D.indent){for(var h=null,_=z.line;_<q;++_){var G=se.getLine(_),U=G.search(S)===-1?G:G.slice(0,Q(G));(h==null||h.length>U.length)&&(h=U)}for(var _=z.line;_<q;++_){var G=se.getLine(_),ae=h.length;!j&&!S.test(G)||(G.slice(0,ae)!=h&&(ae=Q(G)),se.replaceRange(h+qe+A,P(_,0),P(_,ae)))}}else for(var _=z.line;_<q;++_)(j||S.test(se.getLine(_)))&&se.replaceRange(qe+A,P(_,0))})}}),d.defineExtension("blockComment",function(z,ue,D){D||(D=m);var se=this,ve=te(se,z),Ge=D.blockCommentStart||ve.blockCommentStart,qe=D.blockCommentEnd||ve.blockCommentEnd;if(!Ge||!qe){(D.lineComment||ve.lineComment)&&D.fullLines!=!1&&se.lineComment(z,ue,D);return}if(!/\bcomment\b/.test(se.getTokenTypeAt(P(z.line,0)))){var q=Math.min(ue.line,se.lastLine());q!=z.line&&ue.ch==0&&S.test(se.getLine(q))&&--q;var A=D.padding==null?" ":D.padding;z.line>q||se.operation(function(){if(D.fullLines!=!1){var j=S.test(se.getLine(q));se.replaceRange(A+qe,P(q)),se.replaceRange(Ge+A,P(z.line,0));var h=D.blockCommentLead||ve.blockCommentLead;if(h!=null)for(var _=z.line+1;_<=q;++_)(_!=q||j)&&se.replaceRange(h+A,P(_,0))}else{var G=ie(se.getCursor("to"),ue)==0,U=!se.somethingSelected();se.replaceRange(qe,ue),G&&se.setSelection(U?ue:se.getCursor("from"),ue),se.replaceRange(Ge,z)}})}}),d.defineExtension("uncomment",function(z,ue,D){D||(D=m);var se=this,ve=te(se,z),Ge=Math.min(ue.ch!=0||ue.line==z.line?ue.line:ue.line-1,se.lastLine()),qe=Math.min(z.line,Ge),q=D.lineComment||ve.lineComment,A=[],j=D.padding==null?" ":D.padding,h;e:{if(!q)break e;for(var _=qe;_<=Ge;++_){var G=se.getLine(_),U=G.indexOf(q);if(U>-1&&!/comment/.test(se.getTokenTypeAt(P(_,U+1)))&&(U=-1),U==-1&&S.test(G)||U>-1&&S.test(G.slice(0,U)))break e;A.push(G)}if(se.operation(function(){for(var $e=qe;$e<=Ge;++$e){var Ye=A[$e-qe],Je=Ye.indexOf(q),at=Je+q.length;Je<0||(Ye.slice(at,at+j.length)==j&&(at+=j.length),h=!0,se.replaceRange("",P($e,Je),P($e,at)))}}),h)return!0}var ae=D.blockCommentStart||ve.blockCommentStart,we=D.blockCommentEnd||ve.blockCommentEnd;if(!ae||!we)return!1;var Ne=D.blockCommentLead||ve.blockCommentLead,ke=se.getLine(qe),We=ke.indexOf(ae);if(We==-1)return!1;var C=Ge==qe?ke:se.getLine(Ge),E=C.indexOf(we,Ge==qe?We+ae.length:0),p=P(qe,We+1),Z=P(Ge,E+1);if(E==-1||!/comment/.test(se.getTokenTypeAt(p))||!/comment/.test(se.getTokenTypeAt(Z))||se.getRange(p,Z,`
`).indexOf(we)>-1)return!1;var ye=ke.lastIndexOf(ae,z.ch),Pe=ye==-1?-1:ke.slice(0,z.ch).indexOf(we,ye+ae.length);if(ye!=-1&&Pe!=-1&&Pe+we.length!=z.ch)return!1;Pe=C.indexOf(we,ue.ch);var Ve=C.slice(ue.ch).lastIndexOf(ae,Pe-ue.ch);return ye=Pe==-1||Ve==-1?-1:ue.ch+Ve,Pe!=-1&&ye!=-1&&ye!=ue.ch?!1:(se.operation(function(){se.replaceRange("",P(Ge,E-(j&&C.slice(E-j.length,E)==j?j.length:0)),P(Ge,E+we.length));var $e=We+ae.length;if(j&&ke.slice($e,$e+j.length)==j&&($e+=j.length),se.replaceRange("",P(qe,We),P(qe,$e)),Ne)for(var Ye=qe+1;Ye<=Ge;++Ye){var Je=se.getLine(Ye),at=Je.indexOf(Ne);if(!(at==-1||S.test(Je.slice(0,at)))){var Ot=at+Ne.length;j&&Je.slice(Ot,Ot+j.length)==j&&(Ot+=j.length),se.replaceRange("",P(Ye,at),P(Ye,Ot))}}}),!0)})})}()),comment.exports}requireComment();var showHint={exports:{}},hasRequiredShowHint;function requireShowHint(){return hasRequiredShowHint||(hasRequiredShowHint=1,function(b,y){(function(d){d(requireCodemirror())})(function(d){var m="CodeMirror-hint",S="CodeMirror-hint-active";d.showHint=function(q,A,j){if(!A)return q.showHint(j);j&&j.async&&(A.async=!0);var h={hint:A};if(j)for(var _ in j)h[_]=j[_];return q.showHint(h)},d.defineExtension("showHint",function(q){q=he(this,this.getCursor("start"),q);var A=this.listSelections();if(!(A.length>1)){if(this.somethingSelected()){if(!q.hint.supportsSelection)return;for(var j=0;j<A.length;j++)if(A[j].head.line!=A[j].anchor.line)return}this.state.completionActive&&this.state.completionActive.close();var h=this.state.completionActive=new P(this,q);h.options.hint&&(d.signal(this,"startCompletion",this),h.update(!0))}}),d.defineExtension("closeHint",function(){this.state.completionActive&&this.state.completionActive.close()});function P(q,A){if(this.cm=q,this.options=A,this.widget=null,this.debounce=0,this.tick=0,this.startPos=this.cm.getCursor("start"),this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length,this.options.updateOnCursorActivity){var j=this;q.on("cursorActivity",this.activityFunc=function(){j.cursorActivity()})}}var ie=window.requestAnimationFrame||function(q){return setTimeout(q,1e3/60)},Q=window.cancelAnimationFrame||clearTimeout;P.prototype={close:function(){this.active()&&(this.cm.state.completionActive=null,this.tick=null,this.options.updateOnCursorActivity&&this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.data&&d.signal(this.data,"close"),this.widget&&this.widget.close(),d.signal(this.cm,"endCompletion",this.cm))},active:function(){return this.cm.state.completionActive==this},pick:function(q,A){var j=q.list[A],h=this;this.cm.operation(function(){j.hint?j.hint(h.cm,q,j):h.cm.replaceRange(te(j),j.from||q.from,j.to||q.to,"complete"),d.signal(q,"pick",j),h.cm.scrollIntoView()}),this.options.closeOnPick&&this.close()},cursorActivity:function(){this.debounce&&(Q(this.debounce),this.debounce=0);var q=this.startPos;this.data&&(q=this.data.from);var A=this.cm.getCursor(),j=this.cm.getLine(A.line);if(A.line!=this.startPos.line||j.length-A.ch!=this.startLen-this.startPos.ch||A.ch<q.ch||this.cm.somethingSelected()||!A.ch||this.options.closeCharacters.test(j.charAt(A.ch-1)))this.close();else{var h=this;this.debounce=ie(function(){h.update()}),this.widget&&this.widget.disable()}},update:function(q){if(this.tick!=null){var A=this,j=++this.tick;ve(this.options.hint,this.cm,this.options,function(h){A.tick==j&&A.finishUpdate(h,q)})}},finishUpdate:function(q,A){this.data&&d.signal(this.data,"update");var j=this.widget&&this.widget.picked||A&&this.options.completeSingle;this.widget&&this.widget.close(),this.data=q,q&&q.list.length&&(j&&q.list.length==1?this.pick(q,0):(this.widget=new D(this,q),d.signal(q,"shown")))}};function he(q,A,j){var h=q.options.hintOptions,_={};for(var G in qe)_[G]=qe[G];if(h)for(var G in h)h[G]!==void 0&&(_[G]=h[G]);if(j)for(var G in j)j[G]!==void 0&&(_[G]=j[G]);return _.hint.resolve&&(_.hint=_.hint.resolve(q,A)),_}function te(q){return typeof q=="string"?q:q.text}function z(q,A){var j={Up:function(){A.moveFocus(-1)},Down:function(){A.moveFocus(1)},PageUp:function(){A.moveFocus(-A.menuSize()+1,!0)},PageDown:function(){A.moveFocus(A.menuSize()-1,!0)},Home:function(){A.setFocus(0)},End:function(){A.setFocus(A.length-1)},Enter:A.pick,Tab:A.pick,Esc:A.close},h=/Mac/.test(navigator.platform);h&&(j["Ctrl-P"]=function(){A.moveFocus(-1)},j["Ctrl-N"]=function(){A.moveFocus(1)});var _=q.options.customKeys,G=_?{}:j;function U(Ne,ke){var We;typeof ke!="string"?We=function(C){return ke(C,A)}:j.hasOwnProperty(ke)?We=j[ke]:We=ke,G[Ne]=We}if(_)for(var ae in _)_.hasOwnProperty(ae)&&U(ae,_[ae]);var we=q.options.extraKeys;if(we)for(var ae in we)we.hasOwnProperty(ae)&&U(ae,we[ae]);return G}function ue(q,A){for(;A&&A!=q;){if(A.nodeName.toUpperCase()==="LI"&&A.parentNode==q)return A;A=A.parentNode}}function D(q,A){this.id="cm-complete-"+Math.floor(Math.random(1e6)),this.completion=q,this.data=A,this.picked=!1;var j=this,h=q.cm,_=h.getInputField().ownerDocument,G=_.defaultView||_.parentWindow,U=this.hints=_.createElement("ul");U.setAttribute("role","listbox"),U.setAttribute("aria-expanded","true"),U.id=this.id;var ae=q.cm.options.theme;U.className="CodeMirror-hints "+ae,this.selectedHint=A.selectedHint||0;for(var we=A.list,Ne=0;Ne<we.length;++Ne){var ke=U.appendChild(_.createElement("li")),We=we[Ne],C=m+(Ne!=this.selectedHint?"":" "+S);We.className!=null&&(C=We.className+" "+C),ke.className=C,Ne==this.selectedHint&&ke.setAttribute("aria-selected","true"),ke.id=this.id+"-"+Ne,ke.setAttribute("role","option"),We.render?We.render(ke,A,We):ke.appendChild(_.createTextNode(We.displayText||te(We))),ke.hintId=Ne}var E=q.options.container||_.body,p=h.cursorCoords(q.options.alignWithWord?A.from:null),Z=p.left,ye=p.bottom,Pe=!0,Ve=0,$e=0;if(E!==_.body){var Ye=["absolute","relative","fixed"].indexOf(G.getComputedStyle(E).position)!==-1,Je=Ye?E:E.offsetParent,at=Je.getBoundingClientRect(),Ot=_.body.getBoundingClientRect();Ve=at.left-Ot.left-Je.scrollLeft,$e=at.top-Ot.top-Je.scrollTop}U.style.left=Z-Ve+"px",U.style.top=ye-$e+"px";var st=G.innerWidth||Math.max(_.body.offsetWidth,_.documentElement.offsetWidth),ut=G.innerHeight||Math.max(_.body.offsetHeight,_.documentElement.offsetHeight);E.appendChild(U),h.getInputField().setAttribute("aria-autocomplete","list"),h.getInputField().setAttribute("aria-owns",this.id),h.getInputField().setAttribute("aria-activedescendant",this.id+"-"+this.selectedHint);var tt=q.options.moveOnOverlap?U.getBoundingClientRect():new DOMRect,pt=q.options.paddingForScrollbar?U.scrollHeight>U.clientHeight+1:!1,Ct;setTimeout(function(){Ct=h.getScrollInfo()});var Ht=tt.bottom-ut;if(Ht>0){var ft=tt.bottom-tt.top,Mt=tt.top-(p.bottom-p.top)-2;ut-tt.top<Mt?(ft>Mt&&(U.style.height=(ft=Mt)+"px"),U.style.top=(ye=p.top-ft)+$e+"px",Pe=!1):U.style.height=ut-tt.top-2+"px"}var $t=tt.right-st;if(pt&&($t+=h.display.nativeBarWidth),$t>0&&(tt.right-tt.left>st&&(U.style.width=st-5+"px",$t-=tt.right-tt.left-st),U.style.left=(Z=Math.max(p.left-$t-Ve,0))+"px"),pt)for(var ar=U.firstChild;ar;ar=ar.nextSibling)ar.style.paddingRight=h.display.nativeBarWidth+"px";if(h.addKeyMap(this.keyMap=z(q,{moveFocus:function(Vt,Nt){j.changeActive(j.selectedHint+Vt,Nt)},setFocus:function(Vt){j.changeActive(Vt)},menuSize:function(){return j.screenAmount()},length:we.length,close:function(){q.close()},pick:function(){j.pick()},data:A})),q.options.closeOnUnfocus){var Sr;h.on("blur",this.onBlur=function(){Sr=setTimeout(function(){q.close()},100)}),h.on("focus",this.onFocus=function(){clearTimeout(Sr)})}h.on("scroll",this.onScroll=function(){var Vt=h.getScrollInfo(),Nt=h.getWrapperElement().getBoundingClientRect();Ct||(Ct=h.getScrollInfo());var nn=ye+Ct.top-Vt.top,_t=nn-(G.pageYOffset||(_.documentElement||_.body).scrollTop);if(Pe||(_t+=U.offsetHeight),_t<=Nt.top||_t>=Nt.bottom)return q.close();U.style.top=nn+"px",U.style.left=Z+Ct.left-Vt.left+"px"}),d.on(U,"dblclick",function(Vt){var Nt=ue(U,Vt.target||Vt.srcElement);Nt&&Nt.hintId!=null&&(j.changeActive(Nt.hintId),j.pick())}),d.on(U,"click",function(Vt){var Nt=ue(U,Vt.target||Vt.srcElement);Nt&&Nt.hintId!=null&&(j.changeActive(Nt.hintId),q.options.completeOnSingleClick&&j.pick())}),d.on(U,"mousedown",function(){setTimeout(function(){h.focus()},20)});var ur=this.getSelectedHintRange();return(ur.from!==0||ur.to!==0)&&this.scrollToActive(),d.signal(A,"select",we[this.selectedHint],U.childNodes[this.selectedHint]),!0}D.prototype={close:function(){if(this.completion.widget==this){this.completion.widget=null,this.hints.parentNode&&this.hints.parentNode.removeChild(this.hints),this.completion.cm.removeKeyMap(this.keyMap);var q=this.completion.cm.getInputField();q.removeAttribute("aria-activedescendant"),q.removeAttribute("aria-owns");var A=this.completion.cm;this.completion.options.closeOnUnfocus&&(A.off("blur",this.onBlur),A.off("focus",this.onFocus)),A.off("scroll",this.onScroll)}},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var q=this;this.keyMap={Enter:function(){q.picked=!0}},this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(q,A){if(q>=this.data.list.length?q=A?this.data.list.length-1:0:q<0&&(q=A?0:this.data.list.length-1),this.selectedHint!=q){var j=this.hints.childNodes[this.selectedHint];j&&(j.className=j.className.replace(" "+S,""),j.removeAttribute("aria-selected")),j=this.hints.childNodes[this.selectedHint=q],j.className+=" "+S,j.setAttribute("aria-selected","true"),this.completion.cm.getInputField().setAttribute("aria-activedescendant",j.id),this.scrollToActive(),d.signal(this.data,"select",this.data.list[this.selectedHint],j)}},scrollToActive:function(){var q=this.getSelectedHintRange(),A=this.hints.childNodes[q.from],j=this.hints.childNodes[q.to],h=this.hints.firstChild;A.offsetTop<this.hints.scrollTop?this.hints.scrollTop=A.offsetTop-h.offsetTop:j.offsetTop+j.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=j.offsetTop+j.offsetHeight-this.hints.clientHeight+h.offsetTop)},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1},getSelectedHintRange:function(){var q=this.completion.options.scrollMargin||0;return{from:Math.max(0,this.selectedHint-q),to:Math.min(this.data.list.length-1,this.selectedHint+q)}}};function se(q,A){if(!q.somethingSelected())return A;for(var j=[],h=0;h<A.length;h++)A[h].supportsSelection&&j.push(A[h]);return j}function ve(q,A,j,h){if(q.async)q(A,h,j);else{var _=q(A,j);_&&_.then?_.then(h):h(_)}}function Ge(q,A){var j=q.getHelpers(A,"hint"),h;if(j.length){var _=function(G,U,ae){var we=se(G,j);function Ne(ke){if(ke==we.length)return U(null);ve(we[ke],G,ae,function(We){We&&We.list.length>0?U(We):Ne(ke+1)})}Ne(0)};return _.async=!0,_.supportsSelection=!0,_}else return(h=q.getHelper(q.getCursor(),"hintWords"))?function(G){return d.hint.fromList(G,{words:h})}:d.hint.anyword?function(G,U){return d.hint.anyword(G,U)}:function(){}}d.registerHelper("hint","auto",{resolve:Ge}),d.registerHelper("hint","fromList",function(q,A){var j=q.getCursor(),h=q.getTokenAt(j),_,G=d.Pos(j.line,h.start),U=j;h.start<j.ch&&/\w/.test(h.string.charAt(j.ch-h.start-1))?_=h.string.substr(0,j.ch-h.start):(_="",G=j);for(var ae=[],we=0;we<A.words.length;we++){var Ne=A.words[we];Ne.slice(0,_.length)==_&&ae.push(Ne)}if(ae.length)return{list:ae,from:G,to:U}}),d.commands.autocomplete=d.showHint;var qe={hint:d.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnPick:!0,closeOnUnfocus:!0,updateOnCursorActivity:!0,completeOnSingleClick:!0,container:null,customKeys:null,extraKeys:null,paddingForScrollbar:!0,moveOnOverlap:!0};d.defineOption("hintOptions",null)})}()),showHint.exports}requireShowHint();var activeLine={exports:{}},hasRequiredActiveLine;function requireActiveLine(){return hasRequiredActiveLine||(hasRequiredActiveLine=1,function(b,y){(function(d){d(requireCodemirror())})(function(d){var m="CodeMirror-activeline",S="CodeMirror-activeline-background",P="CodeMirror-activeline-gutter";d.defineOption("styleActiveLine",!1,function(z,ue,D){var se=D==d.Init?!1:D;ue!=se&&(se&&(z.off("beforeSelectionChange",te),ie(z),delete z.state.activeLines),ue&&(z.state.activeLines=[],he(z,z.listSelections()),z.on("beforeSelectionChange",te)))});function ie(z){for(var ue=0;ue<z.state.activeLines.length;ue++)z.removeLineClass(z.state.activeLines[ue],"wrap",m),z.removeLineClass(z.state.activeLines[ue],"background",S),z.removeLineClass(z.state.activeLines[ue],"gutter",P)}function Q(z,ue){if(z.length!=ue.length)return!1;for(var D=0;D<z.length;D++)if(z[D]!=ue[D])return!1;return!0}function he(z,ue){for(var D=[],se=0;se<ue.length;se++){var ve=ue[se],Ge=z.getOption("styleActiveLine");if(!(typeof Ge=="object"&&Ge.nonEmpty?ve.anchor.line!=ve.head.line:!ve.empty())){var qe=z.getLineHandleVisualStart(ve.head.line);D[D.length-1]!=qe&&D.push(qe)}}Q(z.state.activeLines,D)||z.operation(function(){ie(z);for(var q=0;q<D.length;q++)z.addLineClass(D[q],"wrap",m),z.addLineClass(D[q],"background",S),z.addLineClass(D[q],"gutter",P);z.state.activeLines=D})}function te(z,ue){he(z,ue.ranges)}})}()),activeLine.exports}requireActiveLine();var markSelection={exports:{}},hasRequiredMarkSelection;function requireMarkSelection(){return hasRequiredMarkSelection||(hasRequiredMarkSelection=1,function(b,y){(function(d){d(requireCodemirror())})(function(d){d.defineOption("styleSelectedText",!1,function(D,se,ve){var Ge=ve&&ve!=d.Init;se&&!Ge?(D.state.markedSelection=[],D.state.markedSelectionStyle=typeof se=="string"?se:"CodeMirror-selectedtext",z(D),D.on("cursorActivity",m),D.on("change",S)):!se&&Ge&&(D.off("cursorActivity",m),D.off("change",S),te(D),D.state.markedSelection=D.state.markedSelectionStyle=null)});function m(D){D.state.markedSelection&&D.operation(function(){ue(D)})}function S(D){D.state.markedSelection&&D.state.markedSelection.length&&D.operation(function(){te(D)})}var P=8,ie=d.Pos,Q=d.cmpPos;function he(D,se,ve,Ge){if(Q(se,ve)!=0)for(var qe=D.state.markedSelection,q=D.state.markedSelectionStyle,A=se.line;;){var j=A==se.line?se:ie(A,0),h=A+P,_=h>=ve.line,G=_?ve:ie(h,0),U=D.markText(j,G,{className:q});if(Ge==null?qe.push(U):qe.splice(Ge++,0,U),_)break;A=h}}function te(D){for(var se=D.state.markedSelection,ve=0;ve<se.length;++ve)se[ve].clear();se.length=0}function z(D){te(D);for(var se=D.listSelections(),ve=0;ve<se.length;ve++)he(D,se[ve].from(),se[ve].to())}function ue(D){if(!D.somethingSelected())return te(D);if(D.listSelections().length>1)return z(D);var se=D.getCursor("start"),ve=D.getCursor("end"),Ge=D.state.markedSelection;if(!Ge.length)return he(D,se,ve);var qe=Ge[0].find(),q=Ge[Ge.length-1].find();if(!qe||!q||ve.line-se.line<=P||Q(se,q.to)>=0||Q(ve,qe.from)<=0)return z(D);for(;Q(se,qe.from)>0;)Ge.shift().clear(),qe=Ge[0].find();for(Q(se,qe.from)<0&&(qe.to.line-se.line<P?(Ge.shift().clear(),he(D,se,qe.to,0)):he(D,se,qe.from,0));Q(ve,q.to)<0;)Ge.pop().clear(),q=Ge[Ge.length-1].find();Q(ve,q.to)>0&&(ve.line-q.from.line<P?(Ge.pop().clear(),he(D,q.from,ve)):he(D,q.to,ve))}})}()),markSelection.exports}requireMarkSelection();const configPanel={panel:null,editor:null,popupWindow:null,shortcuts:[{key:"Ctrl+Enter",description:"Execute code block"},{key:"Ctrl+Alt+Enter",description:"Execute code block (without add auto out)"},{key:"Ctrl+Space",description:"Autocomplete"},{key:"Ctrl+;",description:"Stop Hydra (hush)"},{key:"Alt+X",description:"Toggle Comment"},{key:"Alt+↑",description:"Increment value"},{key:"Alt+↓",description:"Decrement value"},{key:"Alt+I",description:"Show definition"},{key:"Alt+H",description:"Hide/Show code"},{key:"Ctrl+S",description:"Save Code"},{key:"Escape",description:"Close tooltips/panel"},{key:"Ctrl+K",description:"Color picker in .color()"},{key:"Alt+1/2/3/4/5",description:"Render output 0/1/2/3/all"}],init:function(b){this.editor=b,this.panel=document.getElementById("config-panel"),this.setupEventListeners(),this.loadSettings(),this.updateShortcutsList()},setupEventListeners:function(){const b=document.getElementById("config-toggle"),y=document.getElementById("config-close"),d=document.getElementById("font-select"),m=document.getElementById("font-size"),S=document.getElementById("theme-select"),P=document.getElementById("open-popup"),ie=document.getElementById("show-about"),Q=document.getElementById("about-modal"),he=document.getElementById("close-about");b.addEventListener("click",()=>this.togglePanel()),y.addEventListener("click",()=>this.togglePanel()),d.addEventListener("change",te=>{this.setFont(te.target.value),this.saveSettings()}),m.addEventListener("input",te=>{const z=te.target.value;document.getElementById("font-size-value").textContent=z+"px",this.setFontSize(z),this.saveSettings()}),S.addEventListener("change",te=>{this.editor.setOption("theme",te.target.value),this.saveSettings()}),P.addEventListener("click",()=>{this.openCanvasPopup()}),ie.addEventListener("click",()=>{Q.classList.add("show")}),he.addEventListener("click",()=>{Q.classList.remove("show")}),Q.addEventListener("click",te=>{te.target===Q&&Q.classList.remove("show")}),document.addEventListener("keydown",te=>{te.key==="Escape"&&(Q.classList.contains("show")?Q.classList.remove("show"):this.panel.classList.contains("open")&&this.togglePanel())})},openCanvasPopup:function(){this.popupWindow&&!this.popupWindow.closed&&this.popupWindow.close();const b=document.getElementById("canvas"),y=b.width||window.innerWidth,d=b.height||window.innerHeight;this.popupWindow=window.open("","HydraCanvas",`width=${y},height=${d+50},resizable=yes,scrollbars=no,status=no,menubar=no,toolbar=no`),this.popupWindow.document.write(`
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Hydra Canvas</title>
                <style>
                    body {
                        margin: 0;
                        padding: 0;
                        background-color: #000;
                        overflow: hidden;
                    }
                    #popup-canvas {
                        display: block;
                        width: 100vw;
                        height: 100vh;
                    }
                </style>
            </head>
            <body>
                <canvas id="popup-canvas"></canvas>
            </body>
            </html>
        `),this.popupWindow.document.close(),this.startCanvasSync()},startCanvasSync:function(){if(!this.popupWindow||this.popupWindow.closed)return;const b=document.getElementById("canvas"),y=this.popupWindow.document.getElementById("popup-canvas"),d=()=>{if(!this.popupWindow||this.popupWindow.closed){this.popupWindow=null;return}try{console.log("Syncing canvas..."),y.width=b.width,y.height=b.height,y.getContext("2d").drawImage(b,0,0)}catch(m){console.log("Sync error:",m)}requestAnimationFrame(d)};d(),this.popupWindow.addEventListener("beforeunload",()=>{this.popupWindow=null})},togglePanel:function(){this.panel.classList.toggle("open")},setFont:function(b){const y=document.querySelector(".CodeMirror");y.style.fontFamily=`${b}, monospace`},setFontSize:function(b){this.editor.getWrapperElement().style.fontSize=b+"px",this.editor.refresh()},updateShortcutsList:function(){const b=document.getElementById("shortcuts-list");b.innerHTML="",this.shortcuts.forEach(y=>{const d=document.createElement("div");d.className="shortcut-item",d.innerHTML=`
                <span class="shortcut-key">${y.key}</span>
                <span class="shortcut-desc">${y.description}</span>
            `,b.appendChild(d)})},loadSettings:function(){const b=JSON.parse(localStorage.getItem("editor-settings")||"{}");if(b.font&&(document.getElementById("font-select").value=b.font,this.setFont(b.font)),b.fontSize){const y=document.getElementById("font-size");y.value=b.fontSize,document.getElementById("font-size-value").textContent=b.fontSize+"px",this.setFontSize(b.fontSize)}b.theme&&(document.getElementById("theme-select").value=b.theme,this.editor.setOption("theme",b.theme))},saveSettings:function(){const b={font:document.getElementById("font-select").value,fontSize:document.getElementById("font-size").value,theme:document.getElementById("theme-select").value};localStorage.setItem("editor-settings",JSON.stringify(b))}},scriptRel="modulepreload",assetsURL=function(b){return"/apps/super-hydra-turbo-edition/"+b},seen={},__vitePreload=function(y,d,m){let S=Promise.resolve();if(d&&d.length>0){let ie=function(te){return Promise.all(te.map(z=>Promise.resolve(z).then(ue=>({status:"fulfilled",value:ue}),ue=>({status:"rejected",reason:ue}))))};document.getElementsByTagName("link");const Q=document.querySelector("meta[property=csp-nonce]"),he=(Q==null?void 0:Q.nonce)||(Q==null?void 0:Q.getAttribute("nonce"));S=ie(d.map(te=>{if(te=assetsURL(te),te in seen)return;seen[te]=!0;const z=te.endsWith(".css"),ue=z?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${te}"]${ue}`))return;const D=document.createElement("link");if(D.rel=z?"stylesheet":scriptRel,z||(D.as="script"),D.crossOrigin="",D.href=te,he&&D.setAttribute("nonce",he),document.head.appendChild(D),z)return new Promise((se,ve)=>{D.addEventListener("load",se),D.addEventListener("error",()=>ve(new Error(`Unable to preload CSS for ${te}`)))})}))}function P(ie){const Q=new Event("vite:preloadError",{cancelable:!0});if(Q.payload=ie,window.dispatchEvent(Q),!Q.defaultPrevented)throw ie}return S.then(ie=>{for(const Q of ie||[])Q.status==="rejected"&&P(Q.reason);return y().catch(P)})};var Output=function({regl:b,precision:y,label:d="",width:m,height:S}){this.regl=b,this.precision=y,this.label=d,this.positionBuffer=this.regl.buffer([[-2,0],[0,-2],[2,2]]),this.draw=()=>{},this.init(),this.pingPongIndex=0,this.fbos=Array(2).fill().map(()=>this.regl.framebuffer({color:this.regl.texture({mag:"nearest",width:m,height:S,format:"rgba"}),depthStencil:!1}))};Output.prototype.resize=function(b,y){this.fbos.forEach(d=>{d.resize(b,y)})};Output.prototype.getCurrent=function(){return this.fbos[this.pingPongIndex]};Output.prototype.getTexture=function(){var b=this.pingPongIndex?0:1;return this.fbos[b]};Output.prototype.init=function(){return this.transformIndex=0,this.fragHeader=`
  precision ${this.precision} float;

  uniform float time;
  varying vec2 uv;
  `,this.fragBody="",this.vert=`
  precision ${this.precision} float;
  attribute vec2 position;
  varying vec2 uv;

  void main () {
    uv = position;
    gl_Position = vec4(2.0 * position - 1.0, 0, 1);
  }`,this.attributes={position:this.positionBuffer},this.uniforms={time:this.regl.prop("time"),resolution:this.regl.prop("resolution")},this.frag=`
       ${this.fragHeader}

      void main () {
        vec4 c = vec4(0, 0, 0, 0);
        vec2 st = uv;
        ${this.fragBody}
        gl_FragColor = c;
      }
  `,this};Output.prototype.render=function(b){let y=b[0];var d=this,m=Object.assign(y.uniforms,{prevBuffer:()=>d.fbos[d.pingPongIndex]});d.draw=d.regl({frag:y.frag,vert:d.vert,attributes:d.attributes,uniforms:m,count:3,framebuffer:()=>(d.pingPongIndex=d.pingPongIndex?0:1,d.fbos[d.pingPongIndex])})};Output.prototype.tick=function(b){this.draw(b)};var inherits_browser={exports:{}},hasRequiredInherits_browser;function requireInherits_browser(){return hasRequiredInherits_browser||(hasRequiredInherits_browser=1,typeof Object.create=="function"?inherits_browser.exports=function(y,d){d&&(y.super_=d,y.prototype=Object.create(d.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}))}:inherits_browser.exports=function(y,d){if(d){y.super_=d;var m=function(){};m.prototype=d.prototype,y.prototype=new m,y.prototype.constructor=y}}),inherits_browser.exports}var events,hasRequiredEvents;function requireEvents(){if(hasRequiredEvents)return events;hasRequiredEvents=1;function b(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}events=b,b.EventEmitter=b,b.prototype._events=void 0,b.prototype._maxListeners=void 0,b.defaultMaxListeners=10,b.prototype.setMaxListeners=function(P){if(!d(P)||P<0||isNaN(P))throw TypeError("n must be a positive number");return this._maxListeners=P,this},b.prototype.emit=function(P){var ie,Q,he,te,z,ue;if(this._events||(this._events={}),P==="error"&&(!this._events.error||m(this._events.error)&&!this._events.error.length)){if(ie=arguments[1],ie instanceof Error)throw ie;var D=new Error('Uncaught, unspecified "error" event. ('+ie+")");throw D.context=ie,D}if(Q=this._events[P],S(Q))return!1;if(y(Q))switch(arguments.length){case 1:Q.call(this);break;case 2:Q.call(this,arguments[1]);break;case 3:Q.call(this,arguments[1],arguments[2]);break;default:te=Array.prototype.slice.call(arguments,1),Q.apply(this,te)}else if(m(Q))for(te=Array.prototype.slice.call(arguments,1),ue=Q.slice(),he=ue.length,z=0;z<he;z++)ue[z].apply(this,te);return!0},b.prototype.addListener=function(P,ie){var Q;if(!y(ie))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",P,y(ie.listener)?ie.listener:ie),this._events[P]?m(this._events[P])?this._events[P].push(ie):this._events[P]=[this._events[P],ie]:this._events[P]=ie,m(this._events[P])&&!this._events[P].warned&&(S(this._maxListeners)?Q=b.defaultMaxListeners:Q=this._maxListeners,Q&&Q>0&&this._events[P].length>Q&&(this._events[P].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[P].length),typeof console.trace=="function"&&console.trace())),this},b.prototype.on=b.prototype.addListener,b.prototype.once=function(P,ie){if(!y(ie))throw TypeError("listener must be a function");var Q=!1;function he(){this.removeListener(P,he),Q||(Q=!0,ie.apply(this,arguments))}return he.listener=ie,this.on(P,he),this},b.prototype.removeListener=function(P,ie){var Q,he,te,z;if(!y(ie))throw TypeError("listener must be a function");if(!this._events||!this._events[P])return this;if(Q=this._events[P],te=Q.length,he=-1,Q===ie||y(Q.listener)&&Q.listener===ie)delete this._events[P],this._events.removeListener&&this.emit("removeListener",P,ie);else if(m(Q)){for(z=te;z-- >0;)if(Q[z]===ie||Q[z].listener&&Q[z].listener===ie){he=z;break}if(he<0)return this;Q.length===1?(Q.length=0,delete this._events[P]):Q.splice(he,1),this._events.removeListener&&this.emit("removeListener",P,ie)}return this},b.prototype.removeAllListeners=function(P){var ie,Q;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[P]&&delete this._events[P],this;if(arguments.length===0){for(ie in this._events)ie!=="removeListener"&&this.removeAllListeners(ie);return this.removeAllListeners("removeListener"),this._events={},this}if(Q=this._events[P],y(Q))this.removeListener(P,Q);else if(Q)for(;Q.length;)this.removeListener(P,Q[Q.length-1]);return delete this._events[P],this},b.prototype.listeners=function(P){var ie;return!this._events||!this._events[P]?ie=[]:y(this._events[P])?ie=[this._events[P]]:ie=this._events[P].slice(),ie},b.prototype.listenerCount=function(P){if(this._events){var ie=this._events[P];if(y(ie))return 1;if(ie)return ie.length}return 0},b.listenerCount=function(P,ie){return P.listenerCount(ie)};function y(P){return typeof P=="function"}function d(P){return typeof P=="number"}function m(P){return typeof P=="object"&&P!==null}function S(P){return P===void 0}return events}var browser,hasRequiredBrowser;function requireBrowser(){return hasRequiredBrowser||(hasRequiredBrowser=1,browser=globalThis.performance&&globalThis.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date}),browser}var raf={exports:{}},performanceNow$1={exports:{}},performanceNow=performanceNow$1.exports,hasRequiredPerformanceNow;function requirePerformanceNow(){return hasRequiredPerformanceNow||(hasRequiredPerformanceNow=1,(function(){var b,y,d,m,S,P;typeof performance<"u"&&performance!==null&&performance.now?performanceNow$1.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(performanceNow$1.exports=function(){return(b()-S)/1e6},y=process.hrtime,b=function(){var ie;return ie=y(),ie[0]*1e9+ie[1]},m=b(),P=process.uptime()*1e9,S=m-P):Date.now?(performanceNow$1.exports=function(){return Date.now()-d},d=Date.now()):(performanceNow$1.exports=function(){return new Date().getTime()-d},d=new Date().getTime())}).call(performanceNow)),performanceNow$1.exports}var hasRequiredRaf;function requireRaf(){if(hasRequiredRaf)return raf.exports;hasRequiredRaf=1;for(var b=requirePerformanceNow(),y=typeof window>"u"?globalThis:window,d=["moz","webkit"],m="AnimationFrame",S=y["request"+m],P=y["cancel"+m]||y["cancelRequest"+m],ie=0;!S&&ie<d.length;ie++)S=y[d[ie]+"Request"+m],P=y[d[ie]+"Cancel"+m]||y[d[ie]+"CancelRequest"+m];if(!S||!P){var Q=0,he=0,te=[],z=1e3/60;S=function(ue){if(te.length===0){var D=b(),se=Math.max(0,z-(D-Q));Q=se+D,setTimeout(function(){var ve=te.slice(0);te.length=0;for(var Ge=0;Ge<ve.length;Ge++)if(!ve[Ge].cancelled)try{ve[Ge].callback(Q)}catch(qe){setTimeout(function(){throw qe},0)}},Math.round(se))}return te.push({handle:++he,callback:ue,cancelled:!1}),he},P=function(ue){for(var D=0;D<te.length;D++)te[D].handle===ue&&(te[D].cancelled=!0)}}return raf.exports=function(ue){return S.call(y,ue)},raf.exports.cancel=function(){P.apply(y,arguments)},raf.exports.polyfill=function(ue){ue||(ue=y),ue.requestAnimationFrame=S,ue.cancelAnimationFrame=P},raf.exports}var rafLoop,hasRequiredRafLoop;function requireRafLoop(){if(hasRequiredRafLoop)return rafLoop;hasRequiredRafLoop=1;var b=requireInherits_browser(),y=requireEvents().EventEmitter,d=requireBrowser(),m=requireRaf();rafLoop=S;function S(P){if(!(this instanceof S))return new S(P);this.running=!1,this.last=d(),this._frame=0,this._tick=this.tick.bind(this),P&&this.on("tick",P)}return b(S,y),S.prototype.start=function(){if(!this.running)return this.running=!0,this.last=d(),this._frame=m(this._tick),this},S.prototype.stop=function(){return this.running=!1,this._frame!==0&&m.cancel(this._frame),this._frame=0,this},S.prototype.tick=function(){this._frame=m(this._tick);var P=d(),ie=P-this.last;this.emit("tick",ie),this.last=P},rafLoop}var rafLoopExports=requireRafLoop();const loop=getDefaultExportFromCjs(rafLoopExports);function Webcam(b){return navigator.mediaDevices.enumerateDevices().then(y=>y.filter(d=>d.kind==="videoinput")).then(y=>{let d={audio:!1,video:!0};return y[b]&&(d.video={deviceId:{exact:y[b].deviceId}}),window.navigator.mediaDevices.getUserMedia(d)}).then(y=>{const d=document.createElement("video");return d.setAttribute("autoplay",""),d.setAttribute("muted",""),d.setAttribute("playsinline",""),d.srcObject=y,new Promise((m,S)=>{d.addEventListener("loadedmetadata",()=>{d.play().then(()=>m({video:d}))})})}).catch(console.log.bind(console))}function Screen(b){return new Promise(function(y,d){navigator.mediaDevices.getDisplayMedia(b).then(m=>{const S=document.createElement("video");S.srcObject=m,S.addEventListener("loadedmetadata",()=>{S.play(),y({video:S})})}).catch(m=>d(m))})}class HydraSource{constructor({regl:y,width:d,height:m,pb:S,label:P=""}){this.label=P,this.regl=y,this.src=null,this.dynamic=!0,this.width=d,this.height=m,this.tex=this.regl.texture({shape:[1,1]}),this.pb=S}init(y,d){"src"in y&&(this.src=y.src,this.tex=this.regl.texture({data:this.src,...d})),"dynamic"in y&&(this.dynamic=y.dynamic)}initCam(y,d){const m=this;Webcam(y).then(S=>{m.src=S.video,m.dynamic=!0,m.tex=m.regl.texture({data:m.src,...d})}).catch(S=>console.log("could not get camera",S))}initVideo(y="",d){const m=document.createElement("video");m.crossOrigin="anonymous",m.autoplay=!0,m.loop=!0,m.muted=!0,m.addEventListener("loadeddata",()=>{this.src=m,m.play(),this.tex=this.regl.texture({data:this.src,...d}),this.dynamic=!0}),m.src=y}initImage(y="",d){const m=document.createElement("img");m.crossOrigin="anonymous",m.src=y,m.onload=()=>{this.src=m,this.dynamic=!1,this.tex=this.regl.texture({data:this.src,...d})}}initStream(y,d){let m=this;y&&this.pb&&(this.pb.initSource(y),this.pb.on("got video",function(S,P){S===y&&(m.src=P,m.dynamic=!0,m.tex=m.regl.texture({data:m.src,...d}))}))}initScreen(y=0,d){const m=this;Screen().then(function(S){m.src=S.video,m.tex=m.regl.texture({data:m.src,...d}),m.dynamic=!0}).catch(S=>console.log("could not get screen",S))}resize(y,d){this.width=y,this.height=d}clear(){this.src&&this.src.srcObject&&this.src.srcObject.getTracks&&this.src.srcObject.getTracks().forEach(y=>y.stop()),this.src=null,this.tex=this.regl.texture({shape:[1,1]})}tick(y){this.src!==null&&this.dynamic===!0&&(this.src.videoWidth&&this.src.videoWidth!==this.tex.width&&(console.log(this.src.videoWidth,this.src.videoHeight,this.tex.width,this.tex.height),this.tex.resize(this.src.videoWidth,this.src.videoHeight)),this.src.width&&this.src.width!==this.tex.width&&this.tex.resize(this.src.width,this.src.height),this.tex.subimage(this.src))}getTexture(){return this.tex}}const mouse={};function mouseButtons(b){if(typeof b=="object"){if("buttons"in b)return b.buttons;if("which"in b){var y=b.which;if(y===2)return 4;if(y===3)return 2;if(y>0)return 1<<y-1}else if("button"in b){var y=b.button;if(y===1)return 4;if(y===2)return 2;if(y>=0)return 1<<y}}return 0}mouse.buttons=mouseButtons;function mouseElement(b){return b.target||b.srcElement||window}mouse.element=mouseElement;function mouseRelativeX(b){return typeof b=="object"&&"pageX"in b?b.pageX:0}mouse.x=mouseRelativeX;function mouseRelativeY(b){return typeof b=="object"&&"pageY"in b?b.pageY:0}mouse.y=mouseRelativeY;function mouseListen(b,y){y||(y=b,b=window);var d=0,m=0,S=0,P={shift:!1,alt:!1,control:!1,meta:!1},ie=!1;function Q(A){var j=!1;return"altKey"in A&&(j=j||A.altKey!==P.alt,P.alt=!!A.altKey),"shiftKey"in A&&(j=j||A.shiftKey!==P.shift,P.shift=!!A.shiftKey),"ctrlKey"in A&&(j=j||A.ctrlKey!==P.control,P.control=!!A.ctrlKey),"metaKey"in A&&(j=j||A.metaKey!==P.meta,P.meta=!!A.metaKey),j}function he(A,j){var h=mouse.x(j),_=mouse.y(j);"buttons"in j&&(A=j.buttons|0),(A!==d||h!==m||_!==S||Q(j))&&(d=A|0,m=h||0,S=_||0,y&&y(d,m,S,P))}function te(A){he(0,A)}function z(){(d||m||S||P.shift||P.alt||P.meta||P.control)&&(m=S=0,d=0,P.shift=P.alt=P.control=P.meta=!1,y&&y(0,0,0,P))}function ue(A){Q(A)&&y&&y(d,m,S,P)}function D(A){mouse.buttons(A)===0?he(0,A):he(d,A)}function se(A){he(d|mouse.buttons(A),A)}function ve(A){he(d&~mouse.buttons(A),A)}function Ge(){ie||(ie=!0,b.addEventListener("mousemove",D),b.addEventListener("mousedown",se),b.addEventListener("mouseup",ve),b.addEventListener("mouseleave",te),b.addEventListener("mouseenter",te),b.addEventListener("mouseout",te),b.addEventListener("mouseover",te),b.addEventListener("blur",z),b.addEventListener("keyup",ue),b.addEventListener("keydown",ue),b.addEventListener("keypress",ue),b!==window&&(window.addEventListener("blur",z),window.addEventListener("keyup",ue),window.addEventListener("keydown",ue),window.addEventListener("keypress",ue)))}function qe(){ie&&(ie=!1,b.removeEventListener("mousemove",D),b.removeEventListener("mousedown",se),b.removeEventListener("mouseup",ve),b.removeEventListener("mouseleave",te),b.removeEventListener("mouseenter",te),b.removeEventListener("mouseout",te),b.removeEventListener("mouseover",te),b.removeEventListener("blur",z),b.removeEventListener("keyup",ue),b.removeEventListener("keydown",ue),b.removeEventListener("keypress",ue),b!==window&&(window.removeEventListener("blur",z),window.removeEventListener("keyup",ue),window.removeEventListener("keydown",ue),window.removeEventListener("keypress",ue)))}Ge();var q={element:b};return Object.defineProperties(q,{enabled:{get:function(){return ie},set:function(A){A?Ge():qe()},enumerable:!0},buttons:{get:function(){return d},enumerable:!0},x:{get:function(){return m},enumerable:!0},y:{get:function(){return S},enumerable:!0},mods:{get:function(){return P},enumerable:!0}}),q}var meyda_min$1={exports:{}},meyda_min=meyda_min$1.exports,hasRequiredMeyda_min;function requireMeyda_min(){return hasRequiredMeyda_min||(hasRequiredMeyda_min=1,function(b,y){(function(d,m){b.exports=m()})(meyda_min,function(){function d(C,E,p){for(var Z,ye=0,Pe=E.length;ye<Pe;ye++)!Z&&ye in E||(Z||(Z=Array.prototype.slice.call(E,0,ye)),Z[ye]=E[ye]);return C.concat(Z||Array.prototype.slice.call(E))}var m=Object.freeze({__proto__:null,blackman:function(C){for(var E=new Float32Array(C),p=2*Math.PI/(C-1),Z=2*p,ye=0;ye<C/2;ye++)E[ye]=.42-.5*Math.cos(ye*p)+.08*Math.cos(ye*Z);for(ye=Math.ceil(C/2);ye>0;ye--)E[C-ye]=E[ye-1];return E},hamming:function(C){for(var E=new Float32Array(C),p=0;p<C;p++)E[p]=.54-.46*Math.cos(2*Math.PI*(p/C-1));return E},hanning:function(C){for(var E=new Float32Array(C),p=0;p<C;p++)E[p]=.5-.5*Math.cos(2*Math.PI*p/(C-1));return E},sine:function(C){for(var E=Math.PI/(C-1),p=new Float32Array(C),Z=0;Z<C;Z++)p[Z]=Math.sin(E*Z);return p}}),S={};function P(C){for(;C%2==0&&C>1;)C/=2;return C===1}function ie(C,E){if(E!=="rect"){if(E!==""&&E||(E="hanning"),S[E]||(S[E]={}),!S[E][C.length])try{S[E][C.length]=m[E](C.length)}catch{throw new Error("Invalid windowing function")}C=function(p,Z){for(var ye=[],Pe=0;Pe<Math.min(p.length,Z.length);Pe++)ye[Pe]=p[Pe]*Z[Pe];return ye}(C,S[E][C.length])}return C}function Q(C,E,p){for(var Z=new Float32Array(C),ye=0;ye<Z.length;ye++)Z[ye]=ye*E/p,Z[ye]=13*Math.atan(Z[ye]/1315.8)+3.5*Math.atan(Math.pow(Z[ye]/7518,2));return Z}function he(C){return Float32Array.from(C)}function te(C){return 1125*Math.log(1+C/700)}function z(C,E,p){for(var Z,ye=new Float32Array(C+2),Pe=new Float32Array(C+2),Ve=E/2,$e=te(0),Ye=(te(Ve)-$e)/(C+1),Je=new Array(C+2),at=0;at<ye.length;at++)ye[at]=at*Ye,Pe[at]=(Z=ye[at],700*(Math.exp(Z/1125)-1)),Je[at]=Math.floor((p+1)*Pe[at]/E);for(var Ot=new Array(C),st=0;st<Ot.length;st++){for(Ot[st]=new Array(p/2+1).fill(0),at=Je[st];at<Je[st+1];at++)Ot[st][at]=(at-Je[st])/(Je[st+1]-Je[st]);for(at=Je[st+1];at<Je[st+2];at++)Ot[st][at]=(Je[st+2]-at)/(Je[st+2]-Je[st+1])}return Ot}function ue(C,E,p,Z,ye,Pe,Ve){Z===void 0&&(Z=5),ye===void 0&&(ye=2),Pe===void 0&&(Pe=!0),Ve===void 0&&(Ve=440);var $e=Math.floor(p/2)+1,Ye=new Array(p).fill(0).map(function(Ht,ft){return C*function(Mt,$t){return Math.log2(16*Mt/$t)}(E*ft/p,Ve)});Ye[0]=Ye[1]-1.5*C;var Je,at,Ot,st=Ye.slice(1).map(function(Ht,ft){return Math.max(Ht-Ye[ft])},1).concat([1]),ut=Math.round(C/2),tt=new Array(C).fill(0).map(function(Ht,ft){return Ye.map(function(Mt){return(10*C+ut+Mt-ft)%C-ut})}),pt=tt.map(function(Ht,ft){return Ht.map(function(Mt,$t){return Math.exp(-.5*Math.pow(2*tt[ft][$t]/st[$t],2))})});if(at=(Je=pt)[0].map(function(){return 0}),Ot=Je.reduce(function(Ht,ft){return ft.forEach(function(Mt,$t){Ht[$t]+=Math.pow(Mt,2)}),Ht},at).map(Math.sqrt),pt=Je.map(function(Ht,ft){return Ht.map(function(Mt,$t){return Mt/(Ot[$t]||1)})}),ye){var Ct=Ye.map(function(Ht){return Math.exp(-.5*Math.pow((Ht/C-Z)/ye,2))});pt=pt.map(function(Ht){return Ht.map(function(ft,Mt){return ft*Ct[Mt]})})}return Pe&&(pt=d(d([],pt.slice(3),!0),pt.slice(0,3))),pt.map(function(Ht){return Ht.slice(0,$e)})}function D(C,E){for(var p=0,Z=0,ye=0;ye<E.length;ye++)p+=Math.pow(ye,C)*Math.abs(E[ye]),Z+=E[ye];return p/Z}function se(C){var E=C.ampSpectrum,p=C.barkScale,Z=C.numberOfBarkBands,ye=Z===void 0?24:Z;if(typeof E!="object"||typeof p!="object")throw new TypeError;var Pe=ye,Ve=new Float32Array(Pe),$e=0,Ye=E,Je=new Int32Array(Pe+1);Je[0]=0;for(var at=p[Ye.length-1]/Pe,Ot=1,st=0;st<Ye.length;st++)for(;p[st]>at;)Je[Ot++]=st,at=Ot*p[Ye.length-1]/Pe;for(Je[Pe]=Ye.length-1,st=0;st<Pe;st++){for(var ut=0,tt=Je[st];tt<Je[st+1];tt++)ut+=Ye[tt];Ve[st]=Math.pow(ut,.23)}for(st=0;st<Ve.length;st++)$e+=Ve[st];return{specific:Ve,total:$e}}function ve(C){var E=C.ampSpectrum;if(typeof E!="object")throw new TypeError;for(var p=new Float32Array(E.length),Z=0;Z<p.length;Z++)p[Z]=Math.pow(E[Z],2);return p}function Ge(C){var E=C.ampSpectrum,p=C.melFilterBank,Z=C.bufferSize;if(typeof E!="object")throw new TypeError("Valid ampSpectrum is required to generate melBands");if(typeof p!="object")throw new TypeError("Valid melFilterBank is required to generate melBands");for(var ye=ve({ampSpectrum:E}),Pe=p.length,Ve=Array(Pe),$e=new Float32Array(Pe),Ye=0;Ye<$e.length;Ye++){Ve[Ye]=new Float32Array(Z/2),$e[Ye]=0;for(var Je=0;Je<Z/2;Je++)Ve[Ye][Je]=p[Ye][Je]*ye[Je],$e[Ye]+=Ve[Ye][Je];$e[Ye]=Math.log($e[Ye]+1)}return Array.prototype.slice.call($e)}function qe(C){return C&&C.__esModule&&Object.prototype.hasOwnProperty.call(C,"default")?C.default:C}var q=null,A=qe(function(C,E){var p=C.length;return E=E||2,q&&q[p]||function(Z){(q=q||{})[Z]=new Array(Z*Z);for(var ye=Math.PI/Z,Pe=0;Pe<Z;Pe++)for(var Ve=0;Ve<Z;Ve++)q[Z][Ve+Pe*Z]=Math.cos(ye*(Ve+.5)*Pe)}(p),C.map(function(){return 0}).map(function(Z,ye){return E*C.reduce(function(Pe,Ve,$e,Ye){return Pe+Ve*q[p][$e+ye*p]},0)})}),j=Object.freeze({__proto__:null,amplitudeSpectrum:function(C){return C.ampSpectrum},buffer:function(C){return C.signal},chroma:function(C){var E=C.ampSpectrum,p=C.chromaFilterBank;if(typeof E!="object")throw new TypeError("Valid ampSpectrum is required to generate chroma");if(typeof p!="object")throw new TypeError("Valid chromaFilterBank is required to generate chroma");var Z=p.map(function(Pe,Ve){return E.reduce(function($e,Ye,Je){return $e+Ye*Pe[Je]},0)}),ye=Math.max.apply(Math,Z);return ye?Z.map(function(Pe){return Pe/ye}):Z},complexSpectrum:function(C){return C.complexSpectrum},energy:function(C){var E=C.signal;if(typeof E!="object")throw new TypeError;for(var p=0,Z=0;Z<E.length;Z++)p+=Math.pow(Math.abs(E[Z]),2);return p},loudness:se,melBands:Ge,mfcc:function(C){var E=C.ampSpectrum,p=C.melFilterBank,Z=C.numberOfMFCCCoefficients,ye=C.bufferSize,Pe=Math.min(40,Math.max(1,Z||13));if(p.length<Pe)throw new Error("Insufficient filter bank for requested number of coefficients");var Ve=Ge({ampSpectrum:E,melFilterBank:p,bufferSize:ye});return A(Ve).slice(0,Pe)},perceptualSharpness:function(C){for(var E=se({ampSpectrum:C.ampSpectrum,barkScale:C.barkScale}),p=E.specific,Z=0,ye=0;ye<p.length;ye++)Z+=ye<15?(ye+1)*p[ye+1]:.066*Math.exp(.171*(ye+1));return Z*=.11/E.total},perceptualSpread:function(C){for(var E=se({ampSpectrum:C.ampSpectrum,barkScale:C.barkScale}),p=0,Z=0;Z<E.specific.length;Z++)E.specific[Z]>p&&(p=E.specific[Z]);return Math.pow((E.total-p)/E.total,2)},powerSpectrum:ve,rms:function(C){var E=C.signal;if(typeof E!="object")throw new TypeError;for(var p=0,Z=0;Z<E.length;Z++)p+=Math.pow(E[Z],2);return p/=E.length,p=Math.sqrt(p)},spectralCentroid:function(C){var E=C.ampSpectrum;if(typeof E!="object")throw new TypeError;return D(1,E)},spectralCrest:function(C){var E=C.ampSpectrum;if(typeof E!="object")throw new TypeError;var p=0,Z=-1/0;return E.forEach(function(ye){p+=Math.pow(ye,2),Z=ye>Z?ye:Z}),p/=E.length,p=Math.sqrt(p),Z/p},spectralFlatness:function(C){var E=C.ampSpectrum;if(typeof E!="object")throw new TypeError;for(var p=0,Z=0,ye=0;ye<E.length;ye++)p+=Math.log(E[ye]),Z+=E[ye];return Math.exp(p/E.length)*E.length/Z},spectralFlux:function(C){var E=C.signal,p=C.previousSignal,Z=C.bufferSize;if(typeof E!="object"||typeof p!="object")throw new TypeError;for(var ye=0,Pe=-Z/2;Pe<E.length/2-1;Pe++)x=Math.abs(E[Pe])-Math.abs(p[Pe]),ye+=(x+Math.abs(x))/2;return ye},spectralKurtosis:function(C){var E=C.ampSpectrum;if(typeof E!="object")throw new TypeError;var p=E,Z=D(1,p),ye=D(2,p),Pe=D(3,p),Ve=D(4,p);return(-3*Math.pow(Z,4)+6*Z*ye-4*Z*Pe+Ve)/Math.pow(Math.sqrt(ye-Math.pow(Z,2)),4)},spectralRolloff:function(C){var E=C.ampSpectrum,p=C.sampleRate;if(typeof E!="object")throw new TypeError;for(var Z=E,ye=p/(2*(Z.length-1)),Pe=0,Ve=0;Ve<Z.length;Ve++)Pe+=Z[Ve];for(var $e=.99*Pe,Ye=Z.length-1;Pe>$e&&Ye>=0;)Pe-=Z[Ye],--Ye;return(Ye+1)*ye},spectralSkewness:function(C){var E=C.ampSpectrum;if(typeof E!="object")throw new TypeError;var p=D(1,E),Z=D(2,E),ye=D(3,E);return(2*Math.pow(p,3)-3*p*Z+ye)/Math.pow(Math.sqrt(Z-Math.pow(p,2)),3)},spectralSlope:function(C){var E=C.ampSpectrum,p=C.sampleRate,Z=C.bufferSize;if(typeof E!="object")throw new TypeError;for(var ye=0,Pe=0,Ve=new Float32Array(E.length),$e=0,Ye=0,Je=0;Je<E.length;Je++){ye+=E[Je];var at=Je*p/Z;Ve[Je]=at,$e+=at*at,Pe+=at,Ye+=at*E[Je]}return(E.length*Ye-Pe*ye)/(ye*($e-Math.pow(Pe,2)))},spectralSpread:function(C){var E=C.ampSpectrum;if(typeof E!="object")throw new TypeError;return Math.sqrt(D(2,E)-Math.pow(D(1,E),2))},zcr:function(C){var E=C.signal;if(typeof E!="object")throw new TypeError;for(var p=0,Z=1;Z<E.length;Z++)(E[Z-1]>=0&&E[Z]<0||E[Z-1]<0&&E[Z]>=0)&&p++;return p}});function h(C){if(Array.isArray(C)){for(var E=0,p=Array(C.length);E<C.length;E++)p[E]=C[E];return p}return Array.from(C)}var _={},G={},U={bitReverseArray:function(C){if(_[C]===void 0){for(var E=(C-1).toString(2).length,p="0".repeat(E),Z={},ye=0;ye<C;ye++){var Pe=ye.toString(2);Pe=p.substr(Pe.length)+Pe,Pe=[].concat(h(Pe)).reverse().join(""),Z[ye]=parseInt(Pe,2)}_[C]=Z}return _[C]},multiply:function(C,E){return{real:C.real*E.real-C.imag*E.imag,imag:C.real*E.imag+C.imag*E.real}},add:function(C,E){return{real:C.real+E.real,imag:C.imag+E.imag}},subtract:function(C,E){return{real:C.real-E.real,imag:C.imag-E.imag}},euler:function(C,E){var p=-2*Math.PI*C/E;return{real:Math.cos(p),imag:Math.sin(p)}},conj:function(C){return C.imag*=-1,C},constructComplexArray:function(C){var E={};E.real=C.real===void 0?C.slice():C.real.slice();var p=E.real.length;return G[p]===void 0&&(G[p]=Array.apply(null,Array(p)).map(Number.prototype.valueOf,0)),E.imag=G[p].slice(),E}},ae=function(C){var E={};C.real===void 0||C.imag===void 0?E=U.constructComplexArray(C):(E.real=C.real.slice(),E.imag=C.imag.slice());var p=E.real.length,Z=Math.log2(p);if(Math.round(Z)!=Z)throw new Error("Input size must be a power of 2.");if(E.real.length!=E.imag.length)throw new Error("Real and imaginary components must have the same length.");for(var ye=U.bitReverseArray(p),Pe={real:[],imag:[]},Ve=0;Ve<p;Ve++)Pe.real[ye[Ve]]=E.real[Ve],Pe.imag[ye[Ve]]=E.imag[Ve];for(var $e=0;$e<p;$e++)E.real[$e]=Pe.real[$e],E.imag[$e]=Pe.imag[$e];for(var Ye=1;Ye<=Z;Ye++)for(var Je=Math.pow(2,Ye),at=0;at<Je/2;at++)for(var Ot=U.euler(at,Je),st=0;st<p/Je;st++){var ut=Je*st+at,tt=Je*st+at+Je/2,pt={real:E.real[ut],imag:E.imag[ut]},Ct={real:E.real[tt],imag:E.imag[tt]},Ht=U.multiply(Ot,Ct),ft=U.subtract(pt,Ht);E.real[tt]=ft.real,E.imag[tt]=ft.imag;var Mt=U.add(Ht,pt);E.real[ut]=Mt.real,E.imag[ut]=Mt.imag}return E},we=ae,Ne=function(){function C(E,p){var Z=this;if(this._m=p,!E.audioContext)throw this._m.errors.noAC;if(E.bufferSize&&!P(E.bufferSize))throw this._m._errors.notPow2;if(!E.source)throw this._m._errors.noSource;this._m.audioContext=E.audioContext,this._m.bufferSize=E.bufferSize||this._m.bufferSize||256,this._m.hopSize=E.hopSize||this._m.hopSize||this._m.bufferSize,this._m.sampleRate=E.sampleRate||this._m.audioContext.sampleRate||44100,this._m.callback=E.callback,this._m.windowingFunction=E.windowingFunction||"hanning",this._m.featureExtractors=j,this._m.EXTRACTION_STARTED=E.startImmediately||!1,this._m.channel=typeof E.channel=="number"?E.channel:0,this._m.inputs=E.inputs||1,this._m.outputs=E.outputs||1,this._m.numberOfMFCCCoefficients=E.numberOfMFCCCoefficients||this._m.numberOfMFCCCoefficients||13,this._m.numberOfBarkBands=E.numberOfBarkBands||this._m.numberOfBarkBands||24,this._m.spn=this._m.audioContext.createScriptProcessor(this._m.bufferSize,this._m.inputs,this._m.outputs),this._m.spn.connect(this._m.audioContext.destination),this._m._featuresToExtract=E.featureExtractors||[],this._m.barkScale=Q(this._m.bufferSize,this._m.sampleRate,this._m.bufferSize),this._m.melFilterBank=z(Math.max(this._m.melBands,this._m.numberOfMFCCCoefficients),this._m.sampleRate,this._m.bufferSize),this._m.inputData=null,this._m.previousInputData=null,this._m.frame=null,this._m.previousFrame=null,this.setSource(E.source),this._m.spn.onaudioprocess=function(ye){var Pe;Z._m.inputData!==null&&(Z._m.previousInputData=Z._m.inputData),Z._m.inputData=ye.inputBuffer.getChannelData(Z._m.channel),Z._m.previousInputData?((Pe=new Float32Array(Z._m.previousInputData.length+Z._m.inputData.length-Z._m.hopSize)).set(Z._m.previousInputData.slice(Z._m.hopSize)),Pe.set(Z._m.inputData,Z._m.previousInputData.length-Z._m.hopSize)):Pe=Z._m.inputData;var Ve=function($e,Ye,Je){if($e.length<Ye)throw new Error("Buffer is too short for frame length");if(Je<1)throw new Error("Hop length cannot be less that 1");if(Ye<1)throw new Error("Frame length cannot be less that 1");var at=1+Math.floor(($e.length-Ye)/Je);return new Array(at).fill(0).map(function(Ot,st){return $e.slice(st*Je,st*Je+Ye)})}(Pe,Z._m.bufferSize,Z._m.hopSize);Ve.forEach(function($e){Z._m.frame=$e;var Ye=Z._m.extract(Z._m._featuresToExtract,Z._m.frame,Z._m.previousFrame);typeof Z._m.callback=="function"&&Z._m.EXTRACTION_STARTED&&Z._m.callback(Ye),Z._m.previousFrame=Z._m.frame})}}return C.prototype.start=function(E){this._m._featuresToExtract=E||this._m._featuresToExtract,this._m.EXTRACTION_STARTED=!0},C.prototype.stop=function(){this._m.EXTRACTION_STARTED=!1},C.prototype.setSource=function(E){this._m.source&&this._m.source.disconnect(this._m.spn),this._m.source=E,this._m.source.connect(this._m.spn)},C.prototype.setChannel=function(E){E<=this._m.inputs?this._m.channel=E:console.error("Channel ".concat(E," does not exist. Make sure you've provided a value for 'inputs' that is greater than ").concat(E," when instantiating the MeydaAnalyzer"))},C.prototype.get=function(E){return this._m.inputData?this._m.extract(E||this._m._featuresToExtract,this._m.inputData,this._m.previousInputData):null},C}(),ke={audioContext:null,spn:null,bufferSize:512,sampleRate:44100,melBands:26,chromaBands:12,callback:null,windowingFunction:"hanning",featureExtractors:j,EXTRACTION_STARTED:!1,numberOfMFCCCoefficients:13,numberOfBarkBands:24,_featuresToExtract:[],windowing:ie,_errors:{notPow2:new Error("Meyda: Buffer size must be a power of 2, e.g. 64 or 512"),featureUndef:new Error("Meyda: No features defined."),invalidFeatureFmt:new Error("Meyda: Invalid feature format"),invalidInput:new Error("Meyda: Invalid input."),noAC:new Error("Meyda: No AudioContext specified."),noSource:new Error("Meyda: No source node specified.")},createMeydaAnalyzer:function(C){return new Ne(C,Object.assign({},ke))},listAvailableFeatureExtractors:function(){return Object.keys(this.featureExtractors)},extract:function(C,E,p){var Z=this;if(!E)throw this._errors.invalidInput;if(typeof E!="object")throw this._errors.invalidInput;if(!C)throw this._errors.featureUndef;if(!P(E.length))throw this._errors.notPow2;this.barkScale!==void 0&&this.barkScale.length==this.bufferSize||(this.barkScale=Q(this.bufferSize,this.sampleRate,this.bufferSize)),this.melFilterBank!==void 0&&this.barkScale.length==this.bufferSize&&this.melFilterBank.length==this.melBands||(this.melFilterBank=z(Math.max(this.melBands,this.numberOfMFCCCoefficients),this.sampleRate,this.bufferSize)),this.chromaFilterBank!==void 0&&this.chromaFilterBank.length==this.chromaBands||(this.chromaFilterBank=ue(this.chromaBands,this.sampleRate,this.bufferSize)),"buffer"in E&&E.buffer===void 0?this.signal=he(E):this.signal=E;var ye=We(E,this.windowingFunction,this.bufferSize);if(this.signal=ye.windowedSignal,this.complexSpectrum=ye.complexSpectrum,this.ampSpectrum=ye.ampSpectrum,p){var Pe=We(p,this.windowingFunction,this.bufferSize);this.previousSignal=Pe.windowedSignal,this.previousComplexSpectrum=Pe.complexSpectrum,this.previousAmpSpectrum=Pe.ampSpectrum}var Ve=function($e){return Z.featureExtractors[$e]({ampSpectrum:Z.ampSpectrum,chromaFilterBank:Z.chromaFilterBank,complexSpectrum:Z.complexSpectrum,signal:Z.signal,bufferSize:Z.bufferSize,sampleRate:Z.sampleRate,barkScale:Z.barkScale,melFilterBank:Z.melFilterBank,previousSignal:Z.previousSignal,previousAmpSpectrum:Z.previousAmpSpectrum,previousComplexSpectrum:Z.previousComplexSpectrum,numberOfMFCCCoefficients:Z.numberOfMFCCCoefficients,numberOfBarkBands:Z.numberOfBarkBands})};if(typeof C=="object")return C.reduce(function($e,Ye){var Je;return Object.assign({},$e,((Je={})[Ye]=Ve(Ye),Je))},{});if(typeof C=="string")return Ve(C);throw this._errors.invalidFeatureFmt}},We=function(C,E,p){var Z={};C.buffer===void 0?Z.signal=he(C):Z.signal=C,Z.windowedSignal=ie(Z.signal,E),Z.complexSpectrum=we(Z.windowedSignal),Z.ampSpectrum=new Float32Array(p/2);for(var ye=0;ye<p/2;ye++)Z.ampSpectrum[ye]=Math.sqrt(Math.pow(Z.complexSpectrum.real[ye],2)+Math.pow(Z.complexSpectrum.imag[ye],2));return Z};return typeof window<"u"&&(window.Meyda=ke),ke})}(meyda_min$1)),meyda_min$1.exports}var meyda_minExports=requireMeyda_min();const Meyda=getDefaultExportFromCjs(meyda_minExports);class Audio{constructor({numBins:y=4,cutoff:d=2,smooth:m=.4,max:S=15,scale:P=10,isDrawing:ie=!1,parentEl:Q=document.body}){this.vol=0,this.scale=P,this.max=S,this.cutoff=d,this.smooth=m,this.setBins(y),this.beat={holdFrames:20,threshold:40,_cutoff:0,decay:.98,_framesSinceBeat:0},this.onBeat=()=>{},this.canvas=document.createElement("canvas"),this.canvas.width=100,this.canvas.height=80,this.canvas.style.width="100px",this.canvas.style.height="80px",this.canvas.style.position="absolute",this.canvas.style.right="0px",this.canvas.style.bottom="0px",Q.appendChild(this.canvas),this.isDrawing=ie,this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#DFFFFF",this.ctx.strokeStyle="#0ff",this.ctx.lineWidth=.5,window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then(he=>{this.stream=he,this.context=new AudioContext;let te=this.context.createMediaStreamSource(he);this.meyda=Meyda.createMeydaAnalyzer({audioContext:this.context,source:te,featureExtractors:["loudness"]})}).catch(he=>console.log("ERROR",he))}detectBeat(y){y>this.beat._cutoff&&y>this.beat.threshold?(this.onBeat(),this.beat._cutoff=y*1.2,this.beat._framesSinceBeat=0):this.beat._framesSinceBeat<=this.beat.holdFrames?this.beat._framesSinceBeat++:(this.beat._cutoff*=this.beat.decay,this.beat._cutoff=Math.max(this.beat._cutoff,this.beat.threshold))}tick(){if(this.meyda){var y=this.meyda.get();if(y&&y!==null){this.vol=y.loudness.total,this.detectBeat(this.vol);const d=(S,P)=>S+P;let m=Math.floor(y.loudness.specific.length/this.bins.length);this.prevBins=this.bins.slice(0),this.bins=this.bins.map((S,P)=>y.loudness.specific.slice(P*m,(P+1)*m).reduce(d)).map((S,P)=>S*(1-this.settings[P].smooth)+this.prevBins[P]*this.settings[P].smooth),this.fft=this.bins.map((S,P)=>Math.max(0,(S-this.settings[P].cutoff)/this.settings[P].scale)),this.isDrawing&&this.draw()}}}setCutoff(y){this.cutoff=y,this.settings=this.settings.map(d=>(d.cutoff=y,d))}setSmooth(y){this.smooth=y,this.settings=this.settings.map(d=>(d.smooth=y,d))}setBins(y){this.bins=Array(y).fill(0),this.prevBins=Array(y).fill(0),this.fft=Array(y).fill(0),this.settings=Array(y).fill(0).map(()=>({cutoff:this.cutoff,scale:this.scale,smooth:this.smooth})),this.bins.forEach((d,m)=>{window["a"+m]=(S=1,P=0)=>()=>a.fft[m]*S+P})}setScale(y){this.scale=y,this.settings=this.settings.map(d=>(d.scale=y,d))}setMax(y){this.max=y,console.log("set max is deprecated")}hide(){this.isDrawing=!1,this.canvas.style.display="none"}show(){this.isDrawing=!0,this.canvas.style.display="block"}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var y=this.canvas.width/this.bins.length,d=this.canvas.height/(this.max*2);this.bins.forEach((m,S)=>{var P=m*d;this.ctx.fillRect(S*y,this.canvas.height-P,y,P);var ie=this.canvas.height-d*this.settings[S].cutoff;this.ctx.beginPath(),this.ctx.moveTo(S*y,ie),this.ctx.lineTo((S+1)*y,ie),this.ctx.stroke();var Q=this.canvas.height-d*(this.settings[S].scale+this.settings[S].cutoff);this.ctx.beginPath(),this.ctx.moveTo(S*y,Q),this.ctx.lineTo((S+1)*y,Q),this.ctx.stroke()})}}class VideoRecorder{constructor(y){this.mediaSource=new MediaSource,this.stream=y,this.output=document.createElement("video"),this.output.autoplay=!0,this.output.loop=!0;let d=this;this.mediaSource.addEventListener("sourceopen",()=>{console.log("MediaSource opened"),d.sourceBuffer=d.mediaSource.addSourceBuffer('video/webm; codecs="vp8"'),console.log("Source buffer: ",sourceBuffer)})}start(){let y={mimeType:"video/webm;codecs=vp9"};this.recordedBlobs=[];try{this.mediaRecorder=new MediaRecorder(this.stream,y)}catch(d){console.log("Unable to create MediaRecorder with options Object: ",d);try{y={mimeType:"video/webm,codecs=vp9"},this.mediaRecorder=new MediaRecorder(this.stream,y)}catch(m){console.log("Unable to create MediaRecorder with options Object: ",m);try{y="video/vp8",this.mediaRecorder=new MediaRecorder(this.stream,y)}catch(S){alert(`MediaRecorder is not supported by this browser.

Try Firefox 29 or later, or Chrome 47 or later, with Enable experimental Web Platform features enabled from chrome://flags.`),console.error("Exception while creating MediaRecorder:",S);return}}}console.log("Created MediaRecorder",this.mediaRecorder,"with options",y),this.mediaRecorder.onstop=this._handleStop.bind(this),this.mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this.mediaRecorder.start(100),console.log("MediaRecorder started",this.mediaRecorder)}stop(){this.mediaRecorder.stop()}_handleStop(){const y=new Blob(this.recordedBlobs,{type:this.mediaRecorder.mimeType}),d=window.URL.createObjectURL(y);this.output.src=d;const m=document.createElement("a");m.style.display="none",m.href=d;let S=new Date;m.download=`hydra-${S.getFullYear()}-${S.getMonth()+1}-${S.getDate()}-${S.getHours()}.${S.getMinutes()}.${S.getSeconds()}.webm`,document.body.appendChild(m),m.click(),setTimeout(()=>{document.body.removeChild(m),window.URL.revokeObjectURL(d)},300)}_handleDataAvailable(y){y.data&&y.data.size>0&&this.recordedBlobs.push(y.data)}}const easing={linear:function(b){return b},easeInQuad:function(b){return b*b},easeOutQuad:function(b){return b*(2-b)},easeInOutQuad:function(b){return b<.5?2*b*b:-1+(4-2*b)*b},easeInCubic:function(b){return b*b*b},easeOutCubic:function(b){return--b*b*b+1},easeInOutCubic:function(b){return b<.5?4*b*b*b:(b-1)*(2*b-2)*(2*b-2)+1},easeInQuart:function(b){return b*b*b*b},easeOutQuart:function(b){return 1- --b*b*b*b},easeInOutQuart:function(b){return b<.5?8*b*b*b*b:1-8*--b*b*b*b},easeInQuint:function(b){return b*b*b*b*b},easeOutQuint:function(b){return 1+--b*b*b*b*b},easeInOutQuint:function(b){return b<.5?16*b*b*b*b*b:1+16*--b*b*b*b*b},sin:function(b){return(1+Math.sin(Math.PI*b-Math.PI/2))/2}};var map=(b,y,d,m,S)=>(b-y)*(S-m)/(d-y)+m;const ArrayUtils={init:()=>{Array.prototype.fast=function(b=1){return this._speed=b,this},Array.prototype.smooth=function(b=1){return this._smooth=b,this},Array.prototype.ease=function(b="linear"){return typeof b=="function"?(this._smooth=1,this._ease=b):easing[b]&&(this._smooth=1,this._ease=easing[b]),this},Array.prototype.offset=function(b=.5){return this._offset=b%1,this},Array.prototype.fit=function(b=0,y=1){let d=Math.min(...this),m=Math.max(...this);var S=this.map(P=>map(P,d,m,b,y));return S._speed=this._speed,S._smooth=this._smooth,S._ease=this._ease,S}},getValue:(b=[])=>({time:y,bpm:d})=>{let m=b._speed?b._speed:1,S=b._smooth?b._smooth:0,P=y*m*(d/60)+(b._offset||0);if(S!==0){let ie=b._ease?b._ease:easing.linear,Q=P-S/2,he=b[Math.floor(Q%b.length)],te=b[Math.floor((Q+1)%b.length)],z=Math.min(Q%1/S,1);return ie(z)*(te-he)+he}else return b[Math.floor(P%b.length)],b[Math.floor(P%b.length)]}},Sandbox=b=>{var y="",d=S(y),m=(P,ie)=>{y+=`
      var ${P} = ${ie}
    `,d=S(y)};return{addToContext:m,eval:P=>d.eval(P)};function S(P){globalThis.eval(P);var ie=function(Q){globalThis.eval(Q)};return{eval:ie}}};class EvalSandbox{constructor(y,d,m=[]){this.makeGlobal=d,this.sandbox=Sandbox(),this.parent=y;var S=Object.keys(y);S.forEach(P=>this.add(P)),this.userProps=m}add(y){this.makeGlobal&&(window[y]=this.parent[y])}set(y,d){this.makeGlobal&&(window[y]=d),this.parent[y]=d}tick(){this.makeGlobal&&this.userProps.forEach(y=>{this.parent[y]=window[y]})}eval(y){this.sandbox.eval(y)}}const DEFAULT_CONVERSIONS={float:{vec4:{name:"sum",args:[[1,1,1,1]]},vec2:{name:"sum",args:[[1,1]]}}},ensure_decimal_dot=b=>(b=b.toString(),b.indexOf(".")<0&&(b+="."),b);function formatArguments(b,y,d){const m=b.transform.inputs,S=b.userArgs,{generators:P}=b.synth,{src:ie}=P;return m.map((Q,he)=>{const te={value:Q.default,type:Q.type,isUniform:!1,name:Q.name,vecLen:0};if(te.type==="float"&&(te.value=ensure_decimal_dot(Q.default)),Q.type.startsWith("vec"))try{te.vecLen=Number.parseInt(Q.type.substr(3))}catch{console.log(`Error determining length of vector input type ${Q.type} (${Q.name})`)}if(S.length>he&&(te.value=S[he],typeof S[he]=="function"?(te.value=(D,se,ve)=>{try{const Ge=S[he](se);return typeof Ge=="number"?Ge:(console.warn("function does not return a number",S[he]),Q.default)}catch(Ge){return console.warn("ERROR",Ge),Q.default}},te.isUniform=!0):S[he].constructor===Array&&(te.value=(D,se,ve)=>ArrayUtils.getValue(S[he])(se),te.isUniform=!0)),!(y<0)){if(te.value&&te.value.transforms){const D=te.value.transforms[te.value.transforms.length-1];if(D.transform.glsl_return_type!==Q.type){const se=DEFAULT_CONVERSIONS[Q.type];if(typeof se<"u"){const ve=se[D.transform.glsl_return_type];if(typeof ve<"u"){const{name:Ge,args:qe}=ve;te.value=te.value[Ge](...qe)}}}te.isUniform=!1}else if(te.type==="float"&&typeof te.value=="number")te.value=ensure_decimal_dot(te.value);else if(te.type.startsWith("vec")&&typeof te.value=="object"&&Array.isArray(te.value))te.isUniform=!1,te.value=`${te.type}(${te.value.map(ensure_decimal_dot).join(", ")})`;else if(Q.type==="sampler2D"){var z=te.value;te.value=()=>z.getTexture(),te.isUniform=!0}else if(te.value.getTexture&&Q.type==="vec4"){var ue=te.value;te.value=ie(ue),te.isUniform=!1}te.isUniform&&(te.name+=y)}return te})}function generateGlsl(b){var y={uniforms:[],glslFunctions:[],fragColor:""},d=generateGlsl$1(b,y)("st");y.fragColor=d;let m={};return y.uniforms.forEach(S=>m[S.name]=S),y.uniforms=Object.values(m),y}function generateGlsl$1(b,y){var d=()=>"";return b.forEach(m=>{var S=formatArguments(m,y.uniforms.length);S.forEach(Q=>{Q.isUniform&&y.uniforms.push(Q)}),contains(m,y.glslFunctions)||y.glslFunctions.push(m);var P=d;if(m.transform.type==="src")d=Q=>`${shaderString(Q,m.name,S,y)}`;else if(m.transform.type==="coord")d=Q=>`${P(`${shaderString(Q,m.name,S,y)}`)}`;else if(m.transform.type==="color")d=Q=>`${shaderString(`${P(Q)}`,m.name,S,y)}`;else if(m.transform.type==="combine"){var ie=S[0].value&&S[0].value.transforms?Q=>`${generateGlsl$1(S[0].value.transforms,y)(Q)}`:S[0].isUniform?()=>S[0].name:()=>S[0].value;d=Q=>`${shaderString(`${P(Q)}, ${ie(Q)}`,m.name,S.slice(1),y)}`}else if(m.transform.type==="combineCoord"){var ie=S[0].value&&S[0].value.transforms?he=>`${generateGlsl$1(S[0].value.transforms,y)(he)}`:S[0].isUniform?()=>S[0].name:()=>S[0].value;d=he=>`${P(`${shaderString(`${he}, ${ie(he)}`,m.name,S.slice(1),y)}`)}`}}),d}function shaderString(b,y,d,m){const S=d.map(P=>P.isUniform?P.name:P.value&&P.value.transforms?`${generateGlsl$1(P.value.transforms,m)("st")}`:P.value).reduce((P,ie)=>`${P}, ${ie}`,"");return`${y}(${b}${S})`}function contains(b,y){for(var d=0;d<y.length;d++)if(b.name==y[d].name)return!0;return!1}const utilityGlsl={_luminance:{type:"util",glsl:`float _luminance(vec3 rgb){
      const vec3 W = vec3(0.2125, 0.7154, 0.0721);
      return dot(rgb, W);
    }`},_noise:{type:"util",glsl:`
    //	Simplex 3D Noise
    //	by Ian McEwan, Ashima Arts
    vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
  vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}

  float _noise(vec3 v){
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);

  // First corner
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;

  // Other corners
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );

    //  x0 = x0 - 0. + 0.0 * C
    vec3 x1 = x0 - i1 + 1.0 * C.xxx;
    vec3 x2 = x0 - i2 + 2.0 * C.xxx;
    vec3 x3 = x0 - 1. + 3.0 * C.xxx;

  // Permutations
    i = mod(i, 289.0 );
    vec4 p = permute( permute( permute(
               i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
             + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
             + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));

  // Gradients
  // ( N*N points uniformly over a square, mapped onto an octahedron.)
    float n_ = 1.0/7.0; // N=7
    vec3  ns = n_ * D.wyz - D.xzx;

    vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)

    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)

    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);

    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );

    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));

    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;

    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);

  //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;

  // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
  }
    `},_rgbToHsv:{type:"util",glsl:`vec3 _rgbToHsv(vec3 c){
            vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
            vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
            vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));

            float d = q.x - min(q.w, q.y);
            float e = 1.0e-10;
            return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
        }`},_hsvToRgb:{type:"util",glsl:`vec3 _hsvToRgb(vec3 c){
        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
    }`}};var GlslSource=function(b){return this.transforms=[],this.transforms.push(b),this.defaultOutput=b.defaultOutput,this.synth=b.synth,this.type="GlslSource",this.defaultUniforms=b.defaultUniforms,this};GlslSource.prototype.addTransform=function(b){this.transforms.push(b)};GlslSource.prototype.out=function(b){var y=b||this.defaultOutput,d=this.glsl(y);if(this.synth.currentFunctions=[],y)try{y.render(d)}catch(m){console.log("shader could not compile",m)}};GlslSource.prototype.glsl=function(){var b=[],y=[];return this.transforms.forEach(d=>{d.transform.type==="renderpass"?console.warn("no support for renderpass"):y.push(d)}),y.length>0&&b.push(this.compile(y)),b};GlslSource.prototype.compile=function(b){var y=generateGlsl(b,this.synth),d={};y.uniforms.forEach(S=>{d[S.name]=S.value});var m=`
  precision ${this.defaultOutput.precision} float;
  ${Object.values(y.uniforms).map(S=>{let P=S.type;switch(S.type){case"texture":P="sampler2D";break}return`
      uniform ${P} ${S.name};`}).join("")}
  uniform float time;
  uniform vec2 resolution;
  varying vec2 uv;
  uniform sampler2D prevBuffer;

  ${Object.values(utilityGlsl).map(S=>`
            ${S.glsl}
          `).join("")}

  ${y.glslFunctions.map(S=>`
            ${S.transform.glsl}
          `).join("")}

  void main () {
    vec4 c = vec4(1, 0, 0, 1);
    vec2 st = gl_FragCoord.xy/resolution.xy;
    gl_FragColor = ${y.fragColor};
  }
  `;return{frag:m,uniforms:Object.assign({},this.defaultUniforms,d)}};const glslFunctions=()=>[{name:"noise",type:"src",inputs:[{type:"float",name:"scale",default:10},{type:"float",name:"offset",default:.1}],glsl:"   return vec4(vec3(_noise(vec3(_st*scale, offset*time))), 1.0);"},{name:"voronoi",type:"src",inputs:[{type:"float",name:"scale",default:5},{type:"float",name:"speed",default:.3},{type:"float",name:"blending",default:.3}],glsl:`   vec3 color = vec3(.0);
   // Scale
   _st *= scale;
   // Tile the space
   vec2 i_st = floor(_st);
   vec2 f_st = fract(_st);
   float m_dist = 10.;  // minimun distance
   vec2 m_point;        // minimum point
   for (int j=-1; j<=1; j++ ) {
   for (int i=-1; i<=1; i++ ) {
   vec2 neighbor = vec2(float(i),float(j));
   vec2 p = i_st + neighbor;
   vec2 point = fract(sin(vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3))))*43758.5453);
   point = 0.5 + 0.5*sin(time*speed + 6.2831*point);
   vec2 diff = neighbor + point - f_st;
   float dist = length(diff);
   if( dist < m_dist ) {
   m_dist = dist;
   m_point = point;
   }
   }
   }
   // Assign a color using the closest point position
   color += dot(m_point,vec2(.3,.6));
   color *= 1.0 - blending*m_dist;
   return vec4(color, 1.0);`},{name:"osc",type:"src",inputs:[{type:"float",name:"frequency",default:60},{type:"float",name:"sync",default:.1},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st;
   float r = sin((st.x-offset/frequency+time*sync)*frequency)*0.5  + 0.5;
   float g = sin((st.x+time*sync)*frequency)*0.5 + 0.5;
   float b = sin((st.x+offset/frequency+time*sync)*frequency)*0.5  + 0.5;
   return vec4(r, g, b, 1.0);`},{name:"shape",type:"src",inputs:[{type:"float",name:"sides",default:3},{type:"float",name:"radius",default:.3},{type:"float",name:"smoothing",default:.01}],glsl:`   vec2 st = _st * 2. - 1.;
   // Angle and radius from the current pixel
   float a = atan(st.x,st.y)+3.1416;
   float r = (2.*3.1416)/sides;
   float d = cos(floor(.5+a/r)*r-a)*length(st);
   return vec4(vec3(1.0-smoothstep(radius,radius + smoothing + 0.0000001,d)), 1.0);`},{name:"gradient",type:"src",inputs:[{type:"float",name:"speed",default:0}],glsl:"   return vec4(_st, sin(time*speed), 1.0);"},{name:"src",type:"src",inputs:[{type:"sampler2D",name:"tex",default:NaN}],glsl:`   //  vec2 uv = gl_FragCoord.xy/vec2(1280., 720.);
   return texture2D(tex, fract(_st));`},{name:"solid",type:"src",inputs:[{type:"float",name:"r",default:0},{type:"float",name:"g",default:0},{type:"float",name:"b",default:0},{type:"float",name:"a",default:1}],glsl:"   return vec4(r, g, b, a);"},{name:"rotate",type:"coord",inputs:[{type:"float",name:"angle",default:10},{type:"float",name:"speed",default:0}],glsl:`   vec2 xy = _st - vec2(0.5);
   float ang = angle + speed *time;
   xy = mat2(cos(ang),-sin(ang), sin(ang),cos(ang))*xy;
   xy += 0.5;
   return xy;`},{name:"scale",type:"coord",inputs:[{type:"float",name:"amount",default:1.5},{type:"float",name:"xMult",default:1},{type:"float",name:"yMult",default:1},{type:"float",name:"offsetX",default:.5},{type:"float",name:"offsetY",default:.5}],glsl:`   vec2 xy = _st - vec2(offsetX, offsetY);
   xy*=(1.0/vec2(amount*xMult, amount*yMult));
   xy+=vec2(offsetX, offsetY);
   return xy;
   `},{name:"pixelate",type:"coord",inputs:[{type:"float",name:"pixelX",default:20},{type:"float",name:"pixelY",default:20}],glsl:`   vec2 xy = vec2(pixelX, pixelY);
   return (floor(_st * xy) + 0.5)/xy;`},{name:"posterize",type:"color",inputs:[{type:"float",name:"bins",default:3},{type:"float",name:"gamma",default:.6}],glsl:`   vec4 c2 = pow(_c0, vec4(gamma));
   c2 *= vec4(bins);
   c2 = floor(c2);
   c2/= vec4(bins);
   c2 = pow(c2, vec4(1.0/gamma));
   return vec4(c2.xyz, _c0.a);`},{name:"shift",type:"color",inputs:[{type:"float",name:"r",default:.5},{type:"float",name:"g",default:0},{type:"float",name:"b",default:0},{type:"float",name:"a",default:0}],glsl:`   vec4 c2 = vec4(_c0);
   c2.r = fract(c2.r + r);
   c2.g = fract(c2.g + g);
   c2.b = fract(c2.b + b);
   c2.a = fract(c2.a + a);
   return vec4(c2.rgba);`},{name:"repeat",type:"coord",inputs:[{type:"float",name:"repeatX",default:3},{type:"float",name:"repeatY",default:3},{type:"float",name:"offsetX",default:0},{type:"float",name:"offsetY",default:0}],glsl:`   vec2 st = _st * vec2(repeatX, repeatY);
   st.x += step(1., mod(st.y,2.0)) * offsetX;
   st.y += step(1., mod(st.x,2.0)) * offsetY;
   return fract(st);`},{name:"modulateRepeat",type:"combineCoord",inputs:[{type:"float",name:"repeatX",default:3},{type:"float",name:"repeatY",default:3},{type:"float",name:"offsetX",default:.5},{type:"float",name:"offsetY",default:.5}],glsl:`   vec2 st = _st * vec2(repeatX, repeatY);
   st.x += step(1., mod(st.y,2.0)) + _c0.r * offsetX;
   st.y += step(1., mod(st.x,2.0)) + _c0.g * offsetY;
   return fract(st);`},{name:"repeatX",type:"coord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y += step(1., mod(st.x,2.0))* offset;
   return fract(st);`},{name:"modulateRepeatX",type:"combineCoord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:.5}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y += step(1., mod(st.x,2.0)) + _c0.r * offset;
   return fract(st);`},{name:"repeatY",type:"coord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st * vec2(1.0, reps);
   //  float f =  mod(_st.y,2.0);
   st.x += step(1., mod(st.y,2.0))* offset;
   return fract(st);`},{name:"modulateRepeatY",type:"combineCoord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:.5}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.x += step(1., mod(st.y,2.0)) + _c0.r * offset;
   return fract(st);`},{name:"kaleid",type:"coord",inputs:[{type:"float",name:"nSides",default:4}],glsl:`   vec2 st = _st;
   st -= 0.5;
   float r = length(st);
   float a = atan(st.y, st.x);
   float pi = 2.*3.1416;
   a = mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return r*vec2(cos(a), sin(a));`},{name:"modulateKaleid",type:"combineCoord",inputs:[{type:"float",name:"nSides",default:4}],glsl:`   vec2 st = _st - 0.5;
   float r = length(st);
   float a = atan(st.y, st.x);
   float pi = 2.*3.1416;
   a = mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return (_c0.r+r)*vec2(cos(a), sin(a));`},{name:"scroll",type:"coord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"scrollY",default:.5},{type:"float",name:"speedX",default:0},{type:"float",name:"speedY",default:0}],glsl:`
   _st.x += scrollX + time*speedX;
   _st.y += scrollY + time*speedY;
   return fract(_st);`},{name:"scrollX",type:"coord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.x += scrollX + time*speed;
   return fract(_st);`},{name:"modulateScrollX",type:"combineCoord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.x += _c0.r*scrollX + time*speed;
   return fract(_st);`},{name:"scrollY",type:"coord",inputs:[{type:"float",name:"scrollY",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.y += scrollY + time*speed;
   return fract(_st);`},{name:"modulateScrollY",type:"combineCoord",inputs:[{type:"float",name:"scrollY",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.y += _c0.r*scrollY + time*speed;
   return fract(_st);`},{name:"add",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return (_c0+_c1)*amount + _c0*(1.0-amount);"},{name:"sub",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return (_c0-_c1)*amount + _c0*(1.0-amount);"},{name:"layer",type:"combine",inputs:[],glsl:"   return vec4(mix(_c0.rgb, _c1.rgb, _c1.a), clamp(_c0.a + _c1.a, 0.0, 1.0));"},{name:"blend",type:"combine",inputs:[{type:"float",name:"amount",default:.5}],glsl:"   return _c0*(1.0-amount)+_c1*amount;"},{name:"mult",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return _c0*(1.0-amount)+(_c0*_c1)*amount;"},{name:"diff",type:"combine",inputs:[],glsl:"   return vec4(abs(_c0.rgb-_c1.rgb), max(_c0.a, _c1.a));"},{name:"modulate",type:"combineCoord",inputs:[{type:"float",name:"amount",default:.1}],glsl:`   //  return fract(st+(_c0.xy-0.5)*amount);
   return _st + _c0.xy*amount;`},{name:"modulateScale",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:1},{type:"float",name:"offset",default:1}],glsl:`   vec2 xy = _st - vec2(0.5);
   xy*=(1.0/vec2(offset + multiple*_c0.r, offset + multiple*_c0.g));
   xy+=vec2(0.5);
   return xy;`},{name:"modulatePixelate",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:10},{type:"float",name:"offset",default:3}],glsl:`   vec2 xy = vec2(offset + _c0.x*multiple, offset + _c0.y*multiple);
   return (floor(_st * xy) + 0.5)/xy;`},{name:"modulateRotate",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:1},{type:"float",name:"offset",default:0}],glsl:`   vec2 xy = _st - vec2(0.5);
   float angle = offset + _c0.x * multiple;
   xy = mat2(cos(angle),-sin(angle), sin(angle),cos(angle))*xy;
   xy += 0.5;
   return xy;`},{name:"modulateHue",type:"combineCoord",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return _st + (vec2(_c0.g - _c0.r, _c0.b - _c0.g) * amount * 1.0/resolution);"},{name:"invert",type:"color",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return vec4((1.0-_c0.rgb)*amount + _c0.rgb*(1.0-amount), _c0.a);"},{name:"contrast",type:"color",inputs:[{type:"float",name:"amount",default:1.6}],glsl:`   vec4 c = (_c0-vec4(0.5))*vec4(amount) + vec4(0.5);
   return vec4(c.rgb, _c0.a);`},{name:"brightness",type:"color",inputs:[{type:"float",name:"amount",default:.4}],glsl:"   return vec4(_c0.rgb + vec3(amount), _c0.a);"},{name:"mask",type:"combine",inputs:[],glsl:`   float a = _luminance(_c1.rgb);
  return vec4(_c0.rgb*a, a*_c0.a);`},{name:"luma",type:"color",inputs:[{type:"float",name:"threshold",default:.5},{type:"float",name:"tolerance",default:.1}],glsl:`   float a = smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb));
   return vec4(_c0.rgb*a, a);`},{name:"thresh",type:"color",inputs:[{type:"float",name:"threshold",default:.5},{type:"float",name:"tolerance",default:.04}],glsl:"   return vec4(vec3(smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb))), _c0.a);"},{name:"color",type:"color",inputs:[{type:"float",name:"r",default:1},{type:"float",name:"g",default:1},{type:"float",name:"b",default:1},{type:"float",name:"a",default:1}],glsl:`   vec4 c = vec4(r, g, b, a);
   vec4 pos = step(0.0, c); // detect whether negative
   // if > 0, return r * _c0
   // if < 0 return (1.0-r) * _c0
   return vec4(mix((1.0-_c0)*abs(c), c*_c0, pos));`},{name:"saturate",type:"color",inputs:[{type:"float",name:"amount",default:2}],glsl:`   const vec3 W = vec3(0.2125, 0.7154, 0.0721);
   vec3 intensity = vec3(dot(_c0.rgb, W));
   return vec4(mix(intensity, _c0.rgb, amount), _c0.a);`},{name:"hue",type:"color",inputs:[{type:"float",name:"hue",default:.4}],glsl:`   vec3 c = _rgbToHsv(_c0.rgb);
   c.r += hue;
   //  c.r = fract(c.r);
   return vec4(_hsvToRgb(c), _c0.a);`},{name:"colorama",type:"color",inputs:[{type:"float",name:"amount",default:.005}],glsl:`   vec3 c = _rgbToHsv(_c0.rgb);
   c += vec3(amount);
   c = _hsvToRgb(c);
   c = fract(c);
   return vec4(c, _c0.a);`},{name:"prev",type:"src",inputs:[],glsl:"   return texture2D(prevBuffer, fract(_st));"},{name:"sum",type:"color",inputs:[{type:"vec4",name:"scale",default:1}],glsl:`   vec4 v = _c0 * s;
   return v.r + v.g + v.b + v.a;
   }
   float sum(vec2 _st, vec4 s) { // vec4 is not a typo, because argument type is not overloaded
   vec2 v = _st.xy * s.xy;
   return v.x + v.y;`},{name:"r",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.r * scale + offset);"},{name:"g",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.g * scale + offset);"},{name:"b",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.b * scale + offset);"},{name:"a",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.a * scale + offset);"}];class GeneratorFactory{constructor({defaultUniforms:y,defaultOutput:d,extendTransforms:m=[],changeListener:S=()=>{}}={}){this.defaultOutput=d,this.defaultUniforms=y,this.changeListener=S,this.extendTransforms=m,this.generators={},this.init()}init(){const y=glslFunctions();return this.glslTransforms={},this.generators=Object.entries(this.generators).reduce((d,[m,S])=>(this.changeListener({type:"remove",synth:this,method:m}),d),{}),this.sourceClass=class extends GlslSource{},Array.isArray(this.extendTransforms)?y.concat(this.extendTransforms):typeof this.extendTransforms=="object"&&this.extendTransforms.type&&y.push(this.extendTransforms),y.map(d=>this.setFunction(d))}_addMethod(y,d){const m=this;if(this.glslTransforms[y]=d,d.type==="src"){const S=(...P)=>new this.sourceClass({name:y,transform:d,userArgs:P,defaultOutput:this.defaultOutput,defaultUniforms:this.defaultUniforms,synth:m});return this.generators[y]=S,this.changeListener({type:"add",synth:this,method:y}),S}else this.sourceClass.prototype[y]=function(...S){return this.transforms.push({name:y,transform:d,userArgs:S,synth:m}),this}}setFunction(y){var d=processGlsl(y);d&&this._addMethod(y.name,d)}}const typeLookup={src:{returnType:"vec4",args:["vec2 _st"]},coord:{returnType:"vec2",args:["vec2 _st"]},color:{returnType:"vec4",args:["vec4 _c0"]},combine:{returnType:"vec4",args:["vec4 _c0","vec4 _c1"]},combineCoord:{returnType:"vec2",args:["vec2 _st","vec4 _c0"]}};function processGlsl(b){let y=typeLookup[b.type];if(y){let d=y.args.map(ie=>ie).join(", "),m=b.inputs.map(ie=>`${ie.type} ${ie.name}`).join(", "),S=`${d}${m.length>0?", "+m:""}`,P=`
  ${y.returnType} ${b.name}(${S}) {
      ${b.glsl}
  }
`;return(b.type==="combine"||b.type==="combineCoord")&&b.inputs.unshift({name:"color",type:"vec4"}),Object.assign({},b,{glsl:P})}else console.warn(`type ${b.type} not recognized`,b)}var regl$2={exports:{}},regl$1=regl$2.exports,hasRequiredRegl;function requireRegl(){return hasRequiredRegl||(hasRequiredRegl=1,function(b,y){(function(d,m){b.exports=m()})(regl$1,function(){var d=function(u){return u instanceof Uint8Array||u instanceof Uint16Array||u instanceof Uint32Array||u instanceof Int8Array||u instanceof Int16Array||u instanceof Int32Array||u instanceof Float32Array||u instanceof Float64Array||u instanceof Uint8ClampedArray},m=function(u,L){for(var W=Object.keys(L),re=0;re<W.length;++re)u[W[re]]=L[W[re]];return u},S=`
`;function P(u){return typeof atob<"u"?atob(u):"base64:"+u}function ie(u){var L=new Error("(regl) "+u);throw console.error(L),L}function Q(u,L){u||ie(L)}function he(u){return u?": "+u:""}function te(u,L,W){u in L||ie("unknown parameter ("+u+")"+he(W)+". possible values: "+Object.keys(L).join())}function z(u,L){d(u)||ie("invalid parameter type"+he(L)+". must be a typed array")}function ue(u,L){switch(L){case"number":return typeof u=="number";case"object":return typeof u=="object";case"string":return typeof u=="string";case"boolean":return typeof u=="boolean";case"function":return typeof u=="function";case"undefined":return typeof u>"u";case"symbol":return typeof u=="symbol"}}function D(u,L,W){ue(u,L)||ie("invalid parameter type"+he(W)+". expected "+L+", got "+typeof u)}function se(u,L){u>=0&&(u|0)===u||ie("invalid parameter type, ("+u+")"+he(L)+". must be a nonnegative integer")}function ve(u,L,W){L.indexOf(u)<0&&ie("invalid value"+he(W)+". must be one of: "+L)}var Ge=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function qe(u){Object.keys(u).forEach(function(L){Ge.indexOf(L)<0&&ie('invalid regl constructor argument "'+L+'". must be one of '+Ge)})}function q(u,L){for(u=u+"";u.length<L;)u=" "+u;return u}function A(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function j(u,L){this.number=u,this.line=L,this.errors=[]}function h(u,L,W){this.file=u,this.line=L,this.message=W}function _(){var u=new Error,L=(u.stack||u).toString(),W=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(L);if(W)return W[1];var re=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(L);return re?re[1]:"unknown"}function G(){var u=new Error,L=(u.stack||u).toString(),W=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(L);if(W)return W[1];var re=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(L);return re?re[1]:"unknown"}function U(u,L){var W=u.split(`
`),re=1,Ce=0,pe={unknown:new A,0:new A};pe.unknown.name=pe[0].name=L||_(),pe.unknown.lines.push(new j(0,""));for(var ge=0;ge<W.length;++ge){var Me=W[ge],Fe=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Me);if(Fe)switch(Fe[1]){case"line":var Be=/(\d+)(\s+\d+)?/.exec(Fe[2]);Be&&(re=Be[1]|0,Be[2]&&(Ce=Be[2]|0,Ce in pe||(pe[Ce]=new A)));break;case"define":var Ee=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Fe[2]);Ee&&(pe[Ce].name=Ee[1]?P(Ee[2]):Ee[2]);break}pe[Ce].lines.push(new j(re++,Me))}return Object.keys(pe).forEach(function(ze){var Xe=pe[ze];Xe.lines.forEach(function(Ie){Xe.index[Ie.number]=Ie})}),pe}function ae(u){var L=[];return u.split(`
`).forEach(function(W){if(!(W.length<5)){var re=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(W);re?L.push(new h(re[1]|0,re[2]|0,re[3].trim())):W.length>0&&L.push(new h("unknown",0,W))}}),L}function we(u,L){L.forEach(function(W){var re=u[W.file];if(re){var Ce=re.index[W.line];if(Ce){Ce.errors.push(W),re.hasErrors=!0;return}}u.unknown.hasErrors=!0,u.unknown.lines[0].errors.push(W)})}function Ne(u,L,W,re,Ce){if(!u.getShaderParameter(L,u.COMPILE_STATUS)){var pe=u.getShaderInfoLog(L),ge=re===u.FRAGMENT_SHADER?"fragment":"vertex";ye(W,"string",ge+" shader source must be a string",Ce);var Me=U(W,Ce),Fe=ae(pe);we(Me,Fe),Object.keys(Me).forEach(function(Be){var Ee=Me[Be];if(!Ee.hasErrors)return;var ze=[""],Xe=[""];function Ie(He,e){ze.push(He),Xe.push(e||"")}Ie("file number "+Be+": "+Ee.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Ee.lines.forEach(function(He){if(He.errors.length>0){Ie(q(He.number,4)+"|  ","background-color:yellow; font-weight:bold"),Ie(He.line+S,"color:red; background-color:yellow; font-weight:bold");var e=0;He.errors.forEach(function(t){var r=t.message,n=/^\s*'(.*)'\s*:\s*(.*)$/.exec(r);if(n){var i=n[1];switch(r=n[2],i){case"assign":i="=";break}e=Math.max(He.line.indexOf(i,e),0)}else e=0;Ie(q("| ",6)),Ie(q("^^^",e+3)+S,"font-weight:bold"),Ie(q("| ",6)),Ie(r+S,"font-weight:bold")}),Ie(q("| ",6)+S)}else Ie(q(He.number,4)+"|  "),Ie(He.line+S,"color:red")}),typeof document<"u"&&!window.chrome?(Xe[0]=ze.join("%c"),console.log.apply(console,Xe)):console.log(ze.join(""))}),Q.raise("Error compiling "+ge+" shader, "+Me[0].name)}}function ke(u,L,W,re,Ce){if(!u.getProgramParameter(L,u.LINK_STATUS)){var pe=u.getProgramInfoLog(L),ge=U(W,Ce),Me=U(re,Ce),Fe='Error linking program with vertex shader, "'+Me[0].name+'", and fragment shader "'+ge[0].name+'"';typeof document<"u"?console.log("%c"+Fe+S+"%c"+pe,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Fe+S+pe),Q.raise(Fe)}}function We(u){u._commandRef=_()}function C(u,L,W,re){We(u);function Ce(Fe){return Fe?re.id(Fe):0}u._fragId=Ce(u.static.frag),u._vertId=Ce(u.static.vert);function pe(Fe,Be){Object.keys(Be).forEach(function(Ee){Fe[re.id(Ee)]=!0})}var ge=u._uniformSet={};pe(ge,L.static),pe(ge,L.dynamic);var Me=u._attributeSet={};pe(Me,W.static),pe(Me,W.dynamic),u._hasCount="count"in u.static||"count"in u.dynamic||"elements"in u.static||"elements"in u.dynamic}function E(u,L){var W=G();ie(u+" in command "+(L||_())+(W==="unknown"?"":" called from "+W))}function p(u,L,W){u||E(L,W||_())}function Z(u,L,W,re){u in L||E("unknown parameter ("+u+")"+he(W)+". possible values: "+Object.keys(L).join(),re||_())}function ye(u,L,W,re){ue(u,L)||E("invalid parameter type"+he(W)+". expected "+L+", got "+typeof u,re||_())}function Pe(u){u()}function Ve(u,L,W){u.texture?ve(u.texture._texture.internalformat,L,"unsupported texture format for attachment"):ve(u.renderbuffer._renderbuffer.format,W,"unsupported renderbuffer format for attachment")}var $e=33071,Ye=9728,Je=9984,at=9985,Ot=9986,st=9987,ut=5120,tt=5121,pt=5122,Ct=5123,Ht=5124,ft=5125,Mt=5126,$t=32819,ar=32820,Sr=33635,ur=34042,Vt=36193,Nt={};Nt[ut]=Nt[tt]=1,Nt[pt]=Nt[Ct]=Nt[Vt]=Nt[Sr]=Nt[$t]=Nt[ar]=2,Nt[Ht]=Nt[ft]=Nt[Mt]=Nt[ur]=4;function nn(u,L){return u===ar||u===$t||u===Sr?2:u===ur?4:Nt[u]*L}function _t(u){return!(u&u-1)&&!!u}function ri(u,L,W){var re,Ce=L.width,pe=L.height,ge=L.channels;Q(Ce>0&&Ce<=W.maxTextureSize&&pe>0&&pe<=W.maxTextureSize,"invalid texture shape"),(u.wrapS!==$e||u.wrapT!==$e)&&Q(_t(Ce)&&_t(pe),"incompatible wrap mode for texture, both width and height must be power of 2"),L.mipmask===1?Ce!==1&&pe!==1&&Q(u.minFilter!==Je&&u.minFilter!==Ot&&u.minFilter!==at&&u.minFilter!==st,"min filter requires mipmap"):(Q(_t(Ce)&&_t(pe),"texture must be a square power of 2 to support mipmapping"),Q(L.mipmask===(Ce<<1)-1,"missing or incomplete mipmap data")),L.type===Mt&&(W.extensions.indexOf("oes_texture_float_linear")<0&&Q(u.minFilter===Ye&&u.magFilter===Ye,"filter not supported, must enable oes_texture_float_linear"),Q(!u.genMipmaps,"mipmap generation not supported with float textures"));var Me=L.images;for(re=0;re<16;++re)if(Me[re]){var Fe=Ce>>re,Be=pe>>re;Q(L.mipmask&1<<re,"missing mipmap data");var Ee=Me[re];if(Q(Ee.width===Fe&&Ee.height===Be,"invalid shape for mip images"),Q(Ee.format===L.format&&Ee.internalformat===L.internalformat&&Ee.type===L.type,"incompatible type for mip image"),!Ee.compressed)if(Ee.data){var ze=Math.ceil(nn(Ee.type,ge)*Fe/Ee.unpackAlignment)*Ee.unpackAlignment;Q(Ee.data.byteLength===ze*Be,"invalid data for image, buffer size is inconsistent with image format")}else Ee.element||Ee.copy}else u.genMipmaps||Q((L.mipmask&1<<re)===0,"extra mipmap data");L.compressed&&Q(!u.genMipmaps,"mipmap generation for compressed images not supported")}function qo(u,L,W,re){var Ce=u.width,pe=u.height,ge=u.channels;Q(Ce>0&&Ce<=re.maxTextureSize&&pe>0&&pe<=re.maxTextureSize,"invalid texture shape"),Q(Ce===pe,"cube map must be square"),Q(L.wrapS===$e&&L.wrapT===$e,"wrap mode not supported by cube map");for(var Me=0;Me<W.length;++Me){var Fe=W[Me];Q(Fe.width===Ce&&Fe.height===pe,"inconsistent cube map face shape"),L.genMipmaps&&(Q(!Fe.compressed,"can not generate mipmap for compressed textures"),Q(Fe.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Be=Fe.images,Ee=0;Ee<16;++Ee){var ze=Be[Ee];if(ze){var Xe=Ce>>Ee,Ie=pe>>Ee;Q(Fe.mipmask&1<<Ee,"missing mipmap data"),Q(ze.width===Xe&&ze.height===Ie,"invalid shape for mip images"),Q(ze.format===u.format&&ze.internalformat===u.internalformat&&ze.type===u.type,"incompatible type for mip image"),ze.compressed||(ze.data?Q(ze.data.byteLength===Xe*Ie*Math.max(nn(ze.type,ge),ze.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):ze.element||ze.copy)}}}}var M=m(Q,{optional:Pe,raise:ie,commandRaise:E,command:p,parameter:te,commandParameter:Z,constructor:qe,type:D,commandType:ye,isTypedArray:z,nni:se,oneOf:ve,shaderError:Ne,linkError:ke,callSite:G,saveCommandRef:We,saveDrawInfo:C,framebufferFormat:Ve,guessCommand:_,texture2D:ri,textureCube:qo}),Za=0,Uo=0,ua=5,an=6;function Kr(u,L){this.id=Za++,this.type=u,this.data=L}function Yr(u){return u.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function jt(u){if(u.length===0)return[];var L=u.charAt(0),W=u.charAt(u.length-1);if(u.length>1&&L===W&&(L==='"'||L==="'"))return['"'+Yr(u.substr(1,u.length-2))+'"'];var re=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(u);if(re)return jt(u.substr(0,re.index)).concat(jt(re[1])).concat(jt(u.substr(re.index+re[0].length)));var Ce=u.split(".");if(Ce.length===1)return['"'+Yr(u)+'"'];for(var pe=[],ge=0;ge<Ce.length;++ge)pe=pe.concat(jt(Ce[ge]));return pe}function on(u){return"["+jt(u).join("][")+"]"}function $r(u,L){return new Kr(u,on(L+""))}function Mn(u){return typeof u=="function"&&!u._reglType||u instanceof Kr}function Fn(u,L){if(typeof u=="function")return new Kr(Uo,u);if(typeof u=="number"||typeof u=="boolean")return new Kr(ua,u);if(Array.isArray(u))return new Kr(an,u.map((W,re)=>Fn(W,L+"["+re+"]")));if(u instanceof Kr)return u;M(!1,"invalid option type in uniform "+L)}var nr={DynamicVariable:Kr,define:$r,isDynamic:Mn,unbox:Fn,accessor:on},ca={next:typeof requestAnimationFrame=="function"?function(u){return requestAnimationFrame(u)}:function(u){return setTimeout(u,16)},cancel:typeof cancelAnimationFrame=="function"?function(u){return cancelAnimationFrame(u)}:clearTimeout},kt=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Ja(){var u={"":0},L=[""];return{id:function(W){var re=u[W];return re||(re=u[W]=L.length,L.push(W),re)},str:function(W){return L[W]}}}function ht(u,L,W){var re=document.createElement("canvas");m(re.style,{border:0,margin:0,padding:0,top:0,left:0}),u.appendChild(re),u===document.body&&(re.style.position="absolute",m(u.style,{margin:0,padding:0}));function Ce(){var Me=window.innerWidth,Fe=window.innerHeight;if(u!==document.body){var Be=u.getBoundingClientRect();Me=Be.right-Be.left,Fe=Be.bottom-Be.top}re.width=W*Me,re.height=W*Fe,m(re.style,{width:Me+"px",height:Fe+"px"})}var pe;u!==document.body&&typeof ResizeObserver=="function"?(pe=new ResizeObserver(function(){setTimeout(Ce)}),pe.observe(u)):window.addEventListener("resize",Ce,!1);function ge(){pe?pe.disconnect():window.removeEventListener("resize",Ce),u.removeChild(re)}return Ce(),{canvas:re,onDestroy:ge}}function sn(u,L){function W(re){try{return u.getContext(re,L)}catch{return null}}return W("webgl")||W("experimental-webgl")||W("webgl-experimental")}function cr(u){return typeof u.nodeName=="string"&&typeof u.appendChild=="function"&&typeof u.getBoundingClientRect=="function"}function Qt(u){return typeof u.drawArrays=="function"||typeof u.drawElements=="function"}function Yt(u){return typeof u=="string"?u.split():(M(Array.isArray(u),"invalid extension array"),u)}function _r(u){return typeof u=="string"?(M(typeof document<"u","not supported outside of DOM"),document.querySelector(u)):u}function wr(u){var L=u||{},W,re,Ce,pe,ge={},Me=[],Fe=[],Be=typeof window>"u"?1:window.devicePixelRatio,Ee=!1,ze=function(He){He&&M.raise(He)},Xe=function(){};if(typeof L=="string"?(M(typeof document<"u","selector queries only supported in DOM enviroments"),W=document.querySelector(L),M(W,"invalid query string for element")):typeof L=="object"?cr(L)?W=L:Qt(L)?(pe=L,Ce=pe.canvas):(M.constructor(L),"gl"in L?pe=L.gl:"canvas"in L?Ce=_r(L.canvas):"container"in L&&(re=_r(L.container)),"attributes"in L&&(ge=L.attributes,M.type(ge,"object","invalid context attributes")),"extensions"in L&&(Me=Yt(L.extensions)),"optionalExtensions"in L&&(Fe=Yt(L.optionalExtensions)),"onDone"in L&&(M.type(L.onDone,"function","invalid or missing onDone callback"),ze=L.onDone),"profile"in L&&(Ee=!!L.profile),"pixelRatio"in L&&(Be=+L.pixelRatio,M(Be>0,"invalid pixel ratio"))):M.raise("invalid arguments to regl"),W&&(W.nodeName.toLowerCase()==="canvas"?Ce=W:re=W),!pe){if(!Ce){M(typeof document<"u","must manually specify webgl context outside of DOM environments");var Ie=ht(re||document.body,ze,Be);if(!Ie)return null;Ce=Ie.canvas,Xe=Ie.onDestroy}ge.premultipliedAlpha===void 0&&(ge.premultipliedAlpha=!0),pe=sn(Ce,ge)}return pe?{gl:pe,canvas:Ce,container:re,extensions:Me,optionalExtensions:Fe,pixelRatio:Be,profile:Ee,onDone:ze,onDestroy:Xe}:(Xe(),ze("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Nr(u,L){var W={};function re(ge){M.type(ge,"string","extension name must be string");var Me=ge.toLowerCase(),Fe;try{Fe=W[Me]=u.getExtension(Me)}catch{}return!!Fe}for(var Ce=0;Ce<L.extensions.length;++Ce){var pe=L.extensions[Ce];if(!re(pe))return L.onDestroy(),L.onDone('"'+pe+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return L.optionalExtensions.forEach(re),{extensions:W,restore:function(){Object.keys(W).forEach(function(ge){if(W[ge]&&!re(ge))throw new Error("(regl): error restoring extension "+ge)})}}}function qt(u,L){for(var W=Array(u),re=0;re<u;++re)W[re]=L(re);return W}var _i=5120,gr=5121,In=5122,da=5123,Br=5124,Xo=5125,Ei=5126;function eo(u){for(var L=16;L<=1<<28;L*=16)if(u<=L)return L;return 0}function Li(u){var L,W;return L=(u>65535)<<4,u>>>=L,W=(u>255)<<3,u>>>=W,L|=W,W=(u>15)<<2,u>>>=W,L|=W,W=(u>3)<<1,u>>>=W,L|=W,L|u>>1}function ln(){var u=qt(8,function(){return[]});function L(pe){var ge=eo(pe),Me=u[Li(ge)>>2];return Me.length>0?Me.pop():new ArrayBuffer(ge)}function W(pe){u[Li(pe.byteLength)>>2].push(pe)}function re(pe,ge){var Me=null;switch(pe){case _i:Me=new Int8Array(L(ge),0,ge);break;case gr:Me=new Uint8Array(L(ge),0,ge);break;case In:Me=new Int16Array(L(2*ge),0,ge);break;case da:Me=new Uint16Array(L(2*ge),0,ge);break;case Br:Me=new Int32Array(L(4*ge),0,ge);break;case Xo:Me=new Uint32Array(L(4*ge),0,ge);break;case Ei:Me=new Float32Array(L(4*ge),0,ge);break;default:return null}return Me.length!==ge?Me.subarray(0,ge):Me}function Ce(pe){W(pe.buffer)}return{alloc:L,free:W,allocType:re,freeType:Ce}}var Bt=ln();Bt.zero=ln();var Pn=3408,to=3410,Dr=3411,jo=3412,ki=3413,Gr=3414,Hr=3415,ni=33901,Ai=33902,Oi=3379,Nn=3386,Ri=34921,Vr=36347,ha=36348,Mi=35661,Zt=35660,lt=34930,fn=36349,pa=34076,Er=34024,v=7936,X=7937,Ae=7938,Ue=35724,be=34047,Qe=36063,zt=34852,Jt=3553,hr=34067,Fi=34069,Ys=33984,gt=6408,Ko=5126,Yo=5121,Ii=36160,Qr=36053,$s=36064,Vs=16384,va=function(u,L){var W=1;L.ext_texture_filter_anisotropic&&(W=u.getParameter(be));var re=1,Ce=1;L.webgl_draw_buffers&&(re=u.getParameter(zt),Ce=u.getParameter(Qe));var pe=!!L.oes_texture_float;if(pe){var ge=u.createTexture();u.bindTexture(Jt,ge),u.texImage2D(Jt,0,gt,1,1,0,gt,Ko,null);var Me=u.createFramebuffer();if(u.bindFramebuffer(Ii,Me),u.framebufferTexture2D(Ii,$s,Jt,ge,0),u.bindTexture(Jt,null),u.checkFramebufferStatus(Ii)!==Qr)pe=!1;else{u.viewport(0,0,1,1),u.clearColor(1,0,0,1),u.clear(Vs);var Fe=Bt.allocType(Ko,4);u.readPixels(0,0,1,1,gt,Ko,Fe),u.getError()?pe=!1:(u.deleteFramebuffer(Me),u.deleteTexture(ge),pe=Fe[0]===1),Bt.freeType(Fe)}}var Be=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Ee=!0;if(!Be){var ze=u.createTexture(),Xe=Bt.allocType(Yo,36);u.activeTexture(Ys),u.bindTexture(hr,ze),u.texImage2D(Fi,0,gt,3,3,0,gt,Yo,Xe),Bt.freeType(Xe),u.bindTexture(hr,null),u.deleteTexture(ze),Ee=!u.getError()}return{colorBits:[u.getParameter(to),u.getParameter(Dr),u.getParameter(jo),u.getParameter(ki)],depthBits:u.getParameter(Gr),stencilBits:u.getParameter(Hr),subpixelBits:u.getParameter(Pn),extensions:Object.keys(L).filter(function(Ie){return!!L[Ie]}),maxAnisotropic:W,maxDrawbuffers:re,maxColorAttachments:Ce,pointSizeDims:u.getParameter(ni),lineWidthDims:u.getParameter(Ai),maxViewportDims:u.getParameter(Nn),maxCombinedTextureUnits:u.getParameter(Mi),maxCubeMapSize:u.getParameter(pa),maxRenderbufferSize:u.getParameter(Er),maxTextureUnits:u.getParameter(lt),maxTextureSize:u.getParameter(Oi),maxAttributes:u.getParameter(Ri),maxVertexUniforms:u.getParameter(Vr),maxVertexTextureUnits:u.getParameter(Zt),maxVaryingVectors:u.getParameter(ha),maxFragmentUniforms:u.getParameter(fn),glsl:u.getParameter(Ue),renderer:u.getParameter(X),vendor:u.getParameter(v),version:u.getParameter(Ae),readFloat:pe,npotTextureCube:Ee}};function Lr(u){return!!u&&typeof u=="object"&&Array.isArray(u.shape)&&Array.isArray(u.stride)&&typeof u.offset=="number"&&u.shape.length===u.stride.length&&(Array.isArray(u.data)||d(u.data))}var Tr=function(u){return Object.keys(u).map(function(L){return u[L]})},Pi={shape:ef,flatten:Jl};function Qs(u,L,W){for(var re=0;re<L;++re)W[re]=u[re]}function Zs(u,L,W,re){for(var Ce=0,pe=0;pe<L;++pe)for(var ge=u[pe],Me=0;Me<W;++Me)re[Ce++]=ge[Me]}function $o(u,L,W,re,Ce,pe){for(var ge=pe,Me=0;Me<L;++Me)for(var Fe=u[Me],Be=0;Be<W;++Be)for(var Ee=Fe[Be],ze=0;ze<re;++ze)Ce[ge++]=Ee[ze]}function Vo(u,L,W,re,Ce){for(var pe=1,ge=W+1;ge<L.length;++ge)pe*=L[ge];var Me=L[W];if(L.length-W===4){var Fe=L[W+1],Be=L[W+2],Ee=L[W+3];for(ge=0;ge<Me;++ge)$o(u[ge],Fe,Be,Ee,re,Ce),Ce+=pe}else for(ge=0;ge<Me;++ge)Vo(u[ge],L,W+1,re,Ce),Ce+=pe}function Jl(u,L,W,re){var Ce=1;if(L.length)for(var pe=0;pe<L.length;++pe)Ce*=L[pe];else Ce=0;var ge=re||Bt.allocType(W,Ce);switch(L.length){case 0:break;case 1:Qs(u,L[0],ge);break;case 2:Zs(u,L[0],L[1],ge);break;case 3:$o(u,L[0],L[1],L[2],ge,0);break;default:Vo(u,L,0,ge,0)}return ge}function ef(u){for(var L=[],W=u;W.length;W=W[0])L.push(W.length);return L}var ro={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},un=5120,tf=5122,rf=5124,no=5121,ma=5123,nf=5125,af=5126,of=5126,ii={int8:un,int16:tf,int32:rf,uint8:no,uint16:ma,uint32:nf,float:af,float32:of},Qo=35048,Js=35040,io={dynamic:Qo,stream:Js,static:35044},ao=Pi.flatten,Zo=Pi.shape,ga=35044,oo=35040,ya=5121,so=5126,cn=[];cn[5120]=1,cn[5122]=2,cn[5124]=4,cn[5121]=1,cn[5123]=2,cn[5125]=4,cn[5126]=4;function ai(u){return ro[Object.prototype.toString.call(u)]|0}function el(u,L){for(var W=0;W<L.length;++W)u[W]=L[W]}function Jo(u,L,W,re,Ce,pe,ge){for(var Me=0,Fe=0;Fe<W;++Fe)for(var Be=0;Be<re;++Be)u[Me++]=L[Ce*Fe+pe*Be+ge]}function zr(u,L,W,re){var Ce=0,pe={};function ge(e){this.id=Ce++,this.buffer=u.createBuffer(),this.type=e,this.usage=ga,this.byteLength=0,this.dimension=1,this.dtype=ya,this.persistentData=null,W.profile&&(this.stats={size:0})}ge.prototype.bind=function(){u.bindBuffer(this.type,this.buffer)},ge.prototype.destroy=function(){Xe(this)};var Me=[];function Fe(e,t){var r=Me.pop();return r||(r=new ge(e)),r.bind(),ze(r,t,oo,0,1,!1),r}function Be(e){Me.push(e)}function Ee(e,t,r){e.byteLength=t.byteLength,u.bufferData(e.type,t,r)}function ze(e,t,r,n,i,o){var s;if(e.usage=r,Array.isArray(t)){if(e.dtype=n||so,t.length>0){var l;if(Array.isArray(t[0])){s=Zo(t);for(var f=1,c=1;c<s.length;++c)f*=s[c];e.dimension=f,l=ao(t,s,e.dtype),Ee(e,l,r),o?e.persistentData=l:Bt.freeType(l)}else if(typeof t[0]=="number"){e.dimension=i;var w=Bt.allocType(e.dtype,t.length);el(w,t),Ee(e,w,r),o?e.persistentData=w:Bt.freeType(w)}else d(t[0])?(e.dimension=t[0].length,e.dtype=n||ai(t[0])||so,l=ao(t,[t.length,t[0].length],e.dtype),Ee(e,l,r),o?e.persistentData=l:Bt.freeType(l)):M.raise("invalid buffer data")}}else if(d(t))e.dtype=n||ai(t),e.dimension=i,Ee(e,t,r),o&&(e.persistentData=new Uint8Array(new Uint8Array(t.buffer)));else if(Lr(t)){s=t.shape;var O=t.stride,B=t.offset,R=0,H=0,ce=0,Se=0;s.length===1?(R=s[0],H=1,ce=O[0],Se=0):s.length===2?(R=s[0],H=s[1],ce=O[0],Se=O[1]):M.raise("invalid shape"),e.dtype=n||ai(t.data)||so,e.dimension=H;var me=Bt.allocType(e.dtype,R*H);Jo(me,t.data,R,H,ce,Se,B),Ee(e,me,r),o?e.persistentData=me:Bt.freeType(me)}else t instanceof ArrayBuffer?(e.dtype=ya,e.dimension=i,Ee(e,t,r),o&&(e.persistentData=new Uint8Array(new Uint8Array(t)))):M.raise("invalid buffer data")}function Xe(e){L.bufferCount--,re(e);var t=e.buffer;M(t,"buffer must not be deleted already"),u.deleteBuffer(t),e.buffer=null,delete pe[e.id]}function Ie(e,t,r,n){L.bufferCount++;var i=new ge(t);pe[i.id]=i;function o(f){var c=ga,w=null,O=0,B=0,R=1;return Array.isArray(f)||d(f)||Lr(f)||f instanceof ArrayBuffer?w=f:typeof f=="number"?O=f|0:f&&(M.type(f,"object","buffer arguments must be an object, a number or an array"),"data"in f&&(M(w===null||Array.isArray(w)||d(w)||Lr(w),"invalid data for buffer"),w=f.data),"usage"in f&&(M.parameter(f.usage,io,"invalid buffer usage"),c=io[f.usage]),"type"in f&&(M.parameter(f.type,ii,"invalid buffer type"),B=ii[f.type]),"dimension"in f&&(M.type(f.dimension,"number","invalid dimension"),R=f.dimension|0),"length"in f&&(M.nni(O,"buffer length must be a nonnegative integer"),O=f.length|0)),i.bind(),w?ze(i,w,c,B,R,n):(O&&u.bufferData(i.type,O,c),i.dtype=B||ya,i.usage=c,i.dimension=R,i.byteLength=O),W.profile&&(i.stats.size=i.byteLength*cn[i.dtype]),o}function s(f,c){M(c+f.byteLength<=i.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+f.byteLength+" starting from offset "+c+" to a buffer of size "+i.byteLength),u.bufferSubData(i.type,c,f)}function l(f,c){var w=(c||0)|0,O;if(i.bind(),d(f)||f instanceof ArrayBuffer)s(f,w);else if(Array.isArray(f)){if(f.length>0)if(typeof f[0]=="number"){var B=Bt.allocType(i.dtype,f.length);el(B,f),s(B,w),Bt.freeType(B)}else if(Array.isArray(f[0])||d(f[0])){O=Zo(f);var R=ao(f,O,i.dtype);s(R,w),Bt.freeType(R)}else M.raise("invalid buffer data")}else if(Lr(f)){O=f.shape;var H=f.stride,ce=0,Se=0,me=0,Oe=0;O.length===1?(ce=O[0],Se=1,me=H[0],Oe=0):O.length===2?(ce=O[0],Se=O[1],me=H[0],Oe=H[1]):M.raise("invalid shape");var _e=Array.isArray(f.data)?i.dtype:ai(f.data),Re=Bt.allocType(_e,ce*Se);Jo(Re,f.data,ce,Se,me,Oe,f.offset),s(Re,w),Bt.freeType(Re)}else M.raise("invalid data for buffer subdata");return o}return r||o(e),o._reglType="buffer",o._buffer=i,o.subdata=l,W.profile&&(o.stats=i.stats),o.destroy=function(){Xe(i)},o}function He(){Tr(pe).forEach(function(e){e.buffer=u.createBuffer(),u.bindBuffer(e.type,e.buffer),u.bufferData(e.type,e.persistentData||e.byteLength,e.usage)})}return W.profile&&(L.getTotalBufferSize=function(){var e=0;return Object.keys(pe).forEach(function(t){e+=pe[t].stats.size}),e}),{create:Ie,createStream:Fe,destroyStream:Be,clear:function(){Tr(pe).forEach(Xe),Me.forEach(Xe)},getBuffer:function(e){return e&&e._buffer instanceof ge?e._buffer:null},restore:He,_initBuffer:ze}}var sf=0,lf=0,es=1,tl=1,Bn=4,ts=4,Cr={points:sf,point:lf,lines:es,line:tl,triangles:Bn,triangle:ts,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},lo=0,rs=1,Zr=4,ff=5120,Ni=5121,rl=5122,Bi=5123,ns=5124,Dn=5125,is=34963,uf=35040,cf=35044;function df(u,L,W,re){var Ce={},pe=0,ge={uint8:Ni,uint16:Bi};L.oes_element_index_uint&&(ge.uint32=Dn);function Me(He){this.id=pe++,Ce[this.id]=this,this.buffer=He,this.primType=Zr,this.vertCount=0,this.type=0}Me.prototype.bind=function(){this.buffer.bind()};var Fe=[];function Be(He){var e=Fe.pop();return e||(e=new Me(W.create(null,is,!0,!1)._buffer)),ze(e,He,uf,-1,-1,0,0),e}function Ee(He){Fe.push(He)}function ze(He,e,t,r,n,i,o){He.buffer.bind();var s;if(e){var l=o;!o&&(!d(e)||Lr(e)&&!d(e.data))&&(l=L.oes_element_index_uint?Dn:Bi),W._initBuffer(He.buffer,e,t,l,3)}else u.bufferData(is,i,t),He.buffer.dtype=s||Ni,He.buffer.usage=t,He.buffer.dimension=3,He.buffer.byteLength=i;if(s=o,!o){switch(He.buffer.dtype){case Ni:case ff:s=Ni;break;case Bi:case rl:s=Bi;break;case Dn:case ns:s=Dn;break;default:M.raise("unsupported type for element array")}He.buffer.dtype=s}He.type=s,M(s!==Dn||!!L.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var f=n;f<0&&(f=He.buffer.byteLength,s===Bi?f>>=1:s===Dn&&(f>>=2)),He.vertCount=f;var c=r;if(r<0){c=Zr;var w=He.buffer.dimension;w===1&&(c=lo),w===2&&(c=rs),w===3&&(c=Zr)}He.primType=c}function Xe(He){re.elementsCount--,M(He.buffer!==null,"must not double destroy elements"),delete Ce[He.id],He.buffer.destroy(),He.buffer=null}function Ie(He,e){var t=W.create(null,is,!0),r=new Me(t._buffer);re.elementsCount++;function n(i){if(!i)t(),r.primType=Zr,r.vertCount=0,r.type=Ni;else if(typeof i=="number")t(i),r.primType=Zr,r.vertCount=i|0,r.type=Ni;else{var o=null,s=cf,l=-1,f=-1,c=0,w=0;Array.isArray(i)||d(i)||Lr(i)?o=i:(M.type(i,"object","invalid arguments for elements"),"data"in i&&(o=i.data,M(Array.isArray(o)||d(o)||Lr(o),"invalid data for element buffer")),"usage"in i&&(M.parameter(i.usage,io,"invalid element buffer usage"),s=io[i.usage]),"primitive"in i&&(M.parameter(i.primitive,Cr,"invalid element buffer primitive"),l=Cr[i.primitive]),"count"in i&&(M(typeof i.count=="number"&&i.count>=0,"invalid vertex count for elements"),f=i.count|0),"type"in i&&(M.parameter(i.type,ge,"invalid buffer type"),w=ge[i.type]),"length"in i?c=i.length|0:(c=f,w===Bi||w===rl?c*=2:(w===Dn||w===ns)&&(c*=4))),ze(r,o,s,l,f,c,w)}return n}return n(He),n._reglType="elements",n._elements=r,n.subdata=function(i,o){return t.subdata(i,o),n},n.destroy=function(){Xe(r)},n}return{create:Ie,createStream:Be,destroyStream:Ee,getElements:function(He){return typeof He=="function"&&He._elements instanceof Me?He._elements:null},clear:function(){Tr(Ce).forEach(Xe)}}}var as=new Float32Array(1),hf=new Uint32Array(as.buffer),nl=5123;function ba(u){for(var L=Bt.allocType(nl,u.length),W=0;W<u.length;++W)if(isNaN(u[W]))L[W]=65535;else if(u[W]===1/0)L[W]=31744;else if(u[W]===-1/0)L[W]=64512;else{as[0]=u[W];var re=hf[0],Ce=re>>>31<<15,pe=(re<<1>>>24)-127,ge=re>>13&1023;if(pe<-24)L[W]=Ce;else if(pe<-14){var Me=-14-pe;L[W]=Ce+(ge+1024>>Me)}else pe>15?L[W]=Ce+31744:L[W]=Ce+(pe+15<<10)+ge}return L}function Ut(u){return Array.isArray(u)||d(u)}var il=function(u){return!(u&u-1)&&!!u},pf=34467,Jr=3553,oi=34067,er=34069,si=6408,fo=6406,Gn=6407,xa=6409,Sa=6410,al=32854,wa=32855,os=36194,vf=32819,mf=32820,ol=33635,sl=34042,ss=6402,Hn=34041,Wr=35904,Di=35906,zn=36193,uo=33776,Mr=33777,dn=33778,Ta=33779,ll=35986,ls=35987,fl=34798,fs=35840,co=35841,li=35842,qr=35843,us=36196,fi=5121,cs=5123,ds=5125,Ca=5126,ul=10242,cl=10243,_a=10497,ho=33071,dl=33648,hs=10240,po=10241,vo=9728,mo=9729,kr=9984,ps=9985,go=9986,Ea=9987,hl=33170,La=4352,vs=4353,gf=4354,yf=34046,bf=3317,ui=37440,Gi=37441,Hi=37443,yo=37444,ci=33984,pl=[kr,go,ps,Ea],zi=[0,xa,Sa,Gn,si],fr={};fr[xa]=fr[fo]=fr[ss]=1,fr[Hn]=fr[Sa]=2,fr[Gn]=fr[Wr]=3,fr[si]=fr[Di]=4;function Fr(u){return"[object "+u+"]"}var pr=Fr("HTMLCanvasElement"),hn=Fr("OffscreenCanvas"),pn=Fr("CanvasRenderingContext2D"),ka=Fr("ImageBitmap"),vl=Fr("HTMLImageElement"),ms=Fr("HTMLVideoElement"),Aa=Object.keys(ro).concat([pr,hn,pn,ka,vl,ms]),di=[];di[fi]=1,di[Ca]=4,di[zn]=2,di[cs]=2,di[ds]=4;var ir=[];ir[al]=2,ir[wa]=2,ir[os]=2,ir[Hn]=4,ir[uo]=.5,ir[Mr]=.5,ir[dn]=1,ir[Ta]=1,ir[ll]=.5,ir[ls]=1,ir[fl]=1,ir[fs]=.5,ir[co]=.25,ir[li]=.5,ir[qr]=.25,ir[us]=.5;function Oa(u){return Array.isArray(u)&&(u.length===0||typeof u[0]=="number")}function ml(u){if(!Array.isArray(u))return!1;var L=u.length;return!(L===0||!Ut(u[0]))}function vn(u){return Object.prototype.toString.call(u)}function gs(u){return vn(u)===pr}function bo(u){return vn(u)===hn}function ys(u){return vn(u)===pn}function Wi(u){return vn(u)===ka}function xo(u){return vn(u)===vl}function gl(u){return vn(u)===ms}function qi(u){if(!u)return!1;var L=vn(u);return Aa.indexOf(L)>=0?!0:Oa(u)||ml(u)||Lr(u)}function yl(u){return ro[Object.prototype.toString.call(u)]|0}function xf(u,L){var W=L.length;switch(u.type){case fi:case cs:case ds:case Ca:var re=Bt.allocType(u.type,W);re.set(L),u.data=re;break;case zn:u.data=ba(L);break;default:M.raise("unsupported texture type, must specify a typed array")}}function bl(u,L){return Bt.allocType(u.type===zn?Ca:u.type,L)}function So(u,L){u.type===zn?(u.data=ba(L),Bt.freeType(L)):u.data=L}function bs(u,L,W,re,Ce,pe){for(var ge=u.width,Me=u.height,Fe=u.channels,Be=ge*Me*Fe,Ee=bl(u,Be),ze=0,Xe=0;Xe<Me;++Xe)for(var Ie=0;Ie<ge;++Ie)for(var He=0;He<Fe;++He)Ee[ze++]=L[W*Ie+re*Xe+Ce*He+pe];So(u,Ee)}function mn(u,L,W,re,Ce,pe){var ge;if(typeof ir[u]<"u"?ge=ir[u]:ge=fr[u]*di[L],pe&&(ge*=6),Ce){for(var Me=0,Fe=W;Fe>=1;)Me+=ge*Fe*Fe,Fe/=2;return Me}else return ge*W*re}function Ra(u,L,W,re,Ce,pe,ge){var Me={"don't care":La,"dont care":La,nice:gf,fast:vs},Fe={repeat:_a,clamp:ho,mirror:dl},Be={nearest:vo,linear:mo},Ee=m({mipmap:Ea,"nearest mipmap nearest":kr,"linear mipmap nearest":ps,"nearest mipmap linear":go,"linear mipmap linear":Ea},Be),ze={none:0,browser:yo},Xe={uint8:fi,rgba4:vf,rgb565:ol,"rgb5 a1":mf},Ie={alpha:fo,luminance:xa,"luminance alpha":Sa,rgb:Gn,rgba:si,rgba4:al,"rgb5 a1":wa,rgb565:os},He={};L.ext_srgb&&(Ie.srgb=Wr,Ie.srgba=Di),L.oes_texture_float&&(Xe.float32=Xe.float=Ca),L.oes_texture_half_float&&(Xe.float16=Xe["half float"]=zn),L.webgl_depth_texture&&(m(Ie,{depth:ss,"depth stencil":Hn}),m(Xe,{uint16:cs,uint32:ds,"depth stencil":sl})),L.webgl_compressed_texture_s3tc&&m(He,{"rgb s3tc dxt1":uo,"rgba s3tc dxt1":Mr,"rgba s3tc dxt3":dn,"rgba s3tc dxt5":Ta}),L.webgl_compressed_texture_atc&&m(He,{"rgb atc":ll,"rgba atc explicit alpha":ls,"rgba atc interpolated alpha":fl}),L.webgl_compressed_texture_pvrtc&&m(He,{"rgb pvrtc 4bppv1":fs,"rgb pvrtc 2bppv1":co,"rgba pvrtc 4bppv1":li,"rgba pvrtc 2bppv1":qr}),L.webgl_compressed_texture_etc1&&(He["rgb etc1"]=us);var e=Array.prototype.slice.call(u.getParameter(pf));Object.keys(He).forEach(function(N){var de=He[N];e.indexOf(de)>=0&&(Ie[N]=de)});var t=Object.keys(Ie);W.textureFormats=t;var r=[];Object.keys(Ie).forEach(function(N){var de=Ie[N];r[de]=N});var n=[];Object.keys(Xe).forEach(function(N){var de=Xe[N];n[de]=N});var i=[];Object.keys(Be).forEach(function(N){var de=Be[N];i[de]=N});var o=[];Object.keys(Ee).forEach(function(N){var de=Ee[N];o[de]=N});var s=[];Object.keys(Fe).forEach(function(N){var de=Fe[N];s[de]=N});var l=t.reduce(function(N,de){var le=Ie[de];return le===xa||le===fo||le===xa||le===Sa||le===ss||le===Hn||L.ext_srgb&&(le===Wr||le===Di)?N[le]=le:le===wa||de.indexOf("rgba")>=0?N[le]=si:N[le]=Gn,N},{});function f(){this.internalformat=si,this.format=si,this.type=fi,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=yo,this.width=0,this.height=0,this.channels=0}function c(N,de){N.internalformat=de.internalformat,N.format=de.format,N.type=de.type,N.compressed=de.compressed,N.premultiplyAlpha=de.premultiplyAlpha,N.flipY=de.flipY,N.unpackAlignment=de.unpackAlignment,N.colorSpace=de.colorSpace,N.width=de.width,N.height=de.height,N.channels=de.channels}function w(N,de){if(!(typeof de!="object"||!de)){if("premultiplyAlpha"in de&&(M.type(de.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),N.premultiplyAlpha=de.premultiplyAlpha),"flipY"in de&&(M.type(de.flipY,"boolean","invalid texture flip"),N.flipY=de.flipY),"alignment"in de&&(M.oneOf(de.alignment,[1,2,4,8],"invalid texture unpack alignment"),N.unpackAlignment=de.alignment),"colorSpace"in de&&(M.parameter(de.colorSpace,ze,"invalid colorSpace"),N.colorSpace=ze[de.colorSpace]),"type"in de){var le=de.type;M(L.oes_texture_float||!(le==="float"||le==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),M(L.oes_texture_half_float||!(le==="half float"||le==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),M(L.webgl_depth_texture||!(le==="uint16"||le==="uint32"||le==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),M.parameter(le,Xe,"invalid texture type"),N.type=Xe[le]}var je=N.width,bt=N.height,F=N.channels,T=!1;"shape"in de?(M(Array.isArray(de.shape)&&de.shape.length>=2,"shape must be an array"),je=de.shape[0],bt=de.shape[1],de.shape.length===3&&(F=de.shape[2],M(F>0&&F<=4,"invalid number of channels"),T=!0),M(je>=0&&je<=W.maxTextureSize,"invalid width"),M(bt>=0&&bt<=W.maxTextureSize,"invalid height")):("radius"in de&&(je=bt=de.radius,M(je>=0&&je<=W.maxTextureSize,"invalid radius")),"width"in de&&(je=de.width,M(je>=0&&je<=W.maxTextureSize,"invalid width")),"height"in de&&(bt=de.height,M(bt>=0&&bt<=W.maxTextureSize,"invalid height")),"channels"in de&&(F=de.channels,M(F>0&&F<=4,"invalid number of channels"),T=!0)),N.width=je|0,N.height=bt|0,N.channels=F|0;var Y=!1;if("format"in de){var ne=de.format;M(L.webgl_depth_texture||!(ne==="depth"||ne==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),M.parameter(ne,Ie,"invalid texture format");var oe=N.internalformat=Ie[ne];N.format=l[oe],ne in Xe&&("type"in de||(N.type=Xe[ne])),ne in He&&(N.compressed=!0),Y=!0}!T&&Y?N.channels=fr[N.format]:T&&!Y?N.channels!==zi[N.format]&&(N.format=N.internalformat=zi[N.channels]):Y&&T&&M(N.channels===fr[N.format],"number of channels inconsistent with specified format")}}function O(N){u.pixelStorei(ui,N.flipY),u.pixelStorei(Gi,N.premultiplyAlpha),u.pixelStorei(Hi,N.colorSpace),u.pixelStorei(bf,N.unpackAlignment)}function B(){f.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function R(N,de){var le=null;if(qi(de)?le=de:de&&(M.type(de,"object","invalid pixel data type"),w(N,de),"x"in de&&(N.xOffset=de.x|0),"y"in de&&(N.yOffset=de.y|0),qi(de.data)&&(le=de.data)),M(!N.compressed||le instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),de.copy){M(!le,"can not specify copy and data field for the same texture");var je=Ce.viewportWidth,bt=Ce.viewportHeight;N.width=N.width||je-N.xOffset,N.height=N.height||bt-N.yOffset,N.needsCopy=!0,M(N.xOffset>=0&&N.xOffset<je&&N.yOffset>=0&&N.yOffset<bt&&N.width>0&&N.width<=je&&N.height>0&&N.height<=bt,"copy texture read out of bounds")}else if(!le)N.width=N.width||1,N.height=N.height||1,N.channels=N.channels||4;else if(d(le))N.channels=N.channels||4,N.data=le,!("type"in de)&&N.type===fi&&(N.type=yl(le));else if(Oa(le))N.channels=N.channels||4,xf(N,le),N.alignment=1,N.needsFree=!0;else if(Lr(le)){var F=le.data;!Array.isArray(F)&&N.type===fi&&(N.type=yl(F));var T=le.shape,Y=le.stride,ne,oe,V,$,J,I;T.length===3?(V=T[2],I=Y[2]):(M(T.length===2,"invalid ndarray pixel data, must be 2 or 3D"),V=1,I=1),ne=T[0],oe=T[1],$=Y[0],J=Y[1],N.alignment=1,N.width=ne,N.height=oe,N.channels=V,N.format=N.internalformat=zi[V],N.needsFree=!0,bs(N,F,$,J,I,le.offset)}else if(gs(le)||bo(le)||ys(le))gs(le)||bo(le)?N.element=le:N.element=le.canvas,N.width=N.element.width,N.height=N.element.height,N.channels=4;else if(Wi(le))N.element=le,N.width=le.width,N.height=le.height,N.channels=4;else if(xo(le))N.element=le,N.width=le.naturalWidth,N.height=le.naturalHeight,N.channels=4;else if(gl(le))N.element=le,N.width=le.videoWidth,N.height=le.videoHeight,N.channels=4;else if(ml(le)){var K=N.width||le[0].length,k=N.height||le.length,ee=N.channels;Ut(le[0][0])?ee=ee||le[0][0].length:ee=ee||1;for(var fe=Pi.shape(le),Te=1,Le=0;Le<fe.length;++Le)Te*=fe[Le];var xe=bl(N,Te);Pi.flatten(le,fe,"",xe),So(N,xe),N.alignment=1,N.width=K,N.height=k,N.channels=ee,N.format=N.internalformat=zi[ee],N.needsFree=!0}N.type===Ca?M(W.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):N.type===zn&&M(W.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function H(N,de,le){var je=N.element,bt=N.data,F=N.internalformat,T=N.format,Y=N.type,ne=N.width,oe=N.height;O(N),je?u.texImage2D(de,le,T,T,Y,je):N.compressed?u.compressedTexImage2D(de,le,F,ne,oe,0,bt):N.needsCopy?(re(),u.copyTexImage2D(de,le,T,N.xOffset,N.yOffset,ne,oe,0)):u.texImage2D(de,le,T,ne,oe,0,T,Y,bt||null)}function ce(N,de,le,je,bt){var F=N.element,T=N.data,Y=N.internalformat,ne=N.format,oe=N.type,V=N.width,$=N.height;O(N),F?u.texSubImage2D(de,bt,le,je,ne,oe,F):N.compressed?u.compressedTexSubImage2D(de,bt,le,je,Y,V,$,T):N.needsCopy?(re(),u.copyTexSubImage2D(de,bt,le,je,N.xOffset,N.yOffset,V,$)):u.texSubImage2D(de,bt,le,je,V,$,ne,oe,T)}var Se=[];function me(){return Se.pop()||new B}function Oe(N){N.needsFree&&Bt.freeType(N.data),B.call(N),Se.push(N)}function _e(){f.call(this),this.genMipmaps=!1,this.mipmapHint=La,this.mipmask=0,this.images=Array(16)}function Re(N,de,le){var je=N.images[0]=me();N.mipmask=1,je.width=N.width=de,je.height=N.height=le,je.channels=N.channels=4}function Ke(N,de){var le=null;if(qi(de))le=N.images[0]=me(),c(le,N),R(le,de),N.mipmask=1;else if(w(N,de),Array.isArray(de.mipmap))for(var je=de.mipmap,bt=0;bt<je.length;++bt)le=N.images[bt]=me(),c(le,N),le.width>>=bt,le.height>>=bt,R(le,je[bt]),N.mipmask|=1<<bt;else le=N.images[0]=me(),c(le,N),R(le,de),N.mipmask=1;c(N,N.images[0]),N.compressed&&(N.internalformat===uo||N.internalformat===Mr||N.internalformat===dn||N.internalformat===Ta)&&M(N.width%4===0&&N.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Ze(N,de){for(var le=N.images,je=0;je<le.length;++je){if(!le[je])return;H(le[je],de,je)}}var ct=[];function rt(){var N=ct.pop()||new _e;f.call(N),N.mipmask=0;for(var de=0;de<16;++de)N.images[de]=null;return N}function At(N){for(var de=N.images,le=0;le<de.length;++le)de[le]&&Oe(de[le]),de[le]=null;ct.push(N)}function yt(){this.minFilter=vo,this.magFilter=vo,this.wrapS=ho,this.wrapT=ho,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=La}function Ft(N,de){if("min"in de){var le=de.min;M.parameter(le,Ee),N.minFilter=Ee[le],pl.indexOf(N.minFilter)>=0&&!("faces"in de)&&(N.genMipmaps=!0)}if("mag"in de){var je=de.mag;M.parameter(je,Be),N.magFilter=Be[je]}var bt=N.wrapS,F=N.wrapT;if("wrap"in de){var T=de.wrap;typeof T=="string"?(M.parameter(T,Fe),bt=F=Fe[T]):Array.isArray(T)&&(M.parameter(T[0],Fe),M.parameter(T[1],Fe),bt=Fe[T[0]],F=Fe[T[1]])}else{if("wrapS"in de){var Y=de.wrapS;M.parameter(Y,Fe),bt=Fe[Y]}if("wrapT"in de){var ne=de.wrapT;M.parameter(ne,Fe),F=Fe[ne]}}if(N.wrapS=bt,N.wrapT=F,"anisotropic"in de){var oe=de.anisotropic;M(typeof oe=="number"&&oe>=1&&oe<=W.maxAnisotropic,"aniso samples must be between 1 and "),N.anisotropic=de.anisotropic}if("mipmap"in de){var V=!1;switch(typeof de.mipmap){case"string":M.parameter(de.mipmap,Me,"invalid mipmap hint"),N.mipmapHint=Me[de.mipmap],N.genMipmaps=!0,V=!0;break;case"boolean":V=N.genMipmaps=de.mipmap;break;case"object":M(Array.isArray(de.mipmap),"invalid mipmap type"),N.genMipmaps=!1,V=!0;break;default:M.raise("invalid mipmap type")}V&&!("min"in de)&&(N.minFilter=kr)}}function It(N,de){u.texParameteri(de,po,N.minFilter),u.texParameteri(de,hs,N.magFilter),u.texParameteri(de,ul,N.wrapS),u.texParameteri(de,cl,N.wrapT),L.ext_texture_filter_anisotropic&&u.texParameteri(de,yf,N.anisotropic),N.genMipmaps&&(u.hint(hl,N.mipmapHint),u.generateMipmap(de))}var Et=0,Gt={},Pt=W.maxTextureUnits,Tt=Array(Pt).map(function(){return null});function nt(N){f.call(this),this.mipmask=0,this.internalformat=si,this.id=Et++,this.refCount=1,this.target=N,this.texture=u.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new yt,ge.profile&&(this.stats={size:0})}function Lt(N){u.activeTexture(ci),u.bindTexture(N.target,N.texture)}function St(){var N=Tt[0];N?u.bindTexture(N.target,N.texture):u.bindTexture(Jr,null)}function ot(N){var de=N.texture;M(de,"must not double destroy texture");var le=N.unit,je=N.target;le>=0&&(u.activeTexture(ci+le),u.bindTexture(je,null),Tt[le]=null),u.deleteTexture(de),N.texture=null,N.params=null,N.pixels=null,N.refCount=0,delete Gt[N.id],pe.textureCount--}m(nt.prototype,{bind:function(){var N=this;N.bindCount+=1;var de=N.unit;if(de<0){for(var le=0;le<Pt;++le){var je=Tt[le];if(je){if(je.bindCount>0)continue;je.unit=-1}Tt[le]=N,de=le;break}de>=Pt&&M.raise("insufficient number of texture units"),ge.profile&&pe.maxTextureUnits<de+1&&(pe.maxTextureUnits=de+1),N.unit=de,u.activeTexture(ci+de),u.bindTexture(N.target,N.texture)}return de},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&ot(this)}});function mt(N,de){var le=new nt(Jr);Gt[le.id]=le,pe.textureCount++;function je(T,Y){var ne=le.texInfo;yt.call(ne);var oe=rt();return typeof T=="number"?typeof Y=="number"?Re(oe,T|0,Y|0):Re(oe,T|0,T|0):T?(M.type(T,"object","invalid arguments to regl.texture"),Ft(ne,T),Ke(oe,T)):Re(oe,1,1),ne.genMipmaps&&(oe.mipmask=(oe.width<<1)-1),le.mipmask=oe.mipmask,c(le,oe),M.texture2D(ne,oe,W),le.internalformat=oe.internalformat,je.width=oe.width,je.height=oe.height,Lt(le),Ze(oe,Jr),It(ne,Jr),St(),At(oe),ge.profile&&(le.stats.size=mn(le.internalformat,le.type,oe.width,oe.height,ne.genMipmaps,!1)),je.format=r[le.internalformat],je.type=n[le.type],je.mag=i[ne.magFilter],je.min=o[ne.minFilter],je.wrapS=s[ne.wrapS],je.wrapT=s[ne.wrapT],je}function bt(T,Y,ne,oe){M(!!T,"must specify image data");var V=Y|0,$=ne|0,J=oe|0,I=me();return c(I,le),I.width=0,I.height=0,R(I,T),I.width=I.width||(le.width>>J)-V,I.height=I.height||(le.height>>J)-$,M(le.type===I.type&&le.format===I.format&&le.internalformat===I.internalformat,"incompatible format for texture.subimage"),M(V>=0&&$>=0&&V+I.width<=le.width&&$+I.height<=le.height,"texture.subimage write out of bounds"),M(le.mipmask&1<<J,"missing mipmap data"),M(I.data||I.element||I.needsCopy,"missing image data"),Lt(le),ce(I,Jr,V,$,J),St(),Oe(I),je}function F(T,Y){var ne=T|0,oe=Y|0||ne;if(ne===le.width&&oe===le.height)return je;je.width=le.width=ne,je.height=le.height=oe,Lt(le);for(var V=0;le.mipmask>>V;++V){var $=ne>>V,J=oe>>V;if(!$||!J)break;u.texImage2D(Jr,V,le.format,$,J,0,le.format,le.type,null)}return St(),ge.profile&&(le.stats.size=mn(le.internalformat,le.type,ne,oe,!1,!1)),je}return je(N,de),je.subimage=bt,je.resize=F,je._reglType="texture2d",je._texture=le,ge.profile&&(je.stats=le.stats),je.destroy=function(){le.decRef()},je}function vt(N,de,le,je,bt,F){var T=new nt(oi);Gt[T.id]=T,pe.cubeCount++;var Y=new Array(6);function ne($,J,I,K,k,ee){var fe,Te=T.texInfo;for(yt.call(Te),fe=0;fe<6;++fe)Y[fe]=rt();if(typeof $=="number"||!$){var Le=$|0||1;for(fe=0;fe<6;++fe)Re(Y[fe],Le,Le)}else if(typeof $=="object")if(J)Ke(Y[0],$),Ke(Y[1],J),Ke(Y[2],I),Ke(Y[3],K),Ke(Y[4],k),Ke(Y[5],ee);else if(Ft(Te,$),w(T,$),"faces"in $){var xe=$.faces;for(M(Array.isArray(xe)&&xe.length===6,"cube faces must be a length 6 array"),fe=0;fe<6;++fe)M(typeof xe[fe]=="object"&&!!xe[fe],"invalid input for cube map face"),c(Y[fe],T),Ke(Y[fe],xe[fe])}else for(fe=0;fe<6;++fe)Ke(Y[fe],$);else M.raise("invalid arguments to cube map");for(c(T,Y[0]),W.npotTextureCube||M(il(T.width)&&il(T.height),"your browser does not support non power or two texture dimensions"),Te.genMipmaps?T.mipmask=(Y[0].width<<1)-1:T.mipmask=Y[0].mipmask,M.textureCube(T,Te,Y,W),T.internalformat=Y[0].internalformat,ne.width=Y[0].width,ne.height=Y[0].height,Lt(T),fe=0;fe<6;++fe)Ze(Y[fe],er+fe);for(It(Te,oi),St(),ge.profile&&(T.stats.size=mn(T.internalformat,T.type,ne.width,ne.height,Te.genMipmaps,!0)),ne.format=r[T.internalformat],ne.type=n[T.type],ne.mag=i[Te.magFilter],ne.min=o[Te.minFilter],ne.wrapS=s[Te.wrapS],ne.wrapT=s[Te.wrapT],fe=0;fe<6;++fe)At(Y[fe]);return ne}function oe($,J,I,K,k){M(!!J,"must specify image data"),M(typeof $=="number"&&$===($|0)&&$>=0&&$<6,"invalid face");var ee=I|0,fe=K|0,Te=k|0,Le=me();return c(Le,T),Le.width=0,Le.height=0,R(Le,J),Le.width=Le.width||(T.width>>Te)-ee,Le.height=Le.height||(T.height>>Te)-fe,M(T.type===Le.type&&T.format===Le.format&&T.internalformat===Le.internalformat,"incompatible format for texture.subimage"),M(ee>=0&&fe>=0&&ee+Le.width<=T.width&&fe+Le.height<=T.height,"texture.subimage write out of bounds"),M(T.mipmask&1<<Te,"missing mipmap data"),M(Le.data||Le.element||Le.needsCopy,"missing image data"),Lt(T),ce(Le,er+$,ee,fe,Te),St(),Oe(Le),ne}function V($){var J=$|0;if(J!==T.width){ne.width=T.width=J,ne.height=T.height=J,Lt(T);for(var I=0;I<6;++I)for(var K=0;T.mipmask>>K;++K)u.texImage2D(er+I,K,T.format,J>>K,J>>K,0,T.format,T.type,null);return St(),ge.profile&&(T.stats.size=mn(T.internalformat,T.type,ne.width,ne.height,!1,!0)),ne}}return ne(N,de,le,je,bt,F),ne.subimage=oe,ne.resize=V,ne._reglType="textureCube",ne._texture=T,ge.profile&&(ne.stats=T.stats),ne.destroy=function(){T.decRef()},ne}function Wt(){for(var N=0;N<Pt;++N)u.activeTexture(ci+N),u.bindTexture(Jr,null),Tt[N]=null;Tr(Gt).forEach(ot),pe.cubeCount=0,pe.textureCount=0}ge.profile&&(pe.getTotalTextureSize=function(){var N=0;return Object.keys(Gt).forEach(function(de){N+=Gt[de].stats.size}),N});function Xt(){for(var N=0;N<Pt;++N){var de=Tt[N];de&&(de.bindCount=0,de.unit=-1,Tt[N]=null)}Tr(Gt).forEach(function(le){le.texture=u.createTexture(),u.bindTexture(le.target,le.texture);for(var je=0;je<32;++je)if((le.mipmask&1<<je)!==0)if(le.target===Jr)u.texImage2D(Jr,je,le.internalformat,le.width>>je,le.height>>je,0,le.internalformat,le.type,null);else for(var bt=0;bt<6;++bt)u.texImage2D(er+bt,je,le.internalformat,le.width>>je,le.height>>je,0,le.internalformat,le.type,null);It(le.texInfo,le.target)})}function On(){for(var N=0;N<Pt;++N){var de=Tt[N];de&&(de.bindCount=0,de.unit=-1,Tt[N]=null),u.activeTexture(ci+N),u.bindTexture(Jr,null),u.bindTexture(oi,null)}}return{create2D:mt,createCube:vt,clear:Wt,getTexture:function(N){return null},restore:Xt,refresh:On}}var Wn=36161,hi=32854,xs=32855,Ui=36194,Ss=33189,qn=36168,Xi=34041,Un=35907,ji=34836,pi=34842,ws=34843,Ir=[];Ir[hi]=2,Ir[xs]=2,Ir[Ui]=2,Ir[Ss]=2,Ir[qn]=1,Ir[Xi]=4,Ir[Un]=4,Ir[ji]=16,Ir[pi]=8,Ir[ws]=6;function Ts(u,L,W){return Ir[u]*L*W}var Sf=function(u,L,W,re,Ce){var pe={rgba4:hi,rgb565:Ui,"rgb5 a1":xs,depth:Ss,stencil:qn,"depth stencil":Xi};L.ext_srgb&&(pe.srgba=Un),L.ext_color_buffer_half_float&&(pe.rgba16f=pi,pe.rgb16f=ws),L.webgl_color_buffer_float&&(pe.rgba32f=ji);var ge=[];Object.keys(pe).forEach(function(Ie){var He=pe[Ie];ge[He]=Ie});var Me=0,Fe={};function Be(Ie){this.id=Me++,this.refCount=1,this.renderbuffer=Ie,this.format=hi,this.width=0,this.height=0,Ce.profile&&(this.stats={size:0})}Be.prototype.decRef=function(){--this.refCount<=0&&Ee(this)};function Ee(Ie){var He=Ie.renderbuffer;M(He,"must not double destroy renderbuffer"),u.bindRenderbuffer(Wn,null),u.deleteRenderbuffer(He),Ie.renderbuffer=null,Ie.refCount=0,delete Fe[Ie.id],re.renderbufferCount--}function ze(Ie,He){var e=new Be(u.createRenderbuffer());Fe[e.id]=e,re.renderbufferCount++;function t(n,i){var o=0,s=0,l=hi;if(typeof n=="object"&&n){var f=n;if("shape"in f){var c=f.shape;M(Array.isArray(c)&&c.length>=2,"invalid renderbuffer shape"),o=c[0]|0,s=c[1]|0}else"radius"in f&&(o=s=f.radius|0),"width"in f&&(o=f.width|0),"height"in f&&(s=f.height|0);"format"in f&&(M.parameter(f.format,pe,"invalid renderbuffer format"),l=pe[f.format])}else typeof n=="number"?(o=n|0,typeof i=="number"?s=i|0:s=o):n?M.raise("invalid arguments to renderbuffer constructor"):o=s=1;if(M(o>0&&s>0&&o<=W.maxRenderbufferSize&&s<=W.maxRenderbufferSize,"invalid renderbuffer size"),!(o===e.width&&s===e.height&&l===e.format))return t.width=e.width=o,t.height=e.height=s,e.format=l,u.bindRenderbuffer(Wn,e.renderbuffer),u.renderbufferStorage(Wn,l,o,s),M(u.getError()===0,"invalid render buffer format"),Ce.profile&&(e.stats.size=Ts(e.format,e.width,e.height)),t.format=ge[e.format],t}function r(n,i){var o=n|0,s=i|0||o;return o===e.width&&s===e.height||(M(o>0&&s>0&&o<=W.maxRenderbufferSize&&s<=W.maxRenderbufferSize,"invalid renderbuffer size"),t.width=e.width=o,t.height=e.height=s,u.bindRenderbuffer(Wn,e.renderbuffer),u.renderbufferStorage(Wn,e.format,o,s),M(u.getError()===0,"invalid render buffer format"),Ce.profile&&(e.stats.size=Ts(e.format,e.width,e.height))),t}return t(Ie,He),t.resize=r,t._reglType="renderbuffer",t._renderbuffer=e,Ce.profile&&(t.stats=e.stats),t.destroy=function(){e.decRef()},t}Ce.profile&&(re.getTotalRenderbufferSize=function(){var Ie=0;return Object.keys(Fe).forEach(function(He){Ie+=Fe[He].stats.size}),Ie});function Xe(){Tr(Fe).forEach(function(Ie){Ie.renderbuffer=u.createRenderbuffer(),u.bindRenderbuffer(Wn,Ie.renderbuffer),u.renderbufferStorage(Wn,Ie.format,Ie.width,Ie.height)}),u.bindRenderbuffer(Wn,null)}return{create:ze,clear:function(){Tr(Fe).forEach(Ee)},restore:Xe}},yr=36160,gn=36161,vi=3553,wo=34069,xl=36064,Sl=36096,wl=36128,Tl=33306,br=36053,or=36054,vr=36055,sr=36057,Ma=36061,wf=36193,To=5121,Tf=5126,Cl=6407,_l=6408,Cs=6402,El=[Cl,_l],Fa=[];Fa[_l]=4,Fa[Cl]=3;var Co=[];Co[To]=1,Co[Tf]=4,Co[wf]=2;var _s=32854,Es=32855,Ll=36194,kl=33189,Ls=36168,ks=34041,Ia=35907,Cf=34836,_o=34842,yn=34843,Al=[_s,Es,Ll,Ia,_o,yn,Cf],Ki={};Ki[br]="complete",Ki[or]="incomplete attachment",Ki[sr]="incomplete dimensions",Ki[vr]="incomplete, missing attachment",Ki[Ma]="unsupported";function Ol(u,L,W,re,Ce,pe){var ge={cur:null,next:null,dirty:!1,setFBO:null},Me=["rgba"],Fe=["rgba4","rgb565","rgb5 a1"];L.ext_srgb&&Fe.push("srgba"),L.ext_color_buffer_half_float&&Fe.push("rgba16f","rgb16f"),L.webgl_color_buffer_float&&Fe.push("rgba32f");var Be=["uint8"];L.oes_texture_half_float&&Be.push("half float","float16"),L.oes_texture_float&&Be.push("float","float32");function Ee(B,R,H){this.target=B,this.texture=R,this.renderbuffer=H;var ce=0,Se=0;R?(ce=R.width,Se=R.height):H&&(ce=H.width,Se=H.height),this.width=ce,this.height=Se}function ze(B){B&&(B.texture&&B.texture._texture.decRef(),B.renderbuffer&&B.renderbuffer._renderbuffer.decRef())}function Xe(B,R,H){if(B)if(B.texture){var ce=B.texture._texture,Se=Math.max(1,ce.width),me=Math.max(1,ce.height);M(Se===R&&me===H,"inconsistent width/height for supplied texture"),ce.refCount+=1}else{var Oe=B.renderbuffer._renderbuffer;M(Oe.width===R&&Oe.height===H,"inconsistent width/height for renderbuffer"),Oe.refCount+=1}}function Ie(B,R){R&&(R.texture?u.framebufferTexture2D(yr,B,R.target,R.texture._texture.texture,0):u.framebufferRenderbuffer(yr,B,gn,R.renderbuffer._renderbuffer.renderbuffer))}function He(B){var R=vi,H=null,ce=null,Se=B;typeof B=="object"&&(Se=B.data,"target"in B&&(R=B.target|0)),M.type(Se,"function","invalid attachment data");var me=Se._reglType;return me==="texture2d"?(H=Se,M(R===vi)):me==="textureCube"?(H=Se,M(R>=wo&&R<wo+6,"invalid cube map target")):me==="renderbuffer"?(ce=Se,R=gn):M.raise("invalid regl object for attachment"),new Ee(R,H,ce)}function e(B,R,H,ce,Se){if(H){var me=re.create2D({width:B,height:R,format:ce,type:Se});return me._texture.refCount=0,new Ee(vi,me,null)}else{var Oe=Ce.create({width:B,height:R,format:ce});return Oe._renderbuffer.refCount=0,new Ee(gn,null,Oe)}}function t(B){return B&&(B.texture||B.renderbuffer)}function r(B,R,H){B&&(B.texture?B.texture.resize(R,H):B.renderbuffer&&B.renderbuffer.resize(R,H),B.width=R,B.height=H)}var n=0,i={};function o(){this.id=n++,i[this.id]=this,this.framebuffer=u.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function s(B){B.colorAttachments.forEach(ze),ze(B.depthAttachment),ze(B.stencilAttachment),ze(B.depthStencilAttachment)}function l(B){var R=B.framebuffer;M(R,"must not double destroy framebuffer"),u.deleteFramebuffer(R),B.framebuffer=null,pe.framebufferCount--,delete i[B.id]}function f(B){var R;u.bindFramebuffer(yr,B.framebuffer);var H=B.colorAttachments;for(R=0;R<H.length;++R)Ie(xl+R,H[R]);for(R=H.length;R<W.maxColorAttachments;++R)u.framebufferTexture2D(yr,xl+R,vi,null,0);u.framebufferTexture2D(yr,Tl,vi,null,0),u.framebufferTexture2D(yr,Sl,vi,null,0),u.framebufferTexture2D(yr,wl,vi,null,0),Ie(Sl,B.depthAttachment),Ie(wl,B.stencilAttachment),Ie(Tl,B.depthStencilAttachment);var ce=u.checkFramebufferStatus(yr);!u.isContextLost()&&ce!==br&&M.raise("framebuffer configuration not supported, status = "+Ki[ce]),u.bindFramebuffer(yr,ge.next?ge.next.framebuffer:null),ge.cur=ge.next,u.getError()}function c(B,R){var H=new o;pe.framebufferCount++;function ce(me,Oe){var _e;M(ge.next!==H,"can not update framebuffer which is currently in use");var Re=0,Ke=0,Ze=!0,ct=!0,rt=null,At=!0,yt="rgba",Ft="uint8",It=1,Et=null,Gt=null,Pt=null,Tt=!1;if(typeof me=="number")Re=me|0,Ke=Oe|0||Re;else if(!me)Re=Ke=1;else{M.type(me,"object","invalid arguments for framebuffer");var nt=me;if("shape"in nt){var Lt=nt.shape;M(Array.isArray(Lt)&&Lt.length>=2,"invalid shape for framebuffer"),Re=Lt[0],Ke=Lt[1]}else"radius"in nt&&(Re=Ke=nt.radius),"width"in nt&&(Re=nt.width),"height"in nt&&(Ke=nt.height);("color"in nt||"colors"in nt)&&(rt=nt.color||nt.colors,Array.isArray(rt)&&M(rt.length===1||L.webgl_draw_buffers,"multiple render targets not supported")),rt||("colorCount"in nt&&(It=nt.colorCount|0,M(It>0,"invalid color buffer count")),"colorTexture"in nt&&(At=!!nt.colorTexture,yt="rgba4"),"colorType"in nt&&(Ft=nt.colorType,At?(M(L.oes_texture_float||!(Ft==="float"||Ft==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),M(L.oes_texture_half_float||!(Ft==="half float"||Ft==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Ft==="half float"||Ft==="float16"?(M(L.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),yt="rgba16f"):(Ft==="float"||Ft==="float32")&&(M(L.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),yt="rgba32f"),M.oneOf(Ft,Be,"invalid color type")),"colorFormat"in nt&&(yt=nt.colorFormat,Me.indexOf(yt)>=0?At=!0:Fe.indexOf(yt)>=0?At=!1:At?M.oneOf(nt.colorFormat,Me,"invalid color format for texture"):M.oneOf(nt.colorFormat,Fe,"invalid color format for renderbuffer"))),("depthTexture"in nt||"depthStencilTexture"in nt)&&(Tt=!!(nt.depthTexture||nt.depthStencilTexture),M(!Tt||L.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in nt&&(typeof nt.depth=="boolean"?Ze=nt.depth:(Et=nt.depth,ct=!1)),"stencil"in nt&&(typeof nt.stencil=="boolean"?ct=nt.stencil:(Gt=nt.stencil,Ze=!1)),"depthStencil"in nt&&(typeof nt.depthStencil=="boolean"?Ze=ct=nt.depthStencil:(Pt=nt.depthStencil,Ze=!1,ct=!1))}var St=null,ot=null,mt=null,vt=null;if(Array.isArray(rt))St=rt.map(He);else if(rt)St=[He(rt)];else for(St=new Array(It),_e=0;_e<It;++_e)St[_e]=e(Re,Ke,At,yt,Ft);M(L.webgl_draw_buffers||St.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),M(St.length<=W.maxColorAttachments,"too many color attachments, not supported"),Re=Re||St[0].width,Ke=Ke||St[0].height,Et?ot=He(Et):Ze&&!ct&&(ot=e(Re,Ke,Tt,"depth","uint32")),Gt?mt=He(Gt):ct&&!Ze&&(mt=e(Re,Ke,!1,"stencil","uint8")),Pt?vt=He(Pt):!Et&&!Gt&&ct&&Ze&&(vt=e(Re,Ke,Tt,"depth stencil","depth stencil")),M(!!Et+!!Gt+!!Pt<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Wt=null;for(_e=0;_e<St.length;++_e)if(Xe(St[_e],Re,Ke),M(!St[_e]||St[_e].texture&&El.indexOf(St[_e].texture._texture.format)>=0||St[_e].renderbuffer&&Al.indexOf(St[_e].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+_e+" is invalid"),St[_e]&&St[_e].texture){var Xt=Fa[St[_e].texture._texture.format]*Co[St[_e].texture._texture.type];Wt===null?Wt=Xt:M(Wt===Xt,"all color attachments much have the same number of bits per pixel.")}return Xe(ot,Re,Ke),M(!ot||ot.texture&&ot.texture._texture.format===Cs||ot.renderbuffer&&ot.renderbuffer._renderbuffer.format===kl,"invalid depth attachment for framebuffer object"),Xe(mt,Re,Ke),M(!mt||mt.renderbuffer&&mt.renderbuffer._renderbuffer.format===Ls,"invalid stencil attachment for framebuffer object"),Xe(vt,Re,Ke),M(!vt||vt.texture&&vt.texture._texture.format===ks||vt.renderbuffer&&vt.renderbuffer._renderbuffer.format===ks,"invalid depth-stencil attachment for framebuffer object"),s(H),H.width=Re,H.height=Ke,H.colorAttachments=St,H.depthAttachment=ot,H.stencilAttachment=mt,H.depthStencilAttachment=vt,ce.color=St.map(t),ce.depth=t(ot),ce.stencil=t(mt),ce.depthStencil=t(vt),ce.width=H.width,ce.height=H.height,f(H),ce}function Se(me,Oe){M(ge.next!==H,"can not resize a framebuffer which is currently in use");var _e=Math.max(me|0,1),Re=Math.max(Oe|0||_e,1);if(_e===H.width&&Re===H.height)return ce;for(var Ke=H.colorAttachments,Ze=0;Ze<Ke.length;++Ze)r(Ke[Ze],_e,Re);return r(H.depthAttachment,_e,Re),r(H.stencilAttachment,_e,Re),r(H.depthStencilAttachment,_e,Re),H.width=ce.width=_e,H.height=ce.height=Re,f(H),ce}return ce(B,R),m(ce,{resize:Se,_reglType:"framebuffer",_framebuffer:H,destroy:function(){l(H),s(H)},use:function(me){ge.setFBO({framebuffer:ce},me)}})}function w(B){var R=Array(6);function H(Se){var me;M(R.indexOf(ge.next)<0,"can not update framebuffer which is currently in use");var Oe={color:null},_e=0,Re=null,Ke="rgba",Ze="uint8",ct=1;if(typeof Se=="number")_e=Se|0;else if(!Se)_e=1;else{M.type(Se,"object","invalid arguments for framebuffer");var rt=Se;if("shape"in rt){var At=rt.shape;M(Array.isArray(At)&&At.length>=2,"invalid shape for framebuffer"),M(At[0]===At[1],"cube framebuffer must be square"),_e=At[0]}else"radius"in rt&&(_e=rt.radius|0),"width"in rt?(_e=rt.width|0,"height"in rt&&M(rt.height===_e,"must be square")):"height"in rt&&(_e=rt.height|0);("color"in rt||"colors"in rt)&&(Re=rt.color||rt.colors,Array.isArray(Re)&&M(Re.length===1||L.webgl_draw_buffers,"multiple render targets not supported")),Re||("colorCount"in rt&&(ct=rt.colorCount|0,M(ct>0,"invalid color buffer count")),"colorType"in rt&&(M.oneOf(rt.colorType,Be,"invalid color type"),Ze=rt.colorType),"colorFormat"in rt&&(Ke=rt.colorFormat,M.oneOf(rt.colorFormat,Me,"invalid color format for texture"))),"depth"in rt&&(Oe.depth=rt.depth),"stencil"in rt&&(Oe.stencil=rt.stencil),"depthStencil"in rt&&(Oe.depthStencil=rt.depthStencil)}var yt;if(Re)if(Array.isArray(Re))for(yt=[],me=0;me<Re.length;++me)yt[me]=Re[me];else yt=[Re];else{yt=Array(ct);var Ft={radius:_e,format:Ke,type:Ze};for(me=0;me<ct;++me)yt[me]=re.createCube(Ft)}for(Oe.color=Array(yt.length),me=0;me<yt.length;++me){var It=yt[me];M(typeof It=="function"&&It._reglType==="textureCube","invalid cube map"),_e=_e||It.width,M(It.width===_e&&It.height===_e,"invalid cube map shape"),Oe.color[me]={target:wo,data:yt[me]}}for(me=0;me<6;++me){for(var Et=0;Et<yt.length;++Et)Oe.color[Et].target=wo+me;me>0&&(Oe.depth=R[0].depth,Oe.stencil=R[0].stencil,Oe.depthStencil=R[0].depthStencil),R[me]?R[me](Oe):R[me]=c(Oe)}return m(H,{width:_e,height:_e,color:yt})}function ce(Se){var me,Oe=Se|0;if(M(Oe>0&&Oe<=W.maxCubeMapSize,"invalid radius for cube fbo"),Oe===H.width)return H;var _e=H.color;for(me=0;me<_e.length;++me)_e[me].resize(Oe);for(me=0;me<6;++me)R[me].resize(Oe);return H.width=H.height=Oe,H}return H(B),m(H,{faces:R,resize:ce,_reglType:"framebufferCube",destroy:function(){R.forEach(function(Se){Se.destroy()})}})}function O(){ge.cur=null,ge.next=null,ge.dirty=!0,Tr(i).forEach(function(B){B.framebuffer=u.createFramebuffer(),f(B)})}return m(ge,{getFramebuffer:function(B){if(typeof B=="function"&&B._reglType==="framebuffer"){var R=B._framebuffer;if(R instanceof o)return R}return null},create:c,createCube:w,clear:function(){Tr(i).forEach(l)},restore:O})}var Ar=5126,Dt=34962;function Or(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ar,this.offset=0,this.stride=0,this.divisor=0}function Xn(u,L,W,re,Ce){for(var pe=W.maxAttributes,ge=new Array(pe),Me=0;Me<pe;++Me)ge[Me]=new Or;var Fe=0,Be={},Ee={Record:Or,scope:{},state:ge,currentVAO:null,targetVAO:null,restore:Xe()?i:function(){},createVAO:o,getVAO:He,destroyBuffer:ze,setVAO:Xe()?e:t,clear:Xe()?r:function(){}};function ze(s){for(var l=0;l<ge.length;++l){var f=ge[l];f.buffer===s&&(u.disableVertexAttribArray(l),f.buffer=null)}}function Xe(){return L.oes_vertex_array_object}function Ie(){return L.angle_instanced_arrays}function He(s){return typeof s=="function"&&s._vao?s._vao:null}function e(s){if(s!==Ee.currentVAO){var l=Xe();s?l.bindVertexArrayOES(s.vao):l.bindVertexArrayOES(null),Ee.currentVAO=s}}function t(s){if(s!==Ee.currentVAO){if(s)s.bindAttrs();else for(var l=Ie(),f=0;f<ge.length;++f){var c=ge[f];c.buffer?(u.enableVertexAttribArray(f),u.vertexAttribPointer(f,c.size,c.type,c.normalized,c.stride,c.offfset),l&&c.divisor&&l.vertexAttribDivisorANGLE(f,c.divisor)):(u.disableVertexAttribArray(f),u.vertexAttrib4f(f,c.x,c.y,c.z,c.w))}Ee.currentVAO=s}}function r(){Tr(Be).forEach(function(s){s.destroy()})}function n(){this.id=++Fe,this.attributes=[];var s=Xe();s?this.vao=s.createVertexArrayOES():this.vao=null,Be[this.id]=this,this.buffers=[]}n.prototype.bindAttrs=function(){for(var s=Ie(),l=this.attributes,f=0;f<l.length;++f){var c=l[f];c.buffer?(u.enableVertexAttribArray(f),u.bindBuffer(Dt,c.buffer.buffer),u.vertexAttribPointer(f,c.size,c.type,c.normalized,c.stride,c.offset),s&&c.divisor&&s.vertexAttribDivisorANGLE(f,c.divisor)):(u.disableVertexAttribArray(f),u.vertexAttrib4f(f,c.x,c.y,c.z,c.w))}for(var w=l.length;w<pe;++w)u.disableVertexAttribArray(w)},n.prototype.refresh=function(){var s=Xe();s&&(s.bindVertexArrayOES(this.vao),this.bindAttrs(),Ee.currentVAO=this)},n.prototype.destroy=function(){if(this.vao){var s=Xe();this===Ee.currentVAO&&(Ee.currentVAO=null,s.bindVertexArrayOES(null)),s.deleteVertexArrayOES(this.vao),this.vao=null}Be[this.id]&&(delete Be[this.id],re.vaoCount-=1)};function i(){var s=Xe();s&&Tr(Be).forEach(function(l){l.refresh()})}function o(s){var l=new n;re.vaoCount+=1;function f(c){M(Array.isArray(c),"arguments to vertex array constructor must be an array"),M(c.length<pe,"too many attributes"),M(c.length>0,"must specify at least one attribute");var w={},O=l.attributes;O.length=c.length;for(var B=0;B<c.length;++B){var R=c[B],H=O[B]=new Or,ce=R.data||R;if(Array.isArray(ce)||d(ce)||Lr(ce)){var Se;l.buffers[B]&&(Se=l.buffers[B],d(ce)&&Se._buffer.byteLength>=ce.byteLength?Se.subdata(ce):(Se.destroy(),l.buffers[B]=null)),l.buffers[B]||(Se=l.buffers[B]=Ce.create(R,Dt,!1,!0)),H.buffer=Ce.getBuffer(Se),H.size=H.buffer.dimension|0,H.normalized=!1,H.type=H.buffer.dtype,H.offset=0,H.stride=0,H.divisor=0,H.state=1,w[B]=1}else Ce.getBuffer(R)?(H.buffer=Ce.getBuffer(R),H.size=H.buffer.dimension|0,H.normalized=!1,H.type=H.buffer.dtype,H.offset=0,H.stride=0,H.divisor=0,H.state=1):Ce.getBuffer(R.buffer)?(H.buffer=Ce.getBuffer(R.buffer),H.size=(+R.size||H.buffer.dimension)|0,H.normalized=!!R.normalized||!1,"type"in R?(M.parameter(R.type,ii,"invalid buffer type"),H.type=ii[R.type]):H.type=H.buffer.dtype,H.offset=(R.offset||0)|0,H.stride=(R.stride||0)|0,H.divisor=(R.divisor||0)|0,H.state=1,M(H.size>=1&&H.size<=4,"size must be between 1 and 4"),M(H.offset>=0,"invalid offset"),M(H.stride>=0&&H.stride<=255,"stride must be between 0 and 255"),M(H.divisor>=0,"divisor must be positive"),M(!H.divisor||!!L.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in R?(M(B>0,"first attribute must not be a constant"),H.x=+R.x||0,H.y=+R.y||0,H.z=+R.z||0,H.w=+R.w||0,H.state=2):M(!1,"invalid attribute spec for location "+B)}for(var me=0;me<l.buffers.length;++me)!w[me]&&l.buffers[me]&&(l.buffers[me].destroy(),l.buffers[me]=null);return l.refresh(),f}return f.destroy=function(){for(var c=0;c<l.buffers.length;++c)l.buffers[c]&&l.buffers[c].destroy();l.buffers.length=0,l.destroy()},f._vao=l,f._reglType="vao",f(s)}return Ee}var bn=35632,Rl=35633,As=35718,Ml=35721;function _f(u,L,W,re){var Ce={},pe={};function ge(e,t,r,n){this.name=e,this.id=t,this.location=r,this.info=n}function Me(e,t){for(var r=0;r<e.length;++r)if(e[r].id===t.id){e[r].location=t.location;return}e.push(t)}function Fe(e,t,r){var n=e===bn?Ce:pe,i=n[t];if(!i){var o=L.str(t);i=u.createShader(e),u.shaderSource(i,o),u.compileShader(i),M.shaderError(u,i,o,e,r),n[t]=i}return i}var Be={},Ee=[],ze=0;function Xe(e,t){this.id=ze++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,re.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Ie(e,t,r){var n,i,o=Fe(bn,e.fragId),s=Fe(Rl,e.vertId),l=e.program=u.createProgram();if(u.attachShader(l,o),u.attachShader(l,s),r)for(n=0;n<r.length;++n){var f=r[n];u.bindAttribLocation(l,f[0],f[1])}u.linkProgram(l),M.linkError(u,l,L.str(e.fragId),L.str(e.vertId),t);var c=u.getProgramParameter(l,As);re.profile&&(e.stats.uniformsCount=c);var w=e.uniforms;for(n=0;n<c;++n)if(i=u.getActiveUniform(l,n),i)if(i.size>1)for(var O=0;O<i.size;++O){var B=i.name.replace("[0]","["+O+"]");Me(w,new ge(B,L.id(B),u.getUniformLocation(l,B),i))}else Me(w,new ge(i.name,L.id(i.name),u.getUniformLocation(l,i.name),i));var R=u.getProgramParameter(l,Ml);re.profile&&(e.stats.attributesCount=R);var H=e.attributes;for(n=0;n<R;++n)i=u.getActiveAttrib(l,n),i&&Me(H,new ge(i.name,L.id(i.name),u.getAttribLocation(l,i.name),i))}re.profile&&(W.getMaxUniformsCount=function(){var e=0;return Ee.forEach(function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)}),e},W.getMaxAttributesCount=function(){var e=0;return Ee.forEach(function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)}),e});function He(){Ce={},pe={};for(var e=0;e<Ee.length;++e)Ie(Ee[e],null,Ee[e].attributes.map(function(t){return[t.location,t.name]}))}return{clear:function(){var e=u.deleteShader.bind(u);Tr(Ce).forEach(e),Ce={},Tr(pe).forEach(e),pe={},Ee.forEach(function(t){u.deleteProgram(t.program)}),Ee.length=0,Be={},W.shaderCount=0},program:function(e,t,r,n){M.command(e>=0,"missing vertex shader",r),M.command(t>=0,"missing fragment shader",r);var i=Be[t];i||(i=Be[t]={});var o=i[e];if(o&&(o.refCount++,!n))return o;var s=new Xe(t,e);return W.shaderCount++,Ie(s,r,n),o||(i[e]=s),Ee.push(s),m(s,{destroy:function(){if(s.refCount--,s.refCount<=0){u.deleteProgram(s.program);var l=Ee.indexOf(s);Ee.splice(l,1),W.shaderCount--}i[s.vertId].refCount<=0&&(u.deleteShader(pe[s.vertId]),delete pe[s.vertId],delete Be[s.fragId][s.vertId]),Object.keys(Be[s.fragId]).length||(u.deleteShader(Ce[s.fragId]),delete Ce[s.fragId],delete Be[s.fragId])}})},restore:He,shader:Fe,frag:-1,vert:-1}}var Os=6408,xn=5121,Fl=3333,Yi=5126;function jn(u,L,W,re,Ce,pe,ge){function Me(Ee){var ze;L.next===null?(M(Ce.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),ze=xn):(M(L.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),ze=L.next.colorAttachments[0].texture._texture.type,pe.oes_texture_float?(M(ze===xn||ze===Yi,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),ze===Yi&&M(ge.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):M(ze===xn,"Reading from a framebuffer is only allowed for the type 'uint8'"));var Xe=0,Ie=0,He=re.framebufferWidth,e=re.framebufferHeight,t=null;d(Ee)?t=Ee:Ee&&(M.type(Ee,"object","invalid arguments to regl.read()"),Xe=Ee.x|0,Ie=Ee.y|0,M(Xe>=0&&Xe<re.framebufferWidth,"invalid x offset for regl.read"),M(Ie>=0&&Ie<re.framebufferHeight,"invalid y offset for regl.read"),He=(Ee.width||re.framebufferWidth-Xe)|0,e=(Ee.height||re.framebufferHeight-Ie)|0,t=Ee.data||null),t&&(ze===xn?M(t instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):ze===Yi&&M(t instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),M(He>0&&He+Xe<=re.framebufferWidth,"invalid width for read pixels"),M(e>0&&e+Ie<=re.framebufferHeight,"invalid height for read pixels"),W();var r=He*e*4;return t||(ze===xn?t=new Uint8Array(r):ze===Yi&&(t=t||new Float32Array(r))),M.isTypedArray(t,"data buffer for regl.read() must be a typedarray"),M(t.byteLength>=r,"data buffer for regl.read() too small"),u.pixelStorei(Fl,4),u.readPixels(Xe,Ie,He,e,Os,ze,t),t}function Fe(Ee){var ze;return L.setFBO({framebuffer:Ee.framebuffer},function(){ze=Me(Ee)}),ze}function Be(Ee){return!Ee||!("framebuffer"in Ee)?Me(Ee):Fe(Ee)}return Be}function mi(u){return Array.prototype.slice.call(u)}function gi(u){return mi(u).join("")}function Ef(){var u=0,L=[],W=[];function re(ze){for(var Xe=0;Xe<W.length;++Xe)if(W[Xe]===ze)return L[Xe];var Ie="g"+u++;return L.push(Ie),W.push(ze),Ie}function Ce(){var ze=[];function Xe(){ze.push.apply(ze,mi(arguments))}var Ie=[];function He(){var e="v"+u++;return Ie.push(e),arguments.length>0&&(ze.push(e,"="),ze.push.apply(ze,mi(arguments)),ze.push(";")),e}return m(Xe,{def:He,toString:function(){return gi([Ie.length>0?"var "+Ie.join(",")+";":"",gi(ze)])}})}function pe(){var ze=Ce(),Xe=Ce(),Ie=ze.toString,He=Xe.toString;function e(t,r){Xe(t,r,"=",ze.def(t,r),";")}return m(function(){ze.apply(ze,mi(arguments))},{def:ze.def,entry:ze,exit:Xe,save:e,set:function(t,r,n){e(t,r),ze(t,r,"=",n,";")},toString:function(){return Ie()+He()}})}function ge(){var ze=gi(arguments),Xe=pe(),Ie=pe(),He=Xe.toString,e=Ie.toString;return m(Xe,{then:function(){return Xe.apply(Xe,mi(arguments)),this},else:function(){return Ie.apply(Ie,mi(arguments)),this},toString:function(){var t=e();return t&&(t="else{"+t+"}"),gi(["if(",ze,"){",He(),"}",t])}})}var Me=Ce(),Fe={};function Be(ze,Xe){var Ie=[];function He(){var i="a"+Ie.length;return Ie.push(i),i}Xe=Xe||0;for(var e=0;e<Xe;++e)He();var t=pe(),r=t.toString,n=Fe[ze]=m(t,{arg:He,toString:function(){return gi(["function(",Ie.join(),"){",r(),"}"])}});return n}function Ee(){var ze=['"use strict";',Me,"return {"];Object.keys(Fe).forEach(function(He){ze.push('"',He,'":',Fe[He].toString(),",")}),ze.push("}");var Xe=gi(ze).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Ie=Function.apply(null,L.concat(Xe));return Ie.apply(null,W)}return{global:Me,link:re,block:Ce,proc:Be,scope:pe,cond:ge,compile:Ee}}var Sn="xyzw".split(""),Eo=5121,yi=1,Rs=2,Lo=0,Ms=1,Fs=2,$i=3,Pa=4,Il=5,Pl=6,Is="dither",bi="blend.enable",ko="blend.color",Vi="blend.equation",Ao="blend.func",Oo="depth.enable",Ps="depth.func",Nl="depth.range",Ns="depth.mask",lr="colorMask",Na="cull.enable",Bs="cull.face",Ro="frontFace",Mo="lineWidth",xi="polygonOffset.enable",Qi="polygonOffset.offset",Ds="sample.alpha",Gs="sample.enable",Fo="sample.coverage",Si="stencil.enable",Hs="stencil.mask",Zi="stencil.func",Io="stencil.opFront",wn="stencil.opBack",Bl="scissor.enable",Tn="scissor.box",en="viewport",Ji="profile",Kn="framebuffer",Cn="vert",_n="frag",Ur="elements",Xr="primitive",Yn="count",Po="offset",Ba="instances",Pr="vao",$n="Width",wi="Height",ea=Kn+$n,Ti=Kn+wi,Lf=en+$n,kf=en+wi,Dl="drawingBuffer",mr=Dl+$n,zs=Dl+wi,Af=[Ao,Vi,Zi,Io,wn,Fo,en,Tn,Qi],ta=34962,Of=34963,Gl=35632,Hl=35633,Ws=3553,Rf=34067,Mf=2884,Ff=3042,Vn=3024,Da=2960,No=2929,Ga=3089,En=32823,If=32926,Pf=32928,Qn=5126,Ha=35664,za=35665,Wa=35666,ra=5124,Ln=35667,na=35668,ia=35669,qa=35670,Bo=35671,Zn=35672,Ua=35673,Xa=35674,aa=35675,Jn=35676,ja=35678,Ka=35680,oa=4,sa=1028,ei=1029,zl=2304,Ya=2305,Wl=32775,Nf=32776,ql=519,kn=7680,Ul=0,Do=1,la=32774,$a=513,Xl=36160,jl=36064,tn={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Kl=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],fa={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ti={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},qs={frag:Gl,vert:Hl},Us={cw:zl,ccw:Ya};function Go(u){return Array.isArray(u)||d(u)||Lr(u)}function Xs(u){return u.sort(function(L,W){return L===en?-1:W===en?1:L<W?-1:1})}function dr(u,L,W,re){this.thisDep=u,this.contextDep=L,this.propDep=W,this.append=re}function An(u){return u&&!(u.thisDep||u.contextDep||u.propDep)}function tr(u){return new dr(!1,!1,!1,u)}function xr(u,L){var W=u.type;if(W===Lo){var re=u.data.length;return new dr(!0,re>=1,re>=2,L)}else if(W===Pa){var Ce=u.data;return new dr(Ce.thisDep,Ce.contextDep,Ce.propDep,L)}else{if(W===Il)return new dr(!1,!1,!1,L);if(W===Pl){for(var pe=!1,ge=!1,Me=!1,Fe=0;Fe<u.data.length;++Fe){var Be=u.data[Fe];if(Be.type===Ms)Me=!0;else if(Be.type===Fs)ge=!0;else if(Be.type===$i)pe=!0;else if(Be.type===Lo){pe=!0;var Ee=Be.data;Ee>=1&&(ge=!0),Ee>=2&&(Me=!0)}else Be.type===Pa&&(pe=pe||Be.data.thisDep,ge=ge||Be.data.contextDep,Me=Me||Be.data.propDep)}return new dr(pe,ge,Me,L)}else return new dr(W===$i,W===Fs,W===Ms,L)}}var Ci=new dr(!1,!1,!1,function(){});function Yl(u,L,W,re,Ce,pe,ge,Me,Fe,Be,Ee,ze,Xe,Ie,He){var e=Be.Record,t={add:32774,subtract:32778,"reverse subtract":32779};W.ext_blend_minmax&&(t.min=Wl,t.max=Nf);var r=W.angle_instanced_arrays,n=W.webgl_draw_buffers,i={dirty:!0,profile:He.profile},o={},s=[],l={},f={};function c(F){return F.replace(".","_")}function w(F,T,Y){var ne=c(F);s.push(F),o[ne]=i[ne]=!!Y,l[ne]=T}function O(F,T,Y){var ne=c(F);s.push(F),Array.isArray(Y)?(i[ne]=Y.slice(),o[ne]=Y.slice()):i[ne]=o[ne]=Y,f[ne]=T}w(Is,Vn),w(bi,Ff),O(ko,"blendColor",[0,0,0,0]),O(Vi,"blendEquationSeparate",[la,la]),O(Ao,"blendFuncSeparate",[Do,Ul,Do,Ul]),w(Oo,No,!0),O(Ps,"depthFunc",$a),O(Nl,"depthRange",[0,1]),O(Ns,"depthMask",!0),O(lr,lr,[!0,!0,!0,!0]),w(Na,Mf),O(Bs,"cullFace",ei),O(Ro,Ro,Ya),O(Mo,Mo,1),w(xi,En),O(Qi,"polygonOffset",[0,0]),w(Ds,If),w(Gs,Pf),O(Fo,"sampleCoverage",[1,!1]),w(Si,Da),O(Hs,"stencilMask",-1),O(Zi,"stencilFunc",[ql,0,-1]),O(Io,"stencilOpSeparate",[sa,kn,kn,kn]),O(wn,"stencilOpSeparate",[ei,kn,kn,kn]),w(Bl,Ga),O(Tn,"scissor",[0,0,u.drawingBufferWidth,u.drawingBufferHeight]),O(en,en,[0,0,u.drawingBufferWidth,u.drawingBufferHeight]);var B={gl:u,context:Xe,strings:L,next:o,current:i,draw:ze,elements:pe,buffer:Ce,shader:Ee,attributes:Be.state,vao:Be,uniforms:Fe,framebuffer:Me,extensions:W,timer:Ie,isBufferArgs:Go},R={primTypes:Cr,compareFuncs:fa,blendFuncs:tn,blendEquations:t,stencilOps:ti,glTypes:ii,orientationType:Us};M.optional(function(){B.isArrayLike=Ut}),n&&(R.backBuffer=[ei],R.drawBuffer=qt(re.maxDrawbuffers,function(F){return F===0?[0]:qt(F,function(T){return jl+T})}));var H=0;function ce(){var F=Ef(),T=F.link,Y=F.global;F.id=H++,F.batchId="0";var ne=T(B),oe=F.shared={props:"a0"};Object.keys(B).forEach(function(K){oe[K]=Y.def(ne,".",K)}),M.optional(function(){F.CHECK=T(M),F.commandStr=M.guessCommand(),F.command=T(F.commandStr),F.assert=function(K,k,ee){K("if(!(",k,"))",this.CHECK,".commandRaise(",T(ee),",",this.command,");")},R.invalidBlendCombinations=Kl});var V=F.next={},$=F.current={};Object.keys(f).forEach(function(K){Array.isArray(i[K])&&(V[K]=Y.def(oe.next,".",K),$[K]=Y.def(oe.current,".",K))});var J=F.constants={};Object.keys(R).forEach(function(K){J[K]=Y.def(JSON.stringify(R[K]))}),F.invoke=function(K,k){switch(k.type){case Lo:var ee=["this",oe.context,oe.props,F.batchId];return K.def(T(k.data),".call(",ee.slice(0,Math.max(k.data.length+1,4)),")");case Ms:return K.def(oe.props,k.data);case Fs:return K.def(oe.context,k.data);case $i:return K.def("this",k.data);case Pa:return k.data.append(F,K),k.data.ref;case Il:return k.data.toString();case Pl:return k.data.map(function(fe){return F.invoke(K,fe)})}},F.attribCache={};var I={};return F.scopeAttrib=function(K){var k=L.id(K);if(k in I)return I[k];var ee=Be.scope[k];ee||(ee=Be.scope[k]=new e);var fe=I[k]=T(ee);return fe},F}function Se(F){var T=F.static,Y=F.dynamic,ne;if(Ji in T){var oe=!!T[Ji];ne=tr(function($,J){return oe}),ne.enable=oe}else if(Ji in Y){var V=Y[Ji];ne=xr(V,function($,J){return $.invoke(J,V)})}return ne}function me(F,T){var Y=F.static,ne=F.dynamic;if(Kn in Y){var oe=Y[Kn];return oe?(oe=Me.getFramebuffer(oe),M.command(oe,"invalid framebuffer object"),tr(function($,J){var I=$.link(oe),K=$.shared;J.set(K.framebuffer,".next",I);var k=K.context;return J.set(k,"."+ea,I+".width"),J.set(k,"."+Ti,I+".height"),I})):tr(function($,J){var I=$.shared;J.set(I.framebuffer,".next","null");var K=I.context;return J.set(K,"."+ea,K+"."+mr),J.set(K,"."+Ti,K+"."+zs),"null"})}else if(Kn in ne){var V=ne[Kn];return xr(V,function($,J){var I=$.invoke(J,V),K=$.shared,k=K.framebuffer,ee=J.def(k,".getFramebuffer(",I,")");M.optional(function(){$.assert(J,"!"+I+"||"+ee,"invalid framebuffer object")}),J.set(k,".next",ee);var fe=K.context;return J.set(fe,"."+ea,ee+"?"+ee+".width:"+fe+"."+mr),J.set(fe,"."+Ti,ee+"?"+ee+".height:"+fe+"."+zs),ee})}else return null}function Oe(F,T,Y){var ne=F.static,oe=F.dynamic;function V(I){if(I in ne){var K=ne[I];M.commandType(K,"object","invalid "+I,Y.commandStr);var k=!0,ee=K.x|0,fe=K.y|0,Te,Le;return"width"in K?(Te=K.width|0,M.command(Te>=0,"invalid "+I,Y.commandStr)):k=!1,"height"in K?(Le=K.height|0,M.command(Le>=0,"invalid "+I,Y.commandStr)):k=!1,new dr(!k&&T&&T.thisDep,!k&&T&&T.contextDep,!k&&T&&T.propDep,function(it,wt){var et=it.shared.context,dt=Te;"width"in K||(dt=wt.def(et,".",ea,"-",ee));var xt=Le;return"height"in K||(xt=wt.def(et,".",Ti,"-",fe)),[ee,fe,dt,xt]})}else if(I in oe){var xe=oe[I],De=xr(xe,function(it,wt){var et=it.invoke(wt,xe);M.optional(function(){it.assert(wt,et+"&&typeof "+et+'==="object"',"invalid "+I)});var dt=it.shared.context,xt=wt.def(et,".x|0"),Rt=wt.def(et,".y|0"),rr=wt.def('"width" in ',et,"?",et,".width|0:","(",dt,".",ea,"-",xt,")"),Rr=wt.def('"height" in ',et,"?",et,".height|0:","(",dt,".",Ti,"-",Rt,")");return M.optional(function(){it.assert(wt,rr+">=0&&"+Rr+">=0","invalid "+I)}),[xt,Rt,rr,Rr]});return T&&(De.thisDep=De.thisDep||T.thisDep,De.contextDep=De.contextDep||T.contextDep,De.propDep=De.propDep||T.propDep),De}else return T?new dr(T.thisDep,T.contextDep,T.propDep,function(it,wt){var et=it.shared.context;return[0,0,wt.def(et,".",ea),wt.def(et,".",Ti)]}):null}var $=V(en);if($){var J=$;$=new dr($.thisDep,$.contextDep,$.propDep,function(I,K){var k=J.append(I,K),ee=I.shared.context;return K.set(ee,"."+Lf,k[2]),K.set(ee,"."+kf,k[3]),k})}return{viewport:$,scissor_box:V(Tn)}}function _e(F,T){var Y=F.static,ne=typeof Y[_n]=="string"&&typeof Y[Cn]=="string";if(ne){if(Object.keys(T.dynamic).length>0)return null;var oe=T.static,V=Object.keys(oe);if(V.length>0&&typeof oe[V[0]]=="number"){for(var $=[],J=0;J<V.length;++J)M(typeof oe[V[J]]=="number","must specify all vertex attribute locations when using vaos"),$.push([oe[V[J]]|0,V[J]]);return $}}return null}function Re(F,T,Y){var ne=F.static,oe=F.dynamic;function V(k){if(k in ne){var ee=L.id(ne[k]);M.optional(function(){Ee.shader(qs[k],ee,M.guessCommand())});var fe=tr(function(){return ee});return fe.id=ee,fe}else if(k in oe){var Te=oe[k];return xr(Te,function(Le,xe){var De=Le.invoke(xe,Te),it=xe.def(Le.shared.strings,".id(",De,")");return M.optional(function(){xe(Le.shared.shader,".shader(",qs[k],",",it,",",Le.command,");")}),it})}return null}var $=V(_n),J=V(Cn),I=null,K;return An($)&&An(J)?(I=Ee.program(J.id,$.id,null,Y),K=tr(function(k,ee){return k.link(I)})):K=new dr($&&$.thisDep||J&&J.thisDep,$&&$.contextDep||J&&J.contextDep,$&&$.propDep||J&&J.propDep,function(k,ee){var fe=k.shared.shader,Te;$?Te=$.append(k,ee):Te=ee.def(fe,".",_n);var Le;J?Le=J.append(k,ee):Le=ee.def(fe,".",Cn);var xe=fe+".program("+Le+","+Te;return M.optional(function(){xe+=","+k.command}),ee.def(xe+")")}),{frag:$,vert:J,progVar:K,program:I}}function Ke(F,T){var Y=F.static,ne=F.dynamic;function oe(){if(Ur in Y){var k=Y[Ur];Go(k)?k=pe.getElements(pe.create(k,!0)):k&&(k=pe.getElements(k),M.command(k,"invalid elements",T.commandStr));var ee=tr(function(Te,Le){if(k){var xe=Te.link(k);return Te.ELEMENTS=xe,xe}return Te.ELEMENTS=null,null});return ee.value=k,ee}else if(Ur in ne){var fe=ne[Ur];return xr(fe,function(Te,Le){var xe=Te.shared,De=xe.isBufferArgs,it=xe.elements,wt=Te.invoke(Le,fe),et=Le.def("null"),dt=Le.def(De,"(",wt,")"),xt=Te.cond(dt).then(et,"=",it,".createStream(",wt,");").else(et,"=",it,".getElements(",wt,");");return M.optional(function(){Te.assert(xt.else,"!"+wt+"||"+et,"invalid elements")}),Le.entry(xt),Le.exit(Te.cond(dt).then(it,".destroyStream(",et,");")),Te.ELEMENTS=et,et})}return null}var V=oe();function $(){if(Xr in Y){var k=Y[Xr];return M.commandParameter(k,Cr,"invalid primitve",T.commandStr),tr(function(fe,Te){return Cr[k]})}else if(Xr in ne){var ee=ne[Xr];return xr(ee,function(fe,Te){var Le=fe.constants.primTypes,xe=fe.invoke(Te,ee);return M.optional(function(){fe.assert(Te,xe+" in "+Le,"invalid primitive, must be one of "+Object.keys(Cr))}),Te.def(Le,"[",xe,"]")})}else if(V)return An(V)?V.value?tr(function(fe,Te){return Te.def(fe.ELEMENTS,".primType")}):tr(function(){return oa}):new dr(V.thisDep,V.contextDep,V.propDep,function(fe,Te){var Le=fe.ELEMENTS;return Te.def(Le,"?",Le,".primType:",oa)});return null}function J(k,ee){if(k in Y){var fe=Y[k]|0;return M.command(!ee||fe>=0,"invalid "+k,T.commandStr),tr(function(Le,xe){return ee&&(Le.OFFSET=fe),fe})}else if(k in ne){var Te=ne[k];return xr(Te,function(Le,xe){var De=Le.invoke(xe,Te);return ee&&(Le.OFFSET=De,M.optional(function(){Le.assert(xe,De+">=0","invalid "+k)})),De})}else if(ee&&V)return tr(function(Le,xe){return Le.OFFSET="0",0});return null}var I=J(Po,!0);function K(){if(Yn in Y){var k=Y[Yn]|0;return M.command(typeof k=="number"&&k>=0,"invalid vertex count",T.commandStr),tr(function(){return k})}else if(Yn in ne){var ee=ne[Yn];return xr(ee,function(Le,xe){var De=Le.invoke(xe,ee);return M.optional(function(){Le.assert(xe,"typeof "+De+'==="number"&&'+De+">=0&&"+De+"===("+De+"|0)","invalid vertex count")}),De})}else if(V)if(An(V)){if(V)return I?new dr(I.thisDep,I.contextDep,I.propDep,function(Le,xe){var De=xe.def(Le.ELEMENTS,".vertCount-",Le.OFFSET);return M.optional(function(){Le.assert(xe,De+">=0","invalid vertex offset/element buffer too small")}),De}):tr(function(Le,xe){return xe.def(Le.ELEMENTS,".vertCount")});var fe=tr(function(){return-1});return M.optional(function(){fe.MISSING=!0}),fe}else{var Te=new dr(V.thisDep||I.thisDep,V.contextDep||I.contextDep,V.propDep||I.propDep,function(Le,xe){var De=Le.ELEMENTS;return Le.OFFSET?xe.def(De,"?",De,".vertCount-",Le.OFFSET,":-1"):xe.def(De,"?",De,".vertCount:-1")});return M.optional(function(){Te.DYNAMIC=!0}),Te}return null}return{elements:V,primitive:$(),count:K(),instances:J(Ba,!1),offset:I}}function Ze(F,T){var Y=F.static,ne=F.dynamic,oe={};return s.forEach(function(V){var $=c(V);function J(I,K){if(V in Y){var k=I(Y[V]);oe[$]=tr(function(){return k})}else if(V in ne){var ee=ne[V];oe[$]=xr(ee,function(fe,Te){return K(fe,Te,fe.invoke(Te,ee))})}}switch(V){case Na:case bi:case Is:case Si:case Oo:case Bl:case xi:case Ds:case Gs:case Ns:return J(function(I){return M.commandType(I,"boolean",V,T.commandStr),I},function(I,K,k){return M.optional(function(){I.assert(K,"typeof "+k+'==="boolean"',"invalid flag "+V,I.commandStr)}),k});case Ps:return J(function(I){return M.commandParameter(I,fa,"invalid "+V,T.commandStr),fa[I]},function(I,K,k){var ee=I.constants.compareFuncs;return M.optional(function(){I.assert(K,k+" in "+ee,"invalid "+V+", must be one of "+Object.keys(fa))}),K.def(ee,"[",k,"]")});case Nl:return J(function(I){return M.command(Ut(I)&&I.length===2&&typeof I[0]=="number"&&typeof I[1]=="number"&&I[0]<=I[1],"depth range is 2d array",T.commandStr),I},function(I,K,k){M.optional(function(){I.assert(K,I.shared.isArrayLike+"("+k+")&&"+k+".length===2&&typeof "+k+'[0]==="number"&&typeof '+k+'[1]==="number"&&'+k+"[0]<="+k+"[1]","depth range must be a 2d array")});var ee=K.def("+",k,"[0]"),fe=K.def("+",k,"[1]");return[ee,fe]});case Ao:return J(function(I){M.commandType(I,"object","blend.func",T.commandStr);var K="srcRGB"in I?I.srcRGB:I.src,k="srcAlpha"in I?I.srcAlpha:I.src,ee="dstRGB"in I?I.dstRGB:I.dst,fe="dstAlpha"in I?I.dstAlpha:I.dst;return M.commandParameter(K,tn,$+".srcRGB",T.commandStr),M.commandParameter(k,tn,$+".srcAlpha",T.commandStr),M.commandParameter(ee,tn,$+".dstRGB",T.commandStr),M.commandParameter(fe,tn,$+".dstAlpha",T.commandStr),M.command(Kl.indexOf(K+", "+ee)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+K+", "+ee+")",T.commandStr),[tn[K],tn[ee],tn[k],tn[fe]]},function(I,K,k){var ee=I.constants.blendFuncs;M.optional(function(){I.assert(K,k+"&&typeof "+k+'==="object"',"invalid blend func, must be an object")});function fe(et,dt){var xt=K.def('"',et,dt,'" in ',k,"?",k,".",et,dt,":",k,".",et);return M.optional(function(){I.assert(K,xt+" in "+ee,"invalid "+V+"."+et+dt+", must be one of "+Object.keys(tn))}),xt}var Te=fe("src","RGB"),Le=fe("dst","RGB");M.optional(function(){var et=I.constants.invalidBlendCombinations;I.assert(K,et+".indexOf("+Te+'+", "+'+Le+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var xe=K.def(ee,"[",Te,"]"),De=K.def(ee,"[",fe("src","Alpha"),"]"),it=K.def(ee,"[",Le,"]"),wt=K.def(ee,"[",fe("dst","Alpha"),"]");return[xe,it,De,wt]});case Vi:return J(function(I){if(typeof I=="string")return M.commandParameter(I,t,"invalid "+V,T.commandStr),[t[I],t[I]];if(typeof I=="object")return M.commandParameter(I.rgb,t,V+".rgb",T.commandStr),M.commandParameter(I.alpha,t,V+".alpha",T.commandStr),[t[I.rgb],t[I.alpha]];M.commandRaise("invalid blend.equation",T.commandStr)},function(I,K,k){var ee=I.constants.blendEquations,fe=K.def(),Te=K.def(),Le=I.cond("typeof ",k,'==="string"');return M.optional(function(){function xe(De,it,wt){I.assert(De,wt+" in "+ee,"invalid "+it+", must be one of "+Object.keys(t))}xe(Le.then,V,k),I.assert(Le.else,k+"&&typeof "+k+'==="object"',"invalid "+V),xe(Le.else,V+".rgb",k+".rgb"),xe(Le.else,V+".alpha",k+".alpha")}),Le.then(fe,"=",Te,"=",ee,"[",k,"];"),Le.else(fe,"=",ee,"[",k,".rgb];",Te,"=",ee,"[",k,".alpha];"),K(Le),[fe,Te]});case ko:return J(function(I){return M.command(Ut(I)&&I.length===4,"blend.color must be a 4d array",T.commandStr),qt(4,function(K){return+I[K]})},function(I,K,k){return M.optional(function(){I.assert(K,I.shared.isArrayLike+"("+k+")&&"+k+".length===4","blend.color must be a 4d array")}),qt(4,function(ee){return K.def("+",k,"[",ee,"]")})});case Hs:return J(function(I){return M.commandType(I,"number",$,T.commandStr),I|0},function(I,K,k){return M.optional(function(){I.assert(K,"typeof "+k+'==="number"',"invalid stencil.mask")}),K.def(k,"|0")});case Zi:return J(function(I){M.commandType(I,"object",$,T.commandStr);var K=I.cmp||"keep",k=I.ref||0,ee="mask"in I?I.mask:-1;return M.commandParameter(K,fa,V+".cmp",T.commandStr),M.commandType(k,"number",V+".ref",T.commandStr),M.commandType(ee,"number",V+".mask",T.commandStr),[fa[K],k,ee]},function(I,K,k){var ee=I.constants.compareFuncs;M.optional(function(){function xe(){I.assert(K,Array.prototype.join.call(arguments,""),"invalid stencil.func")}xe(k+"&&typeof ",k,'==="object"'),xe('!("cmp" in ',k,")||(",k,".cmp in ",ee,")")});var fe=K.def('"cmp" in ',k,"?",ee,"[",k,".cmp]",":",kn),Te=K.def(k,".ref|0"),Le=K.def('"mask" in ',k,"?",k,".mask|0:-1");return[fe,Te,Le]});case Io:case wn:return J(function(I){M.commandType(I,"object",$,T.commandStr);var K=I.fail||"keep",k=I.zfail||"keep",ee=I.zpass||"keep";return M.commandParameter(K,ti,V+".fail",T.commandStr),M.commandParameter(k,ti,V+".zfail",T.commandStr),M.commandParameter(ee,ti,V+".zpass",T.commandStr),[V===wn?ei:sa,ti[K],ti[k],ti[ee]]},function(I,K,k){var ee=I.constants.stencilOps;M.optional(function(){I.assert(K,k+"&&typeof "+k+'==="object"',"invalid "+V)});function fe(Te){return M.optional(function(){I.assert(K,'!("'+Te+'" in '+k+")||("+k+"."+Te+" in "+ee+")","invalid "+V+"."+Te+", must be one of "+Object.keys(ti))}),K.def('"',Te,'" in ',k,"?",ee,"[",k,".",Te,"]:",kn)}return[V===wn?ei:sa,fe("fail"),fe("zfail"),fe("zpass")]});case Qi:return J(function(I){M.commandType(I,"object",$,T.commandStr);var K=I.factor|0,k=I.units|0;return M.commandType(K,"number",$+".factor",T.commandStr),M.commandType(k,"number",$+".units",T.commandStr),[K,k]},function(I,K,k){M.optional(function(){I.assert(K,k+"&&typeof "+k+'==="object"',"invalid "+V)});var ee=K.def(k,".factor|0"),fe=K.def(k,".units|0");return[ee,fe]});case Bs:return J(function(I){var K=0;return I==="front"?K=sa:I==="back"&&(K=ei),M.command(!!K,$,T.commandStr),K},function(I,K,k){return M.optional(function(){I.assert(K,k+'==="front"||'+k+'==="back"',"invalid cull.face")}),K.def(k,'==="front"?',sa,":",ei)});case Mo:return J(function(I){return M.command(typeof I=="number"&&I>=re.lineWidthDims[0]&&I<=re.lineWidthDims[1],"invalid line width, must be a positive number between "+re.lineWidthDims[0]+" and "+re.lineWidthDims[1],T.commandStr),I},function(I,K,k){return M.optional(function(){I.assert(K,"typeof "+k+'==="number"&&'+k+">="+re.lineWidthDims[0]+"&&"+k+"<="+re.lineWidthDims[1],"invalid line width")}),k});case Ro:return J(function(I){return M.commandParameter(I,Us,$,T.commandStr),Us[I]},function(I,K,k){return M.optional(function(){I.assert(K,k+'==="cw"||'+k+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),K.def(k+'==="cw"?'+zl+":"+Ya)});case lr:return J(function(I){return M.command(Ut(I)&&I.length===4,"color.mask must be length 4 array",T.commandStr),I.map(function(K){return!!K})},function(I,K,k){return M.optional(function(){I.assert(K,I.shared.isArrayLike+"("+k+")&&"+k+".length===4","invalid color.mask")}),qt(4,function(ee){return"!!"+k+"["+ee+"]"})});case Fo:return J(function(I){M.command(typeof I=="object"&&I,$,T.commandStr);var K="value"in I?I.value:1,k=!!I.invert;return M.command(typeof K=="number"&&K>=0&&K<=1,"sample.coverage.value must be a number between 0 and 1",T.commandStr),[K,k]},function(I,K,k){M.optional(function(){I.assert(K,k+"&&typeof "+k+'==="object"',"invalid sample.coverage")});var ee=K.def('"value" in ',k,"?+",k,".value:1"),fe=K.def("!!",k,".invert");return[ee,fe]})}}),oe}function ct(F,T){var Y=F.static,ne=F.dynamic,oe={};return Object.keys(Y).forEach(function(V){var $=Y[V],J;if(typeof $=="number"||typeof $=="boolean")J=tr(function(){return $});else if(typeof $=="function"){var I=$._reglType;I==="texture2d"||I==="textureCube"?J=tr(function(K){return K.link($)}):I==="framebuffer"||I==="framebufferCube"?(M.command($.color.length>0,'missing color attachment for framebuffer sent to uniform "'+V+'"',T.commandStr),J=tr(function(K){return K.link($.color[0])})):M.commandRaise('invalid data for uniform "'+V+'"',T.commandStr)}else Ut($)?J=tr(function(K){var k=K.global.def("[",qt($.length,function(ee){return M.command(typeof $[ee]=="number"||typeof $[ee]=="boolean","invalid uniform "+V,K.commandStr),$[ee]}),"]");return k}):M.commandRaise('invalid or missing data for uniform "'+V+'"',T.commandStr);J.value=$,oe[V]=J}),Object.keys(ne).forEach(function(V){var $=ne[V];oe[V]=xr($,function(J,I){return J.invoke(I,$)})}),oe}function rt(F,T){var Y=F.static,ne=F.dynamic,oe={};return Object.keys(Y).forEach(function(V){var $=Y[V],J=L.id(V),I=new e;if(Go($))I.state=yi,I.buffer=Ce.getBuffer(Ce.create($,ta,!1,!0)),I.type=0;else{var K=Ce.getBuffer($);if(K)I.state=yi,I.buffer=K,I.type=0;else if(M.command(typeof $=="object"&&$,"invalid data for attribute "+V,T.commandStr),"constant"in $){var k=$.constant;I.buffer="null",I.state=Rs,typeof k=="number"?I.x=k:(M.command(Ut(k)&&k.length>0&&k.length<=4,"invalid constant for attribute "+V,T.commandStr),Sn.forEach(function(it,wt){wt<k.length&&(I[it]=k[wt])}))}else{Go($.buffer)?K=Ce.getBuffer(Ce.create($.buffer,ta,!1,!0)):K=Ce.getBuffer($.buffer),M.command(!!K,'missing buffer for attribute "'+V+'"',T.commandStr);var ee=$.offset|0;M.command(ee>=0,'invalid offset for attribute "'+V+'"',T.commandStr);var fe=$.stride|0;M.command(fe>=0&&fe<256,'invalid stride for attribute "'+V+'", must be integer betweeen [0, 255]',T.commandStr);var Te=$.size|0;M.command(!("size"in $)||Te>0&&Te<=4,'invalid size for attribute "'+V+'", must be 1,2,3,4',T.commandStr);var Le=!!$.normalized,xe=0;"type"in $&&(M.commandParameter($.type,ii,"invalid type for attribute "+V,T.commandStr),xe=ii[$.type]);var De=$.divisor|0;"divisor"in $&&(M.command(De===0||r,'cannot specify divisor for attribute "'+V+'", instancing not supported',T.commandStr),M.command(De>=0,'invalid divisor for attribute "'+V+'"',T.commandStr)),M.optional(function(){var it=T.commandStr,wt=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys($).forEach(function(et){M.command(wt.indexOf(et)>=0,'unknown parameter "'+et+'" for attribute pointer "'+V+'" (valid parameters are '+wt+")",it)})}),I.buffer=K,I.state=yi,I.size=Te,I.normalized=Le,I.type=xe||K.dtype,I.offset=ee,I.stride=fe,I.divisor=De}}oe[V]=tr(function(it,wt){var et=it.attribCache;if(J in et)return et[J];var dt={isStream:!1};return Object.keys(I).forEach(function(xt){dt[xt]=I[xt]}),I.buffer&&(dt.buffer=it.link(I.buffer),dt.type=dt.type||dt.buffer+".dtype"),et[J]=dt,dt})}),Object.keys(ne).forEach(function(V){var $=ne[V];function J(I,K){var k=I.invoke(K,$),ee=I.shared,fe=I.constants,Te=ee.isBufferArgs,Le=ee.buffer;M.optional(function(){I.assert(K,k+"&&(typeof "+k+'==="object"||typeof '+k+'==="function")&&('+Te+"("+k+")||"+Le+".getBuffer("+k+")||"+Le+".getBuffer("+k+".buffer)||"+Te+"("+k+'.buffer)||("constant" in '+k+"&&(typeof "+k+'.constant==="number"||'+ee.isArrayLike+"("+k+".constant))))",'invalid dynamic attribute "'+V+'"')});var xe={isStream:K.def(!1)},De=new e;De.state=yi,Object.keys(De).forEach(function(dt){xe[dt]=K.def(""+De[dt])});var it=xe.buffer,wt=xe.type;K("if(",Te,"(",k,")){",xe.isStream,"=true;",it,"=",Le,".createStream(",ta,",",k,");",wt,"=",it,".dtype;","}else{",it,"=",Le,".getBuffer(",k,");","if(",it,"){",wt,"=",it,".dtype;",'}else if("constant" in ',k,"){",xe.state,"=",Rs,";","if(typeof "+k+'.constant === "number"){',xe[Sn[0]],"=",k,".constant;",Sn.slice(1).map(function(dt){return xe[dt]}).join("="),"=0;","}else{",Sn.map(function(dt,xt){return xe[dt]+"="+k+".constant.length>"+xt+"?"+k+".constant["+xt+"]:0;"}).join(""),"}}else{","if(",Te,"(",k,".buffer)){",it,"=",Le,".createStream(",ta,",",k,".buffer);","}else{",it,"=",Le,".getBuffer(",k,".buffer);","}",wt,'="type" in ',k,"?",fe.glTypes,"[",k,".type]:",it,".dtype;",xe.normalized,"=!!",k,".normalized;");function et(dt){K(xe[dt],"=",k,".",dt,"|0;")}return et("size"),et("offset"),et("stride"),et("divisor"),K("}}"),K.exit("if(",xe.isStream,"){",Le,".destroyStream(",it,");","}"),xe}oe[V]=xr($,J)}),oe}function At(F,T){var Y=F.static,ne=F.dynamic;if(Pr in Y){var oe=Y[Pr];return oe!==null&&Be.getVAO(oe)===null&&(oe=Be.createVAO(oe)),tr(function($){return $.link(Be.getVAO(oe))})}else if(Pr in ne){var V=ne[Pr];return xr(V,function($,J){var I=$.invoke(J,V);return J.def($.shared.vao+".getVAO("+I+")")})}return null}function yt(F){var T=F.static,Y=F.dynamic,ne={};return Object.keys(T).forEach(function(oe){var V=T[oe];ne[oe]=tr(function($,J){return typeof V=="number"||typeof V=="boolean"?""+V:$.link(V)})}),Object.keys(Y).forEach(function(oe){var V=Y[oe];ne[oe]=xr(V,function($,J){return $.invoke(J,V)})}),ne}function Ft(F,T,Y,ne,oe){var V=F.static,$=F.dynamic;M.optional(function(){var et=[Kn,Cn,_n,Ur,Xr,Po,Yn,Ba,Ji,Pr].concat(s);function dt(xt){Object.keys(xt).forEach(function(Rt){M.command(et.indexOf(Rt)>=0,'unknown parameter "'+Rt+'"',oe.commandStr)})}dt(V),dt($)});var J=_e(F,T),I=me(F),K=Oe(F,I,oe),k=Ke(F,oe),ee=Ze(F,oe),fe=Re(F,oe,J);function Te(et){var dt=K[et];dt&&(ee[et]=dt)}Te(en),Te(c(Tn));var Le=Object.keys(ee).length>0,xe={framebuffer:I,draw:k,shader:fe,state:ee,dirty:Le,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(xe.profile=Se(F),xe.uniforms=ct(Y,oe),xe.drawVAO=xe.scopeVAO=At(F),!xe.drawVAO&&fe.program&&!J&&W.angle_instanced_arrays){var De=!0,it=fe.program.attributes.map(function(et){var dt=T.static[et];return De=De&&!!dt,dt});if(De&&it.length>0){var wt=Be.getVAO(Be.createVAO(it));xe.drawVAO=new dr(null,null,null,function(et,dt){return et.link(wt)}),xe.useVAO=!0}}return J?xe.useVAO=!0:xe.attributes=rt(T,oe),xe.context=yt(ne),xe}function It(F,T,Y){var ne=F.shared,oe=ne.context,V=F.scope();Object.keys(Y).forEach(function($){T.save(oe,"."+$);var J=Y[$],I=J.append(F,T);Array.isArray(I)?V(oe,".",$,"=[",I.join(),"];"):V(oe,".",$,"=",I,";")}),T(V)}function Et(F,T,Y,ne){var oe=F.shared,V=oe.gl,$=oe.framebuffer,J;n&&(J=T.def(oe.extensions,".webgl_draw_buffers"));var I=F.constants,K=I.drawBuffer,k=I.backBuffer,ee;Y?ee=Y.append(F,T):ee=T.def($,".next"),ne||T("if(",ee,"!==",$,".cur){"),T("if(",ee,"){",V,".bindFramebuffer(",Xl,",",ee,".framebuffer);"),n&&T(J,".drawBuffersWEBGL(",K,"[",ee,".colorAttachments.length]);"),T("}else{",V,".bindFramebuffer(",Xl,",null);"),n&&T(J,".drawBuffersWEBGL(",k,");"),T("}",$,".cur=",ee,";"),ne||T("}")}function Gt(F,T,Y){var ne=F.shared,oe=ne.gl,V=F.current,$=F.next,J=ne.current,I=ne.next,K=F.cond(J,".dirty");s.forEach(function(k){var ee=c(k);if(!(ee in Y.state)){var fe,Te;if(ee in $){fe=$[ee],Te=V[ee];var Le=qt(i[ee].length,function(De){return K.def(fe,"[",De,"]")});K(F.cond(Le.map(function(De,it){return De+"!=="+Te+"["+it+"]"}).join("||")).then(oe,".",f[ee],"(",Le,");",Le.map(function(De,it){return Te+"["+it+"]="+De}).join(";"),";"))}else{fe=K.def(I,".",ee);var xe=F.cond(fe,"!==",J,".",ee);K(xe),ee in l?xe(F.cond(fe).then(oe,".enable(",l[ee],");").else(oe,".disable(",l[ee],");"),J,".",ee,"=",fe,";"):xe(oe,".",f[ee],"(",fe,");",J,".",ee,"=",fe,";")}}}),Object.keys(Y.state).length===0&&K(J,".dirty=false;"),T(K)}function Pt(F,T,Y,ne){var oe=F.shared,V=F.current,$=oe.current,J=oe.gl;Xs(Object.keys(Y)).forEach(function(I){var K=Y[I];if(!(ne&&!ne(K))){var k=K.append(F,T);if(l[I]){var ee=l[I];An(K)?k?T(J,".enable(",ee,");"):T(J,".disable(",ee,");"):T(F.cond(k).then(J,".enable(",ee,");").else(J,".disable(",ee,");")),T($,".",I,"=",k,";")}else if(Ut(k)){var fe=V[I];T(J,".",f[I],"(",k,");",k.map(function(Te,Le){return fe+"["+Le+"]="+Te}).join(";"),";")}else T(J,".",f[I],"(",k,");",$,".",I,"=",k,";")}})}function Tt(F,T){r&&(F.instancing=T.def(F.shared.extensions,".angle_instanced_arrays"))}function nt(F,T,Y,ne,oe){var V=F.shared,$=F.stats,J=V.current,I=V.timer,K=Y.profile;function k(){return typeof performance>"u"?"Date.now()":"performance.now()"}var ee,fe;function Te(et){ee=T.def(),et(ee,"=",k(),";"),typeof oe=="string"?et($,".count+=",oe,";"):et($,".count++;"),Ie&&(ne?(fe=T.def(),et(fe,"=",I,".getNumPendingQueries();")):et(I,".beginQuery(",$,");"))}function Le(et){et($,".cpuTime+=",k(),"-",ee,";"),Ie&&(ne?et(I,".pushScopeStats(",fe,",",I,".getNumPendingQueries(),",$,");"):et(I,".endQuery();"))}function xe(et){var dt=T.def(J,".profile");T(J,".profile=",et,";"),T.exit(J,".profile=",dt,";")}var De;if(K){if(An(K)){K.enable?(Te(T),Le(T.exit),xe("true")):xe("false");return}De=K.append(F,T),xe(De)}else De=T.def(J,".profile");var it=F.block();Te(it),T("if(",De,"){",it,"}");var wt=F.block();Le(wt),T.exit("if(",De,"){",wt,"}")}function Lt(F,T,Y,ne,oe){var V=F.shared;function $(I){switch(I){case Ha:case Ln:case Bo:return 2;case za:case na:case Zn:return 3;case Wa:case ia:case Ua:return 4;default:return 1}}function J(I,K,k){var ee=V.gl,fe=T.def(I,".location"),Te=T.def(V.attributes,"[",fe,"]"),Le=k.state,xe=k.buffer,De=[k.x,k.y,k.z,k.w],it=["buffer","normalized","offset","stride"];function wt(){T("if(!",Te,".buffer){",ee,".enableVertexAttribArray(",fe,");}");var dt=k.type,xt;if(k.size?xt=T.def(k.size,"||",K):xt=K,T("if(",Te,".type!==",dt,"||",Te,".size!==",xt,"||",it.map(function(rr){return Te+"."+rr+"!=="+k[rr]}).join("||"),"){",ee,".bindBuffer(",ta,",",xe,".buffer);",ee,".vertexAttribPointer(",[fe,xt,dt,k.normalized,k.stride,k.offset],");",Te,".type=",dt,";",Te,".size=",xt,";",it.map(function(rr){return Te+"."+rr+"="+k[rr]+";"}).join(""),"}"),r){var Rt=k.divisor;T("if(",Te,".divisor!==",Rt,"){",F.instancing,".vertexAttribDivisorANGLE(",[fe,Rt],");",Te,".divisor=",Rt,";}")}}function et(){T("if(",Te,".buffer){",ee,".disableVertexAttribArray(",fe,");",Te,".buffer=null;","}if(",Sn.map(function(dt,xt){return Te+"."+dt+"!=="+De[xt]}).join("||"),"){",ee,".vertexAttrib4f(",fe,",",De,");",Sn.map(function(dt,xt){return Te+"."+dt+"="+De[xt]+";"}).join(""),"}")}Le===yi?wt():Le===Rs?et():(T("if(",Le,"===",yi,"){"),wt(),T("}else{"),et(),T("}"))}ne.forEach(function(I){var K=I.name,k=Y.attributes[K],ee;if(k){if(!oe(k))return;ee=k.append(F,T)}else{if(!oe(Ci))return;var fe=F.scopeAttrib(K);M.optional(function(){F.assert(T,fe+".state","missing attribute "+K)}),ee={},Object.keys(new e).forEach(function(Te){ee[Te]=T.def(fe,".",Te)})}J(F.link(I),$(I.info.type),ee)})}function St(F,T,Y,ne,oe){for(var V=F.shared,$=V.gl,J,I=0;I<ne.length;++I){var K=ne[I],k=K.name,ee=K.info.type,fe=Y.uniforms[k],Te=F.link(K),Le=Te+".location",xe;if(fe){if(!oe(fe))continue;if(An(fe)){var De=fe.value;if(M.command(De!==null&&typeof De<"u",'missing uniform "'+k+'"',F.commandStr),ee===ja||ee===Ka){M.command(typeof De=="function"&&(ee===ja&&(De._reglType==="texture2d"||De._reglType==="framebuffer")||ee===Ka&&(De._reglType==="textureCube"||De._reglType==="framebufferCube")),"invalid texture for uniform "+k,F.commandStr);var it=F.link(De._texture||De.color[0]._texture);T($,".uniform1i(",Le,",",it+".bind());"),T.exit(it,".unbind();")}else if(ee===Xa||ee===aa||ee===Jn){M.optional(function(){M.command(Ut(De),"invalid matrix for uniform "+k,F.commandStr),M.command(ee===Xa&&De.length===4||ee===aa&&De.length===9||ee===Jn&&De.length===16,"invalid length for matrix uniform "+k,F.commandStr)});var wt=F.global.def("new Float32Array(["+Array.prototype.slice.call(De)+"])"),et=2;ee===aa?et=3:ee===Jn&&(et=4),T($,".uniformMatrix",et,"fv(",Le,",false,",wt,");")}else{switch(ee){case Qn:M.commandType(De,"number","uniform "+k,F.commandStr),J="1f";break;case Ha:M.command(Ut(De)&&De.length===2,"uniform "+k,F.commandStr),J="2f";break;case za:M.command(Ut(De)&&De.length===3,"uniform "+k,F.commandStr),J="3f";break;case Wa:M.command(Ut(De)&&De.length===4,"uniform "+k,F.commandStr),J="4f";break;case qa:M.commandType(De,"boolean","uniform "+k,F.commandStr),J="1i";break;case ra:M.commandType(De,"number","uniform "+k,F.commandStr),J="1i";break;case Bo:M.command(Ut(De)&&De.length===2,"uniform "+k,F.commandStr),J="2i";break;case Ln:M.command(Ut(De)&&De.length===2,"uniform "+k,F.commandStr),J="2i";break;case Zn:M.command(Ut(De)&&De.length===3,"uniform "+k,F.commandStr),J="3i";break;case na:M.command(Ut(De)&&De.length===3,"uniform "+k,F.commandStr),J="3i";break;case Ua:M.command(Ut(De)&&De.length===4,"uniform "+k,F.commandStr),J="4i";break;case ia:M.command(Ut(De)&&De.length===4,"uniform "+k,F.commandStr),J="4i";break}T($,".uniform",J,"(",Le,",",Ut(De)?Array.prototype.slice.call(De):De,");")}continue}else xe=fe.append(F,T)}else{if(!oe(Ci))continue;xe=T.def(V.uniforms,"[",L.id(k),"]")}ee===ja?(M(!Array.isArray(xe),"must specify a scalar prop for textures"),T("if(",xe,"&&",xe,'._reglType==="framebuffer"){',xe,"=",xe,".color[0];","}")):ee===Ka&&(M(!Array.isArray(xe),"must specify a scalar prop for cube maps"),T("if(",xe,"&&",xe,'._reglType==="framebufferCube"){',xe,"=",xe,".color[0];","}")),M.optional(function(){function Rr(Rn,Wf){F.assert(T,Rn,'bad data or missing for uniform "'+k+'".  '+Wf)}function Hf(Rn){M(!Array.isArray(xe),"must not specify an array type for uniform"),Rr("typeof "+xe+'==="'+Rn+'"',"invalid type, expected "+Rn)}function rn(Rn,Wf){Array.isArray(xe)?M(xe.length===Rn,"must have length "+Rn):Rr(V.isArrayLike+"("+xe+")&&"+xe+".length==="+Rn,"invalid vector, should have length "+Rn,F.commandStr)}function zf(Rn){M(!Array.isArray(xe),"must not specify a value type"),Rr("typeof "+xe+'==="function"&&'+xe+'._reglType==="texture'+(Rn===Ws?"2d":"Cube")+'"',"invalid texture type",F.commandStr)}switch(ee){case ra:Hf("number");break;case Ln:rn(2);break;case na:rn(3);break;case ia:rn(4);break;case Qn:Hf("number");break;case Ha:rn(2);break;case za:rn(3);break;case Wa:rn(4);break;case qa:Hf("boolean");break;case Bo:rn(2);break;case Zn:rn(3);break;case Ua:rn(4);break;case Xa:rn(4);break;case aa:rn(9);break;case Jn:rn(16);break;case ja:zf(Ws);break;case Ka:zf(Rf);break}});var dt=1;switch(ee){case ja:case Ka:var xt=T.def(xe,"._texture");T($,".uniform1i(",Le,",",xt,".bind());"),T.exit(xt,".unbind();");continue;case ra:case qa:J="1i";break;case Ln:case Bo:J="2i",dt=2;break;case na:case Zn:J="3i",dt=3;break;case ia:case Ua:J="4i",dt=4;break;case Qn:J="1f";break;case Ha:J="2f",dt=2;break;case za:J="3f",dt=3;break;case Wa:J="4f",dt=4;break;case Xa:J="Matrix2fv";break;case aa:J="Matrix3fv";break;case Jn:J="Matrix4fv";break}if(T($,".uniform",J,"(",Le,","),J.charAt(0)==="M"){var Rt=Math.pow(ee-Xa+2,2),rr=F.global.def("new Float32Array(",Rt,")");Array.isArray(xe)?T("false,(",qt(Rt,function(Rr){return rr+"["+Rr+"]="+xe[Rr]}),",",rr,")"):T("false,(Array.isArray(",xe,")||",xe," instanceof Float32Array)?",xe,":(",qt(Rt,function(Rr){return rr+"["+Rr+"]="+xe+"["+Rr+"]"}),",",rr,")")}else dt>1?T(qt(dt,function(Rr){return Array.isArray(xe)?xe[Rr]:xe+"["+Rr+"]"})):(M(!Array.isArray(xe),"uniform value must not be an array"),T(xe));T(");")}}function ot(F,T,Y,ne){var oe=F.shared,V=oe.gl,$=oe.draw,J=ne.draw;function I(){var xt=J.elements,Rt,rr=T;return xt?((xt.contextDep&&ne.contextDynamic||xt.propDep)&&(rr=Y),Rt=xt.append(F,rr)):Rt=rr.def($,".",Ur),Rt&&rr("if("+Rt+")"+V+".bindBuffer("+Of+","+Rt+".buffer.buffer);"),Rt}function K(){var xt=J.count,Rt,rr=T;return xt?((xt.contextDep&&ne.contextDynamic||xt.propDep)&&(rr=Y),Rt=xt.append(F,rr),M.optional(function(){xt.MISSING&&F.assert(T,"false","missing vertex count"),xt.DYNAMIC&&F.assert(rr,Rt+">=0","missing vertex count")})):(Rt=rr.def($,".",Yn),M.optional(function(){F.assert(rr,Rt+">=0","missing vertex count")})),Rt}var k=I();function ee(xt){var Rt=J[xt];return Rt?Rt.contextDep&&ne.contextDynamic||Rt.propDep?Rt.append(F,Y):Rt.append(F,T):T.def($,".",xt)}var fe=ee(Xr),Te=ee(Po),Le=K();if(typeof Le=="number"){if(Le===0)return}else Y("if(",Le,"){"),Y.exit("}");var xe,De;r&&(xe=ee(Ba),De=F.instancing);var it=k+".type",wt=J.elements&&An(J.elements);function et(){function xt(){Y(De,".drawElementsInstancedANGLE(",[fe,Le,it,Te+"<<(("+it+"-"+Eo+")>>1)",xe],");")}function Rt(){Y(De,".drawArraysInstancedANGLE(",[fe,Te,Le,xe],");")}k?wt?xt():(Y("if(",k,"){"),xt(),Y("}else{"),Rt(),Y("}")):Rt()}function dt(){function xt(){Y(V+".drawElements("+[fe,Le,it,Te+"<<(("+it+"-"+Eo+")>>1)"]+");")}function Rt(){Y(V+".drawArrays("+[fe,Te,Le]+");")}k?wt?xt():(Y("if(",k,"){"),xt(),Y("}else{"),Rt(),Y("}")):Rt()}r&&(typeof xe!="number"||xe>=0)?typeof xe=="string"?(Y("if(",xe,">0){"),et(),Y("}else if(",xe,"<0){"),dt(),Y("}")):et():dt()}function mt(F,T,Y,ne,oe){var V=ce(),$=V.proc("body",oe);return M.optional(function(){V.commandStr=T.commandStr,V.command=V.link(T.commandStr)}),r&&(V.instancing=$.def(V.shared.extensions,".angle_instanced_arrays")),F(V,$,Y,ne),V.compile().body}function vt(F,T,Y,ne){Tt(F,T),Y.useVAO?Y.drawVAO?T(F.shared.vao,".setVAO(",Y.drawVAO.append(F,T),");"):T(F.shared.vao,".setVAO(",F.shared.vao,".targetVAO);"):(T(F.shared.vao,".setVAO(null);"),Lt(F,T,Y,ne.attributes,function(){return!0})),St(F,T,Y,ne.uniforms,function(){return!0}),ot(F,T,T,Y)}function Wt(F,T){var Y=F.proc("draw",1);Tt(F,Y),It(F,Y,T.context),Et(F,Y,T.framebuffer),Gt(F,Y,T),Pt(F,Y,T.state),nt(F,Y,T,!1,!0);var ne=T.shader.progVar.append(F,Y);if(Y(F.shared.gl,".useProgram(",ne,".program);"),T.shader.program)vt(F,Y,T,T.shader.program);else{Y(F.shared.vao,".setVAO(null);");var oe=F.global.def("{}"),V=Y.def(ne,".id"),$=Y.def(oe,"[",V,"]");Y(F.cond($).then($,".call(this,a0);").else($,"=",oe,"[",V,"]=",F.link(function(J){return mt(vt,F,T,J,1)}),"(",ne,");",$,".call(this,a0);"))}Object.keys(T.state).length>0&&Y(F.shared.current,".dirty=true;")}function Xt(F,T,Y,ne){F.batchId="a1",Tt(F,T);function oe(){return!0}Lt(F,T,Y,ne.attributes,oe),St(F,T,Y,ne.uniforms,oe),ot(F,T,T,Y)}function On(F,T,Y,ne){Tt(F,T);var oe=Y.contextDep,V=T.def(),$="a0",J="a1",I=T.def();F.shared.props=I,F.batchId=V;var K=F.scope(),k=F.scope();T(K.entry,"for(",V,"=0;",V,"<",J,";++",V,"){",I,"=",$,"[",V,"];",k,"}",K.exit);function ee(it){return it.contextDep&&oe||it.propDep}function fe(it){return!ee(it)}if(Y.needsContext&&It(F,k,Y.context),Y.needsFramebuffer&&Et(F,k,Y.framebuffer),Pt(F,k,Y.state,ee),Y.profile&&ee(Y.profile)&&nt(F,k,Y,!1,!0),ne)Y.useVAO?Y.drawVAO?ee(Y.drawVAO)?k(F.shared.vao,".setVAO(",Y.drawVAO.append(F,k),");"):K(F.shared.vao,".setVAO(",Y.drawVAO.append(F,K),");"):K(F.shared.vao,".setVAO(",F.shared.vao,".targetVAO);"):(K(F.shared.vao,".setVAO(null);"),Lt(F,K,Y,ne.attributes,fe),Lt(F,k,Y,ne.attributes,ee)),St(F,K,Y,ne.uniforms,fe),St(F,k,Y,ne.uniforms,ee),ot(F,K,k,Y);else{var Te=F.global.def("{}"),Le=Y.shader.progVar.append(F,k),xe=k.def(Le,".id"),De=k.def(Te,"[",xe,"]");k(F.shared.gl,".useProgram(",Le,".program);","if(!",De,"){",De,"=",Te,"[",xe,"]=",F.link(function(it){return mt(Xt,F,Y,it,2)}),"(",Le,");}",De,".call(this,a0[",V,"],",V,");")}}function N(F,T){var Y=F.proc("batch",2);F.batchId="0",Tt(F,Y);var ne=!1,oe=!0;Object.keys(T.context).forEach(function(Te){ne=ne||T.context[Te].propDep}),ne||(It(F,Y,T.context),oe=!1);var V=T.framebuffer,$=!1;V?(V.propDep?ne=$=!0:V.contextDep&&ne&&($=!0),$||Et(F,Y,V)):Et(F,Y,null),T.state.viewport&&T.state.viewport.propDep&&(ne=!0);function J(Te){return Te.contextDep&&ne||Te.propDep}Gt(F,Y,T),Pt(F,Y,T.state,function(Te){return!J(Te)}),(!T.profile||!J(T.profile))&&nt(F,Y,T,!1,"a1"),T.contextDep=ne,T.needsContext=oe,T.needsFramebuffer=$;var I=T.shader.progVar;if(I.contextDep&&ne||I.propDep)On(F,Y,T,null);else{var K=I.append(F,Y);if(Y(F.shared.gl,".useProgram(",K,".program);"),T.shader.program)On(F,Y,T,T.shader.program);else{Y(F.shared.vao,".setVAO(null);");var k=F.global.def("{}"),ee=Y.def(K,".id"),fe=Y.def(k,"[",ee,"]");Y(F.cond(fe).then(fe,".call(this,a0,a1);").else(fe,"=",k,"[",ee,"]=",F.link(function(Te){return mt(On,F,T,Te,2)}),"(",K,");",fe,".call(this,a0,a1);"))}}Object.keys(T.state).length>0&&Y(F.shared.current,".dirty=true;")}function de(F,T){var Y=F.proc("scope",3);F.batchId="a2";var ne=F.shared,oe=ne.current;It(F,Y,T.context),T.framebuffer&&T.framebuffer.append(F,Y),Xs(Object.keys(T.state)).forEach(function($){var J=T.state[$],I=J.append(F,Y);Ut(I)?I.forEach(function(K,k){Y.set(F.next[$],"["+k+"]",K)}):Y.set(ne.next,"."+$,I)}),nt(F,Y,T,!0,!0),[Ur,Po,Yn,Ba,Xr].forEach(function($){var J=T.draw[$];J&&Y.set(ne.draw,"."+$,""+J.append(F,Y))}),Object.keys(T.uniforms).forEach(function($){var J=T.uniforms[$].append(F,Y);Array.isArray(J)&&(J="["+J.join()+"]"),Y.set(ne.uniforms,"["+L.id($)+"]",J)}),Object.keys(T.attributes).forEach(function($){var J=T.attributes[$].append(F,Y),I=F.scopeAttrib($);Object.keys(new e).forEach(function(K){Y.set(I,"."+K,J[K])})}),T.scopeVAO&&Y.set(ne.vao,".targetVAO",T.scopeVAO.append(F,Y));function V($){var J=T.shader[$];J&&Y.set(ne.shader,"."+$,J.append(F,Y))}V(Cn),V(_n),Object.keys(T.state).length>0&&(Y(oe,".dirty=true;"),Y.exit(oe,".dirty=true;")),Y("a1(",F.shared.context,",a0,",F.batchId,");")}function le(F){if(!(typeof F!="object"||Ut(F))){for(var T=Object.keys(F),Y=0;Y<T.length;++Y)if(nr.isDynamic(F[T[Y]]))return!0;return!1}}function je(F,T,Y){var ne=T.static[Y];if(!ne||!le(ne))return;var oe=F.global,V=Object.keys(ne),$=!1,J=!1,I=!1,K=F.global.def("{}");V.forEach(function(ee){var fe=ne[ee];if(nr.isDynamic(fe)){typeof fe=="function"&&(fe=ne[ee]=nr.unbox(fe));var Te=xr(fe,null);$=$||Te.thisDep,I=I||Te.propDep,J=J||Te.contextDep}else{switch(oe(K,".",ee,"="),typeof fe){case"number":oe(fe);break;case"string":oe('"',fe,'"');break;case"object":Array.isArray(fe)&&oe("[",fe.join(),"]");break;default:oe(F.link(fe));break}oe(";")}});function k(ee,fe){V.forEach(function(Te){var Le=ne[Te];if(nr.isDynamic(Le)){var xe=ee.invoke(fe,Le);fe(K,".",Te,"=",xe,";")}})}T.dynamic[Y]=new nr.DynamicVariable(Pa,{thisDep:$,contextDep:J,propDep:I,ref:K,append:k}),delete T.static[Y]}function bt(F,T,Y,ne,oe){var V=ce();V.stats=V.link(oe),Object.keys(T.static).forEach(function(J){je(V,T,J)}),Af.forEach(function(J){je(V,F,J)});var $=Ft(F,T,Y,ne,V);return Wt(V,$),de(V,$),N(V,$),m(V.compile(),{destroy:function(){$.shader.program.destroy()}})}return{next:o,current:i,procs:function(){var F=ce(),T=F.proc("poll"),Y=F.proc("refresh"),ne=F.block();T(ne),Y(ne);var oe=F.shared,V=oe.gl,$=oe.next,J=oe.current;ne(J,".dirty=false;"),Et(F,T),Et(F,Y,null,!0);var I;r&&(I=F.link(r)),W.oes_vertex_array_object&&Y(F.link(W.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var K=0;K<re.maxAttributes;++K){var k=Y.def(oe.attributes,"[",K,"]"),ee=F.cond(k,".buffer");ee.then(V,".enableVertexAttribArray(",K,");",V,".bindBuffer(",ta,",",k,".buffer.buffer);",V,".vertexAttribPointer(",K,",",k,".size,",k,".type,",k,".normalized,",k,".stride,",k,".offset);").else(V,".disableVertexAttribArray(",K,");",V,".vertexAttrib4f(",K,",",k,".x,",k,".y,",k,".z,",k,".w);",k,".buffer=null;"),Y(ee),r&&Y(I,".vertexAttribDivisorANGLE(",K,",",k,".divisor);")}return Y(F.shared.vao,".currentVAO=null;",F.shared.vao,".setVAO(",F.shared.vao,".targetVAO);"),Object.keys(l).forEach(function(fe){var Te=l[fe],Le=ne.def($,".",fe),xe=F.block();xe("if(",Le,"){",V,".enable(",Te,")}else{",V,".disable(",Te,")}",J,".",fe,"=",Le,";"),Y(xe),T("if(",Le,"!==",J,".",fe,"){",xe,"}")}),Object.keys(f).forEach(function(fe){var Te=f[fe],Le=i[fe],xe,De,it=F.block();if(it(V,".",Te,"("),Ut(Le)){var wt=Le.length;xe=F.global.def($,".",fe),De=F.global.def(J,".",fe),it(qt(wt,function(et){return xe+"["+et+"]"}),");",qt(wt,function(et){return De+"["+et+"]="+xe+"["+et+"];"}).join("")),T("if(",qt(wt,function(et){return xe+"["+et+"]!=="+De+"["+et+"]"}).join("||"),"){",it,"}")}else xe=ne.def($,".",fe),De=ne.def(J,".",fe),it(xe,");",J,".",fe,"=",xe,";"),T("if(",xe,"!==",De,"){",it,"}");Y(it)}),F.compile()}(),compile:bt}}function Ho(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Bf=34918,Df=34919,$l=35007,Kt=function(u,L){if(!L.ext_disjoint_timer_query)return null;var W=[];function re(){return W.pop()||L.ext_disjoint_timer_query.createQueryEXT()}function Ce(r){W.push(r)}var pe=[];function ge(r){var n=re();L.ext_disjoint_timer_query.beginQueryEXT($l,n),pe.push(n),Ie(pe.length-1,pe.length,r)}function Me(){L.ext_disjoint_timer_query.endQueryEXT($l)}function Fe(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Be=[];function Ee(){return Be.pop()||new Fe}function ze(r){Be.push(r)}var Xe=[];function Ie(r,n,i){var o=Ee();o.startQueryIndex=r,o.endQueryIndex=n,o.sum=0,o.stats=i,Xe.push(o)}var He=[],e=[];function t(){var r,n,i=pe.length;if(i!==0){e.length=Math.max(e.length,i+1),He.length=Math.max(He.length,i+1),He[0]=0,e[0]=0;var o=0;for(r=0,n=0;n<pe.length;++n){var s=pe[n];L.ext_disjoint_timer_query.getQueryObjectEXT(s,Df)?(o+=L.ext_disjoint_timer_query.getQueryObjectEXT(s,Bf),Ce(s)):pe[r++]=s,He[n+1]=o,e[n+1]=r}for(pe.length=r,r=0,n=0;n<Xe.length;++n){var l=Xe[n],f=l.startQueryIndex,c=l.endQueryIndex;l.sum+=He[c]-He[f];var w=e[f],O=e[c];O===w?(l.stats.gpuTime+=l.sum/1e6,ze(l)):(l.startQueryIndex=w,l.endQueryIndex=O,Xe[r++]=l)}Xe.length=r}}return{beginQuery:ge,endQuery:Me,pushScopeStats:Ie,update:t,getNumPendingQueries:function(){return pe.length},clear:function(){W.push.apply(W,pe);for(var r=0;r<W.length;r++)L.ext_disjoint_timer_query.deleteQueryEXT(W[r]);pe.length=0,W.length=0},restore:function(){pe.length=0,W.length=0}}},Gf=16384,js=256,Va=1024,jr=34962,Qa="webglcontextlost",zo="webglcontextrestored",Ks=1,Vl=2,Ql=3;function Wo(u,L){for(var W=0;W<u.length;++W)if(u[W]===L)return W;return-1}function Zl(u){var L=wr(u);if(!L)return null;var W=L.gl,re=W.getContextAttributes(),Ce=W.isContextLost(),pe=Nr(W,L);if(!pe)return null;var ge=Ja(),Me=Ho(),Fe=pe.extensions,Be=Kt(W,Fe),Ee=kt(),ze=W.drawingBufferWidth,Xe=W.drawingBufferHeight,Ie={tick:0,time:0,viewportWidth:ze,viewportHeight:Xe,framebufferWidth:ze,framebufferHeight:Xe,drawingBufferWidth:ze,drawingBufferHeight:Xe,pixelRatio:L.pixelRatio},He={},e={elements:null,primitive:4,count:-1,offset:0,instances:-1},t=va(W,Fe),r=zr(W,Me,L,i),n=Xn(W,Fe,t,Me,r);function i(ot){return n.destroyBuffer(ot)}var o=df(W,Fe,r,Me),s=_f(W,ge,Me,L),l=Ra(W,Fe,t,function(){w.procs.poll()},Ie,Me,L),f=Sf(W,Fe,t,Me,L),c=Ol(W,Fe,t,l,f,Me),w=Yl(W,ge,Fe,t,r,o,l,c,He,n,s,e,Ie,Be,L),O=jn(W,c,w.procs.poll,Ie,re,Fe,t),B=w.next,R=W.canvas,H=[],ce=[],Se=[],me=[L.onDestroy],Oe=null;function _e(){if(H.length===0){Be&&Be.update(),Oe=null;return}Oe=ca.next(_e),Pt();for(var ot=H.length-1;ot>=0;--ot){var mt=H[ot];mt&&mt(Ie,null,0)}W.flush(),Be&&Be.update()}function Re(){!Oe&&H.length>0&&(Oe=ca.next(_e))}function Ke(){Oe&&(ca.cancel(_e),Oe=null)}function Ze(ot){ot.preventDefault(),Ce=!0,Ke(),ce.forEach(function(mt){mt()})}function ct(ot){W.getError(),Ce=!1,pe.restore(),s.restore(),r.restore(),l.restore(),f.restore(),c.restore(),n.restore(),Be&&Be.restore(),w.procs.refresh(),Re(),Se.forEach(function(mt){mt()})}R&&(R.addEventListener(Qa,Ze,!1),R.addEventListener(zo,ct,!1));function rt(){H.length=0,Ke(),R&&(R.removeEventListener(Qa,Ze),R.removeEventListener(zo,ct)),s.clear(),c.clear(),f.clear(),l.clear(),o.clear(),r.clear(),n.clear(),Be&&Be.clear(),me.forEach(function(ot){ot()})}function At(ot){M(!!ot,"invalid args to regl({...})"),M.type(ot,"object","invalid args to regl({...})");function mt(oe){var V=m({},oe);delete V.uniforms,delete V.attributes,delete V.context,delete V.vao,"stencil"in V&&V.stencil.op&&(V.stencil.opBack=V.stencil.opFront=V.stencil.op,delete V.stencil.op);function $(J){if(J in V){var I=V[J];delete V[J],Object.keys(I).forEach(function(K){V[J+"."+K]=I[K]})}}return $("blend"),$("depth"),$("cull"),$("stencil"),$("polygonOffset"),$("scissor"),$("sample"),"vao"in oe&&(V.vao=oe.vao),V}function vt(oe,V){var $={},J={};return Object.keys(oe).forEach(function(I){var K=oe[I];if(nr.isDynamic(K)){J[I]=nr.unbox(K,I);return}else if(V&&Array.isArray(K)){for(var k=0;k<K.length;++k)if(nr.isDynamic(K[k])){J[I]=nr.unbox(K,I);return}}$[I]=K}),{dynamic:J,static:$}}var Wt=vt(ot.context||{},!0),Xt=vt(ot.uniforms||{},!0),On=vt(ot.attributes||{},!1),N=vt(mt(ot),!1),de={gpuTime:0,cpuTime:0,count:0},le=w.compile(N,On,Xt,Wt,de),je=le.draw,bt=le.batch,F=le.scope,T=[];function Y(oe){for(;T.length<oe;)T.push(null);return T}function ne(oe,V){var $;if(Ce&&M.raise("context lost"),typeof oe=="function")return F.call(this,null,oe,0);if(typeof V=="function")if(typeof oe=="number")for($=0;$<oe;++$)F.call(this,null,V,$);else if(Array.isArray(oe))for($=0;$<oe.length;++$)F.call(this,oe[$],V,$);else return F.call(this,oe,V,0);else if(typeof oe=="number"){if(oe>0)return bt.call(this,Y(oe|0),oe|0)}else if(Array.isArray(oe)){if(oe.length)return bt.call(this,oe,oe.length)}else return je.call(this,oe)}return m(ne,{stats:de,destroy:function(){le.destroy()}})}var yt=c.setFBO=At({framebuffer:nr.define.call(null,Ks,"framebuffer")});function Ft(ot,mt){var vt=0;w.procs.poll();var Wt=mt.color;Wt&&(W.clearColor(+Wt[0]||0,+Wt[1]||0,+Wt[2]||0,+Wt[3]||0),vt|=Gf),"depth"in mt&&(W.clearDepth(+mt.depth),vt|=js),"stencil"in mt&&(W.clearStencil(mt.stencil|0),vt|=Va),M(!!vt,"called regl.clear with no buffer specified"),W.clear(vt)}function It(ot){if(M(typeof ot=="object"&&ot,"regl.clear() takes an object as input"),"framebuffer"in ot)if(ot.framebuffer&&ot.framebuffer_reglType==="framebufferCube")for(var mt=0;mt<6;++mt)yt(m({framebuffer:ot.framebuffer.faces[mt]},ot),Ft);else yt(ot,Ft);else Ft(null,ot)}function Et(ot){M.type(ot,"function","regl.frame() callback must be a function"),H.push(ot);function mt(){var vt=Wo(H,ot);M(vt>=0,"cannot cancel a frame twice");function Wt(){var Xt=Wo(H,Wt);H[Xt]=H[H.length-1],H.length-=1,H.length<=0&&Ke()}H[vt]=Wt}return Re(),{cancel:mt}}function Gt(){var ot=B.viewport,mt=B.scissor_box;ot[0]=ot[1]=mt[0]=mt[1]=0,Ie.viewportWidth=Ie.framebufferWidth=Ie.drawingBufferWidth=ot[2]=mt[2]=W.drawingBufferWidth,Ie.viewportHeight=Ie.framebufferHeight=Ie.drawingBufferHeight=ot[3]=mt[3]=W.drawingBufferHeight}function Pt(){Ie.tick+=1,Ie.time=nt(),Gt(),w.procs.poll()}function Tt(){l.refresh(),Gt(),w.procs.refresh(),Be&&Be.update()}function nt(){return(kt()-Ee)/1e3}Tt();function Lt(ot,mt){M.type(mt,"function","listener callback must be a function");var vt;switch(ot){case"frame":return Et(mt);case"lost":vt=ce;break;case"restore":vt=Se;break;case"destroy":vt=me;break;default:M.raise("invalid event, must be one of frame,lost,restore,destroy")}return vt.push(mt),{cancel:function(){for(var Wt=0;Wt<vt.length;++Wt)if(vt[Wt]===mt){vt[Wt]=vt[vt.length-1],vt.pop();return}}}}var St=m(At,{clear:It,prop:nr.define.bind(null,Ks),context:nr.define.bind(null,Vl),this:nr.define.bind(null,Ql),draw:At({}),buffer:function(ot){return r.create(ot,jr,!1,!1)},elements:function(ot){return o.create(ot,!1)},texture:l.create2D,cube:l.createCube,renderbuffer:f.create,framebuffer:c.create,framebufferCube:c.createCube,vao:n.createVAO,attributes:re,frame:Et,on:Lt,limits:t,hasExtension:function(ot){return t.extensions.indexOf(ot.toLowerCase())>=0},read:O,destroy:rt,_gl:W,_refresh:Tt,poll:function(){Pt(),Be&&Be.update()},now:nt,stats:Me});return L.onDone(null,St),St}return Zl})}(regl$2)),regl$2.exports}var reglExports=requireRegl();const regl=getDefaultExportFromCjs(reglExports),Mouse=mouseListen();class HydraRenderer{constructor({pb:y=null,width:d=1280,height:m=720,numSources:S=4,numOutputs:P=4,makeGlobal:ie=!0,autoLoop:Q=!0,detectAudio:he=!0,enableStreamCapture:te=!0,canvas:z,precision:ue,extendTransforms:D={}}={}){if(ArrayUtils.init(),this.pb=y,this.width=d,this.height=m,this.renderAll=!1,this.detectAudio=he,this._initCanvas(z),this.synth={time:0,bpm:30,width:this.width,height:this.height,fps:void 0,stats:{fps:0},speed:1,mouse:Mouse,render:this._render.bind(this),setResolution:this.setResolution.bind(this),update:ve=>{},hush:this.hush.bind(this),tick:this.tick.bind(this)},ie&&(window.loadScript=this.loadScript),this.timeSinceLastUpdate=0,this._time=0,ue&&["lowp","mediump","highp"].includes(ue.toLowerCase()))this.precision=ue.toLowerCase();else{let ve=(/iPad|iPhone|iPod/.test(navigator.platform)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1)&&!window.MSStream;this.precision=ve?"highp":"mediump"}if(this.extendTransforms=D,this.saveFrame=!1,this.captureStream=null,this.generator=void 0,this._initRegl(),this._initOutputs(P),this._initSources(S),this._generateGlslTransforms(),this.synth.screencap=()=>{this.saveFrame=!0},te)try{this.captureStream=this.canvas.captureStream(25),this.synth.vidRecorder=new VideoRecorder(this.captureStream)}catch(ve){console.warn(`[hydra-synth warning]
new MediaSource() is not currently supported on iOS.`),console.error(ve)}he&&this._initAudio(),Q&&loop(this.tick.bind(this)).start(),this.sandbox=new EvalSandbox(this.synth,ie,["speed","update","bpm","fps"])}eval(y){this.sandbox.eval(y)}getScreenImage(y){this.imageCallback=y,this.saveFrame=!0}hush(){this.s.forEach(y=>{y.clear()}),this.o.forEach(y=>{this.synth.solid(0,0,0,0).out(y)}),this.synth.render(this.o[0]),this.sandbox.set("update",y=>{})}loadScript(y=""){return new Promise((m,S)=>{var P=document.createElement("script");P.onload=function(){console.log(`loaded script ${y}`),m()},P.onerror=ie=>{console.log(`error loading script ${y}`,"log-error"),m()},P.src=y,document.head.appendChild(P)})}setResolution(y,d){this.canvas.width=y,this.canvas.height=d,this.width=y,this.height=d,this.sandbox.set("width",y),this.sandbox.set("height",d),console.log(this.width),this.o.forEach(m=>{m.resize(y,d)}),this.s.forEach(m=>{m.resize(y,d)}),this.regl._refresh(),console.log(this.canvas.width)}canvasToImage(y){const d=document.createElement("a");d.style.display="none";let m=new Date;d.download=`hydra-${m.getFullYear()}-${m.getMonth()+1}-${m.getDate()}-${m.getHours()}.${m.getMinutes()}.${m.getSeconds()}.png`,document.body.appendChild(d);var S=this;this.canvas.toBlob(P=>{S.imageCallback?(S.imageCallback(P),delete S.imageCallback):(d.href=URL.createObjectURL(P),console.log(d.href),d.click())},"image/png"),setTimeout(()=>{document.body.removeChild(d),window.URL.revokeObjectURL(d.href)},300)}_initAudio(){this.synth.a=new Audio({numBins:4,parentEl:this.canvas.parentNode})}_initCanvas(y){y?(this.canvas=y,this.width=y.width,this.height=y.height):(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.imageRendering="pixelated",document.body.appendChild(this.canvas))}_initRegl(){this.regl=regl({canvas:this.canvas,pixelRatio:1}),this.regl.clear({color:[0,0,0,1]}),this.renderAll=this.regl({frag:`
      precision ${this.precision} float;
      varying vec2 uv;
      uniform sampler2D tex0;
      uniform sampler2D tex1;
      uniform sampler2D tex2;
      uniform sampler2D tex3;

      void main () {
        vec2 st = vec2(1.0 - uv.x, uv.y);
        st*= vec2(2);
        vec2 q = floor(st).xy*(vec2(2.0, 1.0));
        int quad = int(q.x) + int(q.y);
        st.x += step(1., mod(st.y,2.0));
        st.y += step(1., mod(st.x,2.0));
        st = fract(st);
        if(quad==0){
          gl_FragColor = texture2D(tex0, st);
        } else if(quad==1){
          gl_FragColor = texture2D(tex1, st);
        } else if (quad==2){
          gl_FragColor = texture2D(tex2, st);
        } else {
          gl_FragColor = texture2D(tex3, st);
        }

      }
      `,vert:`
      precision ${this.precision} float;
      attribute vec2 position;
      varying vec2 uv;

      void main () {
        uv = position;
        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);
      }`,attributes:{position:[[-2,0],[0,-2],[2,2]]},uniforms:{tex0:this.regl.prop("tex0"),tex1:this.regl.prop("tex1"),tex2:this.regl.prop("tex2"),tex3:this.regl.prop("tex3")},count:3,depth:{enable:!1}}),this.renderFbo=this.regl({frag:`
      precision ${this.precision} float;
      varying vec2 uv;
      uniform vec2 resolution;
      uniform sampler2D tex0;

      void main () {
        gl_FragColor = texture2D(tex0, vec2(1.0 - uv.x, uv.y));
      }
      `,vert:`
      precision ${this.precision} float;
      attribute vec2 position;
      varying vec2 uv;

      void main () {
        uv = position;
        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);
      }`,attributes:{position:[[-2,0],[0,-2],[2,2]]},uniforms:{tex0:this.regl.prop("tex0"),resolution:this.regl.prop("resolution")},count:3,depth:{enable:!1}})}_initOutputs(y){const d=this;this.o=Array(y).fill().map((m,S)=>{var P=new Output({regl:this.regl,width:this.width,height:this.height,precision:this.precision,label:`o${S}`});return P.id=S,d.synth["o"+S]=P,P}),this.output=this.o[0]}_initSources(y){this.s=[];for(var d=0;d<y;d++)this.createSource(d)}createSource(y){let d=new HydraSource({regl:this.regl,pb:this.pb,width:this.width,height:this.height,label:`s${y}`});return this.synth["s"+this.s.length]=d,this.s.push(d),d}_generateGlslTransforms(){var y=this;this.generator=new GeneratorFactory({defaultOutput:this.o[0],defaultUniforms:this.o[0].uniforms,extendTransforms:this.extendTransforms,changeListener:({type:d,method:m,synth:S})=>{d==="add"&&(y.synth[m]=S.generators[m],y.sandbox&&y.sandbox.add(m))}}),this.synth.setFunction=this.generator.setFunction.bind(this.generator)}_render(y){y?(this.output=y,this.isRenderingAll=!1):this.isRenderingAll=!0}tick(y,d){if(this.sandbox.tick(),this.detectAudio===!0&&this.synth.a.tick(),this.sandbox.set("time",this.synth.time+=y*.001*this.synth.speed),this.timeSinceLastUpdate+=y,!this.synth.fps||this.timeSinceLastUpdate>=1e3/this.synth.fps){if(this.synth.stats.fps=Math.ceil(1e3/this.timeSinceLastUpdate),this.synth.update)try{this.synth.update(this.timeSinceLastUpdate)}catch(m){console.log(m)}for(let m=0;m<this.s.length;m++)this.s[m].tick(this.synth.time);for(let m=0;m<this.o.length;m++)this.o[m].tick({time:this.synth.time,mouse:this.synth.mouse,bpm:this.synth.bpm,resolution:[this.canvas.width,this.canvas.height]});this.isRenderingAll?this.renderAll({tex0:this.o[0].getCurrent(),tex1:this.o[1].getCurrent(),tex2:this.o[2].getCurrent(),tex3:this.o[3].getCurrent(),resolution:[this.canvas.width,this.canvas.height]}):this.renderFbo({tex0:this.output.getCurrent(),resolution:[this.canvas.width,this.canvas.height]}),this.timeSinceLastUpdate=0}this.saveFrame===!0&&(this.canvasToImage(),this.saveFrame=!1)}}const hydraUtils={hydra:null,isInitialized:!1,extensionsLoaded:!1,init:function(){if(!this.isInitialized)if(typeof HydraRenderer<"u"){this.setupHydra(),this.isInitialized=!0;return}else console.error("Hydra is not defined. Please ensure Hydra is loaded before using hydraUtils.")},setupHydra:function(){const canvas=document.getElementById("canvas");this.hydra=new HydraRenderer({canvas,detectAudio:!0,enableStreamCapture:!0,width:canvas.clientWidth,height:canvas.clientHeight}),eval("setResolution(canvas.clientWidth, canvas.clientHeight)"),eval("a.show()"),window.hydraSynth=this.hydra,this.loadHydraExtensions()},async loadHydraExtensions(){if(!this.extensionsLoaded)try{console.log("🔄 Loading Hydra extensions..."),await __vitePreload(()=>import("./hydra_extra_shader-X2H_kiQe.js"),[]),console.log("✅ Hydra Extra Shaders loaded"),await __vitePreload(()=>import("./hydraFractal-Dxhf6r4P.js"),[]),console.log("✅ Hydra Fractals loaded"),await __vitePreload(()=>import("./antlia-math-C4FlbSWj.js"),[]),console.log("✅ Hydra Antlia Math loaded"),await __vitePreload(()=>import("./antlia-shape-C8XBDYkF.js"),[]),console.log("✅ Hydra Antlia Shapes loaded"),await __vitePreload(()=>import("./hydraFCS-C7pUOJt8.js"),[]),console.log("✅ Hydra FCS loaded"),await __vitePreload(()=>import("./databending-_mY77tKK.js"),[]),console.log("✅ Hydra Databending loaded"),this.extensionsLoaded=!0,console.log("🎉 All Hydra extensions loaded successfully!")}catch(b){console.error("❌ Error loading Hydra extensions:",b)}},getBlock:function(b,y){const d=b.lineCount();let m=y,S=y;for(;m>0&&b.getLine(m-1).trim()!=="";)m--;for(;S<d-1&&b.getLine(S+1).trim()!=="";)S++;return{startLine:m,endLine:S}},evaluateCode:function(code){try{eval(code)}catch(b){this.showErrorFlash(b.message),console.error("Error evaluating code:",b)}},showErrorFlash:function(b){const y=document.querySelector(".error-flash");y&&y.remove();const d=document.createElement("div");d.className="error-flash",d.textContent=`Erreur: ${b}`,document.body.appendChild(d),setTimeout(()=>{d.parentNode&&d.remove()},3e3)},stopHydra:function(){eval("hush()")},incrementValue(b,y){const d=b.getCursor(),m=b.getLine(d.line);let S=d.ch,P=d.ch;for(;S>0&&/[\d\.\-]/.test(m.charAt(S-1));)S--;for(;P<m.length&&/[\d\.]/.test(m.charAt(P));)P++;let ie=m.substring(S,P);if(/^\.\d+$/.test(ie)&&(ie="0"+ie),/^-?\d+(\.\d+)?$/.test(ie)){let he;if(ie.includes(".")){const te=parseFloat(ie),z=ie.split(".")[1]||"",ue=z.length>0?z.length:1,D=ue>1?.01:.1;he=(te+y*D).toFixed(ue)}else{const te=parseInt(ie,10);Math.abs(te)>300?he=(te+y*100).toString():he=(te+y).toString()}b.replaceRange(he,{line:d.line,ch:S},{line:d.line,ch:P}),b.setCursor({line:d.line,ch:S+he.length})}},saveEditorContent(b){let y=b.getValue(),d="";d||(d=`hydraCode_${new Date().toISOString().replace(/[:.-]/g,"")}.js`);const m=new Blob([y],{type:"text/plain"}),S=URL.createObjectURL(m),P=document.createElement("a");P.href=S,P.download=d,P.click()},switchOutput(b=null){if(b===null)this.evaluateCode("render()"),document.getElementById("output-src").textContent="all";else{document.getElementById("output-src").textContent=`o${b}`;const y=`render(o${b})`;this.evaluateCode(y)}}},hydraAutocomplete={sources:[{text:"noise(10,0.1)",displayText:"noise"},{text:"voronoi(5,0.3,0.3)",displayText:"voronoi"},{text:"osc(60,0.1,0)",displayText:"osc"},{text:"shape(3,0.3,0.01)",displayText:"shape"},{text:"gradient(0)",displayText:"gradient"},{text:"solid(1,1,1,1)",displayText:"solid"},{text:"src(o0)",displayText:"src"}],implicitCurves:[{text:"iCardioid(1.0,1.0)",displayText:"iCardioid"},{text:"iBicorn(1.0,1.0,1.0)",displayText:"iBicorn"},{text:"iAstroid(1.0,1.0,1.0)",displayText:"iAstroid"},{text:"iCircle(1.0)",displayText:"iCircle"},{text:"iCassOval(1.0,1.0,1.0,1.0)",displayText:"iCassOval"},{text:"iSextic(1.0,1.0,1.0)",displayText:"iSextic"},{text:"iCochleoid(1.0,1.0,1.0)",displayText:"iCochleoid"},{text:"iCissoid(1.0,1.0,10.0)",displayText:"iCissoid"},{text:"iSluzeConchoid(1.0,3.0,1.0)",displayText:"iSluzeConchoid"},{text:"iDevil(1.0,4.0,1.0,3.0)",displayText:"iDevil"},{text:"iDFolium(1.0,3.0)",displayText:"iDFolium"},{text:"iSpiral(1.0,3.0,1.0)",displayText:"iSpiral"},{text:"iFermatSpiral(1.0,1.0,1.0)",displayText:"iFermatSpiral"},{text:"iFreethNephroid(1.0,1.0,2.0)",displayText:"iFreethNephroid"},{text:"iInvoluteCircle(1.0,10.0)",displayText:"iInvoluteCircle"}],parametricCurves:[{text:"pAstroid(src(o0),1.0)",displayText:"pAstroid"},{text:"pSpiral(src(o0),)",displayText:"pSpiral"},{text:"pCardioid(src(o0),1.0,2.0)",displayText:"pCardioid"},{text:"pConchoid(src(o0),1.0)",displayText:"pConchoid"},{text:"pEpicycloid(src(o0),1.0,1.0)",displayText:"pEpicycloid"},{text:"pDescartesFolium(src(o0),1.0,1.0)",displayText:"pDescartesFolium"},{text:"pHypocycloid(src(o0),1.0,2.0)",displayText:"pHypocycloid"},{text:"pHypotrochoid(src(o0),1.0,2.0,1.0)",displayText:"pHypotrochoid"},{text:"pInvoluteCircle(src(o0),1.0)",displayText:"pInvoluteCircle"},{text:"pCircle(src(o0),1.0)",displayText:"pCircle"},{text:"pLissajous(src(o0),5.0,1.0,1.0,0.0)",displayText:"pLissajous"},{text:"pNephroid(src(o0),1.0)",displayText:"pNephroid"},{text:"pPlateau(src(o0),2.0,1.0)",displayText:"pPlateau"},{text:"pTalbot(src(o0),1.0)",displayText:"pTalbot"}],parametricSurfaces:[{text:"pSphere(1.0,1.0)",displayText:"pSphere"},{text:"pMobiusStrip(1.0,1.0)",displayText:"pMobiusStrip"},{text:"pCylinder(1.0,1.0)",displayText:"pCylinder"},{text:"pKleinBottle(1.0,1.0)",displayText:"pKleinBottle"},{text:"pCrossCap(1.0,1.0)",displayText:"pCrossCap"},{text:"pSteiner(1.0,1.0)",displayText:"pSteiner"},{text:"pTorus(1.0,1.0,0.5)",displayText:"pTorus"}],implicitSurfaces:[{text:"iSphere()",displayText:"iSphere"},{text:"iCube()",displayText:"iCube"},{text:"iTorus(0.5,1.0)",displayText:"iTorus"},{text:"iPlane(1.0,1.0,1.0)",displayText:"iPlane"},{text:"iSteiner(1.0)",displayText:"iSteiner"},{text:"iWineGlass(3.2)",displayText:"iWineGlass"},{text:"iGenus2()",displayText:"iGenus2"}],inverseParametricSurfaces:[{text:"ipSphere(src(o0), 1.0)",displayText:"ipSphere"},{text:"ipTorus(src(o0),1.0)",displayText:"ipTorus"},{text:"ipMobiusStrip(src(o0))",displayText:"ipMobiusStrip"},{text:"ipCylinder(src(o0))",displayText:"ipCylinder"},{text:"ipKleinBottle(src(o0))",displayText:"ipKleinBottle"},{text:"ipCrossCap(src(o0)1.0)",displayText:"ipCrossCap"}],parametricHypersurfaces:[{text:"hpSphere(src(o0),1.0)",displayText:"hpSphere"},{text:"hpTorus(src(o0),1.0,0.5)",displayText:"hpTorus"},{text:"hpCone(src(o0),1.0)",displayText:"hpCone"},{text:"hpConeOblique(src(o0),1.0,1.0,1.0,1.0)",displayText:"hpConeOblique"}],explicitCurves:[{text:"eCircle(1.0,1.0)",displayText:"eCircle"},{text:"eBicorn(1.0)",displayText:"eBicorn"},{text:"eCatenary(1.0)",displayText:"eCatenary"},{text:"eCissoid(1.0,2.0)",displayText:"eCissoid"},{text:"eLame(2.0,2.5,3.0,2.0)",displayText:"eLame"},{text:"eNewton(2.0,0.4,1.0,0.8)",displayText:"eNewton"},{text:"ePearl(2.0,1.0,1.0,1.0,1.0,1.0)",displayText:"ePearl"},{text:"ePear(2.0,2.0,9.0)",displayText:"ePear"},{text:"eStrophoid(2.0,5.0)",displayText:"eStrophoid"},{text:"eTrisectrix(2.0,1.0)",displayText:"eTrisectrix"}],noise:[{text:"whitenoise(10.0,0.0)",displayText:"whitenoise"},{text:"colornoise(10.0,0.0)",displayText:"colornoise"},{text:"unoise(10.0,0.1)",displayText:"unoise"},{text:"turb(10.0,0.1,3.0)",displayText:"turb"},{text:"uturb(10.0,0.1,3.0)",displayText:"uturb"},{text:"warp(10.0,0.1,2.0,3.0,1.0)",displayText:"warp"},{text:"cwarp(10.0,0.1,2.0,3.0,1.0,0.5)",displayText:"cwarp"},{text:"ncontour(0.5,0.1,3,5.0,0.5,2.0)",displayText:"ncontour"}],art:[{text:"brick(0.25,0.08,0.01)",displayText:"brick"},{text:"checker(10.0)",displayText:"checker"},{text:"concentric(100.0,0.5,0.5)",displayText:"concentric"},{text:"hextile(10.0)",displayText:"hextile"},{text:"lissa(0.0,10.0,3.0,0.025)",displayText:"lissa"},{text:"pulse(0.5,0.05,0.001)",displayText:"pulse"},{text:"pulsetrain(3.0,0.5,0.05,0.001)",displayText:"pulsetrain"},{text:"spiral(1.0,5.0,0.1)",displayText:"spiral"},{text:"wave(0.0,10.0,3.0,0.025)",displayText:"wave"}],pattern:[{text:"blinking(5.0,5.0,0.5,0.03)",displayText:"blinking"},{text:"blobs(0.1,0.2,0.05)",displayText:"blobs"},{text:"concentric2(5.0,2.0,0.5,1.0)",displayText:"concentric2"},{text:"phasenoise(0,0.1,5.0,0.5,0.03)",displayText:"phasenoise"},{text:"sdfmove(0.73,1.0,-0.5)",displayText:"sdfmove"},{text:"smoothsun(0.3,0.2,1.0,0.5)",displayText:"smoothsun"}],antliaShapes:[{text:"circle(0.3,0.007)",displayText:"circle"},{text:"square(0.25,0)",displayText:"square"},{text:"rectangle(0.3,[1,1],0)",displayText:"rectangle"},{text:"triangle(0.3,0.007)",displayText:"triangle"},{text:"horiz(0.3,0.0007)",displayText:"horiz"},{text:"vert(0.3,0.0007)",displayText:"vert"},{text:"leftdiag(0.3,0.0007)",displayText:"leftdiag"},{text:"rightdiag(0.3,0.0007)",displayText:"rightdiag"},{text:"firstquad(1,1,1,1)",displayText:"firstquad"},{text:"secondquad(1,1,1,1)",displayText:"secondquad"},{text:"thirdquad(1,1,1,1)",displayText:"thirdquad"},{text:"fourthquad(1,1,1,1)",displayText:"fourthquad"},{text:"quad(0,1,1,1,1)",displayText:"quad"},{text:"star(0.3,5,0.007)",displayText:"star"},{text:"grid(8,4,0.05,0.001)",displayText:"grid"}],initSources:[{text:"s0.initCam()",displayText:"SrcWebCam"},{text:'s0.initImage("")',displayText:"SrcImage"},{text:'s0.initVideo("")',displayText:"SrcVideo"},{text:"s0.initScreen()",displayText:"SrcScreen"}],transformations:[{text:"add()",displayText:"add"},{text:"sub()",displayText:"sub"},{text:"mult()",displayText:"mult"},{text:"blend()",displayText:"blend"},{text:"diff()",displayText:"diff"},{text:"layer()",displayText:"layer"},{text:"mask()",displayText:"mask"},{text:"modulate()",displayText:"modulate"},{text:"modulateRepeat(src(o0),3,3,0.5,0.5)",displayText:"modulateRepeat"},{text:"modulateRepeatX(src(o0),3,0.5)",displayText:"modulateRepeatX"},{text:"modulateRepeatY(src(o0),3,0.5)",displayText:"modulateRepeatY"},{text:"modulateRotate(src(o0),1,0)",displayText:"modulateRotate"},{text:"modulateScale(src(o0),1,1)",displayText:"modulateScale"},{text:"modulatePixelate(src(o0),10,3)",displayText:"modulatePixelate"},{text:"modulateHue(src(o0),1)",displayText:"modulateHue"},{text:"modulateKaleid(src(o0),4)",displayText:"modulateKaleid"},{text:"modulateScrollX(src(o0),0.5,0)",displayText:"modulateScrollX"},{text:"modulateScrollY(src(o0),0.5,0)",displayText:"modulateScrollY"},{text:"out(o0)",displayText:"out"}],effects:[{text:"brightness(0.4)",displayText:"brightness"},{text:"contrast(1.6)",displayText:"contrast"},{text:"color(1,1,1)",displayText:"color"},{text:"colorama(0.005)",displayText:"colorama"},{text:"sum(1)",displayText:"sum"},{text:"r(1,0)",displayText:"r"},{text:"g(1,0)",displayText:"g"},{text:"b(1,0)",displayText:"b"},{text:"a(1,0)",displayText:"a"},{text:"invert(1)",displayText:"invert"},{text:"luma(0.5,0.1)",displayText:"luma"},{text:"posterize(3,0.6)",displayText:"posterize"},{text:"saturate(2)",displayText:"saturate"},{text:"hue(0.4)",displayText:"hue"},{text:"shift(0.1,0.1,0.1,0.1)",displayText:"shift"},{text:"thresh(0.5,0.04)",displayText:"thresh"},{text:"kaleid(4)",displayText:"kaleid"},{text:"pixelate(20,20)",displayText:"pixelate"},{text:"repeat(3,3,0,0)",displayText:"repeat"},{text:"repeatX(3,0)",displayText:"repeatX"},{text:"repeatY(3,0)",displayText:"repeatY"},{text:"rotate(10,0)",displayText:"rotate"},{text:"scale(1, screenRatio)",displayText:"scale"},{text:"scroll(0.5,0.5,0,0)",displayText:"scroll"},{text:"scrollX(0.5,0)",displayText:"scrollX"},{text:"scrollY(0.5,0)",displayText:"scrollY"}],colorEffects:[{text:"sepia(1.0)",displayText:"sepia"},{text:"levels(3.0,1.0)",displayText:"levels"},{text:"monotone(3.0,0.6,1.0)",displayText:"monotone"},{text:"hsvshift(0.0,1.0,1.0)",displayText:"hsvshift"},{text:"grarose(1.0)",displayText:"grarose"},{text:"grawave(1.0)",displayText:"grawave"},{text:"colcross(1.0)",displayText:"colcross"},{text:"coldot(1.0)",displayText:"coldot"},{text:"colboost(1.0)",displayText:"colboost"},{text:"colreflect(1.0)",displayText:"colreflect"}],databending:[{text:"databend(0.5,0.1,0.3)",displayText:"databend"},{text:"rgbshift(1.0,0.05,0.2)",displayText:"rgbshift"},{text:"pixelcorrupt(1.0,16.0,0.4)",displayText:"pixelcorrupt"},{text:"compress(1.0,8.0,0.3)",displayText:"compress"},{text:"glitchcoord(0.1,10.0,0.5)",displayText:"glitchcoord"},{text:"pixelsort(0.2,0.5,0.0)",displayText:"pixelsort"},{text:"memcorrupt(0.15,32.0,0.3)",displayText:"memcorrupt"},{text:"interlace(0.1,200.0,0.05)",displayText:"interlace"}],screenSpaceShaders:[{text:"dither()",displayText:"dither"},{text:"dither2()",displayText:"dither2"},{text:"dither4()",displayText:"dither4"},{text:"ditherrnd()",displayText:"ditherrnd"},{text:"ditherrndcolor()",displayText:"ditherrndcolor"},{text:"erode()",displayText:"erode"},{text:"dilate()",displayText:"dilate"},{text:"blur()",displayText:"blur"},{text:"blurmore()",displayText:"blurmore"},{text:"sharpen()",displayText:"sharpen"},{text:"emboss()",displayText:"emboss"},{text:"edge()",displayText:"edge"},{text:"sobelx()",displayText:"sobelx"},{text:"sobely()",displayText:"sobely"},{text:"pxsort(0.2, 0, 0, 1)",displayText:"pxsort"},{text:"pysort(0.2, 0, 0, 1)",displayText:"pysort"}],fractalEffects:[{text:"mirrorX(0,1)",displayText:"mirrorX"},{text:"mirrorY(0,1)",displayText:"mirrorY"},{text:"mirrorX2(0,1)",displayText:"mirrorX2"},{text:"mirrorY2(0,1)",displayText:"mirrorY2"},{text:"mirrorWrap()",displayText:"mirrorWrap"},{text:"polar(1.0, 1.0, 0.5, 0.5)",displayText:"polar"},{text:"inversion()",displayText:"inversion"}],utilities:[{text:"render(o0)",displayText:"render"},{text:"update = () => {}",displayText:"update"},{text:"setResolution(1920,1080)",displayText:"setResolution"},{text:"setFunction({})",displayText:"setFunction"},{text:"setBins(4)",displayText:"setBins"},{text:"setCutoff(4)",displayText:"setCutoff"},{text:"setSmooth(0.8)",displayText:"setSmooth"},{text:"setScale(2)",displayText:"setScale"},{text:"hide()",displayText:"hide"},{text:"show()",displayText:"show"}],mathFunctions:[{text:"()=>Math.sin(time)",displayText:"time"},{text:"()=>sinrange(time, 0,1,1,1)",displayText:"sinrange"},{text:"()=>cosrange(time, 0,1,1)",displayText:"cosrange"},{text:"()=>sinrange(time, 0,1,1)",displayText:"tanrange"},{text:"()=>sawrange(time, 0,1,1)",displayText:"sawrange"},{text:"()=>mouse.x",displayText:"mouse.x"},{text:"()=>mouse.y",displayText:"mouse.y"},{text:"()=>a.fft[0]",displayText:"a0"},{text:"()=>a.fft[1]",displayText:"a1"},{text:"()=>a.fft[2]",displayText:"a2"},{text:"()=>a.fft[3]",displayText:"a3"},{text:"Math.sin()",displayText:"sin"},{text:"Math.cos()",displayText:"cos"},{text:"Math.tan()",displayText:"tan"},{text:"saw()",displayText:"saw"},{text:"()=>sawt()",displayText:"sawt"},{text:"()=>bouncet(time, 3, 1, 8)",displayText:"bouncet"},{text:"Math.random()",displayText:"random"},{text:"rand(0,1)",displayText:"rand"},{text:"Math.PI",displayText:"Math.PI"},{text:"Math.abs()",displayText:"abs"},{text:"Math.floor()",displayText:"floor"},{text:"Math.ceil()",displayText:"ceil"},{text:"Math.round()",displayText:"round"},{text:"Math.min()",displayText:"min"},{text:"Math.max()",displayText:"max"},{text:"screenRatio",displayText:"sr"}],space:[{text:"invtile(0.5)",displayText:"invtile"},{text:"invsqrt(0.5)",displayText:"invsqrt"},{text:"abslog(1.0)",displayText:"abslog"},{text:"swave(1.0)",displayText:"swave"},{text:"centermag(0.4,0.2,0,0)",displayText:"centermag"}],arrayMethods:[{text:"smooth()",displayText:"smooth"},{text:"fast(1)",displayText:"fast"},{text:'ease("linear")',displayText:"ease"},{text:"offset(0)",displayText:"offset"},{text:"fit(0,1)",displayText:"fit"}],_currentView:"categories",_currentCategory:null,_completionWidget:null,categories:{"🔥 Sources":{items:"sources",blankOnly:!0},"🌊 Noise Functions":{items:"noise",blankOnly:!0},"🎨 Art Patterns":{items:"art",blankOnly:!0},"✨ Soft Patterns":{items:"pattern",blankOnly:!0},"🔷 Antlia Shapes":{items:"antliaShapes",blankOnly:!0},"📐 Implicit Curves FCS":{items:"implicitCurves",blankOnly:!0},"🌐 Parametric Surfaces FCS":{items:"parametricSurfaces",blankOnly:!0},"🔵 Implicit Surfaces FCS":{items:"implicitSurfaces",blankOnly:!1},"🔴 Inverse Parametric Surfaces FCS":{items:"inverseParametricSurfaces",blankOnly:!1},"🟢 Parametric Curves FCS":{items:"parametricCurves",blankOnly:!1},"🟣 Explicit Curves FCS":{items:"explicitCurves",blankOnly:!1},"🔶 Parametric Hypersurfaces FCS":{items:"parametricHypersurfaces",blankOnly:!1},"📺 Init Sources":{items:"initSources",blankOnly:!0},"🔄 Transformations":{items:"transformations",blankOnly:!1},"⚡ Effects":{items:"effects",blankOnly:!1},"🌌 Space Effects":{items:"space",blankOnly:!1},"🌈 Color Effects":{items:"colorEffects",blankOnly:!1},"💾 DataBending":{items:"databending",blankOnly:!1},"🌁 Screen Space Shaders":{items:"screenSpaceShaders",blankOnly:!1},"🪞 Fractal Effects":{items:"fractalEffects",blankOnly:!1},"🧮 Math & Audio":{items:"mathFunctions",blankOnly:!1},"🛠️ Utilities":{items:"utilities",blankOnly:!1}},createCategorySeparator:function(b,y){return{text:"",displayText:b+" →",className:"autocomplete-category-separator",categoryKey:y,render:function(d,m,S){d.className+=" autocomplete-category-separator",d.innerHTML=`<span class="category-text">${S.displayText}</span>`,d.style.cursor="pointer",d.setAttribute("data-category",S.categoryKey)},hint:function(d,m,S){return!1}}},createBackButton:function(){return{text:"",displayText:"← Retour aux catégories",className:"autocomplete-back-button",render:function(b,y,d){b.className+=" autocomplete-back-button",b.innerHTML=`<span class="back-text">${d.displayText}</span>`,b.style.cursor="pointer"},hint:function(b,y,d){return!1}}},hint:function(b,y){const d=b.getCursor(),m=b.getLine(d.line),S=m.slice(0,d.ch);if(b.getTokenAt(d),d.ch,this._currentView="categories",this._currentCategory=null,/\]\s*\.\s*[\w*]*$/.test(S)){const z=S.split(".").pop()||"",ue=S.lastIndexOf(".");return{list:this.filterWithWildcards(this.arrayMethods,z),from:y.Pos(d.line,ue+1),to:y.Pos(d.line,d.ch)}}if(/\.\s*[\w*]*$/.test(S)){const z=S.split(".").pop()||"",ue=S.lastIndexOf(".");if(z===""){const ve=[];return Object.keys(this.categories).forEach(Ge=>{if(!this.categories[Ge].blankOnly){const q=this.createCategorySeparator(Ge,Ge);ve.push(q)}}),{list:ve,from:y.Pos(d.line,ue+1),to:y.Pos(d.line,d.ch)}}const D=[...this.transformations,...this.effects,...this.colorEffects,...this.fractalEffects,...this.screenSpaceShaders,...this.space,...this.parametricCurves,...this.implicitSurfaces,...this.inverseParametricSurfaces,...this.parametricHypersurfaces,...this.explicitCurves,...this.databending];return{list:this.filterWithWildcards(D,z),from:y.Pos(d.line,ue+1),to:y.Pos(d.line,d.ch)}}if(S.trim()===""){const z=[];return Object.keys(this.categories).forEach(ue=>{if(this.categories[ue].blankOnly){const se=this.createCategorySeparator(ue,ue);z.push(se)}}),{list:z,from:y.Pos(d.line,d.ch),to:y.Pos(d.line,d.ch)}}let P="";d.ch;const ie=m.lastIndexOf(" ",d.ch-1)+1,Q=d.ch;P=m.slice(ie,Q);const he=[...this.sources,...this.noise,...this.art,...this.pattern,...this.antliaShapes,...this.implicitCurves,...this.parametricSurfaces,...this.initSources,...this.transformations,...this.effects,...this.colorEffects,...this.fractalEffects,...this.screenSpaceShaders,...this.space,...this.databending,...this.utilities,...this.mathFunctions];return{list:this.filterWithWildcards(he,P),from:y.Pos(d.line,ie),to:y.Pos(d.line,d.ch)}},filterWithWildcards:function(b,y){if(!y||y==="")return b;if(!y.includes("*"))return b.filter(m=>m.displayText.toLowerCase().includes(y.toLowerCase()));const d=this.createWildcardRegex(y);return b.filter(m=>d.test(m.displayText.toLowerCase()))},createWildcardRegex:function(b){if(!b)return/^$/;const y=b.toLowerCase().trim();if(!y)return/^$/;const d=y.replace(/[.+?^${}()|[\]\\]/g,"\\$&");let m;y.startsWith("*")&&y.endsWith("*")&&y.length>2?m=`.*${d.slice(1,-1)}.*`:y.startsWith("*")&&y.length>1?m=`.*${d.slice(1)}$`:y.endsWith("*")&&y.length>1?m=`^${d.slice(0,-1)}.*`:y.includes("*")?m=d.replace(/\*/g,".*"):m=`.*${d}.*`;try{return new RegExp(m,"i")}catch{return/.*/}},showCategoryItems:function(b,y){const d=this.categories[y];if(!d||!this[d.items])return null;const m=[this.createBackButton(),...this[d.items]];return this._currentView="items",this._currentCategory=y,{list:m,from:b.getCursor(),to:b.getCursor()}}};class HydraColorPicker{constructor(){this.hiddenInput=null,this.createHiddenInput()}createHiddenInput(){this.hiddenInput=document.createElement("input"),this.hiddenInput.type="color",this.hiddenInput.style.position="absolute",this.hiddenInput.style.left="-9999px",this.hiddenInput.style.opacity="0",this.hiddenInput.style.pointerEvents="none",this.hiddenInput.tabIndex=-1,document.body.appendChild(this.hiddenInput)}detectColorFunction(y){const d=y.getCursor(),m=y.getLine(d.line),S=/\.color\s*\(/g;let P;for(;(P=S.exec(m))!==null;){const ie=P.index,Q=P.index+P[0].length-1;let he=1,te=Q,z=!1;for(let ue=Q+1;ue<m.length&&he>0;ue++)if(m[ue]==="(")he++;else if(m[ue]===")"&&(he--,he===0)){te=ue,z=!0;break}if(d.ch>Q&&d.ch<=(z?te:m.length)){const ue=m.substring(Q+1,z?te:m.length),D=this.parseColorValues(ue);return{found:!0,start:{line:d.line,ch:ie},end:{line:d.line,ch:z?te+1:m.length},openParenPos:Q+1,closeParenPos:z?te:m.length,currentValues:D,isEmpty:ue.trim()===""}}}return{found:!1}}parseColorValues(y){const d=y.trim();if(d==="")return{r:1,g:0,b:0};const m=d.split(",").map(S=>{const P=parseFloat(S.trim());return isNaN(P)?0:Math.max(0,Math.min(1,P))});return{r:m[0]!==void 0?m[0]:1,g:m[1]!==void 0?m[1]:0,b:m[2]!==void 0?m[2]:0}}openNativeColorPicker(y,d,m){if(!d||!d.found){console.log("Place your cursor in a .color() function to use the color picker");return}const S=this.rgbToHex(d.currentValues.r,d.currentValues.g,d.currentValues.b);this.hiddenInput.value=S,this.handleColorChange&&(this.hiddenInput.removeEventListener("change",this.handleColorChange),this.hiddenInput.removeEventListener("input",this.handleColorChange)),this.handleColorChange=P=>{const ie=P.target.value,Q=this.hexToRgb(ie);m&&m(Q.r,Q.g,Q.b,d),this.hiddenInput.removeEventListener("change",this.handleColorChange),this.hiddenInput.removeEventListener("input",this.handleColorChange)},this.hiddenInput.addEventListener("change",this.handleColorChange),this.hiddenInput.addEventListener("input",this.handleColorChange);try{this.hiddenInput.showPicker?this.hiddenInput.showPicker():(console.log("showPicker() not supported, using fallback..."),this.openColorPickerFallback(y,d,m))}catch(P){console.log("Could not open color picker:",P),this.openColorPickerFallback(y,d,m)}}openColorPickerFallback(y,d,m){const S=document.createElement("div");S.style.cssText=`
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #0f1419, #1a1b26);
            border: 2px solid #4A90C2;
            border-radius: 8px;
            padding: 15px;
            z-index: 9999;
            font-family: 'Fira Code', monospace;
            color: #E8F4FD;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.8);
        `;const P=document.createElement("div");P.textContent="🎨 Color Picker",P.style.cssText="margin-bottom: 10px; text-align: center; font-weight: bold;";const ie=document.createElement("input");ie.type="color",ie.value=this.rgbToHex(d.currentValues.r,d.currentValues.g,d.currentValues.b),ie.style.cssText=`
            width: 80px; 
            height: 40px; 
            border: 2px solid #6BBFDF; 
            border-radius: 6px;
            cursor: pointer;
            display: block;
            margin: 0 auto 10px auto;
        `;const Q=document.createElement("div");Q.textContent="Press Escape to cancel",Q.style.cssText="font-size: 11px; text-align: center; opacity: 0.7;",S.appendChild(P),S.appendChild(ie),S.appendChild(Q),document.body.appendChild(S),ie.addEventListener("change",z=>{const ue=this.hexToRgb(z.target.value);m(ue.r,ue.g,ue.b,d),document.body.removeChild(S)}),ie.focus();const he=z=>{z.key==="Escape"&&(document.body.contains(S)&&document.body.removeChild(S),document.removeEventListener("keydown",he),document.removeEventListener("click",te))},te=z=>{S.contains(z.target)||(document.body.contains(S)&&document.body.removeChild(S),document.removeEventListener("keydown",he),document.removeEventListener("click",te))};document.addEventListener("keydown",he),setTimeout(()=>{document.addEventListener("click",te)},100)}rgbToHex(y,d,m){const S=P=>{const ie=Math.round(Math.max(0,Math.min(255,P*255))).toString(16);return ie.length===1?"0"+ie:ie};return`#${S(y)}${S(d)}${S(m)}`}hexToRgb(y){const d=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(y);return d?{r:parseInt(d[1],16)/255,g:parseInt(d[2],16)/255,b:parseInt(d[3],16)/255}:{r:0,g,b:0}}}const hydraColorPicker=new HydraColorPicker,sources={noise:`noise(scale, offset)
Generates Perlin noise. 
scale: noise scale (default: 10)
offset: noise offset (default: 0.1)`,voronoi:`voronoi(scale, speed, blending)
Generates a Voronoi pattern. 
scale: pattern scale (default: 5)
speed: animation speed (default: 0.3)
blending: edge smoothing (default: 0.3)`,osc:`osc(frequency, sync, offset)
Sinusoidal oscillator. 
frequency: oscillation frequency (default: 60)
sync: synchronization (default: 0.1)
offset: phase offset (default: 0)`,shape:`shape(sides, radius, smoothing)
Creates a geometric shape. 
sides: number of sides (default: 3)
radius: shape radius (default: 0.3)
smoothing: edge smoothing (default: 0.01)`,gradient:`gradient(speed)
Generates an animated gradient. 
speed: animation speed (default: 0)`,solid:`solid(r, g, b, a)
Creates a solid color. 
r,g,b: color components (0-1)
a: alpha channel (default: 1)`,src:`src(input)
Retrieves a video source. 
input: source name (o0-o3, s0-s3)`,whitenoise:`whitenoise(size, dynamic)
Black and white high frequency noise.
size: float (default: 10.0)
dynamic: float (default: 0.0)`,colornoise:`colornoise(size, dynamic)
Colored high frequency noise.
size: float (default: 10.0)
dynamic: float (default: 0.0)`,unoise:`unoise(scale, offset)
Unsigned Perlin noise scaled to 0..1.
scale: float (default: 10.0)
offset: float (default: 0.1)`,turb:`turb(scale, offset, octaves)
Turbulent noise (signed value).
scale: float (default: 10.0)
offset: float (default: 0.1)
octaves: float (default: 3.0)`,uturb:`uturb(scale, offset, octaves)
Unsigned turbulent noise scaled to 0..1.
scale: float (default: 10.0)
offset: float (default: 0.1)
octaves: float (default: 3.0)`,warp:`warp(scalei, offset, octaves, octavesinner, scale)
Domain warping noise.
scalei: float (default: 10.0)
offset: float (default: 0.1)
octaves: float (default: 2.0)
octavesinner: float (default: 3.0)
scale: float (default: 1.0)`,cwarp:`cwarp(scalei, offset, octaves, octavesinner, scale, focus)
Centered domain warping noise.
scalei: float (default: 10.0)
offset: float (default: 0.1)
octaves: float (default: 2.0)
octavesinner: float (default: 3.0)
scale: float (default: 1.0)
focus: float (default: 0.5)`,ncontour:`ncontour(thresh, smooth, octaves, scale, speed, step)
Contour from noise.
thresh: float (default: 0.5)
smooth: float (default: 0.1)
octaves: int (default: 3)
scale: float (default: 5.0)
speed: float (default: 0.5)
step: float (default: 2.0)`,brick:`brick(width, height, gap)
Brick pattern.

see: Ebert, Musgrave, Peachey, Perlin Worley
"Texturing and Modeling – A Procedural Approach"
Darwyn Peachey, Building Procedural Textures, page 37

width: float (default: 0.25)
height: float (default: 0.08)
gap: float (default: 0.01)`,checker:`checker()
Checkerboard pattern.

repeats: float (default: 10.0)`,concentric:`concentric(scale, centerX, centerY)
Concentric circles pattern.

scale: float (default: 100.0)
centerX: float (default: 0.5)
centerY: float (default: 0.5)`,hextile:`hextile(tiles)
Hex tiles pattern.

tiles: float (default: 10.0)`,lissa:`lissa(time, frequ, loops, thick)
Lissajous curve pattern.

time: float (default: 0.0)
frequ: float (default: 10.0)
loops: float (default: 3.0)
thick: float (default: 0.025)`,pulse:`pulse(edge, width, epsilon)
Pulse pattern.

edge: float (default: 0.5)
width: float (default: 0.05)
epsilon: float (default: 0.001)`,pulsetrain:`pulsetrain(train, edge, width, epsilon)
Pulse train pattern.

train: float (default: 3.0)
edge: float (default: 0.5)
width: float (default: 0.05)
epsilon: float (default: 0.001)`,spiral:`spiral(a, b, thickness)
Spiral pattern.

a: float (default: 1.0)
b: float (default: 5.0)
thickness: float (default: 0.1)`,wave:`wave(time, frequ, loops, thick)
Wave pattern.

time: float (default: 0.0)
frequ: float (default: 10.0)
loops: float (default: 3.0)
thick: float (default: 0.025)`,blinking:`blinking(tiles, scale, speed, phase)
Blinking grid: Looks like a grid of colorful square lamps.
tiles: float (default: 5.0)
scale: float (default: 5.0)
speed: float (default: 0.5)
phase: float (default: 0.03)`,blobs:`blobs(speed, tresh, soft)
Three blobs are dancing around.
speed: float (default: 0.1)
tresh: float (default: 0.2)
soft: float (default: 0.05)`,concentric2:`concentric2(base, octaves, ampscale, speed)
Harmonic concentric rings pattern.
base: float (default: 5.0)
octaves: float (default: 2.0)
ampscale: float (default: 0.5)
speed: float (default: 1.0)`,phasenoise:`phasenoise(base, range, scale, speed, phase)
Noise in HSV with phase shifting.
base: float (default: 0.0)
range: float (default: 0.1)
scale: float (default: 5.0)
speed: float (default: 0.5)
phase: float (default: 0.03)`,sdfmove:`sdfmove(speed1, speed2, speed3)
Moving ramp pattern.
speed1: float (default: 0.73)
speed2: float (default: 1.0)
speed3: float (default: -0.5)`,smoothsun:`smoothsun(threshold, border, speed, ampscale)
Smooth sun pattern.
threshold: float (default: 0.3)
border: float (default: 0.2)
speed: float (default: 1.0)
ampscale: float (default: 0.5)`,iCardioid:`iCardioid(freq, a)
Cardioid implicit curve.
freq: animation frequency (default: 1.0)
a: shape parameter (default: 1.0)`,iBicorn:`iBicorn(freq, a_exp, a)
Bicorn implicit curve.
freq: animation frequency (default: 1.0)
a_exp: exponent parameter (default: 1.0)
a: shape parameter (default: 1.0)`,iAstroid:`iAstroid(freq, wrap, amp)
Astroid implicit curve.
freq: animation frequency (default: 1.0)
wrap: wrap parameter (default: 1.0)
amp: amplitude (default: 1.0)`,iCircle:`iCircle(freq)
Circle implicit curve.
freq: animation frequency (default: 1.0)`,iCassOval:`iCassOval(freq, mult, a, c)
Cassini oval implicit curve.
freq: animation frequency (default: 1.0)
mult: multiplier (default: 1.0)
a: shape parameter (default: 1.0)
c: constant (default: 1.0)`,iSextic:`iSextic(freq1, freq2, a)
Sextic curve.
freq1: first frequency (default: 1.0)
freq2: second frequency (default: 1.0)
a: shape parameter (default: 1.0)`,iCochleoid:`iCochleoid(freq1, freq2, a)
Cochleoid curve.
freq1: first frequency (default: 1.0)
freq2: second frequency (default: 1.0)
a: shape parameter (default: 1.0)`,iCissoid:`iCissoid(freq, a, wrap)
Cissoid curve.
freq: animation frequency (default: 1.0)
a: shape parameter (default: 1.0)
wrap: wrap parameter (default: 10.0)`,iSluzeConchoid:`iSluzeConchoid(freq, a, k)
Conchoid of de Sluze.
freq: animation frequency (default: 1.0)
a: shape parameter (default: 3.0)
k: constant (default: 1.0)`,iDevil:`iDevil(freq, wrap, k, a)
Devil curve.
freq: animation frequency (default: 1.0)
wrap: wrap parameter (default: 4.0)
k: shape parameter (default: 1.0)
a: scale parameter (default: 3.0)`,iDFolium:`iDFolium(freq, a)
Descartes folium.
freq: animation frequency (default: 1.0)
a: shape parameter (default: 3.0)`,iSpiral:`iSpiral(freq, a, b)
Spiral curve.
freq: animation frequency (default: 1.0)
a: spiral parameter (default: 3.0)
b: decay parameter (default: 1.0)`,iFermatSpiral:`iFermatSpiral(freq, a, b)
Fermat spiral.
freq: animation frequency (default: 1.0)
a: scale parameter (default: 1.0)
b: spiral parameter (default: 1.0)`,iFreethNephroid:`iFreethNephroid(freq1, freq2, a)
Freeth nephroid.
freq1: first frequency (default: 1.0)
freq2: second frequency (default: 1.0)
a: scale parameter (default: 2.0)`,iInvoluteCircle:`iInvoluteCircle(freq, wrap)
Involute of circle.
freq: animation frequency (default: 1.0)
wrap: wrap parameter (default: 10.0)`,pSphere:`pSphere(freq, a)
Parametric sphere.
freq: animation frequency (default: 1.0)
a: radius (default: 1.0)`,pMobiusStrip:`pMobiusStrip(freq, a)
Mobius strip.
freq: animation frequency (default: 1.0)
a: width parameter (default: 1.0)`,pCylinder:`pCylinder(freq, a)
Parametric cylinder.
freq: animation frequency (default: 1.0)
a: radius (default: 1.0)`,pKleinBottle:`pKleinBottle(freq, aa)
Klein bottle.
freq: animation frequency (default: 1.0)
aa: shape parameter (default: 1.0)`,pCrossCap:`pCrossCap(freq, aa)
Cross cap surface.
freq: animation frequency (default: 1.0)
aa: scale parameter (default: 1.0)`,pSteiner:`pSteiner(freq, aa)
Steiner surface.
freq: animation frequency (default: 1.0)
aa: scale parameter (default: 1.0)`,pTorus:`pTorus(freq, a, c)
Parametric torus.
freq: animation frequency (default: 1.0)
a: tube radius (default: 1.0)
c: torus radius (default: 0.5)`},initSources={initCam:`s0.initCam()
Initializes webcam as video source`,initImage:`s0.initImage(url)
Initializes an image as video source`,initVideo:`s0.initVideo(url)
Initializes a video as video source`,initScreen:`s0.initScreen()
Initializes screen capture as video source`},transformations={add:`add(texture, amount)
Adds a texture with another. 
texture: texture to add 
amount: addition strength (default: 1)`,sub:`sub(texture, amount)
Subtracts a texture from another. 
texture: texture to subtract 
amount: subtraction strength (default: 1)`,mult:`mult(texture, amount)
Multiplies a texture with another. 
texture: multiplicative texture 
amount: multiplication strength (default: 1)`,blend:`blend(texture, amount)
Blends a texture with another. 
texture: texture to blend 
amount: blend strength (default: 0.5)`,diff:`diff(texture)
Creates absolute difference between two textures. 
texture: texture to compare`,layer:`layer(texture)
Layers a texture on top of another. 
texture: texture to layer`,mask:`mask(texture)
Masks a texture with another. 
texture: masking texture (black = transparent, white = opaque)`,modulate:`modulate(texture, amount)
Modulates UV coordinates with a texture. 
texture: modulation texture 
amount: modulation intensity (default: 0.1)`,modulateRepeat:`modulateRepeat(texture, repeatX, repeatY, offsetX, offsetY)
Repeats texture using brightness of another. 
texture: modulation texture 
repeatX/Y: number of repetitions (default: 3) 
offsetX/Y: offset (default: 0.5)`,modulateRotate:`modulateRotate(texture, multiple, offset)
Rotates texture based on brightness of another. 
texture: modulation texture 
multiple: rotation multiplier (default: 1) 
offset: rotation offset (default: 0)`,modulateScale:`modulateScale(texture, multiple, offset)
Scales texture based on brightness of another. 
texture: modulation texture 
multiple: scale multiplier (default: 1) 
offset: scale offset (default: 1)`,modulatePixelate:`modulatePixelate(texture, multiple, offset)
Pixelates texture based on brightness of another. 
texture: modulation texture 
multiple: pixelation multiplier (default: 10) 
offset: pixelation offset (default: 3)`,modulateKaleid:`modulateKaleid(texture, nSides)
Applies modulated kaleidoscope effect. 
texture: modulation texture 
nSides: number of sides (default: 4)`,modulateScrollX:`modulateScrollX(texture, scrollX, speed)
Modulated horizontal scrolling. 
texture: modulation texture 
scrollX: scroll amount (default: 0.5) 
speed: scroll speed (default: 0)`,modulateScrollY:`modulateScrollY(texture, scrollY, speed)
Modulated vertical scrolling. 
texture: modulation texture 
scrollY: scroll amount (default: 0.5) 
speed: scroll speed (default: 0)`,out:`out(buffer)
Sends result to an output buffer. 
buffer: destination buffer (o0-o3, default: o0)`},effects={brightness:`brightness(amount)
Adjusts brightness. 
amount: brightness level (default: 0.4)`,contrast:`contrast(amount)
Adjusts contrast. 
amount: contrast level (default: 1.6)`,color:`color(r, g, b)
Adjusts RGB colors. 
r, g, b: channel multipliers (default: 1)`,colorama:`colorama(amount)
Shifts HSV colors. 
amount: shift intensity (default: 0.005)`,invert:`invert(amount)
Inverts colors. 
amount: inversion intensity (default: 1)`,luma:`luma(threshold, tolerance)
Filters by brightness. 
threshold: threshold (default: 0.5) 
tolerance: tolerance (default: 0.1)`,posterize:`posterize(bins, gamma)
Reduces number of colors. 
bins: number of levels (default: 3) 
gamma: gamma adjustment (default: 0.6)`,saturate:`saturate(amount)
Adjusts saturation. 
amount: saturation level (default: 2)`,hue:`hue(amount)
Shifts hue. 
amount: shift amount (default: 0.4)`,thresh:`thresh(threshold, tolerance)
Thresholds pixels. 
threshold: threshold (default: 0.5) 
tolerance: tolerance (default: 0.04)`,kaleid:`kaleid(nSides)
Kaleidoscope effect. 
nSides: number of sides (default: 4)`,pixelate:`pixelate(pixelX, pixelY)
Pixelates the image. 
pixelX, pixelY: pixel size (default: 20, 20)`,repeat:`repeat(repeatX, repeatY, offsetX, offsetY)
Repeats the image. 
repeatX, repeatY: number of repetitions (default: 3, 3) 
offsetX, offsetY: offset (default: 0, 0)`,repeatX:`repeatX(reps, offset)
Repeats image horizontally. 
reps: number of repetitions (default: 3) 
offset: offset (default: 0)`,repeatY:`repeatY(reps, offset)
Repeats image vertically. 
reps: number of repetitions (default: 3) 
offset: offset (default: 0)`,rotate:`rotate(angle, speed)
Rotates the image. 
angle: angle in radians (default: 10) 
speed: rotation speed (default: 0)`,scale:`scale(amount, xMult, yMult, offsetX, offsetY)
Scales the image. 
amount: size (default: 1.5) 
xMult, yMult: x/y multipliers (default: 1, 1) 
offsetX, offsetY: center offset (default: 0.5, 0.5)`,scrollX:`scrollX(scrollX, speed)
Horizontal scrolling. 
scrollX: scroll amount (default: 0.5) 
speed: speed (default: 0)`,scrollY:`scrollY(scrollY, speed)
Vertical scrolling. 
scrollY: scroll amount (default: 0.5) 
speed: speed (default: 0)`},utilities={render:`render(buffer)
Displays a buffer on screen. 
buffer: buffer to render (default: o0)`,update:`update = callback => {...}
Adds a function to execute each frame`,setResolution:`setResolution(width, height)
Adjusts canvas resolution`,setFunction:`setFunction(objects)
Defines custom functions`,setBins:`setBins(numBins)
Sets number of bins for audio analysis`,setCutoff:`setCutoff(cutoff)
Sets threshold value for audio analysis`,setSmooth:`setSmooth(smooth)
Sets smoothing for audio analysis`,setScale:`setScale(scale)
Sets scale for audio analysis`,hide:`hide()
Hides the canvas`,show:`show()
Shows the canvas`},arrayMethods={smooth:`array.smooth()
Smoothes transitions between values in an array`,fast:`array.fast(speed)
Controls value change speed. 
speed: speed (default: 1)`,ease:`array.ease(easing)
Applies easing function. 
easing: easing type (default: "linear")`,offset:`array.offset(amount)
Shifts values by a constant. 
amount: offset value`,fit:`array.fit(low, high)
Rescales values to a range. 
low, high: destination range`},mathFunctions={time:`time
Variable that increments automatically`,sinrange:`sinrange(x, min, max, freq)
Sine wave in a range. 
x: time or value 
min: minimum value (default: 0)
max: maximum value (default: 1)
freq: frequency (default: 1)`,cosrange:`cosrange(x, min, max, freq)
Cosine wave in a range. 
x: time or value 
min: minimum value (default: 0)
max: maximum value (default: 1)
freq: frequency (default: 1)`,tanrange:`tanrange(x, min, max, freq)
Tangent wave in a range. 
x: time or value 
min: minimum value (default: 0)
max: maximum value (default: 1)
freq: frequency (default: 1)`,mouse:`mouse
Mouse position (x and y between 0 and 1)`,"a.fft":`a.fft[index]
Accesses audio frequency analysis`,sin:`Math.sin(x)
Calculates sine of x`,cos:`Math.cos(x)
Calculates cosine of x`,tan:`Math.tan(x, amp=3, freq=1)
Calculates tangent of x`,saw:`Math.saw(x)
Generates sawtooth wave. 
x: time or value`,sawt:`Math.sawt(amp=3, freq=1)
Generates sawtooth wave with time. 
x: time or value`,random:`Math.random()
Generates random number between 0 and 1`,"Math.PI":`Math.PI
Constant π (3.14159...)`,rand:`rand(min, max)
Generates random number between min and max. 
min: minimum value (default: 0) 
max: maximum value (default: 1)`,bouncet:`bouncet(t, amp=3, freq=1, bouncing=8)
Generates bouncing effect. 
t: time or value 
amp: amplitude (default: 3) 
freq: frequency (default: 1) 
bouncing: number of bounces (default: 8)`,screenRatio:`screenRatio
Aspect ratio of the screen (height/width)`},colorEffects={sepia:`sepia(amount)
Applies sepia tone effect. 
amount: sepia intensity (default: 1.0)`,levels:`levels(levels, amount)
Reduces color levels while preserving light-dark dynamics. 
levels: number of color levels (default: 3.0) 
amount: effect intensity (default: 1.0)`,monotone:`monotone(levels, hue, amount)
Creates monotone effect with specified hue. 
levels: number of levels (default: 3.0) 
hue: color hue 0-1 (default: 0.6) 
amount: effect intensity (default: 1.0)`,hsvshift:`hsvshift(hue, saturation, value)
Shifts HSV color values. 
hue: hue shift 0-1 (default: 0.0) 
saturation: saturation multiplier (default: 1.0) 
value: brightness multiplier (default: 1.0)`,grarose:`grarose(amount)
Applies rose gradient to grayscale conversion. 
amount: gradient intensity (default: 1.0)`,grawave:`grawave(amount)
Applies wave gradient creating color bands. 
amount: gradient intensity (default: 1.0)`,colcross:`colcross(amount)
Applies RGB cross product for strong color effects. 
amount: effect intensity (default: 1.0)`,coldot:`coldot(amount)
Applies RGB dot product of rotated channels. 
amount: effect intensity (default: 1.0)`,colboost:`colboost(amount)
Boosts colors using vector operations. 
amount: boost intensity (default: 1.0)`,colreflect:`colreflect(amount)
Creates color reflection effect. 
amount: reflection intensity (default: 1.0)`,databend:`databend(amount, shift, corruption)
Simulates digital data corruption with bit shifting. 
amount: corruption intensity (default: 0.5) 
shift: channel shift amount (default: 0.1) 
corruption: digital noise level (default: 0.3)`,rgbshift:`rgbshift(amount, offset, chaos)
Separates and corrupts RGB channels. 
amount: effect intensity (default: 1.0) 
offset: channel separation (default: 0.05) 
chaos: corruption chaos level (default: 0.2)`,pixelcorrupt:`pixelcorrupt(amount, blocksize, corruption)
Corrupts pixels in blocks with various digital artifacts. 
amount: effect intensity (default: 1.0) 
blocksize: corruption block size (default: 16.0) 
corruption: corruption probability (default: 0.4)`,compress:`compress(amount, quality, blockiness)
Simulates JPEG-like compression artifacts. 
amount: effect intensity (default: 1.0) 
quality: compression quality levels (default: 8.0) 
blockiness: blocking artifact intensity (default: 0.3)`},screenSpaceShaders={dither:`dither()
Applies black and white ordered dithering.`,dither2:`dither2()
Applies ordered dithering with a 2x2 Bayer matrix for color reduction.`,dither4:`dither4()
Applies ordered dithering with a 4x4 Bayer matrix to preserve more colors.`,ditherrnd:`ditherrnd()
Applies black and white random dithering.`,ditherrndcolor:`ditherrndcolor()
Applies random dithering preserving some colors.`,erode:`erode()
Morphological erode operator.`,dilate:`dilate()
Morphological dilate operator.`,blur:`blur()
Applies a 3x3 Gaussian blur.`,blurmore:`blurmore()
Applies a 5x5 Gaussian blur.`,sharpen:`sharpen()
Applies a sharpening filter.`,emboss:`emboss()
Applies an embossing filter.`,edge:`edge()
Applies an edge detection filter.`,sobelx:`sobelx()
Applies a Sobel filter in the X direction.`,sobely:`sobely()
Applies a Sobel filter in the Y direction.`,pxsort:`pxsort(threshold, frame, dirX, dirY)
Sorts pixels horizontally by brightness.
threshold: (default 0.2)
frame: (default 0)
dirX: (default 0)
dirY: (default 1)`,pysort:`pysort(threshold, frame, dirX, dirY)
Sorts pixels vertically by brightness.
threshold: (default 0.2)
frame: (default 0)
dirX: (default 0)
dirY: (default 1)`},fractalEffects={mirrorX:`mirrorX(pos, coverage)
Mirrors image horizontally from position. 
pos: mirror position (default: 0) 
coverage: effect coverage (default: 1) 
Result: [1234|4321]`,mirrorY:`mirrorY(pos, coverage)
Mirrors image vertically from position. 
pos: mirror position (default: 0) 
coverage: effect coverage (default: 1) 
Same as mirrorX but on Y axis`,mirrorX2:`mirrorX2(pos, coverage)
Mirrors image horizontally from other side. 
pos: mirror position (default: 0) 
coverage: effect coverage (default: 1) 
Result: [8765|5678]`,mirrorY2:`mirrorY2(pos, coverage)
Mirrors image vertically from other side. 
pos: mirror position (default: 0) 
coverage: effect coverage (default: 1) 
Same as mirrorX2 but on Y axis`,mirrorWrap:`mirrorWrap()
Mirrors any out of bounds coordinates. 
Input: [-8,-7,-6,-5,-4,-3,-2,-1] [1,2,3,4,5,6,7,8] [9,10,11,12,13,14,15,16] 
Result: [87654321] [12345678] [87654321]`,polar:`polar(radius, angle, centerX, centerY)
Applies polar transformation. 
radius: radius multiplier (default: 1.0) 
angle: angle multiplier (default: 1.0) 
centerX: horizontal center (default: 0.5) 
centerY: vertical center (default: 0.5)`,inversion:`inversion()
Applies circular inversion transformation. 
Useful for creating fractal-like patterns.`,glitchcoord:`glitchcoord(amount, frequency, chaos)
Applies digital glitch distortions to coordinates. 
amount: distortion strength (default: 0.1) 
frequency: scanline frequency (default: 10.0) 
chaos: chaos factor (default: 0.5)`,pixelsort:`pixelsort(amount, threshold, direction)
Applies pixel sorting effect to coordinates. 
amount: sorting displacement (default: 0.2) 
threshold: sorting trigger threshold (default: 0.5) 
direction: sort direction 0=horizontal, 1=vertical (default: 0.0)`,memcorrupt:`memcorrupt(amount, blocksize, corruption)
Simulates memory corruption on coordinate space. 
amount: corruption strength (default: 0.15) 
blocksize: memory block size (default: 32.0) 
corruption: corruption probability (default: 0.3)`,interlace:`interlace(amount, lines, drift)
Applies interlace corruption effect. 
amount: effect strength (default: 0.1) 
lines: number of scanlines (default: 200.0) 
drift: horizontal drift amount (default: 0.05)`},antliaShapes={circle:`circle(s, smooth)
Creates a circular shape mask.
s: size (default: 0.3)
smooth: edge smoothing (default: 0.007)`,square:`square(s, smooth)
Creates a square shape mask.
s: size (default: 0.25)
smooth: edge smoothing (default: 0)`,rectangle:`rectangle(s, ratio, smooth)
Creates a rectangular shape mask.
s: size (default: 0.3)
ratio: aspect ratio array [width, height] (default: [1,1])
smooth: edge smoothing (default: 0)`,triangle:`triangle(s, smooth)
Creates a triangular shape mask.
s: size (default: 0.3)
smooth: edge smoothing (default: 0.007)`,horiz:`horiz(s, smooth)
Creates a horizontal strip.
s: size (default: 0.3)
smooth: edge smoothing (default: 0.0007)`,vert:`vert(s, smooth)
Creates a vertical strip.
s: size (default: 0.3)
smooth: edge smoothing (default: 0.0007)`,leftdiag:`leftdiag(s, smooth)
Creates a left diagonal strip.
s: size (default: 0.3)
smooth: edge smoothing (default: 0.0007)`,rightdiag:`rightdiag(s, smooth)
Creates a right diagonal strip.
s: size (default: 0.3)
smooth: edge smoothing (default: 0.0007)`,firstquad:`firstquad(r, g, b, a)
Creates a solid color in the first quadrant (top-right).
r,g,b,a: color components (default: 1,1,1,1)`,secondquad:`secondquad(r, g, b, a)
Creates a solid color in the second quadrant (top-left).
r,g,b,a: color components (default: 1,1,1,1)`,thirdquad:`thirdquad(r, g, b, a)
Creates a solid color in the third quadrant (bottom-left).
r,g,b,a: color components (default: 1,1,1,1)`,fourthquad:`fourthquad(r, g, b, a)
Creates a solid color in the fourth quadrant (bottom-right).
r,g,b,a: color components (default: 1,1,1,1)`,quad:`quad(i, r, g, b, a)
Creates a solid color in the specified quadrant.
i: quadrant index (0-3)
r,g,b,a: color components (default: 1,1,1,1)`,star:`star(s, v, smooth)
Creates a star shape.
s: size (default: 0.3)
v: number of points (default: 5)
smooth: edge smoothing (default: 0.007)`,grid:`grid(x, y, b, smooth)
Creates a grid pattern.
x: horizontal divisions (default: 8)
y: vertical divisions (default: 4)
b: border thickness (default: 0.05)
smooth: edge smoothing (default: 0.001)`},parametricCurves={pAstroid:`pAstroid(texture,a)
Parametric astroid curve.
a: scale parameter (default: 1.0)`,pSpiral:`pSpiral(texture,)
Parametric spiral curve.`,pCardioid:`pCardioid(texture,a, p)
Parametric cardioid curve.
a: scale parameter (default: 1.0)
p: parameter (default: 2.0)`,pConchoid:`pConchoid(texture,a)
Parametric conchoid curve.
a: shape parameter (default: 1.0)`,pEpicycloid:`pEpicycloid(texture,a, b)
Parametric epicycloid curve.
a: radius parameter (default: 1.0)
b: radius parameter (default: 1.0)`,pDescartesFolium:`pDescartesFolium(texture,a, b)
Parametric Descartes folium.
a: scale parameter (default: 1.0)
b: shape parameter (default: 1.0)`,pHypocycloid:`pHypocycloid(texture,a, b)
Parametric hypocycloid curve.
a: radius parameter (default: 1.0)
b: frequency parameter (default: 2.0)`,pHypotrochoid:`pHypotrochoid(texture,a, b, d)
Parametric hypotrochoid curve.
a: radius parameter (default: 1.0)
b: frequency parameter (default: 2.0)
d: distance parameter (default: 1.0)`,pInvoluteCircle:`pInvoluteCircle(texture,a)
Parametric involute of circle.
a: radius parameter (default: 1.0)`,pCircle:`pCircle(texture,a)
Parametric circle.
a: radius (default: 1.0)`,pLissajous:`pLissajous(texture,a, n, b, phase)
Parametric Lissajous curve.
a: amplitude parameter (default: 5.0)
n: frequency parameter (default: 1.0)
b: amplitude parameter (default: 1.0)
phase: phase shift (default: 0.0)`,pNephroid:`pNephroid(texture,a)
Parametric nephroid curve.
a: radius parameter (default: 1.0)`,pPlateau:`pPlateau(texture,m, n)
Parametric Plateau curve.
m: parameter (default: 2.0)
n: parameter (default: 1.0)`,pTalbot:`pTalbot(texture,a)
Parametric Talbot curve.
a: scale parameter (default: 1.0)`},implicitSurfaces={iSphere:`iSphere()
Implicit sphere surface.`,iCube:`iCube()
Implicit cube surface.`,iTorus:`iTorus(c, a)
Implicit torus surface.
c: minor radius (default: 0.5)
a: major radius (default: 1.0)`,iPlane:`iPlane(nx, ny, nz)
Implicit plane surface.
nx: normal x component (default: 1.0)
ny: normal y component (default: 1.0)
nz: normal z component (default: 1.0)`,iSteiner:`iSteiner(a)
Implicit Steiner surface.
a: shape parameter (default: 1.0)`,iWineGlass:`iWineGlass(k)
Implicit wine glass surface.
k: shape parameter (default: 3.2)`,iGenus2:`iGenus2()
Implicit genus-2 surface.`},inverseParametricSurfaces={ipSphere:`ipSphere(texture, a)
Inverse parametric sphere.
a: radius parameter (default: 1.0)`,ipTorus:`ipTorus(texture,a)
Inverse parametric torus.
a: shape parameter (default: 1.0)`,ipMobiusStrip:`ipMobiusStrip(texture)
Inverse parametric Mobius strip.`,ipCylinder:`ipCylinder(texture)
Inverse parametric cylinder.`,ipKleinBottle:`ipKleinBottle(texture)
Inverse parametric Klein bottle.`,ipCrossCap:`ipCrossCap(texture,a)
Inverse parametric cross cap.
a: scale parameter (default: 1.0)`},parametricHypersurfaces={hpSphere:`hpSphere(texture,a)
Parametric hypersphere.
a: radius parameter (default: 1.0)`,hpTorus:`hpTorus(texture,c, a)
Parametric hypertorus.
c: major radius (default: 1.0)
a: minor radius (default: 0.5)`,hpCone:`hpCone(texture,c)
Parametric hypercone.
c: shape parameter (default: 1.0)`,hpConeOblique:`hpConeOblique(texture,c, vx, vy, vz)
Parametric oblique hypercone.
c: shape parameter (default: 1.0)
vx: direction x (default: 1.0)
vy: direction y (default: 1.0)
vz: direction z (default: 1.0)`},explicitCurves={eCircle:`eCircle(freq, a)
Explicit circle curve.
freq: animation frequency (default: 1.0)
a: radius (default: 1.0)`,eBicorn:`eBicorn(freq)
Explicit bicorn curve.
freq: animation frequency (default: 1.0)`,eCatenary:`eCatenary(freq)
Explicit catenary curve.
freq: animation frequency (default: 1.0)`,eCissoid:`eCissoid(freq, a)
Explicit cissoid curve.
freq: animation frequency (default: 1.0)
a: shape parameter (default: 2.0)`,eLame:`eLame(freq, n, a, b)
Explicit Lamé curve.
freq: animation frequency (default: 2.0)
n: exponent (default: 2.5)
a: scale parameter (default: 3.0)
b: shape parameter (default: 2.0)`,eNewton:`eNewton(freq, g, a, b)
Explicit Newton diverging parabola.
freq: animation frequency (default: 2.0)
g: parameter (default: 0.4)
a: scale parameter (default: 1.0)
b: shape parameter (default: 0.8)`,ePearl:`ePearl(freq, k, a, n, m, p)
Explicit pearls of Sluze.
freq: animation frequency (default: 2.0)
k: scale parameter (default: 1.0)
a: shape parameter (default: 1.0)
n: exponent (default: 1.0)
m: power (default: 1.0)
p: parameter (default: 1.0)`,ePear:`ePear(freq, b, a)
Explicit pear-shaped quartic.
freq: animation frequency (default: 2.0)
b: scale parameter (default: 2.0)
a: shape parameter (default: 9.0)`,eStrophoid:`eStrophoid(freq, a)
Explicit strophoid curve.
freq: animation frequency (default: 2.0)
a: shape parameter (default: 5.0)`,eTrisectrix:`eTrisectrix(freq, a)
Explicit trisectrix of Maclaurin.
freq: animation frequency (default: 2.0)
a: scale parameter (default: 1.0)`},definitions={...sources,...initSources,...transformations,...effects,...colorEffects,...screenSpaceShaders,...fractalEffects,...antliaShapes,...utilities,...arrayMethods,...mathFunctions,...parametricCurves,...implicitSurfaces,...inverseParametricSurfaces,...parametricHypersurfaces,...explicitCurves};function showHydraDefinition(b){const y=b.getCursor(),d=b.getLine(y.line),S=b.getTokenAt(y).string,P=y.ch;document.querySelectorAll(".CodeMirror-tooltip").forEach(te=>removeTooltip(te));function Q(te,z){const ue=/([a-zA-Z_][a-zA-Z0-9_]*)\s*\(/g,D=[];let se;for(;(se=ue.exec(te))!==null;){const qe=se[1],q=se.index,A=se.index+se[0].length-1;let j=1,h=A;for(let _=A+1;_<te.length&&j>0;_++)te[_]==="("?j++:te[_]===")"&&j--,h=_;D.push({name:qe,start:q,openParen:A,closeParen:h})}let ve=null,Ge=-1;for(const qe of D)if(z>=qe.openParen&&z<=qe.closeParen){const q=qe.openParen;q>Ge&&(Ge=q,ve=qe.name)}return ve}let he=S;if(S.includes(".")){const te=S.split(".");he=te[te.length-1]}if(!definitions[he]||!he.match(/^[a-zA-Z_]/)){const te=Q(d,P);te&&(he=te)}if(definitions[he]){const te=definitions[he],z=makeTooltip(b,y,te);setTimeout(()=>removeTooltip(z),7e3)}}function makeTooltip(b,y,d){const m=document.createElement("div");m.className="CodeMirror-tooltip hydra-tooltip",m.textContent=d,document.body.appendChild(m);const S=b.cursorCoords(y,"page").left,P=S+m.offsetWidth,ie=document.documentElement.clientWidth;return P>ie?m.style.left=`${ie-m.offsetWidth-16}px`:m.style.left=`${S}px`,m.style.top=`${b.cursorCoords(y,"page").bottom}px`,m}function removeTooltip(b){b&&b.parentNode&&b.parentNode.removeChild(b)}function removeAllTooltips(){document.querySelectorAll(".CodeMirror-tooltip").forEach(y=>removeTooltip(y))}document.addEventListener("DOMContentLoaded",()=>{const b=localStorage.getItem("hydra-editor-content"),d=CodeMirror(document.getElementById("editor"),{value:b||"osc(20, 0.1, 0).out()",mode:"javascript",theme:"cobalt",keyMap:"sublime",lineNumbers:!1,autofocus:!0,autoCloseBrackets:!0,styleActiveLine:!0,styleSelectedText:!0,indentUnit:2,tabSize:2,matchBrackets:!0,autoCloseBrackets:!0,lineWrapping:!0});function m(){const z=d.getValue();localStorage.setItem("hydra-editor-content",z)}configPanel.init(d);const S=["initCam","initImage","initVideo","initScreen","render","setResolution","setBin","setCutoff","setSmooth","setScale","hide","show","p5","P5","hush"];function P(z){var{startLine:ue,endLine:D}=hydraUtils.getBlock(z,z.getCursor().line);let se=z.getRange({line:ue,ch:0},{line:D,ch:z.getLine(D).length});const ve=S.some(qe=>se.includes(qe));!/\.out\s*\(.*\)\s*;?$/m.test(se)&&!ve&&(se=se.trim(),se+=".out()",z.replaceRange(se,{line:ue,ch:0},{line:D,ch:z.getLine(D).length})),hydraUtils.evaluateCode(se),Q(ue,D),m()}function ie(z){var{startLine:ue,endLine:D}=hydraUtils.getBlock(z,z.getCursor().line);let se=z.getRange({line:ue,ch:0},{line:D,ch:z.getLine(D).length});hydraUtils.evaluateCode(se),Q(ue,D),m()}function Q(z,ue){for(let D=z;D<=ue;D++){const se=d.markText({line:D,ch:0},{line:D,ch:d.getLine(D).length},{className:"flash-highlight"});setTimeout(()=>se.clear(),200)}}function he(){console.log("Toggling editor visibility"),document.getElementById("editor").classList.toggle("hideEditor")}function te(z){const ue=hydraColorPicker.detectColorFunction(z);ue.found?hydraColorPicker.openNativeColorPicker(z,ue,(D,se,ve,Ge)=>{const qe=`${D.toFixed(2)}, ${se.toFixed(2)}, ${ve.toFixed(2)}`,q={line:Ge.start.line,ch:Ge.openParenPos},A={line:Ge.start.line,ch:Ge.closeParenPos};z.replaceRange(qe,q,A),P(z)}):console.log("Place your cursor in a .color() function to use the color picker")}d.addKeyMap({"Ctrl-Enter":function(z){P(z)},"Ctrl-Alt-Enter":function(z){ie(z)},"Cmd-Enter":function(z){P(z)},"Cmd-Alt-Enter":function(z){ie(z)},"Ctrl-Space":"autocomplete","Cmd-Space":"autocomplete","Ctrl-;":()=>{hydraUtils.stopHydra()},"Cmd-;":()=>{hydraUtils.stopHydra()},"Alt-X":z=>{z.toggleComment()},"Alt-Up":z=>{hydraUtils.incrementValue(z,1),P(z)},"Alt-Down":z=>{hydraUtils.incrementValue(z,-1),P(z)},"Alt-I":z=>{showHydraDefinition(z)},Esc:()=>{removeAllTooltips()},"Alt-H":z=>{he()},"Ctrl-S":z=>{hydraUtils.saveEditorContent(z)},"Cmd-S":z=>{hydraUtils.saveEditorContent(z)},"Ctrl-K":z=>{te(z)},"Cmd-K":z=>{te(z)},"Alt-1":()=>{hydraUtils.switchOutput(0)},"Alt-2":()=>{hydraUtils.switchOutput(1)},"Alt-3":()=>{hydraUtils.switchOutput(2)},"Alt-4":()=>{hydraUtils.switchOutput(3)},"Alt-5":()=>{hydraUtils.switchOutput()},"Alt-P":()=>{configPanel.togglePanel()}}),d.setOption("hintOptions",{hint:z=>hydraAutocomplete.hint(z,CodeMirror),completeSingle:!1,extraKeys:{Right:function(z,ue){const D=document.querySelector(".CodeMirror-hint-active");if(D){const se=D.getAttribute("data-category");if(se){const ve=hydraAutocomplete.showCategoryItems(z,se);ve&&(ue.close(),setTimeout(()=>{z.showHint({hint:()=>ve,completeSingle:!1,extraKeys:{Left:function(Ge,qe){qe.close(),setTimeout(()=>{Ge.showHint()},50)}}})},50))}}},Left:function(z,ue){const D=ue.data[ue.selectedHint];D&&D.displayText&&D.displayText.includes("Retour aux catégories")&&(ue.close(),setTimeout(()=>{z.showHint()},50))}}}),window.addEventListener("beforeunload",()=>{m()});try{hydraUtils.init(),console.log("Hydra initialized successfully.")}catch(z){console.error("Error initializing Hydra:",z)}});
